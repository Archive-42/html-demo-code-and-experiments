<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="netlify-search-index-plugin">Netlify Search Index Plugin</h1>
<p>Generate a Search Index you can query via a static JSON blob or a Netlify Function!</p>
<p>You may not need this - There are other ways to add search to your site, like using Algolia or <a href="https://www.hawksworx.com/blog/adding-search-to-a-jamstack-site/">Vanilla JS with a custom search Index</a>.</p>
<p>However, you may wish to have a way to generate this index based ONLY on crawling your generated static site, or you may wish to do <strong>index searches in a serverless function</strong> instead of making your user download the entire index and run clientside.</p>
<h2 id="demo">Demo</h2>
<ul>
<li>Demo site: https://netlify-plugin-search-index.netlify.app</li>
<li>Demo search function: https://netlify-plugin-search-index.netlify.app/.netlify/functions/search?s=web</li>
<li>Demo JSON blob: https://netlify-plugin-search-index.netlify.app/searchIndex.json</li>
</ul>
<h2 id="usage">Usage</h2>
<p>To install, add the plugin in your <code>netlify.toml</code>. No config is required but we show the default options here.</p>
<details>
<p><summary><b>Generating both serverless function and clientside JSON</b></summary></p>
<pre class="toml"><code>[[build]]
  functions = functions # must specify a functions folder for this to work
[[plugins]]
  package = netlify-plugin-search-index
    # all inputs is optional, we just show you the defaults below
    # [plugins.inputs]
      # ignore = [&quot;/ignore-this-file.html&quot;] # don&#39;t index this file
      # generatedFunctionName = search # change the name of generated folder in case of conflicts, use `null` to turn off
      # publishDirJSONFileName = searchIndex # also use null to turn off</code></pre>
</details>
<p>Without config, this would generate:</p>
<ul>
<li>a function at <code>https://yoursite.netlify.com/.netlify/functions/search</code> and</li>
<li>a clientside JSON blob at <code>https://yoursite.netlify.com/searchIndex.json</code></li>
</ul>
<details>
<p><summary><b>Generating serverless function only</b></summary></p>
<p>To use this plugin only for the generated serveless function, supply <code>null</code> to the <code>publishDirJSONFileName</code>:</p>
<pre class="toml"><code>[[plugins]]
  package = netlify-plugin-search-index
    [plugins.inputs]
      generatedFunctionName = mySearchFunction
      publishDirJSONFileName = null</code></pre>
<p>This would generate a Netlify function at <code>https://yoursite.netlify.com/.netlify/functions/mySearchFunction</code> which you can query with <code>https://yoursite.netlify.com/.netlify/functions/mySearchFunction?search=foo</code>.</p>
</details>
<details>
<p><summary><b>Generating clientside JSON only</b></summary></p>
<p>To use this plugin only for the clientside JSON file, supply <code>null</code> to the <code>generatedFunctionName</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yml"><code class="sourceCode yaml"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">[[</span>plugins<span class="kw">]]</span></a>
<a class="sourceLine" id="cb3-2" title="2">  package = netlify-plugin-search-index</a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="kw">[</span>plugins.inputs<span class="kw">]</span> = </a>
<a class="sourceLine" id="cb3-4" title="4">      generatedFunctionName = null</a>
<a class="sourceLine" id="cb3-5" title="5">      publishDirJSONFileName = mySearchIndex <span class="co"># you can use / to nest in a directory</span></a></code></pre></div>
<p>This would generate a clientside JSON at <code>https://yoursite.netlify.com/mySearchIndex.json</code>.</p>
</details>
<p>Supplying <code>null</code> to both <code>generatedFunctionName</code> and <code>publishDirJSONFileName</code> would be meaningless (because there would be nothing to generate) and cause an error.</p>
<h2 id="more-options">More options</h2>
<h4 id="exclude-files">Exclude files</h4>
<p>Your project probably contains some content files that you don’t want your users to search. Pass an array of paths (or regex) to the files you don’t want to be indexed to dismiss them:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yml"><code class="sourceCode yaml"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">[[</span>plugins<span class="kw">]]</span></a>
<a class="sourceLine" id="cb4-2" title="2">  package = netlify-plugin-search-index</a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="kw">[</span>plugins.inputs<span class="kw">]</span> = </a>
<a class="sourceLine" id="cb4-4" title="4">      exclude = <span class="kw">[</span><span class="st">&#39;/ignore-this-file.html&#39;</span><span class="kw">,</span> /^\/devnull\/.<span class="dt">*/]</span></a></code></pre></div>
<h4 id="search-params">Search params</h4>
<p>At the moment of writing, it is not possible to pass custom options to FuseJS. If it’s something that you would like to see implemented, let us know! ✌️</p>
<h2 id="what-it-does">What It Does</h2>
<p>After your project is built:</p>
<ul>
<li>this plugin goes through your HTML files</li>
<li>extracts their metadata (title, description, keywords) with <a href="https://unifiedjs.com/"><code>unified</code></a></li>
<li>converts them to searchable content, weighted by field type</li>
<li>stores them as a JSON blob in <code>/searchIndex/searchIndex.json</code></li>
<li>generates a <a href="https://docs.netlify.com/functions/overview/?utm_source=twitter&amp;utm_medium=laddersblog-swyx&amp;utm_campaign=devex">Netlify Function</a> that fuzzy searches against a query string with <a href="https://fusejs.io/">fuse.js</a></li>
</ul>
<p>You can use this plugin in two ways:</p>
<ul>
<li><strong>Client-side</strong>: You can simple require the JSON blob in your clientside JavaScript if it isn’t too big: <code>js   // app.js   import searchIndex from './searchIndex.json'</code></li>
<li><strong>Serverless-side</strong>: You can use the generated function that reads the JSON and returns fuzzy search results to be lighter on your frontend. The generated function is available at <code>.netlify/functions/searchIndex</code> and you can use it with a search term like <code>.netlify/functions/searchIndex?s=foo</code> or <code>.netlify/functions/searchIndex?search=foo</code>: <code>js   // app.js   document.getElementById('myForm').addEventListener('submit', async event =&gt; {     event.preventDefault()     const result = await fetch(`/.netlify/functions/searchIndex?search=${event.target.searchText.value}&amp;limit=25`).then(x =&gt; x.json())     document.getElementById('result').innerText = JSON.stringify(result, null, 2)   })</code></li>
</ul>
<p>You can use an optional <code>limit</code> parameter to limit the length of returned results.</p>
<p>Under the hood, the search function uses <a href="https://fusejs.io/">fuse.js</a> and in future we may expose more configurations for this.</p>
<h2 id="notes-for-contributors">Notes for contributors</h2>
<p>We had to use <a href="https://github.com/ds300/patch-package">patch-package</a> to fix this bug: https://github.com/paulmillr/readdirp/issues/157 - <code>readdirp</code> is a dependency of `<code>copy-template-dir</code> which we use.</p>
<p>Hopefully it will be resolved or we can just fork <code>copy-template-dir</code> entirely locally.</p>
<h2 id="future-plans">Future plans</h2>
<p>WE ARE SEEKING MAINTAINERS.</p>
<p>Micro Todo: - expose fuse.js and html parse search options for more configurability - filtering results - support non html files?</p>
</body>
</html>
