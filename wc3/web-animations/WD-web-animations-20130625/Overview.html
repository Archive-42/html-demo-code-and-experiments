<!DOCTYPE html>
<html lang="en" dir="ltr">
<head><script src='MathJax/MathJax.js?config=MML_SVGorMML,local/local' type='text/javascript'></script>
    <title>Web Animations 1.0</title>
    <meta charset="utf-8">
    
    
    
    <!--
      ReSpec.js wishlist:

      Add here any issues you find with ReSpec including missing features. It
      will help us decide if we should continue using it and work out what we
      need to fix.

      * Allow making cross-references to specific methods and members.
    -->
  <link href="respec.css" rel="stylesheet" type="text/css"><link href="web-animations.css" rel="stylesheet" type="text/css"><link href="http://www.w3.org/StyleSheets/TR/W3C-WD" rel="stylesheet" type="text/css"></head>
  <body style="display: inherit;"><div class="head"><p><a href="http://www.w3.org/"><img width="72" height="48" src="http://www.w3.org/Icons/w3c_home" alt="W3C"></a></p><h1 class="title" id="title">Web Animations 1.0</h1><h2 id="w3c-first-public-working-draft-25-june-2013"><abbr title="World Wide Web Consortium">W3C</abbr> First Public Working Draft 25 June 2013</h2><dl><dt>This version:</dt><dd><a href="http://www.w3.org/TR/2013/WD-web-animations-20130625/">http://www.w3.org/TR/2013/WD-web-animations-20130625/</a></dd><dt>Latest published version:</dt><dd><a href="http://www.w3.org/TR/web-animations/">http://www.w3.org/TR/web-animations/</a></dd><dt>Latest editor's draft:</dt><dd><a href="http://dev.w3.org/fxtf/web-animations/">http://dev.w3.org/fxtf/web-animations/</a></dd><dt>Editors:</dt><dd><span>Brian Birtles</span>, <a href="http://mozilla.jp/">Mozilla Japan</a>,  <span class="ed_mailto"><a href="mailto:bbirtles@mozilla.com">bbirtles@mozilla.com</a></span> </dd>
<dd><span>Shane Stephens</span>, <a href="http://www.google.com/">Google, Inc</a>,  <span class="ed_mailto"><a href="mailto:shans@google.com">shans@google.com</a></span> </dd>
<dd><span>Alex Danilo</span>, <a href="http://www.google.com/">Google, Inc</a>,  <span class="ed_mailto"><a href="mailto:adanilo@google.com">adanilo@google.com</a></span> </dd>
<dd><span>Dmitry Baranovskiy</span>, <a href="http://www.adobe.com/">Adobe Systems</a>,  <span class="ed_mailto"><a href="mailto:baranovs@adobe.com">baranovs@adobe.com</a></span> </dd>
<dd><span>Tab Atkins</span>, <a href="http://www.google.com/">Google, Inc</a>,  <span class="ed_mailto"><a href="mailto:jackalmage@gmail.com">jackalmage@gmail.com</a></span> </dd>
</dl><p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> &#xa9; 2013 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>&#xae;</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>), All Rights Reserved. <abbr title="World Wide Web Consortium">W3C</abbr> <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p><hr></div>
    <section id="abstract" class="introductory"><h2>Abstract</h2><p>
      This specification defines a model for synchronization and timing of
      changes to the presentation of a Web page.
      This specification also defines an application programming interface for
      interacting with this model and it is expected that further specifications
      will define declarative means for exposing these features.
    </p></section><section id="sotd" class="introductory"><h2>Status of This Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this technical report can be found in the <a href="http://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at http://www.w3.org/TR/.</em></p><p>This document was published by the <a href="http://www.w3.org/Style/CSS/members">CSS Working Group</a> (part of the <a href="http://www.w3.org/Style/Activity">Style Activity</a>) and <a href="http://www.w3.org/Graphics/SVG/WG">SVG Working Group</a> (part of the <a href="http://www.w3.org/Graphics/Activity">Graphics Activity</a>) as a First Public Working Draft. This document is intended to become a <abbr title="World Wide Web Consortium">W3C</abbr> Recommendation. If you wish to make comments regarding this document, please send them to <a href="mailto:public-fx@w3.org">public-fx@w3.org</a> (<a href="mailto:public-fx-request@w3.org?subject=subscribe">subscribe</a>, <a href="http://lists.w3.org/Archives/Public/public-fx/">archives</a>). All feedback is welcome.</p><p>Publication as a First Public Working Draft does not imply endorsement by the <abbr title="World Wide Web Consortium">W3C</abbr> Membership. This is a draft document and may be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite this document as other than work in progress.</p><p>This document was produced by groups operating under the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>. <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of each group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.</p></section><section id="toc"><h2 class="introductory">Table of Contents</h2><ul class="toc"><li class="tocline"><a href="#introduction" class="tocxref"><span class="secno">1. </span>Introduction</a><ul class="toc"><li class="tocline"><a href="#use-cases" class="tocxref"><span class="secno">1.1 </span>Use cases</a></li><li class="tocline"><a href="#relationship-to-other-specifications" class="tocxref"><span class="secno">1.2 </span>Relationship to other specifications</a></li><li class="tocline"><a href="#overview-of-this-specification" class="tocxref"><span class="secno">1.3 </span>Overview of this specification</a></li></ul></li><li class="tocline"><a href="#web-animations-model-overview" class="tocxref"><span class="secno">2. </span>Web Animations model overview</a></li><li class="tocline"><a href="#timing-model" class="tocxref"><span class="secno">3. </span>Timing model</a><ul class="toc"><li class="tocline"><a href="#the-timing-model-at-a-glance" class="tocxref"><span class="secno">3.1 </span>The timing model at a glance</a><ul class="toc"><li class="tocline"><a href="#stateless" class="tocxref"><span class="secno">3.1.1 </span>Stateless</a></li><li class="tocline"><a href="#hierarchical" class="tocxref"><span class="secno">3.1.2 </span>Hierarchical</a></li></ul></li><li class="tocline"><a href="#timing-model-concepts" class="tocxref"><span class="secno">3.2 </span>Timing model concepts</a></li><li class="tocline"><a href="#the-global-clock" class="tocxref"><span class="secno">3.3 </span>The global clock</a></li><li class="tocline"><a href="#timelines" class="tocxref"><span class="secno">3.4 </span>Timelines</a><ul class="toc"><li class="tocline"><a href="#the-document-timeline" class="tocxref"><span class="secno">3.4.1 </span>The document timeline</a></li></ul></li><li class="tocline"><a href="#players" class="tocxref"><span class="secno">3.5 </span>Players</a><ul class="toc"><li class="tocline"><a href="#the-current-time-of-a-player" class="tocxref"><span class="secno">3.5.1 </span>The current time of a player</a></li><li class="tocline"><a href="#seeking-and-pausing" class="tocxref"><span class="secno">3.5.2 </span>Seeking and pausing</a><ul class="toc"><li class="tocline"><a href="#introduction-to-seeking" class="tocxref"><span class="secno">3.5.2.1 </span>Introduction to seeking</a></li><li class="tocline"><a href="#introduction-to-pausing" class="tocxref"><span class="secno">3.5.2.2 </span>Introduction to pausing</a></li><li class="tocline"><a href="#seeking-and-pausing-properties" class="tocxref"><span class="secno">3.5.2.3 </span>Seeking and pausing properties</a></li><li class="tocline"><a href="#calculating-the-time-drift" class="tocxref"><span class="secno">3.5.2.4 </span>Calculating the time drift</a></li><li class="tocline"><a href="#updating-the-paused-state" class="tocxref"><span class="secno">3.5.2.5 </span>Updating the <span class="internalDFN formerLink internalDFN">paused state</span></a></li><li class="tocline"><a href="#performing-a-seek" class="tocxref"><span class="secno">3.5.2.6 </span>Performing a seek</a></li></ul></li><li class="tocline"><a href="#speed-control" class="tocxref"><span class="secno">3.5.3 </span>Speed control</a><ul class="toc"><li class="tocline"><a href="#updating-the-playback-rate" class="tocxref"><span class="secno">3.5.3.1 </span>Updating the playback rate</a></li></ul></li></ul></li><li class="tocline"><a href="#timed-items" class="tocxref"><span class="secno">3.6 </span>Timed items</a><ul class="toc"><li class="tocline"><a href="#the-active-interval" class="tocxref"><span class="secno">3.6.1 </span>The active interval</a></li><li class="tocline"><a href="#local-time-and-inherited-time" class="tocxref"><span class="secno">3.6.2 </span>Local time and inherited time</a></li><li class="tocline"><a href="#timed-item-states" class="tocxref"><span class="secno">3.6.3 </span>Timed item states</a></li></ul></li><li class="tocline"><a href="#fill-behavior" class="tocxref"><span class="secno">3.7 </span>Fill behavior</a><ul class="toc"><li class="tocline"><a href="#fill-modes" class="tocxref"><span class="secno">3.7.1 </span>Fill modes</a></li></ul></li><li class="tocline"><a href="#repeating" class="tocxref"><span class="secno">3.8 </span>Repeating</a><ul class="toc"><li class="tocline"><a href="#iteration-intervals" class="tocxref"><span class="secno">3.8.1 </span>Iteration intervals</a></li><li class="tocline"><a href="#controlling-iteration" class="tocxref"><span class="secno">3.8.2 </span>Controlling iteration</a></li><li class="tocline"><a href="#iteration-time-space" class="tocxref"><span class="secno">3.8.3 </span>Iteration time space</a></li><li class="tocline"><a href="#interval-timing" class="tocxref"><span class="secno">3.8.4 </span>Interval timing</a></li></ul></li><li class="tocline"><a href="#timed-item-speed-control" class="tocxref"><span class="secno">3.9 </span>Timed item speed control</a></li><li class="tocline"><a href="#core-timed-item-calculations" class="tocxref"><span class="secno">3.10 </span>Core timed item calculations</a><ul class="toc"><li class="tocline"><a href="#overview" class="tocxref"><span class="secno">3.10.1 </span>Overview</a></li><li class="tocline"><a href="#calculating-the-active-duration" class="tocxref"><span class="secno">3.10.2 </span>Calculating the active duration</a></li><li class="tocline"><a href="#transforming-the-local-time" class="tocxref"><span class="secno">3.10.3 </span>Transforming the local time</a><ul class="toc"><li class="tocline"><a href="#calculating-the-active-time" class="tocxref"><span class="secno">3.10.3.1 </span>Calculating the active time</a></li><li class="tocline"><a href="#calculating-the-scaled-active-time" class="tocxref"><span class="secno">3.10.3.2 </span>Calculating the scaled active time</a></li><li class="tocline"><a href="#calculating-the-iteration-time" class="tocxref"><span class="secno">3.10.3.3 </span>Calculating the iteration time</a></li></ul></li><li class="tocline"><a href="#calculating-the-current-iteration" class="tocxref"><span class="secno">3.10.4 </span>Calculating the current iteration</a></li></ul></li><li class="tocline"><a href="#direction-control" class="tocxref"><span class="secno">3.11 </span>Direction control</a><ul class="toc"><li class="tocline"><a href="#calculating-the-directed-time" class="tocxref"><span class="secno">3.11.1 </span>Calculating the directed time</a></li></ul></li><li class="tocline"><a href="#time-transformations" class="tocxref"><span class="secno">3.12 </span>Time transformations</a><ul class="toc"><li class="tocline"><a href="#scaling-the-time" class="tocxref"><span class="secno">3.12.1 </span>Scaling the time</a></li><li class="tocline"><a href="#timing-functions" class="tocxref"><span class="secno">3.12.2 </span>Timing functions</a></li><li class="tocline"><a href="#scaling-using-a-cubic-b-zier-curve" class="tocxref"><span class="secno">3.12.3 </span>Scaling using a cubic B&#xe9;zier curve</a></li><li class="tocline"><a href="#timing-in-discrete-steps" class="tocxref"><span class="secno">3.12.4 </span>Timing in discrete steps</a></li><li class="tocline"><a href="#paced-timing" class="tocxref"><span class="secno">3.12.5 </span>Paced timing</a><ul class="toc"><li class="tocline"><a href="#evaluating-a-paced-timing-function" class="tocxref"><span class="secno">3.12.5.1 </span>Evaluating a paced timing function</a></li><li class="tocline"><a href="#calculating-the-length-between-two-property-values" class="tocxref"><span class="secno">3.12.5.2 </span>Calculating the length between two property values</a></li></ul></li><li class="tocline"><a href="#calculating-the-transformed-time" class="tocxref"><span class="secno">3.12.6 </span>Calculating the transformed time</a></li></ul></li><li class="tocline"><a href="#grouping-and-synchronization" class="tocxref"><span class="secno">3.13 </span>Grouping and synchronization</a><ul class="toc"><li class="tocline"><a href="#relationship-of-group-time-to-child-time" class="tocxref"><span class="secno">3.13.1 </span>Relationship of group time to child time</a></li><li class="tocline"><a href="#types-of-timing-groups" class="tocxref"><span class="secno">3.13.2 </span>Types of timing groups</a></li><li class="tocline"><a href="#parallel-timing-groups" class="tocxref"><span class="secno">3.13.3 </span>Parallel timing groups</a><ul class="toc"><li class="tocline"><a href="#the-start-time-of-children-of-a-parallel-timing-group" class="tocxref"><span class="secno">3.13.3.1 </span>The start time of children of a parallel timing group</a></li><li class="tocline"><a href="#the-intrinsic-iteration-duration-of-a-parallel-timing-group" class="tocxref"><span class="secno">3.13.3.2 </span>The intrinsic iteration duration of a parallel timing group</a></li></ul></li><li class="tocline"><a href="#sequence-timing-groups" class="tocxref"><span class="secno">3.13.4 </span>Sequence timing groups</a><ul class="toc"><li class="tocline"><a href="#the-start-time-of-children-of-a-sequence-timing-group" class="tocxref"><span class="secno">3.13.4.1 </span>The start time of children of a sequence timing group</a></li><li class="tocline"><a href="#the-intrinsic-iteration-duration-of-a-sequence-timing-group" class="tocxref"><span class="secno">3.13.4.2 </span>The intrinsic iteration duration of a sequence timing group</a></li></ul></li></ul></li><li class="tocline"><a href="#animations" class="tocxref"><span class="secno">3.14 </span>Animations</a><ul class="toc"><li class="tocline"><a href="#calculating-the-time-fraction" class="tocxref"><span class="secno">3.14.1 </span>Calculating the time fraction</a></li></ul></li></ul></li><li class="tocline"><a href="#animation-model" class="tocxref"><span class="secno">4. </span>Animation model</a><ul class="toc"><li class="tocline"><a href="#animation-effects" class="tocxref"><span class="secno">4.1 </span>Animation effects</a><ul class="toc"><li class="tocline"><a href="#target-properties" class="tocxref"><span class="secno">4.1.1 </span>Target properties</a></li><li class="tocline"><a href="#target-property-types" class="tocxref"><span class="secno">4.1.2 </span>Target property types</a></li><li class="tocline"><a href="#intermediate-animation-values" class="tocxref"><span class="secno">4.1.3 </span>Intermediate animation values</a><ul class="toc"><li class="tocline"><a href="#unaccumulated-animation-values" class="tocxref"><span class="secno">4.1.3.1 </span>Unaccumulated animation values</a></li><li class="tocline"><a href="#accumulating-animation-values" class="tocxref"><span class="secno">4.1.3.2 </span>Accumulating animation values</a></li></ul></li></ul></li><li class="tocline"><a href="#combining-animations" class="tocxref"><span class="secno">4.2 </span>Combining animations</a><ul class="toc"><li class="tocline"><a href="#the-animation-stack" class="tocxref"><span class="secno">4.2.1 </span>The animation stack</a><ul class="toc"><li class="tocline"><a href="#the-custom-animation-priority" class="tocxref"><span class="secno">4.2.1.1 </span>The custom animation priority</a></li></ul></li><li class="tocline"><a href="#calculating-the-result-of-an-animation-stack" class="tocxref"><span class="secno">4.2.2 </span>Calculating the result of an animation stack</a></li><li class="tocline"><a href="#animation-composition" class="tocxref"><span class="secno">4.2.3 </span>Animation composition</a></li><li class="tocline"><a href="#combining-with-other-styles--the-override-stylesheet" class="tocxref"><span class="secno">4.2.4 </span>Combining with other styles: the override stylesheet</a></li></ul></li><li class="tocline"><a href="#keyframe-animation-effects" class="tocxref"><span class="secno">4.3 </span>Keyframe animation effects</a><ul class="toc"><li class="tocline"><a href="#the-unaccumulated-animation-value-of-a-keyframe-animation-effect" class="tocxref"><span class="secno">4.3.1 </span>The unaccumulated animation value of a keyframe animation effect</a></li><li class="tocline"><a href="#procedure-for-evenly-distributing-keyframes" class="tocxref"><span class="secno">4.3.2 </span>Procedure for evenly distributing keyframes</a></li></ul></li><li class="tocline"><a href="#path-animation-effects" class="tocxref"><span class="secno">4.4 </span>Path animation effects</a><ul class="toc"><li class="tocline"><a href="#the-unaccumulated-animation-value-of-a-path-animation-effect" class="tocxref"><span class="secno">4.4.1 </span>The unaccumulated animation value of a path animation effect</a></li><li class="tocline"><a href="#determining-the-current-path-element-and-element-fraction" class="tocxref"><span class="secno">4.4.2 </span>Determining the current path element and element fraction</a></li><li class="tocline"><a href="#calculating-the-rotation-value-of-a-path-animation-effect" class="tocxref"><span class="secno">4.4.3 </span>Calculating the rotation value of a path animation effect</a></li><li class="tocline"><a href="#calculating-the-translation-value-of-a-path-animation-effect" class="tocxref"><span class="secno">4.4.4 </span>Calculating the translation value of a path animation effect</a></li></ul></li><li class="tocline"><a href="#animatable-properties" class="tocxref"><span class="secno">4.5 </span>Animatable properties</a><ul class="toc"><li class="tocline"><a href="#css-properties" class="tocxref"><span class="secno">4.5.1 </span>CSS Properties</a></li><li class="tocline"><a href="#svg-attributes" class="tocxref"><span class="secno">4.5.2 </span>SVG Attributes</a></li></ul></li><li class="tocline"><a href="#animation-of-property-types" class="tocxref"><span class="secno">4.6 </span>Animation of property types</a><ul class="toc"><li class="tocline"><a href="#animation-of-like-types" class="tocxref"><span class="secno">4.6.1 </span>Animation of like types</a><ul class="toc"><li class="tocline"><a href="#the--integer----number--and--percentage---------------types" class="tocxref"><span class="secno">4.6.1.1 </span>
            The &lt;integer&gt;, &lt;number&gt; and &lt;percentage&gt; 
            types
          </a></li><li class="tocline"><a href="#the--length----angle----time--and---------------frequency--types" class="tocxref"><span class="secno">4.6.1.2 </span>
            The &lt;length&gt;, &lt;angle&gt;, &lt;time&gt; and 
            &lt;frequency&gt; types
          </a></li><li class="tocline"><a href="#the--resolution--type" class="tocxref"><span class="secno">4.6.1.3 </span>The &lt;resolution&gt; type</a></li><li class="tocline"><a href="#the--color--type" class="tocxref"><span class="secno">4.6.1.4 </span>The &lt;color&gt; type</a></li><li class="tocline"><a href="#the--image--type" class="tocxref"><span class="secno">4.6.1.5 </span>The &lt;image&gt; type</a></li><li class="tocline"><a href="#the--position--type" class="tocxref"><span class="secno">4.6.1.6 </span>The &lt;position&gt; type</a></li><li class="tocline"><a href="#the--transform-function--type" class="tocxref"><span class="secno">4.6.1.7 </span>The &lt;transform-function&gt; type</a></li></ul></li><li class="tocline"><a href="#animation-of-non-matching-primitive-types" class="tocxref"><span class="secno">4.6.2 </span>Animation of non-matching primitive types</a></li><li class="tocline"><a href="#animation-of-keywords-and-primitive-types" class="tocxref"><span class="secno">4.6.3 </span>Animation of keywords and primitive types</a></li><li class="tocline"><a href="#animation-of-shorthand-properties" class="tocxref"><span class="secno">4.6.4 </span>Animation of shorthand properties</a></li><li class="tocline"><a href="#animation-of-css-calc-expressions" class="tocxref"><span class="secno">4.6.5 </span>Animation of CSS calc expressions</a></li><li class="tocline"><a href="#animation-of-transform-lists" class="tocxref"><span class="secno">4.6.6 </span>Animation of transform lists</a></li><li class="tocline"><a href="#default-animation-procedures" class="tocxref"><span class="secno">4.6.7 </span>Default animation procedures</a></li></ul></li><li class="tocline"><a href="#custom-effects" class="tocxref"><span class="secno">4.7 </span>Custom effects</a><ul class="toc"><li class="tocline"><a href="#execution-order-of-custom-effects" class="tocxref"><span class="secno">4.7.1 </span>Execution order of custom effects</a></li></ul></li></ul></li><li class="tocline"><a href="#timing-events" class="tocxref"><span class="secno">5. </span>Timing events</a><ul class="toc"><li class="tocline"><a href="#types-of-timing-events" class="tocxref"><span class="secno">5.1 </span>Types of timing events</a></li><li class="tocline"><a href="#uneased-timing" class="tocxref"><span class="secno">5.2 </span>Uneased timing</a></li><li class="tocline"><a href="#inverse-timing-calculations" class="tocxref"><span class="secno">5.3 </span>Inverse timing calculations</a></li><li class="tocline"><a href="#event-parameters" class="tocxref"><span class="secno">5.4 </span>Event parameters</a></li><li class="tocline"><a href="#propagation-path" class="tocxref"><span class="secno">5.5 </span>Propagation path</a></li><li class="tocline"><a href="#sequence-of-events" class="tocxref"><span class="secno">5.6 </span>Sequence of events</a></li><li class="tocline"><a href="#event-dispatch" class="tocxref"><span class="secno">5.7 </span>Event dispatch</a><ul class="toc"><li class="tocline"><a href="#seeked-event-dispatch" class="tocxref"><span class="secno">5.7.1 </span>Seeked event dispatch</a></li><li class="tocline"><a href="#event-dispatch-and-seeking-a-player" class="tocxref"><span class="secno">5.7.2 </span>Event dispatch and seeking a player</a></li><li class="tocline"><a href="#event-dispatch-and-time-adjustments" class="tocxref"><span class="secno">5.7.3 </span>Event dispatch and time adjustments</a></li><li class="tocline"><a href="#event-dispatch-and-unattached-timed-items" class="tocxref"><span class="secno">5.7.4 </span>Event dispatch and unattached timed items</a></li><li class="tocline"><a href="#event-dispatch-and-extended-delays" class="tocxref"><span class="secno">5.7.5 </span>Event dispatch and extended delays</a></li></ul></li></ul></li><li class="tocline"><a href="#script-interface" class="tocxref"><span class="secno">6. </span>Script interface</a><ul class="toc"><li class="tocline"><a href="#the-timeline-interface" class="tocxref"><span class="secno">6.1 </span>The <code>Timeline</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes" class="tocxref"><span class="secno">6.1.1 </span>Attributes</a></li><li class="tocline"><a href="#methods" class="tocxref"><span class="secno">6.1.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-player-interface" class="tocxref"><span class="secno">6.2 </span>The <code>Player</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-1" class="tocxref"><span class="secno">6.2.1 </span>Attributes</a></li></ul></li><li class="tocline"><a href="#the-timeditem-interface" class="tocxref"><span class="secno">6.3 </span>The <code>TimedItem</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-2" class="tocxref"><span class="secno">6.3.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-1" class="tocxref"><span class="secno">6.3.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-timing-interface" class="tocxref"><span class="secno">6.4 </span>The <code>Timing</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-3" class="tocxref"><span class="secno">6.4.1 </span>Attributes</a></li></ul></li><li class="tocline"><a href="#the-timinginput-dictionary" class="tocxref"><span class="secno">6.5 </span>The <code>TimingInput</code> dictionary</a><ul class="toc"><li class="tocline"><a href="#dictionary-timinginput-members" class="tocxref"><span class="secno">6.5.1 </span>Dictionary <span class="idlType formerLink idlType"><code>TimingInput</code></span> Members</a></li><li class="tocline"><a href="#the-fillmode-enumeration" class="tocxref"><span class="secno">6.5.2 </span>The <code>FillMode</code> enumeration</a><ul class="toc"><li class="tocline"><a href="#values" class="tocxref"><span class="secno">6.5.2.1 </span>Values</a></li></ul></li><li class="tocline"><a href="#the-playbackdirection-enumeration" class="tocxref"><span class="secno">6.5.3 </span>The <code>PlaybackDirection</code> enumeration</a><ul class="toc"><li class="tocline"><a href="#values-1" class="tocxref"><span class="secno">6.5.3.1 </span>Values</a></li></ul></li></ul></li><li class="tocline"><a href="#the-timinggroup-interface" class="tocxref"><span class="secno">6.6 </span>The <code>TimingGroup</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-4" class="tocxref"><span class="secno">6.6.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-2" class="tocxref"><span class="secno">6.6.2 </span>Methods</a></li><li class="tocline"><a href="#common-definitions-for-manipulating-hierarchies" class="tocxref"><span class="secno">6.6.3 </span>Common definitions for manipulating hierarchies</a></li></ul></li><li class="tocline"><a href="#the-timeditemlist-interface" class="tocxref"><span class="secno">6.7 </span>The <code>TimedItemList</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-5" class="tocxref"><span class="secno">6.7.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-3" class="tocxref"><span class="secno">6.7.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-pargroup-interface" class="tocxref"><span class="secno">6.8 </span>The <code>ParGroup</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors" class="tocxref"><span class="secno">6.8.1 </span>Constructors</a></li><li class="tocline"><a href="#methods-4" class="tocxref"><span class="secno">6.8.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-seqgroup-interface" class="tocxref"><span class="secno">6.9 </span>The <code>SeqGroup</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors-1" class="tocxref"><span class="secno">6.9.1 </span>Constructors</a></li><li class="tocline"><a href="#methods-5" class="tocxref"><span class="secno">6.9.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-animation-interface" class="tocxref"><span class="secno">6.10 </span>The <code>Animation</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors-2" class="tocxref"><span class="secno">6.10.1 </span>Constructors</a></li><li class="tocline"><a href="#attributes-6" class="tocxref"><span class="secno">6.10.2 </span>Attributes</a></li><li class="tocline"><a href="#methods-6" class="tocxref"><span class="secno">6.10.3 </span>Methods</a></li><li class="tocline"><a href="#creating-a-new-animation-object" class="tocxref"><span class="secno">6.10.4 </span>Creating a new <code>Animation</code> object</a></li></ul></li><li class="tocline"><a href="#the-pseudoelementreference-interface" class="tocxref"><span class="secno">6.11 </span>The <code>PseudoElementReference</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors-3" class="tocxref"><span class="secno">6.11.1 </span>Constructors</a></li><li class="tocline"><a href="#attributes-7" class="tocxref"><span class="secno">6.11.2 </span>Attributes</a></li></ul></li><li class="tocline"><a href="#the-animationtarget-typedef" class="tocxref"><span class="secno">6.12 </span>The <code>AnimationTarget</code> typedef</a></li><li class="tocline"><a href="#the-animationeffect-interface" class="tocxref"><span class="secno">6.13 </span>The <code>AnimationEffect</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-8" class="tocxref"><span class="secno">6.13.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-7" class="tocxref"><span class="secno">6.13.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-accumulateoperation-enumeration" class="tocxref"><span class="secno">6.14 </span>The <code>AccumulateOperation</code> enumeration</a><ul class="toc"><li class="tocline"><a href="#values-2" class="tocxref"><span class="secno">6.14.1 </span>Values</a></li></ul></li><li class="tocline"><a href="#the-compositeoperation-enumeration" class="tocxref"><span class="secno">6.15 </span>The <code>CompositeOperation</code> enumeration</a><ul class="toc"><li class="tocline"><a href="#values-3" class="tocxref"><span class="secno">6.15.1 </span>Values</a></li></ul></li><li class="tocline"><a href="#the-keyframeanimationeffect-interface" class="tocxref"><span class="secno">6.16 </span>The <code>KeyframeAnimationEffect</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors-4" class="tocxref"><span class="secno">6.16.1 </span>Constructors</a></li><li class="tocline"><a href="#attributes-9" class="tocxref"><span class="secno">6.16.2 </span>Attributes</a></li><li class="tocline"><a href="#methods-8" class="tocxref"><span class="secno">6.16.3 </span>Methods</a></li><li class="tocline"><a href="#normalizing-the-list-of-keyframes" class="tocxref"><span class="secno">6.16.4 </span>Normalizing the list of keyframes</a></li></ul></li><li class="tocline"><a href="#the-keyframe-dictionary" class="tocxref"><span class="secno">6.17 </span>The <code>Keyframe</code> dictionary</a><ul class="toc"><li class="tocline"><a href="#dictionary-keyframe-members" class="tocxref"><span class="secno">6.17.1 </span>Dictionary <span class="idlType formerLink idlType"><code>Keyframe</code></span> Members</a></li><li class="tocline"><a href="#normalizing-a-keyframe-object" class="tocxref"><span class="secno">6.17.2 </span>Normalizing a <code>Keyframe</code> object</a></li></ul></li><li class="tocline"><a href="#the-oneormorekeyframes-typedef" class="tocxref"><span class="secno">6.18 </span>The <code>OneOrMoreKeyframes</code> typedef</a></li><li class="tocline"><a href="#the-pathanimationeffect-interface" class="tocxref"><span class="secno">6.19 </span>The <code>PathAnimationEffect</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors-5" class="tocxref"><span class="secno">6.19.1 </span>Constructors</a></li><li class="tocline"><a href="#attributes-10" class="tocxref"><span class="secno">6.19.2 </span>Attributes</a></li><li class="tocline"><a href="#the-autorotationmode-enumeration" class="tocxref"><span class="secno">6.19.3 </span>The <code>AutoRotationMode</code> enumeration</a><ul class="toc"><li class="tocline"><a href="#values-4" class="tocxref"><span class="secno">6.19.3.1 </span>Values</a></li></ul></li></ul></li><li class="tocline"><a href="#the-customeffect-callback-interface" class="tocxref"><span class="secno">6.20 </span>The <code>CustomEffect</code> callback interface</a><ul class="toc"><li class="tocline"><a href="#attributes-11" class="tocxref"><span class="secno">6.20.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-9" class="tocxref"><span class="secno">6.20.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-timingevent-interface" class="tocxref"><span class="secno">6.21 </span>The <code>TimingEvent</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors-6" class="tocxref"><span class="secno">6.21.1 </span>Constructors</a></li><li class="tocline"><a href="#attributes-12" class="tocxref"><span class="secno">6.21.2 </span>Attributes</a></li><li class="tocline"><a href="#dictionary-timingeventinit-members" class="tocxref"><span class="secno">6.21.3 </span>Dictionary <span class="idlType formerLink idlType"><code>TimingEventInit</code></span> Members</a></li></ul></li><li class="tocline"><a href="#extensions-to-the-document-interface" class="tocxref"><span class="secno">6.22 </span>Extensions to the <code>Document</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-13" class="tocxref"><span class="secno">6.22.1 </span>Attributes</a></li></ul></li><li class="tocline"><a href="#extensions-to-the-element-interface" class="tocxref"><span class="secno">6.23 </span>Extensions to the <code>Element</code> interface</a><ul class="toc"><li class="tocline"><a href="#methods-10" class="tocxref"><span class="secno">6.23.1 </span>Methods</a></li></ul></li><li class="tocline"><a href="#script-execution-and-live-updates-to-the-model" class="tocxref"><span class="secno">6.24 </span>Script execution and live updates to the model</a></li></ul></li><li class="tocline"><a href="#integration-with-media-fragments" class="tocxref"><span class="secno">7. </span>Integration with Media Fragments</a></li><li class="tocline"><a href="#interaction-with-page-display" class="tocxref"><span class="secno">8. </span>Interaction with page display</a></li><li class="tocline"><a href="#implementation-requirements" class="tocxref"><span class="secno">9. </span>Implementation requirements</a><ul class="toc"><li class="tocline"><a href="#precision-of-time-values" class="tocxref"><span class="secno">9.1 </span>Precision of time values</a></li><li class="tocline"><a href="#conformance-criteria" class="tocxref"><span class="secno">9.2 </span>Conformance criteria</a></li></ul></li><li class="tocline"><a href="#webidl-ref" class="tocxref"><span class="secno">A. </span>Interface summary</a></li><li class="tocline"><a href="#algorithms-for-path-animation-effects" class="tocxref"><span class="secno">B. </span>Algorithms for path animation effects</a></li><li class="tocline"><a href="#algorithms-for-event-dispatch" class="tocxref"><span class="secno">C. </span>Algorithms for event dispatch</a><ul class="toc"><li class="tocline"><a href="#interval-boundaries-and-time-marks" class="tocxref"><span class="secno">C.1 </span>Interval boundaries and time marks</a></li><li class="tocline"><a href="#events-when-sampling-a-timeline" class="tocxref"><span class="secno">C.2 </span>Events when sampling a timeline</a></li><li class="tocline"><a href="#events-when-sampling-a-player" class="tocxref"><span class="secno">C.3 </span>Events when sampling a player</a></li><li class="tocline"><a href="#events-for-a-timed-item-during-regular-sampling" class="tocxref"><span class="secno">C.4 </span>Events for a timed item during regular sampling</a></li><li class="tocline"><a href="#events-for-a-timed-item-during-seeked-event-dispatch" class="tocxref"><span class="secno">C.5 </span>Events for a timed item during seeked event dispatch</a></li></ul></li><li class="tocline"><a href="#acknowledgements" class="tocxref"><span class="secno">D. </span>Acknowledgements</a></li><li class="tocline"><a href="#references" class="tocxref"><span class="secno">E. </span>References</a><ul class="toc"><li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">E.1 </span>Normative references</a></li><li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">E.2 </span>Informative references</a></li></ul></li></ul></section>

    <section class="informative" id="introduction">
      <!--OddPage--><h2><span class="secno">1. </span>Introduction</h2><div class="informative-bg"><p><em>This section is non-normative.</em></p>
      <p>
        Web Animations defines a model for supporting animation and
        synchronization on the Web platform.
        It is intended that other specifications will build on this model and
        expose its features through declarative means.
        In addition, this specification also defines a programming interface to
        the model that may be implemented by user agents that provide support
        for scripting.
      </p>
      <section id="use-cases">
        <h3><span class="secno">1.1 </span>Use cases</h3>
        <p>
          The Web Animations model aims at two broad areas of application:
        </p>
        <dl>
          <dt>User interface effects</dt>
          <dd>
            <p>
              Animation can be used to give visual clues and feedback to make
              a user interface more readily comprehensible.
            </p>
            <p>
              For example, a user action results in a table row being
              removed to represent an item being removed from a shopping cart.
              In such a case, fading the row to transparent and then shifting
              the subsequent rows up to fill the space over a few hundred
              milliseconds provides the user with clear feedback as to the
              results of their action as opposed to instantly removing the row
              from the DOM.
            </p>
            <p>
              To support this scenario not only are the animated effects of
              fading and shifting required, but so is synchronization, both
              between the animations, and between animations and scripted
              actions (removing the table row from the DOM after the animations
              have completed).
            </p>
          </dd>
          <dt>Storytelling and visualisation</dt>
          <dd>
            <p>
              Another type of animation uses the animated effect to convey
              a story or represent some information.
              Unlike user interface effects which are largely a presentational
              adjunct to the content, these animations form an essential part of
              the content presented to the user.
            </p>
            <p>
              For example, in an animated cartoon two cats fly through space
              to another planet leaving a rainbow trail behind them.
              After arriving at the planet a change of scene occurs and the user
              should decide whether or not the cats enter a magic mountain by
              selecting one of two preset destinations in the scene.
            </p>
            <p>
              This scenario requires the following features:
            </p>
            <ul>
              <li>animated effects for moving characters along a path as well as
                  warping a path (the rainbow trail),
              </li><li>synchronization that allows some actions to happen
                  simultaneously (the two cats moving) and others in sequence
                  (the change of scene),
              </li><li>play control to allow rewinding the cartoon, or changing its
                  playback rate to accommodate particular learning or
                  accessibility needs,
              </li><li>the ability to trigger animations in response to user input
            </li></ul>
            <p>
              Similar use cases in this category include visualising physical
              phenomena such as spring motion for educational purposes,
              or visualising data such as the prevalence of a disease over
              a geographical space over a year whereby animation is used to
              present the time-based component of the data.
            </p>
          </dd>
        </dl>
      </section>
      <section id="relationship-to-other-specifications">
        <h3><span class="secno">1.2 </span>Relationship to other specifications</h3>
        <p>
          CSS Transitions [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>], CSS Animations 
          [<cite><a class="bibref" href="#bib-CSS3-ANIMATIONS">CSS3-ANIMATIONS</a></cite>], and SVG [<cite><a class="bibref" href="#bib-SVG11">SVG11</a></cite>] all provide mechanisms that
          generate animated content on a Web page.
          Although the three specifications provide many similar features,
          they are described in different terms.
          This specification proposes an abstract animation model that
          encompasses the common features of all three specifications.
          This model is backwards-compatible with the current behavior of these
          specifications such that they can be defined in terms of this model
          without any observable change.
        </p>
        <p>
          The animation features in SVG 1.1 are defined in terms of SMIL
          Animation [<cite><a class="bibref" href="#bib-SMIL-ANIMATION">SMIL-ANIMATION</a></cite>].
          It is intended that by defining SVG's animation features in terms of
          the Web Animations model, the dependency between SVG and SMIL
          Animation can be removed.
        </p>
        <p>
          The programming interface component of this specification makes
          some additions to interfaces defined in HTML5 [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
        </p>
      </section>
      <section id="overview-of-this-specification">
        <h3><span class="secno">1.3 </span>Overview of this specification</h3>
        <p>
          This specification begins by defining an abstract model for animation.
          This is followed by a programming interface defined in terms of the
          abstract model.
          The programming interface is defined in terms of the abstract model
          and is only relevant to user agents that provide scripting support.
        </p>
      </section>
    </div></section>

    <section class="informative" id="web-animations-model-overview">
      <!--OddPage--><h2><span class="secno">2. </span>Web Animations model overview</h2><div class="informative-bg"><p><em>This section is non-normative.</em></p>
      <p>
        At a glance, the Web Animations model consists of two largely
        independent pieces, a <em>timing model</em> and an <em>animation
        model</em>.  The role of these pieces is as follows:
      </p>
      <dl>
        <dt>Timing model</dt>
        <dd>
          Takes a moment in time and converts it to a proportional distance
          within a single iteration of an animation called the <em>time
          fraction</em>.
          An <em>iteration index</em> is also generated for animations
          that vary as they repeat.
        </dd>
        <dt>Animation model</dt>
        <dd>
          Takes the <em>time fractions</em> and <em>iteration indices</em>
          produced by the timing model and converts them into a series of values
          to apply to the target properties and attributes.
        </dd>
      </dl>
      <p>
        Graphically, this flow can be represented as follows:
      </p>
      <div class="figure">
        <img src="img/timing-and-animation-models.svg" width="600" alt="Overview of the operation of the Web Animations model.">
      </div>
      <p class="caption">
        Overview of the operation of the Web Animations model.<br>
        The current time is input to the timing model which produces a time
        fraction and an iteration index.<br>
        These parameters are used as input to the animation model which produces
        the values to apply.<br>
      </p>
      <p>
        For example, consider an animation that:
      </p>
      <ul>
        <li>starts after 3 seconds,</li>
        <li>runs twice,</li>
        <li>takes 2 seconds every time, and</li>
        <li>changes the width of a rectangle from 50 pixels to 100
            pixels.</li>
      </ul>
      <p>
        The first three points apply to the timing model.
        At a time of 6 seconds, it will calculate that the animation should be
        half-way through its second iteration and produces the result 0.5.
        The animation model then uses that information to calculate a width
        for the rectangle of 75.
      </p>
      <p>
        This specification begins with the timing model and then proceeds to
        the animation model.
      </p>
    </div></section>

    <section id="timing-model">
      <!--OddPage--><h2><span class="secno">3. </span>Timing model</h2>
      <p>
        This section describes and defines the behavior of the Web Animations
        timing model.
        <a href="#dfn-timing-event" class="internalDFN">Timing events</a>, however, which are also a feature of the timing
        model, are described separately in <a href="#timing-events" class="sectionRef">section 5. Timing events</a>.
      </p>
    <section class="informative" id="the-timing-model-at-a-glance">
      <h3><span class="secno">3.1 </span>The timing model at a glance</h3><div class="informative-bg"><p><em>This section is non-normative.</em></p>
      <p>
        Two features characterise the Web Animations timing model: it is
        <em>stateless</em> and it is <em>hierarchical</em>.
      </p>
      <section id="stateless">
        <h4><span class="secno">3.1.1 </span>Stateless</h4>
        <p>
          The Web Animations timing model operates by taking an input time and
          producing an output time fraction.
          Since the output is based solely on the input time and is independent
          of previous inputs, the model may be described as stateless.
          This gives the model the following properties:
        </p>
        <dl>
          <dt>Frame-rate independent</dt>
          <dd>
            Since the output is independent of previous inputs, the rate at
            which the model is sampled will not affect its progress.
            Provided the input times are proportional to the progress of
            real-world time, animations will progress at an identical rate
            regardless of the capabilities of the device running them.
          </dd>
          <dt>Direction-agnostic</dt>
          <dd>
            Since the sequence of inputs is insignificant, the model is
            directionless.
            This means that the model can be sampled in reverse or even in
            a backwards and forwards pattern without requiring any specialized
            handling.
          </dd>
          <dt>Constant-time seeking</dt>
          <dd>
            Since each input is independent of the previous input, the
            processing required to perform a seek operation, even far into the
            future, is at least potentially constant.
          </dd>
        </dl>
        <p>
          There are a few apparent exceptions to the stateless behavior of the
          timing model.
        </p>
        <p>
          Firstly, <a href="#dfn-timing-event" class="internalDFN">timing events</a> are fired when, for example, one sample
          falls on the opposite side of an animation's interval boundary to the
          previous sample.
          This is certainly stative behavior.
          However, events should be considered as a layer added on top of the
          core timing model.
          When no event listeners are registered, the model is stateless.
        </p>
        <p>
          The other exception to this stateless behavior is that a number of
          methods defined in the <a href="#script-interface">programming
          interface</a> to the model provide play control such as pausing
          an item.
          These methods are defined in terms of the time at which they are
          called and are therefore stative.
          These methods are provided primarily for convenience and are not part
          of the core timing model but, like events, are layered on top.
        </p>
        <p>
          Finally, each time the model is sampled, it can be considered to
          establish a temporary state.
          While this temporary state affects the values returned from the <a href="#script-interface">programming interface</a>, it has no
          influence on the subsequent samples and hence does not conflict with
          the stateless qualities described above.
        </p>
      </section>
      <section id="hierarchical">
        <h4><span class="secno">3.1.2 </span>Hierarchical</h4>
        <p>
          The other characteristic feature of the Web Animations timing model is
          that time is inherited.
          Time begins with a monotonically increasing time source and cascades
          down a number of steps to each animation.
          At each step, time may be shifted backwards and forwards, scaled,
          reversed, paused, and repeated.
        </p>
        <div class="figure">
          <img src="img/time-hierarchy.svg" width="600" alt="A hierarchy of timing nodes">
        </div>
        <p class="caption">
          A hierarchy of timing nodes.
          Each node in the tree derives its time from its parent node.
          At the root of the tree is the global clock.
        </p>
        <p>
          A consequence of this hierarchical arrangement is that complex
          animation arrangements can be reversed, scheduled, accelerated and so
          on as a whole unit since the manipulations applied to the parent
          cascade down to its <a href="#dfn-descendant" class="internalDFN">descendants</a>.
          Furthermore, since time has a common source, it is easy to synchronize
          animations.
        </p>
      </section>
    </div></section>

    <section id="timing-model-concepts">
      <h3><span class="secno">3.2 </span>Timing model concepts</h3>
      <p>
        In Web Animations timing is based on a hierarchy of time relationships
        between timing nodes.
        Parent nodes provide timing information to their child nodes in the form
        of <a href="#dfn-time-value" class="internalDFN">time values</a>.
        A <dfn id="dfn-time-value">time value</dfn> is a real number which nominally represents
        a number of seconds from some moment.
        The connection between <a href="#dfn-time-value" class="internalDFN">time values</a> and wall-clock seconds may be
        obscured by any number of transformations applied to the value as it
        passes through the time hierarchy.
      </p>
      
      <p>
        Periodically, the user agent will trigger an update to the timing model
        in a process called <dfn id="dfn-sampling">sampling</dfn>.
        On each <dfn id="dfn-sample">sample</dfn> the <a href="#dfn-time-value" class="internalDFN">time values</a> of each timing node are
        updated.
      </p>
      <p class="note">
        A more precise definition of when the model is updated when scripting is
        involved is provided in <a href="#script-execution-and-live-updates-to-the-model" class="sectionRef">section 6.24 Script execution and live updates to the model</a>.
      </p>
    </section>

    <section id="the-global-clock">
      <h3><span class="secno">3.3 </span>The global clock</h3>
      <p>
        At the root of the Web Animations timing hierarchy is the <a href="#dfn-global-clock" class="internalDFN">global
        clock</a>.
      </p>
      <p>
        The <dfn id="dfn-global-clock">global clock</dfn> is a source of monotonically increasing
        <a href="#dfn-time-value" class="internalDFN">time values</a> unaffected by adjustments to the system clock.
        The <a href="#dfn-time-value" class="internalDFN">time values</a> produced by the <a href="#dfn-global-clock" class="internalDFN">global clock</a> represent
        wall-clock seconds from an unspecified historical moment.
        Because the zero time of the <a href="#dfn-global-clock" class="internalDFN">global clock</a> is not specified,
        the absolute values of the <a href="#dfn-time-value" class="internalDFN">time values</a> produced by the <a href="#dfn-global-clock" class="internalDFN">global
        clock</a> are not significant, only their range of change.
      </p>
      <p class="note">
        Note that the <a href="#dfn-global-clock" class="internalDFN">global clock</a> is not exposed in the <a href="#script-interface">programming interface</a> and nor is it
        expected to be exposed by markup.
        As a result the moment from which <a href="#dfn-global-clock" class="internalDFN">global clock</a> <a href="#dfn-time-value" class="internalDFN">time values</a>
        are measured, that is, the zero time of the clock, is allowed to be
        implementation-dependent.
        One user agent may measure the number of seconds since the the user
        agent was loaded whilst another may use the time when the device was
        started.
        Both approaches are acceptable and produce no observable difference
        in the output of the model.
      </p>
    </section>

    <section id="timelines">
      <h3><span class="secno">3.4 </span>Timelines</h3>
      <p>
        A <dfn id="dfn-timeline">timeline</dfn> provides a source of <a href="#dfn-time-value" class="internalDFN">time values</a> for the
        purpose of synchronization.
      </p>
      <p>
        Typically, a <a href="#dfn-timeline" class="internalDFN">timeline</a> is tied to the <a href="#dfn-global-clock" class="internalDFN">global clock</a> such
        that its absolute time is calculated as a fixed offset from the time of
        the <a href="#dfn-global-clock" class="internalDFN">global clock</a>.
        This offset is established by designating some moment as the timeline's
        <dfn id="dfn-zero-time">zero time</dfn> and recording the <a href="#dfn-time-value" class="internalDFN">time value</a> of the
        <a href="#dfn-global-clock" class="internalDFN">global clock</a> at that moment.
        At subsequent moments, the <a href="#dfn-time-value" class="internalDFN">time value</a> of the timeline is
        calculated as the difference between the current <a href="#dfn-time-value" class="internalDFN">time value</a> of
        the <a href="#dfn-global-clock" class="internalDFN">global clock</a> and the value recorded at the <a href="#dfn-zero-time" class="internalDFN">zero time</a>.
      </p>
      
      <p>
        Since a <a href="#dfn-timeline" class="internalDFN">timeline</a> may be defined to relative a moment that has yet
        to occur, it may not always be able to return a meaningful <a href="#dfn-time-value" class="internalDFN">time
        value</a>.
        A <a href="#dfn-timeline" class="internalDFN">timeline</a> is considered to be <dfn id="dfn-not-started">not started</dfn> when it is
        in such a state that it cannot produce a <a href="#dfn-time-value" class="internalDFN">time value</a>.
      </p>
      <section id="the-document-timeline">
        <h4><span class="secno">3.4.1 </span>The document timeline</h4>
        <p>
          Each document has a <a href="#dfn-timeline" class="internalDFN">timeline</a> called the <dfn id="dfn-document-timeline">document
          timeline</dfn> whose <a href="#dfn-time-value" class="internalDFN">time value</a> at a given moment is calculated
          as a fixed offset from the <a href="#dfn-global-clock" class="internalDFN">global clock</a> such that its <a href="#dfn-zero-time" class="internalDFN">zero
          time</a> corresponds to the moment immediately prior to dispatching
          the load event of the document.
          Prior to this moment, the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> is <a href="#dfn-not-started" class="internalDFN">not
          started</a>.
        </p>
        <p>
          For documents that support the concept of <a href="http://www.w3.org/TR/html51/dom.html#current-document-readiness
          ">current document readiness</a>, this is the moment after the <a href="http://www.w3.org/TR/html51/dom.html#current-document-readiness
          ">current document readiness</a> has changed to "complete" but
          before dispatching the load event.
          For user agents that support Navigation Timing [<cite><a class="bibref" href="#bib-NAVIGATION-TIMING">NAVIGATION-TIMING</a></cite>],
          this occurs between the <em>domComplete</em> and
          <em>loadEventStart</em> timings.
        </p>
        <div class="issue">
          This is not correct.
          We need a means to start animations prior to document load.
        </div>
        <p>
          Since the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> is tied to the <a href="#dfn-global-clock" class="internalDFN">global clock</a>
          by a fixed offset, <a href="#dfn-time-value" class="internalDFN">time values</a> reported by the <a href="#dfn-document-timeline" class="internalDFN">document
          timeline</a> increase monotonically.
          Furthermore, since no scaling is applied, these <a href="#dfn-time-value" class="internalDFN">time values</a>
          are proportional to wall-clock seconds.
        </p>
      </section>
    </section>

    <section id="players">
      <h3><span class="secno">3.5 </span>Players</h3>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          The children of a <a href="#dfn-timeline" class="internalDFN">timeline</a> are called <em>players</em>.
          A player takes a <a href="#dfn-timed-item" class="internalDFN">timed item</a> which is a static description of
          some timed behavior and binds it to a <a href="#dfn-timeline" class="internalDFN">timeline</a> so that it runs.
          A player also allows run-time control of the connection between the
          <a href="#dfn-timed-item" class="internalDFN">timed item</a> and its <a href="#dfn-timeline" class="internalDFN">timeline</a> by providing pausing,
          seeking, and speed control.
          The relationship between a player and a <a href="#dfn-timed-item" class="internalDFN">timed item</a> is analogous
          to that of a DVD player and a DVD.
        </p>
      </div>
      <p>
        A <dfn id="dfn-player">player</dfn> connects a single <a href="#dfn-timed-item" class="internalDFN">timed item</a>, called its
        <dfn id="dfn-source-content">source content</dfn>, to a <a href="#dfn-timeline" class="internalDFN">timeline</a> and provides playback
        control.
      </p>
      <p>
        A <a href="#dfn-player" class="internalDFN">player</a> records the <a href="#dfn-time-value" class="internalDFN">time value</a> of its <a href="#dfn-timeline" class="internalDFN">timeline</a>
        at which its <a href="#dfn-source-content" class="internalDFN">source content</a> is scheduled to begin
        as the <dfn title="player start time" id="dfn-player-start-time">start time</dfn>.
      </p>
      <p>
        When a <a href="#dfn-player" class="internalDFN">player</a> is created, it is assigned a globally unique
        sequence number called the <dfn id="dfn-player-sequence-number">player sequence number</dfn>.
        This number is used to resolve the sort order of players that have the
        same <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a> for a variety of
        situations such as combining animations, queuing events, and returning
        the list of players.
      </p>
      
      <section id="the-current-time-of-a-player">
        <h4><span class="secno">3.5.1 </span>The current time of a player</h4>
        <p>
          <a href="#dfn-player" class="internalDFN">Players</a> provide a <a href="#dfn-time-value" class="internalDFN">time value</a> to their <a href="#dfn-source-content" class="internalDFN">source
          content</a> called the player's <dfn id="dfn-current-time">current time</dfn>.
          The calculation of the <a href="#dfn-current-time" class="internalDFN">current time</a> is as follows:
        </p>
        <blockquote>
          <code><a href="#dfn-current-time" class="internalDFN">current time</a> =
          (<var>timeline time</var> - <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start
          time</a>) * <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a>
          - <a href="#dfn-time-drift" class="internalDFN">time drift</a></code>
        </blockquote>
        <p>
          Where:
        </p>
        <ul>
          <li><var>timeline time</var> is the current <a href="#dfn-time-value" class="internalDFN">time value</a> of the
          <a href="#dfn-timeline" class="internalDFN">timeline</a> with which this <a href="#dfn-player" class="internalDFN">player</a> is associated.</li>
          <li><var>start time</var> is the player's <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a>.</li>
          <li><var>playback rate</var> is the player's <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> value described in <a href="#speed-control" class="sectionRef">section 3.5.3 Speed control</a>.</li>
          <li><var>time drift</var> is the <a href="#dfn-time-drift" class="internalDFN">time drift</a> value described in
          <a href="#seeking-and-pausing" class="sectionRef">section 3.5.2 Seeking and pausing</a>.</li>
        </ul>
        <p>
          If the <a href="#dfn-timeline" class="internalDFN">timeline</a> with which is <a href="#dfn-player" class="internalDFN">player</a> is associated is
          <a href="#dfn-not-started" class="internalDFN">not started</a> then the <a href="#dfn-current-time" class="internalDFN">current time</a> is <code>null</code>.
        </p>
        <p>
          It is often useful to treat the <a href="#dfn-current-time" class="internalDFN">current time</a> as zero when it
          would otherwise be <code>null</code>.
          We define the <dfn id="dfn-effective-current-time">effective current time</dfn> as being equal
          to <a href="#dfn-current-time" class="internalDFN">current time</a> unless the <a href="#dfn-current-time" class="internalDFN">current time</a> is
          <code>null</code>,
          in which case the <var>effective current time</var> is zero.
        </p>
        <p>
          The procedure for performing manual updates to the <a href="#dfn-current-time" class="internalDFN">current time</a>
          is defined in <a href="#performing-a-seek" class="sectionRef">section 3.5.2.6 Performing a seek</a>.
        </p>
      </section>
      <section id="seeking-and-pausing">
        <h4><span class="secno">3.5.2 </span>Seeking and pausing</h4>
        <p>
          Seeking and pausing a player are closely related and are described
          here together.
        </p>
        <section class="informative" id="introduction-to-seeking">
          <h5><span class="secno">3.5.2.1 </span>Introduction to seeking</h5><div class="informative-bg"><p><em>This section is non-normative.</em></p>
          <p>
            Changing the current playback position of a player can be used to
            rewind its <a href="#dfn-source-content" class="internalDFN">source content</a> to its start point, fast-forward
            to a point in the future, or to provide ad-hoc synchronization
            between timed items.
          </p>
          <p>
            However, in Web Animations, the <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start
            time</a> of a <a href="#dfn-player" class="internalDFN">player</a> has special significance in determining
            the priority of animations (see <a href="#combining-animations" class="sectionRef">section 4.2 Combining animations</a>) and so we cannot simply adjust the <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a>.
            Instead, an additional offset is introduced called the <a href="#dfn-time-drift" class="internalDFN">time
            drift</a> that further offsets a player's <a href="#dfn-current-time" class="internalDFN">current time</a> from
            its timeline.
            The effect of the <a href="#dfn-time-drift" class="internalDFN">time drift</a> when seeking is illustrated
            below.
          </p>
          <div class="figure">
            <img src="img/seeking.svg" width="600" alt="The effect of seeking a player.">
          </div>
          <p class="caption">
            At time <var>t</var>, a seek is performed on the player changing its
            <a href="#dfn-current-time" class="internalDFN">current time</a> from 1.5s to 2s.<br>
            As a result, the <a href="#dfn-time-drift" class="internalDFN">time drift</a> is set to -0.5s.<br>
            Note that the <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a> indicated
            by a red star does not change.
          </p>
          <p>
            It is possible to seek a player even if its <a href="#dfn-timeline" class="internalDFN">timeline</a> is
            <a href="#dfn-not-started" class="internalDFN">not started</a>.
            Once the timeline begins, the player will begin playback from the
            seeked time.
          </p>
        </div></section>
        <section class="informative" id="introduction-to-pausing">
          <h5><span class="secno">3.5.2.2 </span>Introduction to pausing</h5><div class="informative-bg"><p><em>This section is non-normative.</em></p>
          <p>
            Pausing can be used to temporarily suspend a <a href="#dfn-player" class="internalDFN">player</a>.
            Like seeking, pausing effectively causes the <a href="#dfn-current-time" class="internalDFN">current time</a> of
            a player to be offset from its <a href="#dfn-timeline" class="internalDFN">timeline</a> by means of
            setting the <a href="#dfn-time-drift" class="internalDFN">time drift</a>.
          </p>
          <p>
            The effect of pausing on a <a href="#dfn-player" class="internalDFN">player</a>'s <a href="#dfn-time-drift" class="internalDFN">time drift</a> is
            illustrated below.
          </p>
          <div class="figure">
            <img src="img/pausing.svg" width="600" alt="The effect of pausing a player.">
          </div>
          <p class="caption">
            The effect of pausing a <a href="#dfn-player" class="internalDFN">player</a>.<br>
            Whether pausing before or after a <a href="#dfn-player" class="internalDFN">player</a>'s <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a>
            the duration of the interval during which the <a href="#dfn-player" class="internalDFN">player</a> was
            paused is added to the <a href="#dfn-player" class="internalDFN">player</a>'s <a href="#dfn-time-drift" class="internalDFN">time drift</a> whilst the
            <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a> remains unaffected.
          </p>
        </div></section>
        <section id="seeking-and-pausing-properties">
          <h5><span class="secno">3.5.2.3 </span>Seeking and pausing properties</h5>
          <p>
            <a href="#dfn-player" class="internalDFN">Players</a> track three properties related to seeking and
            pausing.
          </p>
          <dl>
            <dt><dfn id="dfn-time-drift">time drift</dfn></dt>
            <dd>
              The offset from a player's scheduled current time as defined by
              its <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a>, and its actual
              current time after accounting for the effects of seeking and
              pausing.
              The <a href="#dfn-time-drift" class="internalDFN">time drift</a> is initially zero and is updated as per the
              definition in <a href="#calculating-the-time-drift" class="sectionRef">section 3.5.2.4 Calculating the time drift</a>.
            </dd>
            <dt><dfn id="dfn-paused-state">paused state</dfn></dt>
            <dd>
              A boolean value that is true if the player is currently paused.
              The <a href="#dfn-paused-state" class="internalDFN">paused state</a> is initially false.
            </dd>
            <dt><dfn id="dfn-pause-start-time">pause start time</dfn></dt>
            <dd>
              The player's <a href="#dfn-effective-current-time" class="internalDFN">effective current time</a> at the time when the
              <a href="#dfn-paused-state" class="internalDFN">paused state</a> was last newly true.
              The <a href="#dfn-pause-start-time" class="internalDFN">pause start time</a> is initially zero.
            </dd>
          </dl>
          <p>
            A number of calculations for performing seeking and pausing are
            defined to operate even when the associated <a href="#dfn-timeline" class="internalDFN">timeline</a> is
            <a href="#dfn-not-started" class="internalDFN">not started</a>.
            For such situations we define the <dfn id="dfn-effective-timeline-time">effective timeline time</dfn>
            as the current <a href="#dfn-time-value" class="internalDFN">time value</a> of the <a href="#dfn-timeline" class="internalDFN">timeline</a> associated
            with a <a href="#dfn-player" class="internalDFN">player</a>;
            if the timeline is <a href="#dfn-not-started" class="internalDFN">not started</a>, then the <var>effective
            timeline time</var> is zero.
          </p>
        </section>
        <section id="calculating-the-time-drift">
          <h5><span class="secno">3.5.2.4 </span>Calculating the time drift</h5>
          <p>
            The <a href="#dfn-time-drift" class="internalDFN">time drift</a> value is both a stored and a calculated value.
            When a player is paused, the value is calculated from the <a href="#dfn-pause-start-time" class="internalDFN">pause
            start time</a>.
            When a player is not paused, the stored value is used.
            The stored value is initially zero, and is updated when the player
            is unpaused or seeked.
          </p>
          <p>
            The value of <a href="#dfn-time-drift" class="internalDFN">time drift</a> at a given moment is calculated as
            follows:
          </p>
          <dl class="switch">
            <dt>If the <a href="#dfn-paused-state" class="internalDFN">paused state</a> is true,</dt>
            <dd>
              Return the result of 
              <code>(<a href="#dfn-effective-timeline-time" class="internalDFN">effective timeline time</a> - <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a>) * <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> -
              <a href="#dfn-pause-start-time" class="internalDFN">pause start time</a></code>.
            </dd>
            <dt>Otherwise,</dt>
            <dd>
              Return the stored value for this property.
            </dd>
          </dl>
          <p class="todo">
            These formulae need to be verified since removing the special
            behavior regarding pausing before the start time.
          </p>
        </section>
        <section id="updating-the-paused-state">
          <h5><span class="secno">3.5.2.5 </span>Updating the <a href="#dfn-paused-state" class="internalDFN">paused state</a></h5>
          <p>
            The procedure for updating the <a href="#dfn-paused-state" class="internalDFN">paused state</a> is as
            follows:
          </p>
          <ol>
            <li>
              Let <var>new value</var> be the new paused state to set.
            </li>
            <li>
              If <var>new value</var> equals the current <a href="#dfn-paused-state" class="internalDFN">paused state</a>,
              return.
            </li>
            <li>
              The next step depends on the current <a href="#dfn-paused-state" class="internalDFN">paused state</a> as
              follows,
              <dl class="switch">
                <dt>If <a href="#dfn-paused-state" class="internalDFN">paused state</a> is true,</dt>
                <dd>
                  Set the <em>stored</em> value of <a href="#dfn-time-drift" class="internalDFN">time drift</a> to the
                  <em>current calculated</em> value of <a href="#dfn-time-drift" class="internalDFN">time drift</a> as
                  defined in <a href="#calculating-the-time-drift" class="sectionRef">section 3.5.2.4 Calculating the time drift</a>.
                </dd>
                <dt>Otherwise,</dt>
                <dd>
                  Record the current value of the <a href="#dfn-effective-current-time" class="internalDFN">effective current time</a>
                  as <a href="#dfn-pause-start-time" class="internalDFN">pause start time</a>.
                </dd>
              </dl>
            </li>
            <li>
              Update <a href="#dfn-paused-state" class="internalDFN">paused state</a> to <var>new value</var>.
            </li>
          </ol>
        </section>
        <section id="performing-a-seek">
          <h5><span class="secno">3.5.2.6 </span>Performing a seek</h5>
          <p>
            <dfn id="dfn-seeking">Seeking</dfn> is the process of updating a player's <a href="#dfn-current-time" class="internalDFN">current
            time</a> to a desired value.
            It is achieved using the following procedure:
          </p>
          <ol>
            <li>Let <var>seek time</var> be the desired <a href="#dfn-time-value" class="internalDFN">time value</a> for
                the player's <a href="#dfn-current-time" class="internalDFN">current time</a>.</li>
            <li>The steps for adjusting the <a href="#dfn-current-time" class="internalDFN">current time</a> depend on the
                <a href="#dfn-paused-state" class="internalDFN">paused state</a> as follows:
              <dl class="switch">
                <dt>If the <a href="#dfn-paused-state" class="internalDFN">paused state</a> is true,</dt>
                <dd>
                  Set <a href="#dfn-pause-start-time" class="internalDFN">pause start time</a> to <var>seek time</var>.
                </dd>
                <dt>If the <a href="#dfn-paused-state" class="internalDFN">paused state</a> is false,</dt>
                <dd>
                  Set the stored value for the <a href="#dfn-time-drift" class="internalDFN">time drift</a> to
                  the result of evaluating
                  <code>(<a href="#dfn-effective-timeline-time" class="internalDFN">effective timeline time</a> - <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a>)
                     * <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> -
                     <var>seek time</var></code>.
                </dd>
              </dl>
            </li>
          </ol>
          <p>
            The <a href="#dfn-timing-event" class="internalDFN">timing events</a> queued when a seek is performed are
            described in <a href="#event-dispatch-and-seeking-a-player" class="sectionRef">section 5.7.2 Event dispatch and seeking a player</a>.
          </p>
        </section>
      </section>
      <section id="speed-control">
        <h4><span class="secno">3.5.3 </span>Speed control</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            The rate of play of a player can be controlled by setting its
            <em>playback rate</em>.
            For example, setting a playback rate of 2 will cause the player's
            <a href="#dfn-current-time" class="internalDFN">current time</a> to increase at twice the rate of its
            <a href="#dfn-timeline" class="internalDFN">timeline</a>.
            Similarly, a playback rate of -1 will cause the player's <a href="#dfn-current-time" class="internalDFN">current
            time</a> to decrease at the same rate as the <a href="#dfn-time-value" class="internalDFN">time values</a> from
            its <a href="#dfn-timeline" class="internalDFN">timeline</a> increase.
          </p>
          <p>
            Note that <a href="#dfn-timed-item" class="internalDFN">timed items</a> also have a <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a> associated with
            them that behaves differently to that defined here.
          </p>
        </div>
        <p>
          <a href="#dfn-player" class="internalDFN">Players</a> have a <dfn title="player playback
          rate" id="dfn-player-playback-rate">playback rate</dfn> that provides a scaling factor from the rate
          of change of the associated <a href="#dfn-timeline" class="internalDFN">timeline</a>'s <a href="#dfn-time-value" class="internalDFN">time values</a> to
          the player's <a href="#dfn-current-time" class="internalDFN">current time</a>.
          The <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> is initially 1.
        </p>
        <p>
          Setting a player's <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a>
          to zero effectively pauses the player but without affecting the
          player's <a href="#dfn-paused-state" class="internalDFN">paused state</a>.
        </p>
        <section id="updating-the-playback-rate">
          <h5><span class="secno">3.5.3.1 </span>Updating the playback rate</h5>
          <p>
            Changes to the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a>
            also trigger a compensatory seek so that that the player's
            <a href="#dfn-current-time" class="internalDFN">current time</a> is unaffected by the change to the playback
            rate.
          </p>
          <p>
            The procedure is as follows:
          </p>
          <ol>
            <li>Let <var>previous time</var> be the value of the <a href="#dfn-effective-current-time" class="internalDFN">effective
                current time</a> before updating the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a>.</li>
            <li>Update the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> to
                the new value.</li>
            <li>Seek to <var>previous time</var> using the procedure defined in
                <a href="#performing-a-seek" class="sectionRef">section 3.5.2.6 Performing a seek</a>.</li>
          </ol>
        </section>
      </section>
    </section>

    <section id="timed-items">
      <h3><span class="secno">3.6 </span>Timed items</h3>
      <p>
        The <a href="#dfn-source-content" class="internalDFN">source content</a> of a <a href="#dfn-player" class="internalDFN">player</a>, if set, is a type of
        <dfn id="dfn-timed-item">timed item</dfn>.
        There are two types of <a href="#dfn-timed-item" class="internalDFN">timed item</a>:
      </p>
      <ul>
        <li><a href="#dfn-animation" class="internalDFN">animations</a>, and</li>
        <li><a href="#dfn-timing-group" class="internalDFN">timing groups</a>.</li>
      </ul>
      <p>
        At a given moment, a <a href="#dfn-timed-item" class="internalDFN">timed item</a> can be associated with at most
        one <a href="#dfn-player" class="internalDFN">player</a>.
      </p>
      <p>
        <a href="#dfn-timed-item" class="internalDFN">Timed items</a> can be chained together into a hierarchy using
        <a>timings groups</a>.
        Only the <a href="#dfn-root" class="internalDFN">root</a> <a href="#dfn-timed-item" class="internalDFN">timed item</a> of such a hierarchy can be <dfn title="directly associated with a player" id="dfn-directly-associated-with-a-player">directly associated</dfn> with
        a <a href="#dfn-player" class="internalDFN">player</a>.
        Attempting to associate a <a href="#dfn-timed-item" class="internalDFN">timed item</a> that has a <a href="#dfn-parent-timing-group" class="internalDFN">parent timing
        group</a> with a <a href="#dfn-player" class="internalDFN">player</a> results in the <a href="#dfn-timed-item" class="internalDFN">timed item</a> being
        removed from the <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a> first.
        A <a href="#dfn-timed-item" class="internalDFN">timed item</a> with an <a href="#dfn-ancestor" class="internalDFN">ancestor</a> <a href="#dfn-timing-group" class="internalDFN">timing group</a> that is
        <a href="#dfn-directly-associated-with-a-player" class="internalDFN">directly associated with a player</a> is <dfn title="indirectly associated with a player" id="dfn-indirectly-associated-with-a-player">indirectly associated</dfn>
        with that <a href="#dfn-player" class="internalDFN">player</a>.
      </p>
      <p>
        A <a href="#dfn-timed-item" class="internalDFN">timed item</a>, <var>item</var>, is <dfn id="dfn-associated-with-a-timeline">associated with
        a timeline</dfn>, <var>timeline</var>, if <var>item</var> is
        <a title="directly associated with a player" href="#dfn-directly-associated-with-a-player" class="internalDFN">directly</a> or
        <a title="indirectly associated with a player" href="#dfn-indirectly-associated-with-a-player" class="internalDFN">indirectly</a> associated
        with a <a href="#dfn-player" class="internalDFN">player</a> which, in turn, is associated with
        <var>timeline</var>.
      </p>
      <p>
        All types of <a href="#dfn-timed-item" class="internalDFN">timed item</a> define a number of common properties
        which are described in the following sections.
      </p>
      <section id="the-active-interval">
        <h4><span class="secno">3.6.1 </span>The active interval</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            The period that a <a href="#dfn-timed-item" class="internalDFN">timed item</a> is scheduled to run is called
            its <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
            Each <a href="#dfn-timed-item" class="internalDFN">timed item</a> has only one such interval.
          </p>
          <p>
            The lower bound of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> is determined by the
            <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> of the <a href="#dfn-timed-item" class="internalDFN">timed
            item</a> but may be shifted by a <a href="#dfn-start-delay" class="internalDFN">start delay</a> on the <a href="#dfn-timed-item" class="internalDFN">timed
            item</a>.
          </p>
          <p>
            The upper bound of the interval is determined by the <a href="#dfn-active-duration" class="internalDFN">active
            duration</a>.
          </p>
          <p>
            The relationship between the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start
            time</a>, <a href="#dfn-start-delay" class="internalDFN">start delay</a>, and <a href="#dfn-active-duration" class="internalDFN">active duration</a> is
            illustrated below.
          </p>
          <div class="figure">
            <img src="img/active-interval-examples.svg" width="600" alt="Examples of the effect of the start delay on the endpoints
                    of the active interval">
          </div>
          <p class="caption">
            Examples of the effect of the <a href="#dfn-start-delay" class="internalDFN">start delay</a> on the endpoints of
            the <a href="#dfn-active-interval" class="internalDFN">active interval</a>.<br>
            (a) A timed item with no delay; the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> and beginning of the
            <a href="#dfn-active-interval" class="internalDFN">active interval</a> are coincident.<br>
            (b) A timed item with a positive delay; the beginning of the
            <a href="#dfn-active-interval" class="internalDFN">active interval</a> is deferred by the delay.<br>
            (c) A timed item with a negative delay; the beginning of the
            <a href="#dfn-active-interval" class="internalDFN">active interval</a> is brought forward by the delay.
          </p>
        </div>
        <p>
          <a href="#dfn-timed-item" class="internalDFN">Timed items</a> define an <dfn id="dfn-active-interval">active interval</dfn> which is the
          period of time during which the item is scheduled to produce its
          effect with the exception of <a href="#dfn-fill-mode" class="internalDFN">fill modes</a> which apply outside
          the <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
        </p>
        <p>
          The lower bound of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> is defined by the
          combination of the timed item's <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start
          time</a> and <a href="#dfn-start-delay" class="internalDFN">start delay</a>
        </p>
        <p>
          A <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <dfn title="timed item start time" id="dfn-timed-item-start-time">start
          time</dfn> is the moment at which the <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>, if
          any, has scheduled the <a href="#dfn-timed-item" class="internalDFN">timed item</a> to begin.
          It is expressed in <a href="#dfn-inherited-time" class="internalDFN">inherited time</a>.
          In most cases, including the case when the <a href="#dfn-timed-item" class="internalDFN">timed item</a> has no
          <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>, the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start
          time</a> is zero.
          The singular exception is <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing groups</a> which set the
          <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start times</a> of their children as
          described in <a href="#the-start-time-of-children-of-a-sequence-timing-group" class="sectionRef">section 3.13.4.1 The start time of children of a sequence timing group</a>.
        </p>
        <p>
          In addition to the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a>,
          a <a href="#dfn-timed-item" class="internalDFN">timed item</a> also has a <dfn id="dfn-start-delay">start delay</dfn> which is an
          offset from the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a>.
          Unlike the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> which is
          determined by the <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>, the <a href="#dfn-start-delay" class="internalDFN">start delay</a>
          is a property of the <a href="#dfn-timed-item" class="internalDFN">timed item</a> itself.
        </p>
        <p>
          The lower bound of the <a href="#dfn-active-interval" class="internalDFN">active interval</a><a> of a </a><a href="#dfn-timed-item" class="internalDFN">timed item</a>,
          expressed in <a title="inherited time" href="#dfn-inherited-time" class="internalDFN">inherited time space</a>, is
          the sum of the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> and the
          <a href="#dfn-start-delay" class="internalDFN">start delay</a>.
        </p>
        <p>
          These definitions are incorporated in the calculation of the <a href="#dfn-local-time" class="internalDFN">local
          time</a> (see <a href="#local-time-and-inherited-time" class="sectionRef">section 3.6.2 Local time and inherited time</a>) and <a href="#dfn-active-time" class="internalDFN">active time</a>.
        </p>
        <p>
          The length of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> is called the <dfn id="dfn-active-duration">active
          duration</dfn>, the calculation of which is defined in <a href="#calculating-the-active-duration" class="sectionRef">section 3.10.2 Calculating the active duration</a>.
        </p>
      </section>
      <section id="local-time-and-inherited-time">
        <h4><span class="secno">3.6.2 </span>Local time and inherited time</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            In Web Animations all times are relative to some point of reference.
            These different points of reference produce different <em>time
            spaces</em>.
          </p>
          <p>
            This can be compared to coordinate spaces as used in computer
            graphics.
            The zero time of a time space is analogous to the origin of
            a coordinate space.
          </p>
          <p>
            Just as with coordinate spaces, time spaces can also be nested.
            <a href="#dfn-timing-group" class="internalDFN">Timing groups</a> typically perform some
            transformations on the <a href="#dfn-time-value" class="internalDFN">time values</a> they
            receive from their <a title="parent timing group" href="#dfn-parent-timing-group" class="internalDFN">parent</a> or
            <a href="#dfn-player" class="internalDFN">player</a> before passing on the transformed <a href="#dfn-time-value" class="internalDFN">time values</a>
            to their children.
            Child <a href="#dfn-timed-item" class="internalDFN">timed items</a> then operate <em>within</em> that
            transformed time space.
          </p>
          <p>
            Children take the transformed time values from their
            parent&#x2014;called the <a href="#dfn-inherited-time" class="internalDFN">inherited time</a>&#x2014; and add their
            <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> to establish their
            own <a title="local time" href="#dfn-local-time" class="internalDFN">local time space</a> as illustrated below.
          </p>
          <div class="figure">
            <img src="img/local-time.svg" width="600" alt="Inherited time and local time.">
          </div>
          <p class="caption">
            Inherited time and local time.<br>
            At time <var>t</var>, the <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> is 2.5.<br>
            For <a href="#dfn-timed-item" class="internalDFN">timed item</a> (a) which has a <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> of 1, the <a href="#dfn-local-time" class="internalDFN">local
              time</a> is 1.5.<br>
            For <a href="#dfn-timed-item" class="internalDFN">timed item</a> (b) which has a <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> of 1
              and a <a href="#dfn-start-delay" class="internalDFN">start delay</a> of 1,
              the <a href="#dfn-local-time" class="internalDFN">local time</a> is also 1.5
              since <a href="#dfn-local-time" class="internalDFN">local time</a> is based on a <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s
              <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> only,
              and not on its <a href="#dfn-start-delay" class="internalDFN">start delay</a>.
          </p>
        </div>
        <p>
          For a <a href="#dfn-timed-item" class="internalDFN">timed item</a>, the <dfn id="dfn-inherited-time">inherited time</dfn> at
          a given moment is based on the first matching condition from the
          following:
        </p>
        <dl class="switch">
          <dt>If the <a href="#dfn-timed-item" class="internalDFN">timed item</a> has a <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>,</dt>
          <dd>
            the inherited time is the <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>'s current
            <a title="transformed time" href="#dfn-transformed-time" class="internalDFN">transformed time value</a>.
          </dd>
          <dt>If the <a href="#dfn-timed-item" class="internalDFN">timed item</a> is directly associated with
              a <a href="#dfn-player" class="internalDFN">player</a>,</dt>
          <dd>
            the inherited time is the <a href="#dfn-current-time" class="internalDFN">current time</a> of the
            <a href="#dfn-player" class="internalDFN">player</a>.
          </dd>
          <dt>Otherwise,</dt>
          <dd>
            the inherited time is <code>null</code>.
          </dd>
        </dl>
        <p>
          The <dfn id="dfn-local-time">local time</dfn> of a <a href="#dfn-timed-item" class="internalDFN">timed item</a> is the <a href="#dfn-timed-item" class="internalDFN">timed
          item</a>'s <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> minus its <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a>.
          If the <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> is <code>null</code> then the local time
          is also <code>null</code>.
        </p>
      </section>
      <section id="timed-item-states">
        <h4><span class="secno">3.6.3 </span>Timed item states</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            At given moment, a <a href="#dfn-timed-item" class="internalDFN">timed item</a> may be described as being in
            one of several overlapping states.
            These states are only established for the duration of a single
            sample and are primarily a convenience for describing stative parts
            of the model such as event dispatch.
          </p>
          <p>
            The different states are illustrated below.
          </p>
          <div class="figure">
            <img src="img/timed-item-states.svg" width="700" alt="An example of the different states used for describing a
                    timed item.">
          </div>
          <p class="caption">
            An example of the different states used for describing a <a href="#dfn-timed-item" class="internalDFN">timed
            item</a> at a given time.
            Note that a <a href="#dfn-timed-item" class="internalDFN">timed item</a> is considered to be <a href="#dfn-in-effect" class="internalDFN">in effect</a>
            for all times inside the <a href="#dfn-active-interval" class="internalDFN">active interval</a> as well as times
            outside the <a href="#dfn-active-interval" class="internalDFN">active interval</a> where a <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> is
            applied.
          </p>
          <p>
            These states and their useage within the model are summarised as
            follows:
          </p>
          <dl>
            <dt><a href="#dfn-scheduled" class="internalDFN">scheduled</a></dt>
            <dd>
              The <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> falls before the item's
              <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
              This state is only used in conjunction with the
              <a href="#dfn-active" class="internalDFN"><em>active</em></a> state to define the <a href="#dfn-current" class="internalDFN"><em>current</em></a>
              state.
            </dd>
            <dt><a href="#dfn-active" class="internalDFN">active</a></dt>
            <dd>
              The <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> falls inside the item's
              <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
              Transitions to and from the <a href="#dfn-active" class="internalDFN"><em>active</em></a> state trigger
              timing events as defined in <a href="#timing-events" class="sectionRef">section 5. Timing events</a>.
            </dd>
            <dt><a href="#dfn-current" class="internalDFN">current</a></dt>
            <dd>
              <p>
                The <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> falls either before or
                inside the item's <a href="#dfn-active-interval" class="internalDFN">active interval</a>, <em>or</em> the
                <a href="#dfn-local-time" class="internalDFN">local time</a> of an <a href="#dfn-ancestor" class="internalDFN">ancestor</a> <a href="#dfn-timing-group" class="internalDFN">timing group</a>
                falls before or inside its <a href="#dfn-active-interval" class="internalDFN">active interval</a> thereby
                opening up the possibility that this <a href="#dfn-timed-item" class="internalDFN">timed item</a> might
                play again (e.g. due to repeating).
              </p>
              <p>
                This state is used in the <a href="#script-interface">programming interface</a> to identify
                all <a href="#dfn-animation" class="internalDFN">animations</a> and <a href="#dfn-player" class="internalDFN">players</a> that are likely to be
                of interest.
              </p>
              <p>
                Furthermore, the <a href="#dfn-current" class="internalDFN">current</a> state provides an important
                definition for managing the amount of memory required by
                implementations.
                Assuming a monotonically increasing <a href="#dfn-timeline" class="internalDFN">timeline</a>, in the
                absence of dynamic changes to the model, an implementation can
                safely discard all <a href="#dfn-timed-item" class="internalDFN">timed items</a> that are <em>not</em>
                <a href="#dfn-current" class="internalDFN">current</a> and not referenced elsewhere provided they take
                care to preserve any <a>fill values</a> since they will not have
                any dynamic effect.
              </p>
            </dd>
            <dt><a href="#dfn-in-effect" class="internalDFN">in effect</a></dt>
            <dd>
              The <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> falls either inside the
              item's <a href="#dfn-active-interval" class="internalDFN">active interval</a> or outside the interval but at
              a time where the item's <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> (see <a href="#fill-behavior" class="sectionRef">section 3.7 Fill behavior</a>) causes it to affect
              its target.
              <a href="#dfn-timed-item" class="internalDFN">Timed items</a> only produce a <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> when the
              item is <a href="#dfn-in-effect" class="internalDFN">in effect</a>.
              At all other times, the <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> of a <a href="#dfn-timed-item" class="internalDFN">timed
              item</a> is <code>null</code>.
            </dd>
          </dl>
          <p>
            The normative definition of each of these states follows.
          </p>
        </div>
        <p>
          A <a href="#dfn-timed-item" class="internalDFN">timed item</a> is <dfn id="dfn-scheduled">scheduled</dfn> if <em>either</em> of the
          following conditions is true:
        </p>
        <ol>
          <li>the timed item's <a href="#dfn-local-time" class="internalDFN">local time</a> is not <code>null</code> and is
              less than the item's <code>startDelay</code>, or</li>
          <li>the timed item has a <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a> which is
              a <a href="#dfn-scheduled" class="internalDFN">scheduled</a> timed item.</li>
        </ol>
        <p>
          A <a href="#dfn-timed-item" class="internalDFN">timed item</a> is <dfn id="dfn-active">active</dfn> if <em>all</em> of the
          following conditions are met:
        </p>
        <ol>
          <li>the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> is not
              <code>null</code>, and</li>
          <li>the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> is <em>greater than or
              equal</em> to its <a href="#dfn-start-delay" class="internalDFN">start delay</a>, and</li>
          <li>the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> is <em>less than</em>
              the sum of its <a href="#dfn-start-delay" class="internalDFN">start delay</a> and <a href="#dfn-active-duration" class="internalDFN">active duration</a>.</li>
        </ol>
        <p>
          A timed item is <dfn id="dfn-current">current</dfn> if it is either <a href="#dfn-scheduled" class="internalDFN">scheduled</a> or
          <a href="#dfn-active" class="internalDFN">active</a> or it has a <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a> and the
          <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a> is <a href="#dfn-current" class="internalDFN">current</a>.
        </p>
        <p>
          A timed item is <dfn id="dfn-in-effect">in effect</dfn> if its <a href="#dfn-active-time" class="internalDFN">active time</a> as
          calculated according to the procedure in <a href="#calculating-the-active-time" class="sectionRef">section 3.10.3.1 Calculating the active time</a> is not
          <code>null</code>.
        </p>
      </section>
    </section>

    <section id="fill-behavior">
      <h3><span class="secno">3.7 </span>Fill behavior</h3>
      <p>
        The effect of a <a href="#dfn-timed-item" class="internalDFN">timed item</a> outside its <a href="#dfn-active-interval" class="internalDFN">active interval</a> is
        determined by its <dfn id="dfn-fill-mode">fill mode</dfn>.
      </p>
      <p>
        The possible <a href="#dfn-fill-mode" class="internalDFN">fill modes</a> are:
      </p>
      <ul>
        <li>none,</li>
        <li>forwards,</li>
        <li>backwards, and</li>
        <li>both.</li>
      </ul>
      <p>
        The normative definition of these modes is incorporated in the
        calculation of the <a href="#dfn-active-time" class="internalDFN">active time</a> in <a href="#calculating-the-active-time" class="sectionRef">section 3.10.3.1 Calculating the active time</a>.
      </p>
      <section class="informative" id="fill-modes">
        <h4><span class="secno">3.7.1 </span>Fill modes</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          The effect of each <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> is as follows:
        </p>
        <dl>
          <dt>none</dt>
          <dd>
            The timed item has no effect outside of the <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
          </dd>
          <dt>forwards</dt>
          <dd>
            For times that occur later than the <a href="#dfn-active-interval" class="internalDFN">active interval</a>, the
            timed item will continue to produce the same <a title="transformed time" href="#dfn-transformed-time" class="internalDFN">transformed time value</a> that was used at
            the end of the <a href="#dfn-active-interval" class="internalDFN">active interval</a>.

            For times that occur before the <a href="#dfn-active-interval" class="internalDFN">active interval</a>, the
            timed item will have no effect.
          </dd>
          <dt>backwards</dt>
          <dd>
            For times that occur before the <a href="#dfn-active-interval" class="internalDFN">active interval</a>, the timed
            item will produce the same <a title="transformed time" href="#dfn-transformed-time" class="internalDFN">transformed
            time value</a> that will be used at the start of the <a href="#dfn-active-interval" class="internalDFN">active
            interval</a>.

            For times that occur later than the <a href="#dfn-active-interval" class="internalDFN">active interval</a>, the
            timed item will have no effect.
          </dd>
          <dt>both</dt>
          <dd>
            For times that occur before the <a href="#dfn-active-interval" class="internalDFN">active interval</a>, the
            <span class="prop-value">backwards</span> fill behavior is used.

            For times that occur after the <a href="#dfn-active-interval" class="internalDFN">active interval</a>, the
            <span class="prop-value">forwards</span> fill behavior is used.
          </dd>
        </dl>
        <p>
          Some examples of the these fill modes are illustrated below.
        </p>
        <div class="figure">
          <img src="img/animation-state-and-fill-behavior.svg" width="600" alt="Examples of various fill modes and the states produced.">
        </div>
        <p class="caption">
          Examples of various fill modes and the states produced.<br>
          (a) fill mode &#x2018;none&#x2019;. The timed item has no effect outside
              its active interval.<br>
          (b) fill mode &#x2018;forwards&#x2019;. After the active interval has
              finished, the timed value continues to maintain a fill value.<br>
          (c) fill mode &#x2018;backwards&#x2019;. The timed item produces a fill
              value until the start of the active interval.<br>
          (d) fill mode &#x2018;both&#x2019;. Both before and after the active
              interval the timed item produces a fill value.
        </p> 
        <p class="note">
          Note that setting a fill mode has no bearing on the endpoints of the
          <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
          However, the fill mode <em>does</em> have an effect on various other
          properties of the timing model since the <a href="#dfn-active-time" class="internalDFN">active time</a> of a timed
          item is only defined (that is, not <code>null</code>) inside the
          <a href="#dfn-active-interval" class="internalDFN">active interval</a> <em>or</em> when a fill is applied.
        </p>
        <div class="issue">
          <p>
            As currently defined, when filling, a <a href="#dfn-timed-item" class="internalDFN">timed item</a> uses an
            <a href="#dfn-active-time" class="internalDFN">active time</a> equal to either zero or its <a href="#dfn-active-duration" class="internalDFN">active
            duration</a>, and this is used as the basis for the time which is
            inherited by its children.
          </p>
          <p>
            This has the effect of &#x2018;snapshotting&#x2019; the children for
            the duration of the parent's fill.
            As a result, if a child is active at the boundary of an ancestor's
            <a href="#dfn-active-interval" class="internalDFN">active interval</a> and that ancestor is configured to fill at
            the point, the child will remain active through the ancestor's fill
            even if the child is <em>not</em> configured to fill in the given
            direction.
          </p>
          <p>
            This behavior may be surprising in some circumstances..
            It is particularly noticeable in the case of an ancestor with
            backwards fill, as for the common case where children are aligned at
            the start of the parent's active interval, they will also fill
            backwards regardless of their fill mode.
          </p>
          <p>
            In order to provide control of this behavior we
            are considering modifying the definition of fill to depend on the
            parent's fill state.
            In particular, when a parent is filling, a child will only be active
            (and its descendants thus have an effect) if it too is configured to
            fill in that direction.
          </p>
          <p>
            In order to provide the currently-defined behavior (which we expect
            is useful for many situations), we would likely introduce a new
            'auto' fill mode, which means that a <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s fill mode
            should match that of its parent, if present, or use forward fill
            otherwise.
          </p>
          <p>
            See <a href="http://lists.w3.org/Archives/Public/public-fx/2013AprJun/0184.html">section
            2 (Fill modes on descendants) of minuted discussion from Tokyo 2013
              F2F</a>.
          </p>
        </div>
        <div class="issue">
          <p>
            Currently <a href="#dfn-timing-function" class="internalDFN">timing functions</a> that generate results outside the
            range [0, 1] will behave unexpectedly when applied to animation
            groups, as children will increase iterations or enter into fill mode
            rather than continuing to extrapolate along their defined behavior
            (which is what they would do if the timing function applied to them
            directly).
          </p>
          <p>
            To fix this it is possible we will wish to introduce 'overflow' fill
            modes that respond to time values larger than or smaller than the
            active time range by extrapolating rather than filling.
          </p>
          <p>
            See <a href="http://lists.w3.org/Archives/Public/public-fx/2013AprJun/0184.html">section
            15 (Overflowing fill) of minuted discussion from Tokyo 2013 F2F</a>.
          </p>
        </div>
      </div></section>
    </section>

    <section id="repeating">
      <h3><span class="secno">3.8 </span>Repeating</h3>
      <section id="iteration-intervals">
        <h4><span class="secno">3.8.1 </span>Iteration intervals</h4>
        <p>
          It is possible to specify that a timed item should repeat
          a fixed number of times or indefinitely.
          This repetition occurs <em>within</em> the <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
          The span of time during which a single repetition takes place is
          called an <dfn id="dfn-iteration-interval">iteration interval</dfn>.
        </p>
        <p>
          Unlike the <a href="#dfn-active-interval" class="internalDFN">active interval</a>, a timed item can have multiple
          <a href="#dfn-iteration-interval" class="internalDFN">iteration intervals</a> although typically only the interval
          corresponding to the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> is of interest.
        </p>
        <p>
          The length of a single iteration is called the <dfn id="dfn-iteration-duration">iteration
          duration</dfn>.
          The initial <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of a timed item is simply its
          <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a>.
        </p>
        <p>
          The <dfn id="dfn-intrinsic-iteration-duration">intrinsic iteration duration</dfn> of a timed item is zero,
          however some specific types of timed item such as timing groups
          override this behavior and provide an alternative intrinsic duration
          (see <a href="#the-intrinsic-iteration-duration-of-a-parallel-timing-group" class="sectionRef">section 3.13.3.2 The intrinsic iteration duration of a parallel timing group</a> and <a href="#the-intrinsic-iteration-duration-of-a-sequence-timing-group" class="sectionRef">section 3.13.4.2 The intrinsic iteration duration of a sequence timing group</a>).
        </p>
        <p>
          The <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of a <a href="#dfn-timed-item" class="internalDFN">timed item</a> may be set by the
          author to represent a value other than the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration
          duration</a>.
        </p>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            Comparing the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> and the <a href="#dfn-active-duration" class="internalDFN">active
            duration</a> we have:
          </p>
          <dl>
            <dt>Iteration duration</dt>
            <dd>
              The time taken for a single iteration of the timed item to
              complete.
            </dd>
            <dt>Active duration</dt>
            <dd>
              The time taken for the entire timed item to complete, including
              repetitions.
              This may be longer or shorter than the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>.
            </dd>
          </dl>
          <p>
            The relationship between the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> and <a href="#dfn-active-duration" class="internalDFN">active
            duration</a> is illustrated below.
          </p>
          <div class="figure">
            <img src="img/iteration-intervals.svg" width="600" alt="Comparison of the iteration duration and active time.">
          </div>
          <p class="caption">
            A comparison of the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> and <a href="#dfn-active-duration" class="internalDFN">active
            duration</a> of a timed item with an <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> of 2.5.
            Note that the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> for the final iteration does
            not change, it is simply cut-off by the <a href="#dfn-active-duration" class="internalDFN">active duration</a>.
          </p>
        </div>
      </section>
      <section id="controlling-iteration">
        <h4><span class="secno">3.8.2 </span>Controlling iteration</h4>
        <p>
          The number of times a <a href="#dfn-timed-item" class="internalDFN">timed item</a> repeats is called its
          <dfn id="dfn-iteration-count">iteration count</dfn>.
          The <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> is a real number greater than or equal to
          zero.
          The <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> may also be positive infinity to represent
          that the <a href="#dfn-timed-item" class="internalDFN">timed item</a> repeats indefinitely.
        </p>
        <p>
          In addition to the <a href="#dfn-iteration-count" class="internalDFN">iteration count</a>, <a href="#dfn-timed-item" class="internalDFN">timed items</a> also
          have an <dfn id="dfn-iteration-start">iteration start</dfn> property which specifies an offset
          into the series of iterations at which the <a href="#dfn-timed-item" class="internalDFN">timed item</a> should
          begin.
          The <a href="#dfn-iteration-start" class="internalDFN">iteration start</a> is a finite real number greater than or
          equal to zero.
        </p>
        <p>
          The behavior of these parameters is defined in the calculations in <a href="#core-timed-item-calculations" class="sectionRef">section 3.10 Core timed item calculations</a>.
        </p>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            The effect of the <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> and <a href="#dfn-iteration-start" class="internalDFN">iteration start</a>
            parameters is illustrated below.
          </p>
          <div class="figure">
            <img src="img/iteration-count-and-start.svg" width="600" alt="The effect of the iteration count and iteration start
                    parameters">
          </div>
          <p class="caption">
            The effect of the <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> and <a href="#dfn-iteration-start" class="internalDFN">iteration start</a>
            parameters.<br>
            In the first case the <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> is 2.5 resulting in the
            third iteration being cut-off half way through its <a href="#dfn-iteration-interval" class="internalDFN">iteration
            interval</a>.<br>
            The second case is the same but with an <a href="#dfn-iteration-start" class="internalDFN">iteration start</a> of
            0.5.
            This causes the <a href="#dfn-timed-item" class="internalDFN">timed item</a> to begin half way through the
            first iteration.
          </p>
          <p>
            Unlike the <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> parameter, the <a href="#dfn-iteration-start" class="internalDFN">iteration
            start</a> parameter does not effect the length of the <a href="#dfn-active-duration" class="internalDFN">active
            duration</a>.
          </p>
          <p>
            Note that values of <a href="#dfn-iteration-start" class="internalDFN">iteration start</a> greater than or equal to
            one are generally not useful unless used in combination with an
            <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> that has an <a href="#dfn-accumulation-operation" class="internalDFN">accumulation operation</a>
            property of <a title="accumulation operation sum" href="#dfn-accumulation-operation-sum" class="internalDFN">sum</a>.
          </p>
        </div>
      </section>
      <section class="informative" id="iteration-time-space">
        <h4><span class="secno">3.8.3 </span>Iteration time space</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          We have already encountered different time spaces in describing
          <a>local time and inherited time</a> (see <a href="#local-time-and-inherited-time" class="sectionRef">section 3.6.2 Local time and inherited time</a>).
          Repetition introduces yet another time space: the iteration time
          space.
        </p>
        <p>
          <em>Iteration time space</em> is a time space whose zero time is the
          beginning of a timed item's current iteration.
        </p>
        <p>
          Within the Web Animations model we also refer to <a href="#dfn-active-time" class="internalDFN">active
          time</a> which is a time relative to the beginning of the active
          interval.
          This time space, however, is internal to the model and not exposed in
          the script interface or in markup.
        </p>
        <p>
          These time spaces are illustrated below.
        </p>
        <div class="figure">
          <img src="img/time-spaces.svg" width="600" alt="A comparison of item time, active time, and iteration time.">
        </div>
        <p class="caption">
          A comparison of item time, active time, and iteration time for an
          animation with a iteration duration of 1s and an iteration count of
          2.5.
        </p>
        <p class="note">
          Note that while the time spaces themselves are not bounded, Web
          Animations defines <a href="#dfn-active-time" class="internalDFN">active time</a> and <a href="#dfn-iteration-time" class="internalDFN">iteration
          time</a> such that they are clamped to a set range as shown in the
          diagram.
          For example, whilst a time of -1 second is a valid time in
          <em>active time space</em>, the procedure for calculating the
          <a href="#dfn-active-time" class="internalDFN">active time</a> defined in <a href="#calculating-the-active-time" class="sectionRef">section 3.10.3.1 Calculating the active time</a> will
          never return a negative value.
        </p>
        <p>
          In addition to these time spaces we can also refer to the
          <em>document time space</em> which is time space of the <a href="#dfn-time-value" class="internalDFN">time
          values</a> of the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> of the <a href="http://www.w3.org/TR/html5/browsers.html#active-document">active
          document</a>.
        </p>
      </div></section>
      <section class="informative" id="interval-timing">
        <h4><span class="secno">3.8.4 </span>Interval timing</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          When a timed item repeats we must define the behavior at the iteration
          boundaries.
          For this and indeed for all interval-timing, Web Animations uses an
          endpoint-exclusive timing model.
          This means that whilst the begin time of an interval
          is included in the interval, the end time time is not.
          In interval notation this can written <code>[begin,end)</code>.
          This model provides sensible behavior when intervals are repeated and
          sequenced since there is no overlap between the intervals.
        </p>
        <p>
          In the examples below, for the repeated item, at local time 1s,
          the iteration time is 0.
          For the sequenced items, at inherited time 1s, only item B will be
          <a href="#dfn-active" class="internalDFN">active</a>; there is no overlap.
        </p>
        <div class="figure">
          <img src="img/endpoint-exclusive-timing.svg" width="600" alt="Illustration of end-point exclusive timing.">
        </div>
        <p class="caption">
          Illustration of end-point exclusive timing. For both repeated and
          sequenced timed items there is no overlap at the boundaries between
          intervals.
        </p>
        <p>
          An exception to this behavior is that when performing a <a href="#fill-behavior">fill</a>, if the fill begins at an
          interval endpoint, the endpoint is used.
          This behavior falls out of the algorithm given in <a href="#calculating-the-iteration-time" class="sectionRef">section 3.10.3.3 Calculating the iteration time</a> and is illustrated below.
        </p>
        <div class="figure">
          <img src="img/endpoint-exclusive-timing-and-fill.svg" width="600" alt="Effect of iterations and fill on iteration time.">
        </div>
        <p class="caption">
          After one iteration, the iteration time is 0, but after two iterations
          (and thereonwards), the iteration time is equal to the iteration
          duration due to the special behavior defined when a timed item fills.
        </p>
      </div></section>
    </section>

    <section id="timed-item-speed-control">
      <h3><span class="secno">3.9 </span>Timed item speed control</h3>
      <p>
        Like <a href="#dfn-player" class="internalDFN">players</a>, <a href="#dfn-timed-item" class="internalDFN">timed items</a> also have a <dfn title="timed item playback rate" id="dfn-timed-item-playback-rate">playback rate</dfn> parameter.
        The <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a> of a <a href="#dfn-timed-item" class="internalDFN">timed
        item</a> is a finite real number that acts as a multiplier when
        calculating the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> from its
        <a href="#dfn-local-time" class="internalDFN">local time</a>.
      </p>
      <p>
        The effect of setting the <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback
        rate</a> of a <a href="#dfn-timed-item" class="internalDFN">timed item</a> differs from the setting the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> on a player.
        Its behavior is defined in the timing calculations given in <a href="#core-timed-item-calculations" class="sectionRef">section 3.10 Core timed item calculations</a>.
      </p>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          In summary, the behavior of the <a title="timed item playback
          rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a> of a <a href="#dfn-timed-item" class="internalDFN">timed item</a> is as follows:
        </p>
        <ul>
          <li>
            The <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a> is applied
            only to the <a href="#dfn-active-interval" class="internalDFN">active interval</a> of a <a href="#dfn-timed-item" class="internalDFN">timed item</a> and not to
            the time while it is <a title="start delay" href="#dfn-start-delay" class="internalDFN">delayed</a> or <a title="fill mode" href="#dfn-fill-mode" class="internalDFN">filling</a>.
          </li>
          <li>
            Setting a negative <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback
            rate</a> on a <a href="#dfn-timed-item" class="internalDFN">timed item</a> causes the <a href="#dfn-timed-item" class="internalDFN">timed item</a> to
            begin at the end of its <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
            This differs from the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback
            rate</a> on a <a href="#dfn-player" class="internalDFN">player</a>.
            Setting a <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> on
            a <a href="#dfn-player" class="internalDFN">player</a> to a negative value at a moment before the
            <a href="#dfn-player" class="internalDFN">player</a>'s source content has begun, will result in the
            <a href="#dfn-source-content" class="internalDFN">source content</a> never playing.
          </li>
          <li>
            Setting the <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a> of
            a <a href="#dfn-timed-item" class="internalDFN">timed item</a> affects the calculated value of the <a href="#dfn-active-duration" class="internalDFN">active
            duration</a> (see <a href="#calculating-the-active-duration" class="sectionRef">section 3.10.2 Calculating the active duration</a>).
          </li>
          <li>
            <p>
              Changing the <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a>
              of a <a href="#dfn-timed-item" class="internalDFN">timed item</a> whose <a href="#dfn-local-time" class="internalDFN">local time</a> is within its
              <a href="#dfn-active-interval" class="internalDFN">active interval</a> will cause it to jump.
              This is because the <a href="#dfn-active-duration" class="internalDFN">active duration</a> will be updated but the
              <a href="#dfn-local-time" class="internalDFN">local time</a> will not.
            </p>
            <p>
              Furthermore, if other <a href="#dfn-timed-item" class="internalDFN">timed items</a> depend on the <a href="#dfn-timed-item" class="internalDFN">timed
              item</a>'s <a href="#dfn-active-duration" class="internalDFN">active duration</a>, such as sibling <a href="#dfn-timed-item" class="internalDFN">timed
              items</a> in a <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing group</a>, they too may jump as
              a result of setting the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a>.
            </p>
            <p>
              For runtime speed control the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> of the
              <a href="#dfn-player" class="internalDFN">player</a> should be used.
            </p>
          </li>
        </ul>
      </div>
    </section>

    <section id="core-timed-item-calculations">
      <h3><span class="secno">3.10 </span>Core timed item calculations</h3>
      <section class="informative" id="overview">
        <h4><span class="secno">3.10.1 </span>Overview</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          At the core of the Web Animations timing model is the process that
          takes an <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> value and converts it to an
          <a href="#dfn-iteration-time" class="internalDFN">iteration time</a>.
        </p>
        <p>
          Following this further transformations are applied before resulting at
          a final <a href="#dfn-transformed-time" class="internalDFN">transformed time</a>.
        </p>
        <p>
          The first step in this process is to calculate the boundary when the
          <a href="#dfn-timed-item" class="internalDFN">timed item</a> is <a href="#dfn-active" class="internalDFN">active</a>, that is, the <a href="#dfn-active-duration" class="internalDFN">active
          duration</a>.
        </p>
        <p>
          This process is illustrated below.
        </p>
        <div class="figure">
          <img src="img/active-duration-calculation.svg" width="650" alt="Calculation of the active duration.">
        </div>
        <p class="caption">
          Calculation of the <a href="#dfn-active-duration" class="internalDFN">active duration</a> is based on
          multiplying the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> by the <a href="#dfn-iteration-count" class="internalDFN">iteration
          count</a> and then dividing by the <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a>.
        </p>
        <p>
          The process for calculating the <a href="#dfn-active-duration" class="internalDFN">active duration</a> is normatively
          defined in <a href="#calculating-the-active-duration" class="sectionRef">section 3.10.2 Calculating the active duration</a>.
        </p>
        <p>
          Having established the <a href="#dfn-active-duration" class="internalDFN">active duration</a>, the process for
          transforming a <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> into its
          <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> is illustrated below.
        </p>
        <div class="figure">
          <img src="img/time-calculations.svg" width="650" alt="An overview of timing model calculations.">
        </div>
        <p class="caption">
          An overview of timing model calculations.<br>
          (1) The <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> is converted into a <a href="#dfn-local-time" class="internalDFN">local time</a> by
          incorporating the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a>.<br>
          (2) The <a href="#dfn-local-time" class="internalDFN">local time</a> is converted into an <a href="#dfn-active-time" class="internalDFN">active time</a> by
          incorporating the <a href="#dfn-start-delay" class="internalDFN">start delay</a>.<br>
          (3) The <a>playback rate</a> and <a href="#dfn-iteration-start" class="internalDFN">iteration start</a> properties are
          applied to the <a href="#dfn-active-time" class="internalDFN">active time</a> to produce the <a href="#dfn-scaled-active-time" class="internalDFN">scaled active
          time</a>.<br>
          (4) The <a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> is then converted to an offset
          within a single iteration: the <a href="#dfn-iteration-time" class="internalDFN">iteration time</a>.<br>
          (5) The <a href="#dfn-iteration-time" class="internalDFN">iteration time</a> is converted into a <a href="#dfn-directed-time" class="internalDFN">directed time</a>
          by incorporating the <a href="#dfn-playback-direction" class="internalDFN">playback direction</a>.<br>
          (6) Finally, a timing function is applied to the <a href="#dfn-directed-time" class="internalDFN">directed
          time</a> to produce the <a href="#dfn-transformed-time" class="internalDFN">transformed time</a>.
        </p>
        <p>
          The first step, calculating the <a href="#dfn-local-time" class="internalDFN">local time</a> is described in <a href="#local-time-and-inherited-time" class="sectionRef">section 3.6.2 Local time and inherited time</a>.
          Steps 2 to 4 in the diagram are described in the following sections.
          Steps 5 and 6 are described in
          <a href="#calculating-the-directed-time" class="sectionRef">section 3.11.1 Calculating the directed time</a>
          and
          <a href="#calculating-the-transformed-time" class="sectionRef">section 3.12.6 Calculating the transformed time</a>
          respectively.
        </p>
      </div></section>
      <section id="calculating-the-active-duration">
        <h4><span class="secno">3.10.2 </span>Calculating the active duration</h4>
        <p>
          In order to calculate the <a href="#dfn-active-duration" class="internalDFN">active duration</a> we first define the
          <a href="#dfn-repeated-duration" class="internalDFN">repeated duration</a> as follows:
        </p>
        <blockquote>
          <dfn id="dfn-repeated-duration">repeated duration</dfn> =
            <code><a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> *
                  <a href="#dfn-iteration-count" class="internalDFN">iteration count</a></code>
        </blockquote>
        <p>
          The <a href="#dfn-active-duration" class="internalDFN">active duration</a> is calculated according to the following
          steps:
        </p>
        <ol>
          <li>
            If the <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a> is
            zero, return <code>Infinity</code>.
          </li>
          <li>
            Otherwise, return <code><a href="#dfn-repeated-duration" class="internalDFN">repeated duration</a>
            / abs(<a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a>)</code>.
          </li>
        </ol>
      </section>
      <section id="transforming-the-local-time">
        <h4><span class="secno">3.10.3 </span>Transforming the local time</h4>
        <section id="calculating-the-active-time">
          <h5><span class="secno">3.10.3.1 </span>Calculating the active time</h5>
          <p>
            The <dfn id="dfn-active-time">active time</dfn> is based on the <a href="#dfn-local-time" class="internalDFN">local time</a>
            and <a href="#dfn-start-delay" class="internalDFN">start delay</a>.
            It is defined only when the <a href="#dfn-timed-item" class="internalDFN">timed item</a> is <a href="#dfn-in-effect" class="internalDFN">in effect</a>
            and is calculated according to the following steps:
          </p>
          <ol>
            <li>
              If <a href="#dfn-local-time" class="internalDFN">local time</a> is <code>null</code>, return
              <code>null</code>.
            </li>
            <li>
              If <code><a href="#dfn-local-time" class="internalDFN">local time</a> &lt; <a href="#dfn-start-delay" class="internalDFN">start delay</a></code>
              the result depends on the <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> as follows,
              <dl class="switch">
                <dt>
                  If the <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> is <span class="prop-value">backwards</span> or <span class="prop-value">both</span>,
                </dt>
                <dd>
                  return zero.
                </dd><dd>
                </dd><dt>
                  Otherwise,
                </dt>
                <dd>
                  return <code>null</code>.
                </dd>
              </dl>
            </li>
            <li>
              If <code><a href="#dfn-local-time" class="internalDFN">local time</a> &lt; <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> + <a href="#dfn-active-duration" class="internalDFN">active
              duration</a></code>, return <code><a href="#dfn-local-time" class="internalDFN">local time</a> - <a href="#dfn-start-delay" class="internalDFN">start
              delay</a></code>.
            </li>
            <li>
              Otherwise, the result depends on the <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> as follows,
              <dl class="switch">
                <dt>
                  If the <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> is <span class="prop-value">forwards</span> or <span class="prop-value">both</span>,
                </dt>
                <dd>
                  return the <a href="#dfn-active-duration" class="internalDFN">active duration</a>.
                </dd><dd>
                </dd><dt>
                  Otherwise,
                </dt>
                <dd>
                  return <code>null</code>.
                </dd>
              </dl>
            </li>
          </ol>
        </section>
        <section id="calculating-the-scaled-active-time">
          <h5><span class="secno">3.10.3.2 </span>Calculating the scaled active time</h5>
          <p>
            Before the <a href="#dfn-active-time" class="internalDFN">active time</a> can be converted to an <a href="#dfn-iteration-time" class="internalDFN">iteration
            time</a> we must factor in the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a> and <a href="#dfn-iteration-start" class="internalDFN">iteration
            start</a>.
            The result is called the <a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a>.
          </p>
          <p>
            In order to calculate the <a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> we first
            define the <a href="#dfn-start-offset" class="internalDFN">start offset</a> as follows:
          </p>
          <blockquote>
            <dfn id="dfn-start-offset">start offset</dfn> =
              <code><a href="#dfn-iteration-start" class="internalDFN">iteration start</a> * <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a></code>
          </blockquote>
          <p>
            The <dfn id="dfn-scaled-active-time">scaled active time</dfn> is calculated according to
            the following steps:
          </p>
          <ol>
            <li>
              If the <a href="#dfn-active-time" class="internalDFN">active time</a> is <code>null</code>, return
              <code>null</code>.
            </li>
            <li>
              Return the scaled active time based on the
              <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a> as follows,
              <dl class="switch">
                <dt>If the <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a>
                    is negative,</dt>
                <dd>
                Return <code>(<a href="#dfn-active-time" class="internalDFN">active time</a> -
                              <a href="#dfn-active-duration" class="internalDFN">active duration</a>)
                        * <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a>
                        + <a href="#dfn-start-offset" class="internalDFN">start offset</a></code>.
                </dd>
                <dt>Otherwise,</dt>
                <dd>
                  Return <code><a href="#dfn-active-time" class="internalDFN">active time</a>
                  * <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a>
                  + <a href="#dfn-start-offset" class="internalDFN">start offset</a></code>.
                </dd>
            </dl></li>
          </ol>
        </section>
        <section id="calculating-the-iteration-time">
          <h5><span class="secno">3.10.3.3 </span>Calculating the iteration time</h5>
          <p>
            The <dfn id="dfn-iteration-time">iteration time</dfn> is calculated according to the
            following steps:
          </p>
          <ol>
            <li>
              If the <a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> is <code>null</code>,
              return <code>null</code>.
            </li>
            <li>
              If the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> is zero, return zero.
            </li>
            <li>
              If <code><a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> - <a href="#dfn-start-offset" class="internalDFN">start
              offset</a></code> is equal to the <a href="#dfn-repeated-duration" class="internalDFN">repeated duration</a>,
              and <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> is not zero,
              and <code>(<a href="#dfn-iteration-count" class="internalDFN">iteration count</a> + <a href="#dfn-iteration-start" class="internalDFN">iteration start</a>)
              % 1</code> is zero,
              return the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>.
            </li>
            <li>
              Otherwise, return <code><a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a>
              % <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a></code>.
            </li>
          </ol>
        </section>
      </section>
      <section id="calculating-the-current-iteration">
        <h4><span class="secno">3.10.4 </span>Calculating the current iteration</h4>
        <p>
          The <dfn id="dfn-current-iteration">current iteration</dfn> can be calculated using the
          following steps:
        </p>
        <ol>
          <li>
            If the <a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> is <code>null</code>, return
            <code>null</code>.
          </li>
          <li>
            If the <a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> is zero, return zero.
          </li>
          <li>
            If the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> is zero, return
            <code>floor(<a href="#dfn-iteration-start" class="internalDFN">iteration start</a> + <a href="#dfn-iteration-count" class="internalDFN">iteration count</a>)</code>.
          </li>
          <li>
            If the <a href="#dfn-iteration-time" class="internalDFN">iteration time</a> equals the <a href="#dfn-iteration-duration" class="internalDFN">iteration
            duration</a>, return <code><a href="#dfn-iteration-start" class="internalDFN">iteration start</a>
            + <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> - 1</code>.
          </li>
          <li>
            Return <code>floor(<a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> /
            <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>)</code>.
            <p class="note">
              If the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> is infinite, the
              result of <code>floor(<a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> /
              <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>)</code> will be zero as defined by
              IEEE 754-2008.
            </p>
          </li>
        </ol>
      </section>
    </section>

    <section id="direction-control">
      <h3><span class="secno">3.11 </span>Direction control</h3>
      <p>
        <a href="#dfn-timed-item" class="internalDFN">Timed items</a> may also be configured to run iterations in
        alternative directions using direction control.
        For this purpose, <a href="#dfn-timed-item" class="internalDFN">timed items</a> have a <dfn id="dfn-playback-direction">playback
        direction</dfn> parameter which takes one of the following values:
      </p>
      <ul>
        <li>normal,</li>
        <li>reverse,</li>
        <li>alternate, or</li>
        <li>alternate-reverse.</li>
      </ul>
      <p>
        The semantics of these values are incorporated into the calculation of
        the <a href="#dfn-directed-time" class="internalDFN">directed time</a> which follows.
      </p>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          A non-normative definition of these values is as follows:
        </p>
        <dl>
          <dt>normal</dt>
          <dd>
            All iterations are played as specified.
          </dd>
          <dt>reverse</dt>
          <dd>
            All iterations are played in the reverse direction from the way
            they are specified.
          </dd>
          <dt>alternate</dt>
          <dd>
            Even iterations are played as specified, odd iterations are played
            in the reverse direction from the way they are specified.
          </dd>
          <dt>alternate-reverse</dt>
          <dd>
            Even iterations are played in the reverse direction from the way
            they are specified, odd iterations are played as specified.
          </dd>
        </dl>
      </div>
      <section id="calculating-the-directed-time">
        <h4><span class="secno">3.11.1 </span>Calculating the directed time</h4>
        <p>
          The <dfn id="dfn-directed-time">directed time</dfn> is calculated from the <a href="#dfn-iteration-time" class="internalDFN">iteration
          time</a> using the following steps:
        </p>
        <ol>
          <li>If the <a href="#dfn-iteration-time" class="internalDFN">iteration time</a> is <code>null</code>, return
              <code>null</code>.
          </li><li>
            Calculate the <var>current direction</var> using the first
            matching condition from the following list:
            <dl class="switch">
              <dt>
                If <a href="#dfn-playback-direction" class="internalDFN">playback direction</a> is <code>normal</code>,
              </dt>
              <dd>Let the <var>current direction</var> be forwards.</dd>
              <dt>
                If <a href="#dfn-playback-direction" class="internalDFN">playback direction</a> is <code>reverse</code>,
              </dt>
              <dd>Let the <var>current direction</var> be reverse.</dd>
              <dt>
                Otherwise,
              </dt>
              <dd>
                <ol>
                  <li>
                    Let <var>d</var> be the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a>.
                  </li>
                  <li>
                    If <a href="#dfn-playback-direction" class="internalDFN">playback direction</a> is
                    <code>alternate-reverse</code> increment
                    <var>d</var> by 1.
                  </li>
                  <li>
                    <p class="issue">
                      There used to be a step here which seemed to be adding
                      special handling for filling when the item ends on
                      a repeat boundary but it seems like that is taken care
                      of by the calcuation of <a href="#dfn-iteration-time" class="internalDFN">iteration time</a> and
                      <a href="#dfn-current-iteration" class="internalDFN">current iteration</a>.
                      Is anything actually needed here?
                    </p>
                  </li>
                  <li>
                    If <code><var>d</var> % 2 == 0</code>, let the
                    <var>current direction</var> be forwards, otherwise let
                    the <var>current direction</var> be reverse.
                  </li>
                </ol>
              </dd>
            </dl>
          </li>
          <li>
            If the <var>current direction</var> is forwards then return
            the <a href="#dfn-iteration-time" class="internalDFN">iteration time</a>.
            <p>
              Otherwise, return the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>
              - <a href="#dfn-iteration-time" class="internalDFN">iteration time</a>.
            </p>
          </li>
        </ol>
      </section>
    </section>

    <section id="time-transformations">
      <h3><span class="secno">3.12 </span>Time transformations</h3>
      <section class="informative" id="scaling-the-time">
        <h4><span class="secno">3.12.1 </span>Scaling the time</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          It is often desirable to control the rate at which a <a href="#dfn-timed-item" class="internalDFN">timed item</a>
          progresses.
          For example, easing the rate of animation can create a sense of
          momentum and produce a more natural effect.
          Conversely, in other situations such as when modelling a discrete
          change, a smooth transition is undesirable and instead it is necessary
          for the <a href="#dfn-timed-item" class="internalDFN">timed item</a> to progress in a series of distinct steps.
        </p>
        <p>
          For such situations Web Animations provides <a href="#dfn-timing-function" class="internalDFN">timing functions</a>
          that scale the progress of a <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
        </p>
        <p>
          <a href="#dfn-timing-function" class="internalDFN">Timing functions</a> take an input time fraction and produce
          a scaled output time fraction.
        </p>
        <div class="figure">
          <img src="img/timing-function-example.svg" width="350" alt="Example of a timing function that produces an ease-in effect.">
        </div>
        <p class="caption">
          Example of a timing function that produces a ease-in effect.
          Given a input timing fraction of 0.7, the timing function scales the
          value to produce an output time fraction of 0.52.<br>
          By applying this timing function, time will appear to progress more
          slowly at first but then gradually progress more quickly.
        </p>
        <p>
          Such <a href="#dfn-timing-function" class="internalDFN">timing functions</a> can be applied to an iteration of
          a <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
        </p>
      </div></section>
      <section id="timing-functions">
        <h4><span class="secno">3.12.2 </span>Timing functions</h4>
        <p>
          A <dfn id="dfn-timing-function">timing function</dfn> takes an input time fraction in the range
          [0, 1] and produces an output time fraction whose range is unbounded
          (i.e. positive and negative infinity are permitted).
        </p>
        <p>
          <a href="#dfn-timed-item" class="internalDFN">Timed items</a> have one <a href="#dfn-timing-function" class="internalDFN">timing function</a> associated with
          them.
          The default <a href="#dfn-timing-function" class="internalDFN">timing function</a> is the <dfn id="dfn-linear-timing-function">linear timing
          function</dfn> whose output is identical to its input.
        </p>
        <div class="issue">
          <p>
            We are considering introducing the concept of chained timing
            functions.
          </p>
          <p>
            A chained timing function is composed of a set of primitive timing
            functions, where each primitive timing function maps a limited
            portion of the input range to a portion of the output range.
            Available primitive timing functions include
            <a href="#dfn-cubic-b-zier-timing-function" class="internalDFN">cubic B&#xe9;zier timing functions</a>, <a href="#dfn-step-timing-function" class="internalDFN">step timing functions</a>
            and the <a href="#dfn-linear-timing-function" class="internalDFN">linear timing function</a>.
          </p>
          <p>
            A chained timing function can be configured to explicitly specify
            the input and output ranges of each primitive timing function, or to
            align the input ranges of the primitive timing functions with the
            offsets of the corresponding animation effect's keyframes or path
            segments.
          </p>
          <p>
            See <a href="http://lists.w3.org/Archives/Public/public-fx/2013AprJun/0184.html">section
            5 (Chained timing functions) of minuted discussion from Tokyo
              2013 F2F</a>.
          </p>
        </div>
      </section>
      <section id="scaling-using-a-cubic-b-zier-curve">
        <h4><span class="secno">3.12.3 </span>Scaling using a cubic B&#xe9;zier curve</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            A common method of producing easing effects is to use a cubic B&#xe9;zier
            curve to scale the time.
            The endpoints of the curve are fixed at (0, 0) and (1, 1) while two
            control points <var>P1</var> and <var>P2</var> define the shape of
            the curve.
            Provided the <var>x</var> values of <var>P1</var> and <var>P2</var>
            lie within the range [0, 1] such a curve produces a function that is
            used to map input times (the <var>x</var> values) onto output times
            (the <var>y</var> values).
            This arrangement is illustrated below.
          </p>
          <div class="figure">
            <img src="img/cubic-bezier-timing-curve.svg" width="500" alt="A cubic Bezier curve used as a timing function.">
          </div>
          <p class="caption">
            A cubic B&#xe9;zier curve used as a timing function.<br>
            The shape of the curve is determined by the location of the control
            points <var>P1</var> and <var>P2</var>.<br>
            Input time fractions serve as <var>x</var> values of the curve,
            whilst the <var>y</var> values are the output time fractions.
          </p>
          <p>
            Some example cubic B&#xe9;zier timing functions are illustrated below.
          </p>
          <div class="figure">
            <img src="img/curve-keywords.svg" width="500" alt="The timing functions produced by keyword values.">
          </div>
          <p class="caption">
            The timing functions produced by each of the keyword values
            associated with cubic B&#xe9;zier timing functions accepted by the
            <a href="#widl-Timing-timingFunction" class="idlType"><code>Timing.timingFunction</code></a>
            member from the <a href="#script-interface">script interface</a>.
          </p>
        </div>
        <p>
          A <dfn id="dfn-cubic-b-zier-timing-function">cubic B&#xe9;zier timing function</dfn> is a type of <a href="#dfn-timing-function" class="internalDFN">timing
          function</a> defined by four real numbers that specify the two control
          points, <var>P1</var> and <var>P2</var>, of a cubic B&#xe9;zier curve whose
          end points are fixed at (0, 0) and (1, 1).
          The x coordinates of <var>P1</var> and <var>P2</var> are
          restricted to the range [0, 1].
        </p>
        <p>
          The evaluation of this curve is covered in many sources such as
          [<cite><a class="bibref" href="#bib-FUND-COMP-GRAPHICS">FUND-COMP-GRAPHICS</a></cite>].
        </p>
        <div class="issue">
          <p>
            It has been proposed to extend <code>cubic-bezier</code> to allow
            multiple segments, using syntax such as the following:
          </p>
          <pre>            <code>cubic-bezier( [ &lt;number&gt;{6} ; ]* &lt;number&gt;{4} )</code>
          </pre>
          <p>
            (i.e. the curve starts at (0, 0); each segment is defined by six
            numbers where the start point is the end of the previous segment and
            the numbers define the two control points and the end point. The
            last segment is defined by four numbers since the end point is fixed
            at (1, 1).)
          </p>
          <p>
            This would provide a simpler and more compact syntax for tools
            trying to map arbitrary curves (e.g. bounce functions) to timing
            functions than trying to construct the corresponding chained timing
            function.
          </p>
        </div>
      </section>
      <section id="timing-in-discrete-steps">
        <h4><span class="secno">3.12.4 </span>Timing in discrete steps</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            It is possible to scale a timed item's timing so that the timed item
            occurs in a series of discrete steps using a stepping function.
          </p>
          <p>
            Some example step timing functions are illustrated below.
          </p>
          <div class="figure">
            <img src="img/step-timing-func-examples.svg" width="700" alt="Example step timing functions.">
          </div>
          <p class="caption">
            Example step timing functions.
            In each case the domain is the input time fraction whilst the range
            represents the output time fraction produced by the step
            function.<br>
            The first row shows the function for each transition point when only
            one step is specified whilst the second row shows the same for three
            steps.
          </p>
        </div>
        <p>
          A <dfn id="dfn-step-timing-function">step timing function</dfn> is a type of <a href="#dfn-timing-function" class="internalDFN">timing function</a>
          that divides the input time into a specified number of intervals that
          are equal in duration.
          The output time, starting at zero, rises by an amount equal to the
          interval duration once during each interval at the transition point
          which may be either the start, midpoint, or end of the interval.
        </p>
        <p>
          In keeping with Web Animation's model for endpoint exclusive
          interval timing (see <a href="#interval-timing" class="sectionRef">section 3.8.4 Interval timing</a>), the output time at the transition point is
          the time <em>after</em> applying the increase (i.e. the top of the
          step).
        </p>
      </section>
      <section id="paced-timing">
        <h4><span class="secno">3.12.5 </span>Paced timing</h4>
        <div class="todo">
          <p>Insert a nice diagram showing how this works</p>
        </div>
        <p>
          A <dfn id="dfn-paced-timing-function">paced timing function</dfn> scales the input time such that the
          resulting time values cause a <dfn id="dfn-referenced-property">referenced property</dfn> that is
          animated by a specified <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>, referred to as the
          <dfn id="dfn-paced-effect">paced effect</dfn>,
          to change at a constant rate over the period of time for which the
          paced timing function applies.
        </p>
        <p>
          The syntax for specifying a paced timing function is:
          <code>paced(<a href="http://www.w3.org/TR/css3-syntax/#property">&lt;property&gt;</a>)</code>.
          The <code>&lt;property&gt;</code> argument is the <a href="#dfn-referenced-property" class="internalDFN">referenced
          property</a> of the <a href="#dfn-paced-timing-function" class="internalDFN">paced timing function</a>.
        </p>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            For example, <code>paced(transform)</code> would indicate that the
            time should be scaled such that changes to the <span class="prop-name">transform</span> property occur at a constant
            rate.
          </p>
        </div>
        <p>
          The <a href="#dfn-paced-effect" class="internalDFN">paced effect</a> is the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> specified on
          the same <a href="#dfn-timed-item" class="internalDFN">timed item</a> where the <a href="#dfn-paced-timing-function" class="internalDFN">paced timing function</a> is
          applied.
          As a result, <a href="#dfn-paced-timing-function" class="internalDFN">paced timing functions</a> can only be used on
          <a href="#dfn-animation" class="internalDFN">animations</a> and not other types of <a href="#dfn-timed-item" class="internalDFN">timed items</a>.
        </p>
        <p>
          If <em>any</em> of the following conditions is true, the
          <a href="#dfn-linear-timing-function" class="internalDFN">linear timing function</a> is used for the purpose of timing model
          calculations:
        </p>
        <ul>
          <li>there is no <a href="#dfn-paced-effect" class="internalDFN">paced effect</a> (because the <a href="#dfn-timed-item" class="internalDFN">timed item</a> is
              not an <a href="#dfn-animation" class="internalDFN">animation</a> or does not specify an <a href="#dfn-animation-effect" class="internalDFN">animation
              effect</a>), or
          </li><li>the <a href="#dfn-referenced-property" class="internalDFN">referenced property</a> is not one of the <a href="#dfn-target-properties" class="internalDFN">target
              properties</a> of the <a href="#dfn-paced-effect" class="internalDFN">paced effect</a>, or
          </li><li>the <a href="#dfn-referenced-property" class="internalDFN">referenced property</a> is not <a href="#dfn-interpolable" class="internalDFN">interpolable</a>, or
          </li><li>the <a href="#dfn-referenced-property" class="internalDFN">referenced property</a> is not a valid property.
        </li></ul>
        <section id="evaluating-a-paced-timing-function">
          <h5><span class="secno">3.12.5.1 </span>Evaluating a paced timing function</h5>
          <p>
            The result of evaluating a <a href="#dfn-paced-timing-function" class="internalDFN">paced timing function</a> at
            <var>input time</var> is calculated as follows:
          </p>
          <ol>
            <li>
              Let <var>length list</var> be a sequence of length values
              calculated using the rules defined in <a href="#calculating-the-length-between-two-property-values" class="sectionRef">section 3.12.5.2 Calculating the length between two property values</a>
              for the <a href="#dfn-referenced-property" class="internalDFN">referenced property</a> between each pair of keyframes
              that refers to the <a href="#dfn-referenced-property" class="internalDFN">referenced property</a> in a <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe
              animation effect</a>,
              or between each path segment in a <a href="#dfn-path-animation-effect" class="internalDFN">path animation effect</a>.
              <p class="issue">
                Need to confirm this approach is actually backwards-compatible
                with SVG with regards to motion-path behavior.
              </p>
            </li><li>
              If the number of items in <var>length list</var> is 1 or less let
              the output of the timing function be <var>input time</var> and
              terminate these steps.
            </li><li>
              Let <var>total length</var> be the sum of values in
              <var>length list</var>.
            </li><li>
              If <var>total length</var> is zero let
              the output of the timing function be <var>input time</var> and
              terminate these steps.
            </li><li>
              Let <var>distance</var> be
              <code><var>input time</var> &#xd7; <var>total length</var></code>.
            </li><li>
              Let <var>current position</var> be 0.
            </li><li>
              Let <var>current distance</var> be 0.
            </li><li>
              Let <var>current length</var> be the first value in <var>length
              list</var>.
            </li><li>While <var>distance</var> &gt; <code><var>current distance</var>
              + <var>current length</var></code>, perform the following steps:
              <ol>
                <li>Increment <var>current position</var> by 1.
                </li><li>Increase <var>current distance</var> by <var>current
                    length</var>.
                </li><li>Let <var>current length</var> be the value at
                    position <var>current position</var> in <var>length
                    list</var>.
              </li></ol>
            </li><li>
              The output of the paced timing function is the result of
              evaluating:
              <code><var>current distance</var> / <var>total length</var> + 
                (<var>distance</var> - <var>current distance</var>) / 
                <var>current length</var></code>
          </li></ol>
          <p class="issue">
            Is this algorithm necessary? Would a prose description suffice?
          </p>
        </section>
        <section id="calculating-the-length-between-two-property-values">
          <h5><span class="secno">3.12.5.2 </span>Calculating the length between two property values</h5>
          <p>
            The length between any two property values depends on the type of
            values as follows:
          </p>
          <dl>
            <dt>For numeric values,</dt>
            <dd>
              length is defined as the absolute value of the
              difference between two values.
              <p class="todo">
                Need to explain how this applies to length values.
              </p>
            </dd>
            <dt>For colors,</dt>
            <dd>
              length is defined as the result of evaluating the following
              expression
              <div role="math" aria-describedby="math-color-length">
              <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
              <mrow>
                <msqrt>
                  <msup>
                    <mrow>
                      <mfenced open="(" close=")" separators=",">
                        <mrow><mi>ra</mi><mo>-</mo><mi>rb</mi></mrow></mfenced>
                    </mrow><mn>2</mn>
                  </msup>
                  <mo>+</mo>
                  <msup>
                    <mrow>
                      <mfenced open="(" close=")" separators=",">
                        <mrow><mi>ga</mi><mo>-</mo><mi>gb</mi></mrow></mfenced>
                    </mrow><mn>2</mn>
                  </msup>
                  <mo>+</mo>
                  <msup>
                    <mrow>
                      <mfenced open="(" close=")" separators=",">
                        <mrow><mi>ba</mi><mo>-</mo><mi>bb</mi></mrow></mfenced>
                    </mrow><mn>2</mn>
                  </msup>
                  <mo>+</mo>
                  <mn>255</mn><mo>&#xd7;</mo><mn>255</mn><mo>&#xd7;</mo>
                  <msup>
                    <mrow>
                      <mfenced open="(" close=")" separators=",">
                        <mrow><mi>aa</mi><mo>-</mo><mi>ab</mi></mrow>
                      </mfenced>
                    </mrow><mn>2</mn>
                  </msup>
                </msqrt>
              </mrow>
              </math>
              <pre id="math-color-length">sqrt((ra - rb)^2 + (ga - gb)^2 + (ba - bb)^2 + 255*255*(aa - ab)^2)</pre>
              </div>
              <p>
                where the colors between which the length is to be measured are
                <code>rgba(ra, ga, ba, aa)</code> and
                <code>rgba(rb, gb, bb, ab)</code> respectively.
              </p>
            </dd>
            <dt>For transform values,</dt>
            <dd>
              <p>
                The definition of length for transform values depends on whether
                adjacent keyframe values of the transform property have matching
                first components.
                If the components are translate functions, then euclidean
                distance between the two translation vectors is used. 
                If the components are scale functions, then the absolute
                difference between the average scale values is used.
                If the components are rotate functions, then the absolute
                difference between rotation angles is used.
              </p>
              <p>
                If the components match but are not scale, rotate or translate
                functions, then the <a href="#dfn-linear-timing-function" class="internalDFN">linear timing function</a> is used
                for the purpose of timing model calculations.
              </p>
              <p>
                If the components do not match, then interpolation between the 
                components will require matrix decomposition.
                In this case the length is calculated using the euclidean
                distance between the translate components of the decomposed
                matrices.
              </p>
              <p class="todo">
                Need a reference for euclidean distance.
              </p>
              <p class="todo">
                This only refers to keyframe values.
                Need to explain what to do for paths.
              </p>
            </dd>
          </dl>
        </section>
      </section>
      <section id="calculating-the-transformed-time">
        <h4><span class="secno">3.12.6 </span>Calculating the transformed time</h4>
        <p>
          The <dfn id="dfn-transformed-time">transformed time</dfn> is calculated from the
          <a href="#dfn-directed-time" class="internalDFN">directed time</a> using the following steps:
        </p>
        <ol>
          <li>
            If the <a href="#dfn-directed-time" class="internalDFN">directed time</a> is <code>null</code>,
            return <code>null</code>.
          </li>
          <li>Let <var>iteration fraction</var> be the result of
              evaluating <code><a href="#dfn-directed-time" class="internalDFN">directed time</a> / <a href="#dfn-iteration-duration" class="internalDFN">iteration
              duration</a></code> unless <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> is
              zero, in which case let <var>iteration fraction</var> be
              zero.</li>
          <li>Let <var>scaled fraction</var> be the result of
              evaluating the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-timing-function" class="internalDFN">timing function</a>
              with <var>iteration fraction</var> as the input time
              fraction.
          </li><li>Return the result of evaluating <code><var>scaled
              fraction</var> * <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a></code>.
        </li></ol>
      </section>
    </section>

    <section id="grouping-and-synchronization">
      <h3><span class="secno">3.13 </span>Grouping and synchronization</h3>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          While it is possible to set the timing properties of <a href="#dfn-timed-item" class="internalDFN">timed
          items</a> individually, it is often useful to synchronize <a href="#dfn-timed-item" class="internalDFN">timed
          items</a> so that they share common timing properties and maintain
          their temporal relationship.  This is achieved using a <a href="#dfn-timing-group" class="internalDFN">timing
          group</a>.
        </p>
        <p>
          A simple example is illustrated below.
        </p>
        <div class="figure">
          <img src="img/grouping-delay.svg" width="800" alt="Using groups to share common timing properties.">
        </div>
        <p class="caption">
          Using groups to share common timing properties.<br>
          (a) Shows setting a delay of 5 seconds on individual animations.<br>
          (b) Produces the same effect by setting the delay on the group.
        </p>
        <p>
          When a <a href="#dfn-timing-group" class="internalDFN">timing group</a> is directly associated with
          a <a href="#dfn-player" class="internalDFN">player</a>, the <a href="#dfn-timed-item" class="internalDFN">timed items</a> associated with the <a href="#dfn-timing-group" class="internalDFN">timing
          group</a> can be seeked, paused, and stopped as a unit.
        </p>
      </div>
      <p>
        A <dfn id="dfn-timing-group">timing group</dfn> is a type of <a href="#dfn-timed-item" class="internalDFN">timed item</a> that contains
        an ordered sequence of zero or more <a href="#dfn-timed-item" class="internalDFN">timed items</a> known as <dfn title="child timed item" id="dfn-child-timed-item">child timed items</dfn>.
      </p>
      <p>
        At a given moment, a <a href="#dfn-timed-item" class="internalDFN">timed item</a> may be a <a href="#dfn-child-timed-item" class="internalDFN">child timed item</a>
        of at most one <a href="#dfn-timing-group" class="internalDFN">timing group</a> known as the <dfn id="dfn-parent-timing-group">parent timing
        group</dfn>.
        The <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a> cannot be the same <a href="#dfn-timed-item" class="internalDFN">timed
        item</a> as the <a href="#dfn-child-timed-item" class="internalDFN">child timed item</a> itself.
      </p>
      <p>
        By nesting <a href="#dfn-timing-group" class="internalDFN">timing groups</a> it is possible to create hierarchical
        tree structures.
        The following terms are used to describe the parts and properties of
        such structures and are defined in [<cite><a class="bibref" href="#bib-DOM4">DOM4</a></cite>]:
      </p>
      <ul>
        <li><dfn id="dfn-tree-order"><a href="http://www.w3.org/TR/dom/#concept-tree-order">tree order</a></dfn>
        </li><li><dfn id="dfn-root"><a href="http://www.w3.org/TR/dom/#concept-tree-root">root</a></dfn>
        </li><li><dfn id="dfn-ancestor"><a href="http://www.w3.org/TR/dom/#concept-tree-ancestor">ancestor</a></dfn>
        </li><li><dfn id="dfn-descendant"><a href="http://www.w3.org/TR/dom/#concept-tree-descendant">descendant</a></dfn>
        </li><li><dfn id="dfn-inclusive-ancestor"><a href="http://www.w3.org/TR/dom/#concept-tree-inclusive-ancestor">inclusive ancestor</a></dfn>
        </li><li><dfn id="dfn-inclusive-descendant"><a href="http://www.w3.org/TR/dom/#concept-tree-inclusive-descendant">inclusive descendant</a></dfn>
        </li><li><dfn id="dfn-next-sibling"><a href="http://www.w3.org/TR/dom/#concept-tree-next-sibling">next
        sibling</a></dfn>
        </li><li><dfn id="dfn-previous-sibling"><a href="http://www.w3.org/TR/dom/#concept-tree-previous-sibling">previous
        sibling</a></dfn>
        </li><li><dfn id="dfn-first-child"><a href="http://www.w3.org/TR/dom/#concept-tree-first-child">first child</a></dfn>
        </li><li><dfn id="dfn-last-child"><a href="http://www.w3.org/TR/dom/#concept-tree-last-child">last child</a></dfn>
      </li></ul>
      <p class="note">
        Note that in applying these definitions to <a href="#dfn-timed-item" class="internalDFN">timed items</a>, the term
        <em>parent</em> refers exclusively to a <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a> and
        does not include the <a href="#dfn-player" class="internalDFN">player</a> which with a <a href="#dfn-timed-item" class="internalDFN">timed item</a> may be
        <a title="directly associated with a player" href="#dfn-directly-associated-with-a-player" class="internalDFN">directly associated</a>
        despite the fact that conceptually the <a href="#dfn-player" class="internalDFN">player</a> acts as a parent
        time source.
      </p>
      <p>
        The temporal relationship between a <a href="#dfn-child-timed-item" class="internalDFN">child timed item</a> and its
        <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a> is incorporated in the definition of
        <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> (see <a href="#local-time-and-inherited-time" class="sectionRef">section 3.6.2 Local time and inherited time</a>).
      </p>
      <section class="informative" id="relationship-of-group-time-to-child-time">
        <h4><span class="secno">3.13.1 </span>Relationship of group time to child time</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          The timing of the children of a <a href="#dfn-timing-group" class="internalDFN">timing group</a> is based on the
          timing of the group.
          Specifically, times for the children are based on the parent's
          <a href="#dfn-transformed-time" class="internalDFN">transformed time</a>.
          With regards to repetition, this means the children operate
          <em>inside</em> an iteration of the parent.
        </p>
        <p>
          For example, if a <a href="#dfn-timing-group" class="internalDFN">timing group</a> has an <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> of
          2, then the children of of the group will all play twice since they
          effectively play <em>inside</em> the group's iterations.
        </p>
        <div class="figure">
          <img src="img/grouping-repetition.svg" width="600" alt="The effect of multiple iterations on the children of a
                    group.">
        </div>
        <p class="caption">
          Since children of an <a href="#dfn-timing-group" class="internalDFN">timing group</a> base their timing on the
          group's <a href="#dfn-transformed-time" class="internalDFN">transformed time</a>, when the group repeats, the
          children play again.
        </p>
        <p>
          Note that even in this case, the child <a href="#dfn-timed-item" class="internalDFN">timed items</a> still have
          only <em>one</em> <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
          However, as a result of the parent's timing, the <a href="#dfn-active-interval" class="internalDFN">active
          interval</a> is played twice.
        </p>
        <p>
          If an <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> is specified for the children of a group
          as well as for the group itself, the effect is as if the <a href="#dfn-iteration-count" class="internalDFN">iteration
          count</a> of the group was multiplied with the <a href="#dfn-iteration-count" class="internalDFN">iteration count</a>
          of the children.
        </p>
        <div class="figure">
          <img src="img/grouping-repetition-and-animation-repetition.svg" width="600" alt="Iteration counts are multiplicative.">
        </div>
        <p class="caption">
          Specifying an <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> of 2 on an <a href="#dfn-timing-group" class="internalDFN">timing group</a>
          and an <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> of 3 on one of its children results in
          that child playing 6 times.
        </p>
        <p>
          A further result of the children of a <a href="#dfn-timing-group" class="internalDFN">timing group</a> basing their
          timing on the group's <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> is that they cannot
          animate outside of the group's <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
          This is because the <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> of a group will not
          change outside its <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
          This allows groups to <em>clip</em> the playback of their children.
        </p>
        <div class="figure">
          <img src="img/grouping-clipping.svg" width="600" alt="Groups clip the active interval of contained children.">
        </div>
        <p class="caption">
          In the first instance, a <a href="#dfn-timed-item" class="internalDFN">timed item</a> has a negative delay and an
          infinite <a href="#dfn-iteration-count" class="internalDFN">iteration count</a>.<br>
          However, when a similar <a href="#dfn-timed-item" class="internalDFN">timed item</a> is placed inside a <a href="#dfn-timing-group" class="internalDFN">timing
          group</a> with a specified <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> it has the effect
          of clipping the child <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
        </p>
        <p>
          Some further consequences of <a href="#dfn-timing-group" class="internalDFN">timing group</a> children basing their
          timing on their parent group's <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> are:
        </p>
        <ul>
          <li>
            Setting the <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a> of
            a <a href="#dfn-timing-group" class="internalDFN">timing group</a> will speed up or slow down all children.
          </li>
          <li>
            Changing the <a href="#dfn-playback-direction" class="internalDFN">playback direction</a> of a <a href="#dfn-timing-group" class="internalDFN">timing group</a> will
            change the direction of all children.
          </li>
          <li>
            Applying a <a href="#dfn-timing-function" class="internalDFN">timing function</a> to a <a href="#dfn-timing-group" class="internalDFN">timing group</a> will
            affect the progress of all children.
          </li>
        </ul>
      </div></section>
      <section class="informative" id="types-of-timing-groups">
        <h4><span class="secno">3.13.2 </span>Types of timing groups</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          <a href="#dfn-timing-group" class="internalDFN">Timing groups</a> can be used to provide different kinds of
          synchronization behavior for their children.
          For example, one type of <a href="#dfn-timing-group" class="internalDFN">timing group</a> runs its children in
          parallel, whilst another type runs the children in sequence.
        </p>
        <p>
          Compare the two arrangements illustrated below:
        </p>
        <div class="figure">
          <img src="img/grouping-types.svg" width="600" alt="Two types of timing groups.">
        </div>
        <p class="caption">
          Two types of <a href="#dfn-timing-group" class="internalDFN">timing groups</a>.<br>
          (a) is a <a href="#dfn-parallel-timing-group" class="internalDFN">parallel timing group</a> where all the children run
              simultaneously.<br>
          (b) is a <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing group</a> where the children run in turn.
        </p>
        <p>
          <a href="#dfn-timing-group" class="internalDFN">Timing groups</a> can also contain other <a href="#dfn-timing-group" class="internalDFN">timing groups</a> which
          allows for more sophisticated synchronization.
          An example is illustrated below.
        </p>
        <div class="figure">
          <img src="img/grouping-nesting.svg" width="600" alt="Nesting of timing groups.">
        </div>
        <p class="caption">
          A <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing group</a> that contains a <a href="#dfn-parallel-timing-group" class="internalDFN">parallel timing
          group</a> as a child.<br>
          The <a href="#dfn-parallel-timing-group" class="internalDFN">parallel timing group</a> waits for the previous child of the
          <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing group</a> to finish, and then the children of the
          <a href="#dfn-parallel-timing-group" class="internalDFN">parallel timing group</a> play simultaneously.
          After they have finished the next child of the <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing
          group</a> plays.
        </p>
        <p>
          Web Animations defines two types of <a href="#dfn-timing-group" class="internalDFN">timing groups</a>.
        </p>
        <dl>
          <dt><a href="#dfn-parallel-timing-group" class="internalDFN">Parallel timing groups</a></dt>
          <dd>
            Children of the group play simultaneously.
            The <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> of each child
            coincides with the beginning of the group's <a href="#dfn-iteration-interval" class="internalDFN">iteration
            interval</a>.
          </dd>
          <dt><a href="#dfn-sequence-timing-group" class="internalDFN">Sequence timing groups</a></dt>
          <dd>
            Children of the group play in turn beginning with the first child
            and proceeding to the last.
            The <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> of each child is
            set to the end of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> of the previous
            sibling.
          </dd>
        </dl>
      </div></section>
      <section id="parallel-timing-groups">
        <h4><span class="secno">3.13.3 </span>Parallel timing groups</h4>
        <p>
          A <dfn id="dfn-parallel-timing-group">parallel timing group</dfn> is a type of <a href="#dfn-timing-group" class="internalDFN">timing group</a>
          that schedules its <a href="#dfn-child-timed-item" class="internalDFN">child timed items</a> such that they play
          simultaneously.
        </p>
        <section id="the-start-time-of-children-of-a-parallel-timing-group">
          <h5><span class="secno">3.13.3.1 </span>The start time of children of a parallel timing group</h5>
          <p>
            The <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> of a <a href="#dfn-child-timed-item" class="internalDFN">child
            timed item</a> of a <a href="#dfn-parallel-timing-group" class="internalDFN">parallel timing group</a> is zero.
          </p>
        </section>
        <section id="the-intrinsic-iteration-duration-of-a-parallel-timing-group">
          <h5><span class="secno">3.13.3.2 </span>The intrinsic iteration duration of a parallel timing group</h5>
          <p>
            The <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> of a <a href="#dfn-parallel-timing-group" class="internalDFN">parallel timing
            group</a> is based on the time when the last <a href="#dfn-child-timed-item" class="internalDFN">child timed item</a>
            completes its <a href="#dfn-active-interval" class="internalDFN">active interval</a> and is calculated using the
            following procedure.
          </p>
          <ol>
            <li>
              <p>Define the <a href="#dfn-end-time" class="internalDFN">end time</a> of a <a href="#dfn-timed-item" class="internalDFN">timed item</a> as
              :</p>
              <blockquote>
                <dfn id="dfn-end-time">end time</dfn> =
                <code><a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> + <a href="#dfn-start-delay" class="internalDFN">start
                delay</a> + <a href="#dfn-active-duration" class="internalDFN">active duration</a></code>
              </blockquote>
            </li>
            <li>
              <p>
                The <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> depends on the number of
                <a href="#dfn-child-timed-item" class="internalDFN">child timed items</a> as follows,
              </p>
              <dl class="switch">
                <dt>If the group has no <a href="#dfn-child-timed-item" class="internalDFN">child timed items</a>,</dt>
                <dd>
                  the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> is zero.
                </dd>
                <dt>Otherwise,</dt>
                <dd>
                  <ol>
                    <li>Let <var>maximum end time</var> be the maximum value
                        after calculating the <a href="#dfn-end-time" class="internalDFN">end time</a> of each <a href="#dfn-child-timed-item" class="internalDFN">child
                        timed item</a> in the group.</li>
                    <li>The <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> is the result of
                        evaluating <code>max(0, <var>maximum end
                        time</var>)</code>.</li>
                  </ol>
                </dd>
              </dl>
            </li>
          </ol>
          <p class="note">
            Note that for children of a <a href="#dfn-parallel-timing-group" class="internalDFN">parallel timing group</a>, the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> will always be zero but
            it is included in the definition of <a href="#dfn-end-time" class="internalDFN">end time</a> here since the
            <a href="#dfn-end-time" class="internalDFN">end time</a> is also used to define the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration
            duration</a> of a <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing group</a>
            (see <a href="#the-intrinsic-iteration-duration-of-a-sequence-timing-group" class="sectionRef">section 3.13.4.2 The intrinsic iteration duration of a sequence timing group</a>).
          </p>
        </section>
      </section>
      <section id="sequence-timing-groups">
        <h4><span class="secno">3.13.4 </span>Sequence timing groups</h4>
        <p>
          A <dfn id="dfn-sequence-timing-group">sequence timing group</dfn> is a type of <a href="#dfn-timing-group" class="internalDFN">timing group</a>
          that schedules its <a href="#dfn-child-timed-item" class="internalDFN">child timed items</a> such that they play in
          turn following their order in the group.
          This ordering is achieved by adjusting the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> of each <a href="#dfn-child-timed-item" class="internalDFN">child timed
          item</a> in the group.
        </p>
        <section id="the-start-time-of-children-of-a-sequence-timing-group">
          <h5><span class="secno">3.13.4.1 </span>The start time of children of a sequence timing group</h5>
          <p>
            The <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> of a <a href="#dfn-child-timed-item" class="internalDFN">child
            timed item</a> of a <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing group</a> is the <a href="#dfn-end-time" class="internalDFN">end
            time</a> of the child's <a href="#dfn-previous-sibling" class="internalDFN">previous sibling</a>.
            If the child has no <a href="#dfn-previous-sibling" class="internalDFN">previous sibling</a> the start time is zero.
          </p>
          <div class="note">
            <p>
              When the <a href="#dfn-active-duration" class="internalDFN">active duration</a> is positive infinity the behavior
              for calculating the <a href="#dfn-end-time" class="internalDFN">end time</a> of an <a href="#dfn-timed-item" class="internalDFN">timed item</a> and
              the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> of subsequent
              children follows the usual behavior defined by IEEE 754-2008.
              As a result, if any of the children of a <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing
              group</a> has an infinite <a href="#dfn-active-duration" class="internalDFN">active duration</a>, any children
              that occur later in the sequence will not play.
            </p>
            <p>
              Similarly, the above definition does not restrict
              <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start times</a> to positive
              values and hence some children may not play due to a negative
              <a href="#dfn-start-delay" class="internalDFN">start delay</a> on children that occur earlier in the group
              since their <a href="#dfn-active-interval" class="internalDFN">active interval</a> may end before the group's <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a>.
            </p>
            <p class="todo">
              Need to define if events fire in this case.
            </p>
          </div>
          <div class="informative informative-bg">
            <p><em>This section is non-normative.</em></p><p>
              Because the start of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> is based on the
              sum of a <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> <em>and</em> <a href="#dfn-start-delay" class="internalDFN">start
              delay</a>, the <a href="#dfn-active-interval" class="internalDFN">active intervals</a> of
              children of a <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing group</a> need not run in strict
              sequence but can be shifted back and forth by using the <a href="#dfn-start-delay" class="internalDFN">start
              delay</a> as shown in the following diagram.
            </p>
            <div class="figure">
              <img src="img/sequence-groups-and-start-delays.svg" width="600" alt="Using negative start delays to overlap children of seq
                    groups">
            </div>
            <p>
              A negative <a href="#dfn-start-delay" class="internalDFN">start delay</a> can be used to cause the <a href="#dfn-active-interval" class="internalDFN">active
              interval</a> of two children to overlap.  Note that the <a href="#dfn-start-delay" class="internalDFN">start
              delay</a> affects the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start
              time</a> of subsequent children in the group.
            </p>
          </div>
        </section>
        <section id="the-intrinsic-iteration-duration-of-a-sequence-timing-group">
          <h5><span class="secno">3.13.4.2 </span>The intrinsic iteration duration of a sequence timing group</h5>
          <p>
            The <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> of a <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing
            group</a> is equivalent to the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> of a hypothetical
            <a href="#dfn-child-timed-item" class="internalDFN">child timed item</a> appended to the group's children calculated
            according to the definition in <a href="#the-start-time-of-children-of-a-sequence-timing-group" class="sectionRef">section 3.13.4.1 The start time of children of a sequence timing group</a> unless that produces a negative value, in
            which case the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> is zero.
          </p>
          <p>
            As a result, if the <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing group</a> has no <a href="#dfn-child-timed-item" class="internalDFN">child
            timed items</a> the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> will be
            zero.
          </p>
        </section>
      </section>
    </section>

    <section id="animations">
      <h3><span class="secno">3.14 </span>Animations</h3>
      <p>
        <dfn title="animation" id="dfn-animation">Animations</dfn> are a kind of <a href="#dfn-timed-item" class="internalDFN">timed item</a>
        that apply an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> to an element or pseudo-element
        such as <code>::before</code> and <code>::first-line</code> [<cite><a class="bibref" href="#bib-SELECT">SELECT</a></cite>]
        referred to as the <dfn id="dfn-target-element">target element</dfn>.
      </p>
      <section id="calculating-the-time-fraction">
        <h4><span class="secno">3.14.1 </span>Calculating the time fraction</h4>
        <p>
          Before passing the <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> of an <a href="#dfn-animation" class="internalDFN">animation</a> to
          its <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> it is converted to a <em>time
          fraction</em>.
          The <dfn id="dfn-time-fraction">time fraction</dfn> of a <a href="#dfn-timed-item" class="internalDFN">timed item</a> is calculated
          according to the following steps:
        </p>
        <dl class="switch">
          <dt>
            If the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> is zero,
          </dt>
          <dd>
            <p>
              the <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> is as follows,
            </p>
            <dl class="switch">
              <dt>
                If <a href="#dfn-local-time" class="internalDFN">local time</a> &lt; <a href="#dfn-start-delay" class="internalDFN">start delay</a>,
              </dt>
              <dd>
                Return the result of recalculating the <a href="#dfn-transformed-time" class="internalDFN">transformed time</a>
                using a <a href="#dfn-local-time" class="internalDFN">local time</a> less than <a href="#dfn-start-delay" class="internalDFN">start delay</a> (e.g.
                <code><a href="#dfn-start-delay" class="internalDFN">start delay</a> - 1</code>) and an <a href="#dfn-iteration-duration" class="internalDFN">iteration
                duration</a> of 1.
              </dd>
              <dt>
                Otherwise,
              </dt>
              <dd>
                <ol>
                  <li>Let <var>normalized active duration</var> be the result of
                      recalculating the <a href="#dfn-active-duration" class="internalDFN">active duration</a> using an
                      <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of 1.
                  </li><li>Return the result of recalculating the <a href="#dfn-transformed-time" class="internalDFN">transformed
                      time</a> using a <a href="#dfn-local-time" class="internalDFN">local time</a> of <var>normalized
                      active duration</var> and an <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of
                      1.
                </li></ol>
              </dd>
            </dl>
          </dd>
          <dt>
            Otherwise,
          </dt>
          <dd>
            Return <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> / <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> unless
            <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> is <code>null</code>, in which case return
            <code>null</code>.
          </dd>
        </dl>
        <p class="note">
          Since <a href="#dfn-timing-function" class="internalDFN">timing functions</a> are allowed to produce output times
          outside the range [0, 1] it is possible that the value calculated for
          a <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> also lies outside this range.
        </p>
      </section>
    </section>
    </section> <!-- End of timing model -->

    <section id="animation-model">
      <!--OddPage--><h2><span class="secno">4. </span>Animation model</h2>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          The Web Animations <em>animation model</em> takes the <a href="#dfn-time-fraction" class="internalDFN">time
          fractions</a> and <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> values produced by the
          <em>timing model</em> for a given <a href="#dfn-animation" class="internalDFN">animation</a> and applies it as
          the input to the <a href="#dfn-animation" class="internalDFN">animation</a>'s <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>.
        </p>
        <p>
          The output of each <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> is then combined with other
          <a href="#dfn-animation-effect" class="internalDFN">animation effects</a> using an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> before being
          applied to the target properties (see <a href="#combining-animations" class="sectionRef">section 4.2 Combining animations</a>).
        </p>
      </div>

    <section id="animation-effects">
      <h3><span class="secno">4.1 </span>Animation effects</h3>
      <p>
        An <dfn id="dfn-animation-effect">animation effect</dfn> takes a <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> and
        a <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> value and uses them to calculate an
        <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> for its <a href="#dfn-target-properties" class="internalDFN">target properties</a>.
        Each <a href="#dfn-animation" class="internalDFN">animation</a> may have at most one <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>
        associated with it.
      </p>
      <p>
        Since the result of an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> is based on the
        <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> and <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> value, it is updated
        whenever the timing model is <a title="sampling" href="#dfn-sampling" class="internalDFN">sampled</a>.
        Note that changes to the timing model caused by using the <a href="#script-interface">programming interface</a> do <em>not</em> cause
        the animation model (and hence <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>) to be updated
        as described in <a href="#script-execution-and-live-updates-to-the-model" class="sectionRef">section 6.24 Script execution and live updates to the model</a>.
      </p>
      <section id="target-properties">
        <h4><span class="secno">4.1.1 </span>Target properties</h4>
        <p>
          Each <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> can have zero or more associated
          <dfn id="dfn-target-properties">target properties</dfn>.
          Not all properties may be animated by an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>.
          Properties that may be animated by an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> are 
          defined as <dfn id="dfn-animatable">animatable</dfn>.
          The set of <a href="#dfn-animatable" class="internalDFN">animatable</a> properties is is defined in <a href="#animatable-properties" class="sectionRef">section 4.5 Animatable properties</a>.
        </p>
        <p>
          An <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> that targets a property that is not
          <a href="#dfn-animatable" class="internalDFN">animatable</a> will have no effect on the property.
          However, an <a href="#dfn-animation" class="internalDFN">animation</a> that applies such an <a href="#dfn-animation-effect" class="internalDFN">animation
          effect</a> will still exhibit the usual behavior for a <a href="#dfn-timed-item" class="internalDFN">timed
          item</a> such as firing <a href="#dfn-timing-event" class="internalDFN">timing events</a> and occupying time in
          a <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing group</a>.
        </p>
      </section>
      <section id="target-property-types">
        <h4><span class="secno">4.1.2 </span>Target property types</h4>
        <p>
          The specific operations involved in animating a <a title="target properties" href="#dfn-target-properties" class="internalDFN">target property</a> differ based on the
          <dfn id="dfn-property-type">property type</dfn>.
          For example, the specific procedure for animating a property that
          specifies a color will differ from a property that specifies a length.
          Each <a href="#dfn-animatable" class="internalDFN">animatable</a> property defines one or more <a href="#dfn-property-type" class="internalDFN">property
          types</a> to use when animating.
        </p>
        <p>
          In order to produce a smooth change between property values,
          a procedure for <dfn id="dfn-interpolation">interpolation</dfn> is required.
          A given <a href="#dfn-property-type" class="internalDFN">property type</a> is <dfn id="dfn-interpolable">interpolable</dfn> if there is
          a procedure defined to interpolate between two values of that type.
        </p>
        <p>
          In order to support <a href="#dfn-accumulation" class="internalDFN">accumulation</a> and <a title="composition operation add" href="#dfn-composition-operation-add" class="internalDFN">additive composition</a>,
          a procedure for <dfn id="dfn-addition">addition</dfn> is required.
          A given <a href="#dfn-property-type" class="internalDFN">property type</a> is <dfn id="dfn-additive">additive</dfn> if there is
          a procedure defined to add two values of that type.
        </p>
        <p>
          An initial list of <a href="#dfn-property-type" class="internalDFN">property types</a> and their procedures for
          <a href="#dfn-interpolation" class="internalDFN">interpolation</a> and <a href="#dfn-addition" class="internalDFN">addition</a> is given in <a href="#animation-of-property-types" class="sectionRef">section 4.6 Animation of property types</a>.
          In addition to this initial list, specifications that define CSS
          properties may provide additional property types to define the
          procedures for interpolation and addition of the values of those
          properties.
        </p>
      </section>
      <section id="intermediate-animation-values">
        <h4><span class="secno">4.1.3 </span>Intermediate animation values</h4>
        <p>
          Given a <a href="#dfn-time-fraction" class="internalDFN">time fraction</a>, a <a href="#dfn-current-iteration" class="internalDFN">current iteration</a>, and an
          <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>, an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> produces
          an <dfn id="dfn-intermediate-animation-value">intermediate animation value</dfn> for each <a href="#dfn-animatable" class="internalDFN">animatable</a>
          <a title="target properties" href="#dfn-target-properties" class="internalDFN">target property</a>.
          Before being applied to the <a href="#dfn-target-properties" class="internalDFN">target properties</a>,
          these <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a> are composed together using
          the process defined in <a href="#combining-animations" class="sectionRef">section 4.2 Combining animations</a>.
        </p>
        <div class="issue">
          <p>
            The use of the term 'value' here is misleading, as the output of
            the effect stage can not be resolved to a concrete value until it
            is composited with an underlying value. This takes place in the
            compositing stage, when the animation stack is resolved. It is
            therfore more accurate to describe the output of the effect stage
            as a set of values and corresponding composition operations, which
            are used to modify an underlying value. The same is true of the
            unaccumulated animation value.
          </p>
          <p>
            Use of this more precise terminology will also allow the algorithm
            for accumulation to be specified more precisely.
          </p>
        </div>
        <p>
          An <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> is established by first
          calculating an <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation value</a> and then applying
          <a href="#dfn-accumulation" class="internalDFN">accumulation</a> behavior.
        </p>
        <section id="unaccumulated-animation-values">
          <h5><span class="secno">4.1.3.1 </span>Unaccumulated animation values</h5>
          <p>
            The <dfn id="dfn-unaccumulated-animation-value">unaccumulated animation value</dfn> is the result of
            evaluating an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> for a given <a>target
            property</a>, <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> and <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>
            <em>independent</em> of the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a>.
            The procedure for calculating this value depends on the specific
            type of <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> and is defined subsequently (see <a href="#the-unaccumulated-animation-value-of-a-keyframe-animation-effect" class="sectionRef">section 4.3.1 The unaccumulated animation value of a keyframe animation effect</a> and <a href="#the-unaccumulated-animation-value-of-a-path-animation-effect" class="sectionRef">section 4.4.1 The unaccumulated animation value of a path animation effect</a>).
          </p>
        </section>
        <section id="accumulating-animation-values">
          <h5><span class="secno">4.1.3.2 </span>Accumulating animation values</h5>
          <p>
            <a href="#dfn-animation-effect" class="internalDFN">Animation effects</a> may be defined such that as the
            <a href="#dfn-animation" class="internalDFN">animation</a> that is applying them is <a href="#repeating">repeated</a>, the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation
            value</a> builds on the value produced by previous iterations.
            This behavior is called <dfn id="dfn-accumulation">accumulation</dfn>.
          </p>
          <p>
            The <a href="#dfn-accumulation" class="internalDFN">accumulation</a> behavior of an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> is
            specified by the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>'s <dfn id="dfn-accumulation-operation">accumulation
            operation</dfn> property.
            The <a href="#dfn-accumulation-operation" class="internalDFN">accumulation operation</a> property takes one of the
            following two values.
          </p>
          <dl>
            <dt><dfn title="accumulation operation sum" id="dfn-accumulation-operation-sum">sum</dfn></dt>
            <dd>
              <p>
                The <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> produced by the
                <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> for a given property is the sum of the
                <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation value</a> for the given <a href="#dfn-time-fraction" class="internalDFN">time
                fraction</a> and the final <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a>
                of the previous iteration (i.e. the result of evaluating the
                <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> with a <a href="#dfn-time-fraction" class="internalDFN">time fraction</a>
                of 1, and a <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> of <code><a href="#dfn-current-iteration" class="internalDFN">current
                iteration</a> - 1</code>).
              </p>
              <p>
                If the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> is zero, the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate
                animation value</a> is just the <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation
                value</a>.
              </p>
            </dd>
            <dt><dfn title="accumulation operation none" id="dfn-accumulation-operation-none">none</dfn></dt>
            <dd>
              The <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> for the <a href="#dfn-animation-effect" class="internalDFN">animation
              effect</a> is just the <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation value</a>.
            </dd>
          </dl>
          <p>
            <a href="#dfn-accumulation" class="internalDFN">Accumulation</a> behavior is only applied for <a href="#dfn-target-properties" class="internalDFN">target
            properties</a> that are <a href="#dfn-additive" class="internalDFN">additive</a>.
            For <a href="#dfn-target-properties" class="internalDFN">target properties</a> whose values are not <a href="#dfn-additive" class="internalDFN">additive</a>,
            an <a href="#dfn-accumulation-operation" class="internalDFN">accumulation operation</a> of
            <a title="accumulation operation none" href="#dfn-accumulation-operation-none" class="internalDFN">none</a> is used.
          </p>
          <p>
            <a href="#dfn-accumulation" class="internalDFN">Accumulation</a> behavior is only applied for <a title="keyframe animation effect" href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effects</a>
            when the <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> is uniform across all
            <a href="#dfn-keyframe" class="internalDFN">keyframes</a>.
            For <a title="keyframe animation effect" href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe
            animation effects</a> where the <a href="#dfn-composition-operation" class="internalDFN">composition operation</a>
            varies, an <a href="#dfn-accumulation-operation" class="internalDFN">accumulation operation</a> of <a title="accumulation operation none" href="#dfn-accumulation-operation-none" class="internalDFN">none</a> is used.
          </p>
          <div class="issue">
            The definition of accumulation here needs review.
            The intention is to provide compatible behavior with SVG but also
            needs to account for the possibility of <a href="#dfn-timing-function" class="internalDFN">timing functions</a>
            whose final output value is not 1 (if we allow that), and possible
            differences in the way <a title="composition operation" href="#dfn-composition-operation" class="internalDFN">composition</a> is defined.
          </div>
        </section>
      </section>
    </section>

    <section id="combining-animations">
      <h3><span class="secno">4.2 </span>Combining animations</h3>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          After calculating the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a> for an
          <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> they are applied to the <a href="#dfn-animation-effect" class="internalDFN">animation
          effect</a>'s <a href="#dfn-target-properties" class="internalDFN">target properties</a>.
        </p>
        <p>
          Since it is possible for multiple <a href="#dfn-in-effect" class="internalDFN">in effect</a> <a title="animation" href="#dfn-animation" class="internalDFN">animations</a> to target the same property it is
          often necessary to combine the results of several <a href="#dfn-animation-effect" class="internalDFN">animation
          effects</a> together.
          This process is called <em>compositing</em> and is based on
          establishing an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> for each property targetted by
          an <a href="#dfn-in-effect" class="internalDFN">in effect</a> <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>.
        </p>
        <p>
          After compositing the results of <a href="#dfn-animation-effect" class="internalDFN">animation
          effects</a> together, the composited result is combined with other
          styles applied to the <a title="target properties" href="#dfn-target-properties" class="internalDFN">target
          property</a>.
        </p>
        <p>
          An overview of this arrangement is illustrated below:
        </p>
        <div class="figure">
          <img src="img/animation-cascade.svg" width="450" alt="Overview of the application of intermediate animation values
                to their target properties">
        </div>
        <p class="caption">
          Overview of the application of <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a> to
          their <a href="#dfn-target-properties" class="internalDFN">target properties</a>.<br>
          The results of <a href="#dfn-animation-effect" class="internalDFN">animation effects</a> targetting the same property
          are composited together using an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>.<br>
          The result of this composition is written to an override stylesheet
          that is more important than other stylesheets but less than any
          <code>!important</code> rules.
        </p>
        <p>
          For the first part of this operation&#x2014;combining <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate
          animation values</a> that target the same <a title="target property">property</a>&#x2014; it is necessary to
          determine both
          <em>how</em> the <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>
          associated with the <a href="#dfn-animation" class="internalDFN">animations</a> are combined
          with one another,
          as well as the <em>order</em> in which they are applied, that is,
          their relative <em>priority</em>.
        </p>
        <p>
          The matter of <em>how</em> <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a> are
          combined is governed by any <a href="#dfn-composition-operation" class="internalDFN">composition operations</a> associated
          with the corresponding <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>.
        </p>
        <p>
          The relative <em>priority</em> of <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a>
          is determined by an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> established for each
          animated property.
        </p>
      </div>
      <section id="the-animation-stack">
        <h4><span class="secno">4.2.1 </span>The animation stack</h4>
        <p>
          Associated with each property <a title="target property">targetted</a>
          by one or more <a href="#dfn-animation-effect" class="internalDFN">animation effects</a> is an <dfn id="dfn-animation-stack">animation
          stack</dfn> that establishes the relative priority of the <a href="#dfn-animation-effect" class="internalDFN">animation
          effects</a>.
        </p>
        <p>
          The relative priority of any two <a href="#dfn-animation-effect" class="internalDFN">animation
          effects</a>, <var>A</var> and <var>B</var>, within an <a href="#dfn-animation-stack" class="internalDFN">animation
          stack</a> is established by comparing the properties of the
          <a href="#dfn-animation" class="internalDFN">animations</a> applying <var>A</var> and <var>B</var> as follows:
        </p>
        <ol>
          <li>Let the <var>associated player</var> of an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>
              be the <a href="#dfn-player" class="internalDFN">player</a> <a title="associated with a player">associated</a> with the
              <a href="#dfn-animation" class="internalDFN">animation</a> that is applying the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> to
              the property with which this <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> is
              associated.
          </li><li>Sort <var>A</var> and <var>B</var> by applying the following
              conditions in turn until the order is resolved,
            <ol>
              <li>Sort <var>A</var> and <var>B</var> using any <a href="#dfn-custom-animation-priority" class="internalDFN">custom
                  animation priority</a> specified for <var>A</var> and
                  <var>B</var> so that lower priorities sort first.
              </li><li>Sort <var>A</var> and <var>B</var> by the <a href="#dfn-player-start-time" class="internalDFN">player start
                  time</a> of the <var>associated player</var> of each
                  of <var>A</var> and <var>B</var> so that earlier times sort
                  first.
              </li><li>Sort by the <a href="#dfn-player-sequence-number" class="internalDFN">player sequence number</a> so that lower
                  sequence numbers sort first.
              </li><li>Sort <var>A</var> and <var>B</var> in <a href="#dfn-tree-order" class="internalDFN">tree order</a>.
           </li></ol>
        </li></ol>
        <p>
          <a href="#dfn-animation-effect" class="internalDFN">Animation effects</a> that sort earlier have <em>lower</em>
          priority.
        </p>
        <section id="the-custom-animation-priority">
          <h5><span class="secno">4.2.1.1 </span>The custom animation priority</h5>
          <p>
            Each <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> has an associated numeric
            <dfn id="dfn-custom-animation-priority">custom animation priority</dfn> that is used to provide
            high-level control of animation priority for specifications layered
            on top of Web Animations.
            The initial value of the <a href="#dfn-custom-animation-priority" class="internalDFN">custom animation priority</a> is zero.
          </p>
          <div class="note">
            <p>
              Note that the <a href="#dfn-custom-animation-priority" class="internalDFN">custom animation priority</a> is primarily
              intended to be used to prioritize animation effects at
              a high-level, such as to prioritize animations <em>by type</em>.
              For example, it can be used to ensure that CSS Animations always
              override CSS Transitions.
            </p>
            <p>
              It is possible to control animation priority at a lower-level by
              setting the <a href="#dfn-player-start-time" class="internalDFN">player start time</a> appropriately,
              (possibly after making compensatory adjustments to the <a href="#dfn-start-delay" class="internalDFN">start
              delay</a> of the <a href="#dfn-source-content" class="internalDFN">source content</a>) or influencing the
              <a href="#dfn-player-sequence-number" class="internalDFN">player sequence number</a> by controlling when <a href="#dfn-player" class="internalDFN">players</a>
              are created.
            </p>
          </div>
        </section>
      </section>
      <section id="calculating-the-result-of-an-animation-stack">
        <h4><span class="secno">4.2.2 </span>Calculating the result of an animation stack</h4>
        <p>
          In order to calculate the final value of an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>,
          the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a> of each
          <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> in the stack are combined in order of priority
          from lowest to highest priority.
        </p>
        <p>
          Each step in the process of evaluating an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> takes
          an <dfn id="dfn-underlying-value">underlying value</dfn> as input.
          The initial <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> is the <a href="#dfn-base-value" class="internalDFN">base value</a> of the
          target property as defined in <a href="#combining-with-other-styles--the-override-stylesheet" class="sectionRef">section 4.2.4 Combining with other styles: the override stylesheet</a>.
        </p>
        <p>
          For each <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> in the stack, the appropriate
          <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> from the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>
          is combined with the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> to produce a new value.
          This resulting value becomes the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> for combining
          the next <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> in the stack.
        </p>
        <p>
          The final value of an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>, called the
          <dfn id="dfn-composited-value">composited value</dfn>, is simply the result of combining the
          <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> of the final (highest priority)
          <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> in the stack with the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>
          at that point.
        </p>
      </section>
      <section id="animation-composition">
        <h4><span class="secno">4.2.3 </span>Animation composition</h4>
        <p>
          The specific operation used to combine an <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation
          value</a> with an <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> is determined by the
          <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> that produced the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation
          value</a> and is called the <dfn id="dfn-composition-operation">composition operation</dfn>.
        </p>
        <p>
          This specification defines two common <a href="#dfn-composition-operation" class="internalDFN">composition operations</a> as
          follows:
        </p>
        <dl>
          <dt><dfn title="composition operation replace" id="dfn-composition-operation-replace">replace</dfn></dt>
          <dd>
            The result of compositing the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a>
            with the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> is simply the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate
            animation value</a>.
          </dd>
          <dt><dfn title="composition operation add" id="dfn-composition-operation-add">add</dfn></dt>
          <dd>
            <p>
              The <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> is <a title="addition" href="#dfn-addition" class="internalDFN">added</a> to the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>.
              For <a href="#dfn-property-type" class="internalDFN">property types</a> where
              <a href="#dfn-addition" class="internalDFN">addition</a> is defined such that it is not commutative, the
              order of the operands is <code><a href="#dfn-underlying-value" class="internalDFN">underlying value</a>
              + <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a></code>.
            </p>
            <p>
              If <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> and <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>
              are not of the same <a href="#dfn-property-type" class="internalDFN">property type</a>, or if they are of the
              same <a href="#dfn-property-type" class="internalDFN">property type</a> but that <a href="#dfn-property-type" class="internalDFN">property type</a> is not
              <a href="#dfn-additive" class="internalDFN">additive</a>, <a title="composition operation replace" href="#dfn-composition-operation-replace" class="internalDFN">replace</a> behavior is
              applied.
            </p>
          </dd>
        </dl>
      </section>
      <section id="combining-with-other-styles--the-override-stylesheet">
        <h4><span class="secno">4.2.4 </span>Combining with other styles: the override stylesheet</h4>
        <p>
          Applying a <a href="#dfn-composited-value" class="internalDFN">composited value</a> to a property depends on
          establishing an <a href="#dfn-override-stylesheet" class="internalDFN">override stylesheet</a>.
        </p>
        <p>
          The <dfn id="dfn-override-stylesheet">override stylesheet</dfn> contains
          <a title="composited value" href="#dfn-composited-value" class="internalDFN">composited animation values</a>
          and acts with a higher priority than all other stylesheets.
          However, <code>!important</code> rules from all other stylesheets act
          with a higher priority than the <a href="#dfn-override-stylesheet" class="internalDFN">override stylesheet</a>.
          The <a href="#dfn-override-stylesheet" class="internalDFN">override stylesheet</a> is regenerated each time the
          <a>animation model</a> is updated (see <a href="#animation-effects" class="sectionRef">section 4.1 Animation effects</a>).
        </p>
        <p>
        </p>
        <p>
          The <a href="#dfn-composited-value" class="internalDFN">composited value</a> calculated for a property is applied
          using the following process.
        </p>
        <ol>
          <li>Calculate the <dfn id="dfn-base-value">base value</dfn> of the property as
              the value generated for that property by computing the <a href="http://www.w3.org/TR/CSS2/cascade.html#used-value">used
              value</a> [<cite><a class="bibref" href="#bib-CSS21">CSS21</a></cite>] for that property in the absence of the
              <a href="#dfn-override-stylesheet" class="internalDFN">override stylesheet</a>.</li>
          <li>Establish the <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> for the property (see <a href="#the-animation-stack" class="sectionRef">section 4.2.1 The animation stack</a>).</li>
          <li>Calculate the <a href="#dfn-composited-value" class="internalDFN">composited value</a> of the <a href="#dfn-animation-stack" class="internalDFN">animation
              stack</a> passing in the <a href="#dfn-base-value" class="internalDFN">base value</a> of the property as the
              initial <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> (see <a href="#calculating-the-result-of-an-animation-stack" class="sectionRef">section 4.2.2 Calculating the result of an animation stack</a>).</li>
          <li>Insert the <a href="#dfn-composited-value" class="internalDFN">composited value</a> into the <a href="#dfn-override-stylesheet" class="internalDFN">override
              stylesheet</a>.</li>
        </ol>
      </section>
    </section>

    <section id="keyframe-animation-effects">
      <h3><span class="secno">4.3 </span>Keyframe animation effects</h3>
      <p>
        A <dfn id="dfn-keyframe-animation-effect">keyframe animation effect</dfn> is an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>
        that produces <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a> for its <a href="#dfn-target-properties" class="internalDFN">target
        properties</a> by interpolating between a series of property values
        positioned at fractional offsets.
      </p>
      <p>
        Each set of property values indexed by a positional offset is called
        a <dfn id="dfn-keyframe">keyframe</dfn>.
      </p>
      <p>
        The <dfn id="dfn-positional-offset-of-a-keyframe">positional offset of a keyframe</dfn> is a value in the range
        [0, 1].
        The list of <a href="#dfn-keyframe" class="internalDFN">keyframes</a> for a <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effect</a> is
        sorted in ascending order by the <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offset of each
        keyframe</a>.
      </p>
      <p class="note">
        Unlike CSS syntax, <a href="#dfn-timing-function" class="internalDFN">timing functions</a> are <em>not</em> directly
        associated with a <a href="#dfn-keyframe" class="internalDFN">keyframe</a>.
        Rather, this is achieved by setting a chain of <a href="#dfn-timing-function" class="internalDFN">timing functions</a>
        on the <a href="#dfn-timed-item" class="internalDFN">timed item</a> (proposal for this is still in the works).
      </p>
      <p>
        If, due to a <a href="#dfn-timing-function" class="internalDFN">timing function</a> specified on the <a href="#dfn-timed-item" class="internalDFN">timed
        item</a> from which the <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> is derived, the <a href="#dfn-time-fraction" class="internalDFN">time
        fraction</a> lies outside the range [0, 1], the specified
        <a href="#dfn-keyframe" class="internalDFN">keyframe</a> property values are extrapolated to cover the extended
        range.
      </p>
      <p>
        The behavior when <a href="#dfn-keyframe" class="internalDFN">keyframes</a> overlap or have unsupported values
        is defined in <a href="#the-unaccumulated-animation-value-of-a-keyframe-animation-effect" class="sectionRef">section 4.3.1 The unaccumulated animation value of a keyframe animation effect</a>.
      </p>
      <p>
        Each <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effect</a> has an associated <a href="#dfn-composition-operation" class="internalDFN">composition
        operation</a> that specifies how it is combined with other <a href="#dfn-animation-effect" class="internalDFN">animation
        effects</a> in the <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>.
      </p>
      <p>
        Furthermore, each <a href="#dfn-keyframe" class="internalDFN">keyframe</a> may also have an associated
        <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> that is applied to all values specified in
        that <a href="#dfn-keyframe" class="internalDFN">keyframe</a>.
        If no <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> is specified for a <a href="#dfn-keyframe" class="internalDFN">keyframe</a>,
        the <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> specified for the <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe
        animation effect</a> is used.
      </p>
      <section id="the-unaccumulated-animation-value-of-a-keyframe-animation-effect">              
        <h4><span class="secno">4.3.1 </span>The unaccumulated animation value of a keyframe animation effect</h4>
        <p>
          The <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation value</a> of a single property
          referenced by a <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effect</a> as one of its
          <a href="#dfn-target-properties" class="internalDFN">target properties</a>, for a given <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> and
          <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> is calculated as follows.
        </p>
        <ol>
          <li>Let <var>target property</var> be the property for which the
              <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation value</a> is to be calculated.
          </li><li>If <var>target property</var> is not <a href="#dfn-animatable" class="internalDFN">animatable</a> abort the
              procedure since the effect cannot be applied.</li>
          <li>Let <var>time fraction</var> be the <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> for which
              the <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation value</a> is to be calculated.</li>
          <li>Let <var>underlying value</var> be the current <a href="#dfn-underlying-value" class="internalDFN">underlying
              value</a>.
          </li><li>Define the <dfn id="dfn-neutral-value-for-composition">neutral value for composition</dfn> as a value
              which, when combined with an <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> using the <a title="composition operation add" href="#dfn-composition-operation-add" class="internalDFN">add</a> <a href="#dfn-composition-operation" class="internalDFN">composition
              operation</a>, produces the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>.
              <p class="note">
                Note that this definition does not require determining
                a suitable zero value for each possible <a href="#dfn-property-type" class="internalDFN">property type</a>.
                This behavior could be realized, for example, by use of
                a sentinel value.
              </p>
          </li><li>Let <var>property-specific keyframes</var> be a copy of the list
              of <a href="#dfn-keyframe" class="internalDFN">keyframes</a> specified on the effect.</li>
          <li>Remove any <a href="#dfn-keyframe" class="internalDFN">keyframes</a> from <var>property-specific
              keyframes</var> that do not have a property value for
              <var>target property</var>.
          </li><li>If <var>property-specific keyframes</var> is empty, return
              <var>underlying value</var>.
          </li><li>If there is no <a href="#dfn-keyframe" class="internalDFN">keyframe</a> with a <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offset</a> of
              0, create a new <a href="#dfn-keyframe" class="internalDFN">keyframe</a> with a positional offset of 0,
              a property value set to the <a href="#dfn-neutral-value-for-composition" class="internalDFN">neutral value for composition</a>,
              and a <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> of <a title="composition
              operation add" href="#dfn-composition-operation-add" class="internalDFN">add</a>, and add it to the beginning of
              <var>property-specific keyframes</var>.
          </li><li>Similarly, if there is no <a href="#dfn-keyframe" class="internalDFN">keyframe</a> with a <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offset</a> of
              1, create a new <a href="#dfn-keyframe" class="internalDFN">keyframe</a> with a positional offset of 1,
              a property value set to the <a href="#dfn-neutral-value-for-composition" class="internalDFN">neutral value for composition</a>,
              and a <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> of <a title="composition
              operation add" href="#dfn-composition-operation-add" class="internalDFN">add</a>, and append it to the end of
              <var>property-specific keyframes</var>.
          </li><li>Iterate over each <var>keyframe</var> in <var>property-specific
              keyframes</var> and for each <var>keyframe</var>, if:
              <ul>
                <li><var>keyframe</var> has a <a href="#dfn-composition-operation" class="internalDFN">composition operation</a>
                    of <a title="composition operation add" href="#dfn-composition-operation-add" class="internalDFN">add</a>, or
                </li><li><var>keyframe</var> has no <a href="#dfn-composition-operation" class="internalDFN">composition operation</a>
                    and the <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> of this <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe
                    animation effect</a> is <a title="composition operation add" href="#dfn-composition-operation-add" class="internalDFN">add</a>
              </li></ul>
              perform the following steps:
              <ol>
                <li>Let <var>value to add</var> be the property value of
                    <var>target property</var> specified on <var>keyframe</var>.
                </li><li>If the <a href="#dfn-property-type" class="internalDFN">property type</a> of <var>underlying value</var>
                    and <var>value to add</var> is the same and is
                    <a href="#dfn-additive" class="internalDFN">additive</a>, set the property value of <var>target
                    property</var> for <var>keyframe</var> to
                    <code><var>underlying value</var> + <var>value to
                    add</var></code>.
              </li></ol>
          </li><li>If <var>time fraction</var> &lt; 0 and there is more
              than one <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>property-specific
              keyframes</var> with a positional offset of 0, return the property
              value for <var>target property</var> of the first <a href="#dfn-keyframe" class="internalDFN">keyframe</a>
              in <var>property-specific keyframes</var>.</li>
          <li>If <var>time fraction</var> &#x2265; 1 and there is more than one
              <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>property-specific keyframes</var> with
              a positional offset of 1, return the property value for
              <var>target property</var> of the last <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in
              <var>property-specific keyframes</var>.</li>
          <li>Let <var>start keyframe</var> be the last <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in
              <var>property-specific keyframes</var> whose positional offset is
              less than or equal to <var>time fraction</var> and less than 1.
              If there is no such <a href="#dfn-keyframe" class="internalDFN">keyframe</a> (because, for example, the
              <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> is negative), let <var>start keyframe</var>
              be the last <a href="#dfn-keyframe" class="internalDFN">keyframe</a> whose positional offset is 0.</li>
          <li>Let <var>end keyframe</var> be the next <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in
              <var>property-specific keyframes</var> after <var>start
              keyframe</var>.</li>
          <li>Let <var>start offset</var> be the positional offset of <var>start
              keyframe</var>.</li>
          <li>Let <var>end offset</var> be the offset of <var>end
              keyframe</var>.</li>
          <li>
            Let <var>interval distance</var> be the result of evaluating
            <code>(<var>time fraction</var> - <var>start offset</var>) /
                  (<var>end offset</var> - <var>start offset</var>)</code>
          </li>
          <li>
            Return the result of <a title="interpolation" href="#dfn-interpolation" class="internalDFN">interpolating</a>
            between the property values defined for <var>start keyframe</var>
            and <var>end keyframe</var> using the procedure defined for their
            <a href="#dfn-property-type" class="internalDFN">property type</a> with <var>interval distance</var> as the
            interpolation parameter.
          </li>
        </ol>
        <div class="note">
          <p>Note that this procedure assumes the following about the list of
             <a href="#dfn-keyframe" class="internalDFN">keyframes</a> specified on the effect:</p>
          <ul>
            <li>Each <a href="#dfn-keyframe" class="internalDFN">keyframe</a> has a specified <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offset</a> in
                the range [0, 1].
            </li><li>The list of <a href="#dfn-keyframe" class="internalDFN">keyframes</a> is sorted in ascending order by
                <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional
                offset</a>.
            </li><li>Each specified property value is a valid and supported value.
            </li><li>For a given property, there is a most one specified property
                value on each keyframe.
          </li></ul>
          <p>
            It is the responsibility of the user of the model (for example,
            a declarative markup or programming interface) to ensure these
            conditions are met.
          </p>
        </div>
        <p class="note">
          Note that this procedure permits overlapping <a href="#dfn-keyframe" class="internalDFN">keyframes</a>.
          The behavior is that at the point of overlap the output value jumps to
          the value of last defined <a href="#dfn-keyframe" class="internalDFN">keyframe</a> at that offset.
          For overlapping frames at 0 or 1, the output value for <a title="time fraction" href="#dfn-time-fraction" class="internalDFN">time fractions</a> less than 0 or greater than
          or equal to 1 is the value of the first <a href="#dfn-keyframe" class="internalDFN">keyframe</a> or the last
          <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>keyframes</var> respectively.
        </p>
        <div class="issue">
          <p>
            In the presence of certain timing functions, the input time
            fraction to an animation effect is not limited to the range [0, 1].
            Currently, however, keyframe offsets are limited to the range
            [0, 1] and property values are simply extrapolated for input time
            fractions outside this range. We are considering removing this
            restriction for the following reasons.
          </p>
          <p>
            We are considering removing the restriction since cases exist where
            it is useful to be able to specify non-linear changes in property
            values at time fractions outside the range [0, 1].
          </p>
          <p>
            While this effect could be achieved by careful modification of the
            timing function, this approach is complex and breaks the model's
            separation of timing concerns from animation effects. An example is
            an animation which is subject to an 'overshoot' timing function and
            which has an effect that sweeps through a non-linear color space.
          </p>
          <p>
            See <a href="http://lists.w3.org/Archives/Public/public-fx/2013AprJun/0184.html">section
            4 (Keyframe offsets outside [0, 1]) of minuted discussion from Tokyo
              2013 F2F</a>.
          </p>
        </div>
      </section>
      <section id="procedure-for-evenly-distributing-keyframes">              
        <h4><span class="secno">4.3.2 </span>Procedure for evenly distributing keyframes</h4>
        <p>
          Whilst the Web Animations model assumes a sorted list of
          <a href="#dfn-keyframe" class="internalDFN">keyframes</a> with specified <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offsets</a> in the
          range [0, 1] many users of the model require a facility for
          automatically distributing keyframes when positional offsets are not
          provided.
          A procedure for evenly distributing keyframes with unspecified
          positional offsets is provided below.
        </p>
        <p>
          Given a list of <a href="#dfn-keyframe" class="internalDFN">keyframes</a> whose <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offets</a> are
          either a real number in the range [0, 1] or unspecified,
          we define such as list as <dfn id="dfn-loosely-sorted-by-offset">loosely sorted by offset</dfn> if, for
          each <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in the list that has a specified offset, the
          offset is greater than or equal to the offset of the previous
          <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in the list with a specified offset, if any.
        </p>
        <p>
          Given a list of <a href="#dfn-keyframe" class="internalDFN">keyframes</a>, <var>initial keyframe list</var>,
          that is <a href="#dfn-loosely-sorted-by-offset" class="internalDFN">loosely sorted by offset</a> we can evenly distribute the
          <a href="#dfn-keyframe" class="internalDFN">keyframes</a> with unspecified <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offsets</a> between
          those frames with specified offsets using the following procedure:
        </p>
        <ol>
          <li>Let <var>distributed keyframes</var> be a copy of <var>initial
              keyframe list</var>.
          </li><li>If <var>distributed keyframes</var> contains more than one
              <a href="#dfn-keyframe" class="internalDFN">keyframe</a> and the <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offset</a> of
              the first <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>distributed keyframes</var> is
              unspecified, set the <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offset</a> of
              the first <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>distributed keyframes</var> to
              0.
          </li><li>If the <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional
              offset</a> of the last <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>distributed
              keyframes</var> is unspecified, set its <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offset</a> to
              1.
          </li><li>Set the offset of all <a href="#dfn-keyframe" class="internalDFN">keyframes</a> in <var>distributed
              keyframes</var> without a specified <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offset</a> as
              so that for a <a href="#dfn-keyframe" class="internalDFN">keyframe</a>, <var>k</var>, without a specified
              offset, if:
              <ul>
                <li><var>a</var> is the positional offset of the last
                    <a href="#dfn-keyframe" class="internalDFN">keyframe</a> with a specified offset appearing in
                    <var>distributed keyframes</var> before <var>k</var>,
                </li><li><var>b</var> is the positional offset of the first
                    <a href="#dfn-keyframe" class="internalDFN">keyframe</a> with a specified offset appearing in
                    <var>pre-processed keyframes</var> after <var>k</var>,
                </li><li><var>n</var> is the number of <a href="#dfn-keyframe" class="internalDFN">keyframes</a> between
                    <var>a</var> and <var>b</var>, and
                </li><li><var>i</var> is the index of <var>k</var> among the
                    <a href="#dfn-keyframe" class="internalDFN">keyframes</a> between <var>a</var> and <var>b</var>
                    such that the first <a href="#dfn-keyframe" class="internalDFN">keyframe</a> has index 1 and the last
                    <a href="#dfn-keyframe" class="internalDFN">keyframe</a> has index <var>n</var>;
              </li></ul>
              <p>
                then the offset of <var>k</var> is
                <code><var>a</var> + (<var>b</var> - <var>a</var>)
                * <var>i</var>
                / (<var>n</var> + 1)</code>
              </p>
          </li><li>Return <var>distributed keyframes</var>.
        </li></ol>
      </section>
    </section>

    <section id="path-animation-effects">
      <h3><span class="secno">4.4 </span>Path animation effects</h3>
      <p>
        A <dfn id="dfn-path-animation-effect">path animation effect</dfn> is an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> that
        produces transform <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation values</a>
        such that a <a href="#dfn-target-element" class="internalDFN">target element</a> follows a specified geometric curve.
      </p>
      <p>
        The <dfn id="dfn-path">path</dfn> of a <a href="#dfn-path-animation-effect" class="internalDFN">path animation effect</a> is provided by an
        SVG Path, as defined in SVG [<cite><a class="bibref" href="#bib-SVG11">SVG11</a></cite>].
        A <a href="#dfn-path" class="internalDFN">path</a> consists of a list of <dfn id="dfn-path-elements">path elements</dfn>.
      </p>
      <p>
        The <dfn id="dfn-automatic-rotation-flag">automatic rotation flag</dfn> of a <a href="#dfn-path-animation-effect" class="internalDFN">path animation
        effect</a>, if set, specifies that the <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation
        value</a> generated by the <a href="#dfn-path-animation-effect" class="internalDFN">path animation effect</a> produces
        a rotation that matches the directional tangent vector of the
        <a href="#dfn-path" class="internalDFN">path</a>.
      </p>
      <p>
        The <dfn id="dfn-rotation-angle">rotation angle</dfn> parameter of a <a href="#dfn-path-animation-effect" class="internalDFN">path animation
        effect</a> specifies a constant rotation that applies to the target
        transform in addition to any rotation generated by setting the
        <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a>.
      </p>
      <p>
        Each <a href="#dfn-path-animation-effect" class="internalDFN">path animation effect</a> has an associated <a href="#dfn-composition-operation" class="internalDFN">composition
        operation</a> that specifies whether the <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation
        values</a> generated by the effect <a title="composition operation replace" href="#dfn-composition-operation-replace" class="internalDFN">replace</a> the underlying value
        or <a title="composition operation add" href="#dfn-composition-operation-add" class="internalDFN">add</a> to it.
      </p>
      <section id="the-unaccumulated-animation-value-of-a-path-animation-effect">
        <h4><span class="secno">4.4.1 </span>The unaccumulated animation value of a path animation effect</h4>
        <p>
          The <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation value</a> of a <a href="#dfn-path-animation-effect" class="internalDFN">path animation
          effect</a> for a given <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> and <a href="#dfn-underlying-value" class="internalDFN">underlying
          value</a> is given by the following process:
          </p><ol>
            <li>
              Determine the <a href="#dfn-current-path-element" class="internalDFN">current path element</a> and
              <a href="#dfn-element-fraction" class="internalDFN">element fraction</a> for the given <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> using
              the procedure defined in 
              <a href="#determining-the-current-path-element-and-element-fraction" class="sectionRef">section 4.4.2 Determining the current path element and element fraction</a>.
            </li><li>
              Calculate the <a title="rotation value along a path" href="#dfn-rotation-value-along-a-path" class="internalDFN">rotation
              value</a> for the <var>current path element</var> and <var>element
              fraction</var> using the process defined in 
              <a href="#calculating-the-rotation-value-of-a-path-animation-effect" class="sectionRef">section 4.4.3 Calculating the rotation value of a path animation effect</a>.
            </li><li>
              Calculate the <a title="translation value along a path" href="#dfn-translation-value-along-a-path" class="internalDFN">translation
              value</a> for the <var>current path element</var> and <var>element
              fraction</var> using the process defined in 
              <a href="#calculating-the-translation-value-of-a-path-animation-effect" class="sectionRef">section 4.4.4 Calculating the translation value of a path animation effect</a>.
            </li><li>
              Let the <var>transform value</var> be the result of combining
              the <a>rotation value</a> and <a> translation value</a>
              by constructing a transform list consisting of the
              translation value followed by the rotation value.
            </li><li>
              The <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation value</a> of the <a href="#dfn-path-animation-effect" class="internalDFN">path animation
              effect</a> depends on the value of its <a href="#dfn-composition-operation" class="internalDFN">composition
              operation</a> as follows,
              <dl class="switch">
                <dt>If the <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> of this <a href="#dfn-path-animation-effect" class="internalDFN">path
                    animation effect</a> is <a title="composition operation
                    replace" href="#dfn-composition-operation-replace" class="internalDFN">replace</a>,</dt>
                <dd>
                  the <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation value</a> of the effect is
                  <var>transform value</var>.
                </dd>
                <dt>Otherwise,</dt>
                <dd>
                  the <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation value</a> of the effect is the
                  result of adding <var>transform value</var> to the
                  <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> according to the process defined in <a href="#the--transform-function--type" class="sectionRef">section 4.6.1.7 The &lt;transform-function&gt; type</a>.
                </dd>
              </dl>
          </li></ol>
        <p></p>
      </section>
      <section id="determining-the-current-path-element-and-element-fraction">
        <h4><span class="secno">4.4.2 </span>Determining the current path element and element fraction</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            Each element in the path (excluding moveto elements) is allocated
            an equally sized non-overlapping segment, with segments 
            collectively partitioning the range [0, 1].
          </p>
          <p>
            The <a href="#dfn-current-path-element" class="internalDFN">current path element</a> is the <a title="path elements" href="#dfn-path-elements" class="internalDFN">path
            element</a> corresponding to a given <a href="#dfn-time-fraction" class="internalDFN">time fraction</a>.
          </p>
          <p>
            The <a href="#dfn-element-fraction" class="internalDFN">element fraction</a> represents the offset into the
            <a href="#dfn-current-path-element" class="internalDFN">current path element</a> at the given <a href="#dfn-time-fraction" class="internalDFN">time fraction</a>.
          </p>
        </div>
        <p>
          The <dfn id="dfn-current-path-element">current path element</dfn> and <dfn id="dfn-element-fraction">element fraction</dfn>
          for a given <a href="#dfn-time-fraction" class="internalDFN">time fraction</a>, <var>progress</var>, are
          determined by following the steps corresponding to the first matching
          condition from below:
        </p>
        <dl class="switch">
          <dt>
            If <var>progress</var> is greater than or equal to 1,
          </dt>
          <dd>
            the <var>current path element</var> is the last element in the
            <a href="#dfn-path" class="internalDFN">path</a>,
            and the <var>element fraction</var> is 1.
          </dd>
          <dt>
            If <var>progress</var> is less than 0,
          </dt>
          <dd>
            the <var>current path element</var> is the first element in the
            <a href="#dfn-path" class="internalDFN">path</a>,
            and the <var>element fraction</var> is 0.
          </dd>
          <dt>
            Otherwise,
          </dt>
          <dd>
            <ol>
              <li>
                Let <var>effective element list</var> be a clone of the
                list of <a href="#dfn-path-elements" class="internalDFN">path elements</a> with all moveto elements removed.
              </li>
              <li>
                Let <var>time index</var> be <var>progress</var>
                multiplied by the number of elements in <var>effective
                element list</var>.
              </li>
              <li>
                Let <var>current element</var> be the element in the
                <var>effective element list</var> at the index given by
                <code>floor(<var>progress</var>)</code>.
              </li>
              <li>
                Let <var>element fraction</var> be the value given by
                <code><var>progress</var> - floor(<var>progress</var>)
                </code>.
              </li>
            </ol>
          </dd>
        </dl>
      </section>
      <section id="calculating-the-rotation-value-of-a-path-animation-effect">
        <h4><span class="secno">4.4.3 </span>Calculating the rotation value of a path animation effect</h4>
        <p>
          For a given <a>path element</a> and <a href="#dfn-element-fraction" class="internalDFN">element fraction</a>,
          the <dfn title="rotation value along a path" id="dfn-rotation-value-along-a-path">rotation value</dfn> at
          that point is calculated according to the steps corresponding to the
          first matching condition from below:
        </p>
        <dl class="switch">
          <dt>If the <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a> is not set,</dt>
          <dd>
            the <a title="rotation value along a path" href="#dfn-rotation-value-along-a-path" class="internalDFN">rotation value</a> of the
            given <a>path element</a> is the <a href="#dfn-rotation-angle" class="internalDFN">rotation angle</a>.
          </dd>
          <dt>Otherwise,</dt>
          <dd>
            the <a title="rotation value along a path" href="#dfn-rotation-value-along-a-path" class="internalDFN">rotation value</a> of the
            <a>current element</a> is the sum of:
            <ul>
              <li>
                the angle of the tangent vector of the given <a>path element</a>
                at the point selected in
                <a href="#calculating-the-translation-value-of-a-path-animation-effect" class="sectionRef">section 4.4.4 Calculating the translation value of a path animation effect</a>
                for the purpose of calculating the <a title="translation value along a path" href="#dfn-translation-value-along-a-path" class="internalDFN">translation value</a>; 
                and
              </li>
              <li>
                the <a href="#dfn-rotation-angle" class="internalDFN">rotation angle</a>.
              </li>
            </ul>
          </dd>
        </dl>
        <p>
          For continuous <a href="#dfn-path-elements" class="internalDFN">path elements</a> (all elements except moveto),
          the angle of the tangent vector for the purpose of these calculations
          is defined to be an integer multiple of 2&#x3c0; different from the value
          given by <a href="http://en.wikipedia.org/wiki/Tangential_angle">standard
          mathematical formulae for tangents to curves in 2
          dimensional space</a>.
        </p>
        <p class="todo">
          What does &#x201c;different from&#x201d; mean here?
        </p>
        <p>
          For moveto <a href="#dfn-path-elements" class="internalDFN">path elements</a>, which are discontinuous,
          the angle of the tangent vector for the purpose of these calculations
          is always an integer multiple of 2&#x3c0;.
        </p>
        <p class="todo">
          Any multiple?
        </p>
        <p>
          At non-smooth junction points, the angle of the tangent vector for
          the purpose of these calculations is determined by the tangent to
          the curve after the junction.
        </p>
        <p>
          The initial value of the angle of the tangent vector is computed 
          using the first element of the curve, and is always in the range
          [0, 2&#x3c0;).
        </p>
        <p>
          Single continuous path elements must never produce tangent
          vector angles that are discontinuous over their defined region. This
          implies that a single unique solution is available for all points on
          continuous path elements.
        </p>
        <p>
          When computing angles after discontinuous or non-smooth jumps,
          multiple possible solutions may be available.
          These solutions will differ by integer multiples of 2&#x3c0;.
          In such cases the solution that lies closest to the previous tangent
          angle is used.
        </p>
        <p>
          Please see
          <a href="#algorithms-for-path-animation-effects" class="sectionRef">section B. Algorithms for path animation effects</a>
          for a non-normative treatment of this topic.
        </p>
      </section>
      <section id="calculating-the-translation-value-of-a-path-animation-effect">
        <h4><span class="secno">4.4.4 </span>Calculating the translation value of a path animation effect</h4>
        <p>
          For a given <a>path element</a> and <a href="#dfn-element-fraction" class="internalDFN">element fraction</a>,
          the <dfn title="translation value along a path" id="dfn-translation-value-along-a-path">translation
          value</dfn> is determined using the following procedure:
        </p>
        <ol>
          <li>
            <p>
              Let <var>length</var> be the length of the given
              <a>path element</a>.
            </p>
            <p class="todo">
              Need a reference to how this is calculated even if it's just
              a pointer to SVG (which says pretty much nothing).
            </p>
          </li>
          <li>
            Let <var>element distance</var> be the result of evaluating
            <code><var>element fraction</var> &#xd7; <var>length</var></code>.
          </li>
          <li>
            <p>
              Let <var>point</var> be the unique point along the
              <a>current element</a> which is <var>element distance</var>
              along the path from the start of the path.
            </p>
            <p class="todo">
              What is the significance of &#x201c;unique point&#x201d; here?
            </p>
          </li>
          <li>
            The <a>translation value</a> is the translation transform
            that transforms the point at the start of the path to 
            <var>point</var>.
          </li>
        </ol>
        <p>
          The length of a path element is determined, where possible, via 
          closed-form solutions. For some path elements (e.g. beziers) a
          closed-form solution is not generally possible, and approximations
          should be used.
        </p>
        <p>
          The length of a moveto element is always 0.
        </p>
        <p>
          Please see
          <a href="#algorithms-for-path-animation-effects" class="sectionRef">section B. Algorithms for path animation effects</a>
          for a full non-normative treatment of this topic.
        </p>
      </section>
      <div class="todo">
        <p>
          Need to describe how <a href="http://www.w3.org/TR/css3-transforms/#transform-origin">transform-origin</a>
          is applied.
        </p>
      </div>
    </section>

    <section id="animatable-properties">
      <h3><span class="secno">4.5 </span>Animatable properties</h3>
      <section id="css-properties">
        <h4><span class="secno">4.5.1 </span>CSS Properties</h4>
        <p>
          Unless specified otherwise, all CSS properties are <a href="#dfn-animatable" class="internalDFN">animatable</a>.
          Examples of properties which are explicitly marked as not animatable
          are those defined in [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>] and [<cite><a class="bibref" href="#bib-CSS3-ANIMATIONS">CSS3-ANIMATIONS</a></cite>].
        </p>
        <div class="note">
          <p>
            [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>] requires future CSS specifications to provide
            an &#x2018;Animatable:&#x2019; line for each newly defined property.
            This line defines how animation occurs.
            &#x2018;Animatable: none&#x2019; in this
            regard merely means that a property is not <em>continuously</em>
            animatable, that is, not <a href="#dfn-interpolable" class="internalDFN">interpolable</a>.
          </p>
        </div>
        <p>
          This also applies to CSS properties defined in SVG [<cite><a class="bibref" href="#bib-SVG11">SVG11</a></cite>] which
          are likewise animatable except where explicitly noted otherwise.
        </p>
      </section>
      <section id="svg-attributes">
        <h4><span class="secno">4.5.2 </span>SVG Attributes</h4>
        <p>
          There are a number of SVG attributes which do not map to CSS
          properties but which are nevertheless animatable.
          The procedures for animating these attributes are defined in
          <span class="todo">a forthcoming SVG Animation specification</span>.
        </p>
      </section>
    </section>

    <section id="animation-of-property-types">
      <h3><span class="secno">4.6 </span>Animation of property types</h3>
      <section>
        <p>
          The specific procedures for <a href="#dfn-interpolation" class="internalDFN">interpolation</a> and <a href="#dfn-addition" class="internalDFN">addition</a>
          of animation values for common CSS value types are defined below.
        </p>
        <p>
          For a given pair of animation values, the procedures depend on the
          types of the two values.
          If there is no set of procedures matching the particular types of the
          two values, the default procedures defined in <a href="#default-animation-procedures" class="sectionRef">section 4.6.7 Default animation procedures</a> is used.
        </p>
        <p class="issue">
          In CSS transitions the interpolation procedure is determined by the
          property, not the specific values.
          Do we really want to define this in terms of the values in question?
          That seems to remove flexibility to make different properties with the
          same value types interpolate differently or turn off additive behavior
          on a per-property basis.
        </p>
        <p>
          For each set of procedures, a common notation is used. For
          <a href="#dfn-interpolation" class="internalDFN">interpolation</a>,
        </p>
        <ul>
          <li><var>V<sub>res</sub></var> is the result of the
              <a href="#dfn-interpolation" class="internalDFN">interpolation</a> operation,
          </li><li><var>p</var> is the interpolation parameter, and
          </li><li><var>V<sub>start</sub></var> and <var>V<sub>end</sub></var> are
              the animation values representing the start and end of the
              interpolation interval respectively.
        </li></ul>
        <p>For addition,</p>
        <ul>
          <li><var>V<sub>res</sub></var> is the result of the <a href="#dfn-addition" class="internalDFN">addition</a>
              operation,
          </li><li><var>V<sub>a</sub></var> and <var>V<sub>b</sub></var> are
              the two animation values to be added.
        </li></ul>
        <p>
          When an <a href="#dfn-addition" class="internalDFN">addition</a> procedure is not commutative,
          <var>V<sub>a</sub></var> represents the first term of the operation
          and <var>V<sub>b</sub></var> represents the second.
        </p>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            In some cases the mechanism by which <a href="#dfn-interpolation" class="internalDFN">interpolation</a> and
            <a href="#dfn-addition" class="internalDFN">addition</a> is achieved differs from that defined in
            [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>].
            However, the observable results of these operations should be
            identical.
          </p>
          <p>
            For example, in [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>] length values are always
            converted to computed style pixel lengths and interpolated as
            numbers, whereas in this specification <a href="#dfn-interpolation" class="internalDFN">interpolation</a> between
            different length units is defined using calc expressions.
          </p>
        </div>
      </section>
      <section id="animation-of-like-types">
        <h4><span class="secno">4.6.1 </span>Animation of like types</h4>
        <p>
          When the types being interpolated or animated equal the following
          specific procedures are used.
        </p>
        <p>
          Note that in all cases, if the result of the addition is specified by
          a calc expression and the units of <var>V<sub>a</sub></var>  and
          <var>V<sub>b</sub></var> are related by a constant scalar multiple
          then the result of the calc expression is evaluated as defined in
          [<cite><a class="bibref" href="#bib-CSS3-VALUES">CSS3-VALUES</a></cite>] before being returned.
        </p>
        <p class="issue">
          What does &#x201c;being returned&#x201d; mean here?
        </p>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            For example, the CSS &#x2018;px&#x2019; unit is related to the CSS
            &#x2018;in&#x2019; unit by a constant scalar multiple of 96 (i.e.
            96px = 1in).
            On the other hand, the CSS &#x2018;em&#x2019; unit is not related to
            the &#x2018;in&#x2019; unit by a constant scalar multiple.
          </p>
        </div>
        <section id="the--integer----number--and--percentage---------------types">
          <h5><span class="secno">4.6.1.1 </span>
            The &lt;integer&gt;, &lt;number&gt; and &lt;percentage&gt; 
            types
          </h5>
          <p>
            Interpolation is calculated as defined in [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>].
          </p>
          <p class="issue">
            This is weird: we partly redefine what is already described in
            [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>] and party reuse its definitions.
            We should either redefine everything here, or simply extend what is
            there.
          </p>
          <p>
            Addition is calculated as <var>V<sub>res</sub></var> = 
            <var>V<sub>a</sub></var> + <var>V<sub>b</sub></var>.
          </p>
        </section>
        <section id="the--length----angle----time--and---------------frequency--types">
          <h5><span class="secno">4.6.1.2 </span>
            The &lt;length&gt;, &lt;angle&gt;, &lt;time&gt; and 
            &lt;frequency&gt; types
          </h5>
          <p>
            Interpolation is calculated as <var>V<sub>res</sub></var> = (1 - 
            <i>p</i>) * <var>V<sub>start</sub></var> + <i>p</i>  * <i>V</i>
            <sub>end</sub>.
          </p>
          <p>
            Addition is calculated as <var>V<sub>res</sub></var> = calc(<i>V</i>
            <sub>a</sub> + <var>V<sub>b</sub></var>).
          </p>
        </section>
        <section id="the--resolution--type">
          <h5><span class="secno">4.6.1.3 </span>The &lt;resolution&gt; type</h5>
          <div class="issue">Do we want to interpolate this?</div>
          <p>
            Interpolation is calculated as <var>V<sub>res</sub></var> = 
            (1 - <i>p</i>) * <var>V<sub>start</sub></var> + <i>p</i>  * 
            <var>V<sub>end</sub></var>.
          </p>
          <p>
            Addition is calculated as <var>V<sub>res</sub></var> = 
            calc(<var>V<sub>a</sub></var> + <var>V<sub>b</sub></var>).
          </p>        
        </section>
        <section id="the--color--type">
          <h5><span class="secno">4.6.1.4 </span>The &lt;color&gt; type</h5>
          <p>
            Interpolation is calculated as defined in [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>].
          </p>
          <p>
            Addition is performed on each RGBA color component in premultiplied
            space, clamping so it is within the range specified in 
            [<cite><a class="bibref" href="#bib-CSS3-COLOR">CSS3-COLOR</a></cite>].
          </p>
          <div class="issue">
            What we do for addition depends on why we're adding. As defined
            here, the result will tend to saturate to opaque white.
          </div>
          <div class="issue">
            Do we clamp upon each addition, or wait until the end?
            Does it make a difference if we never actually subtract?
          </div>
        </section>
        <section id="the--image--type">
          <h5><span class="secno">4.6.1.5 </span>The &lt;image&gt; type</h5>
          <p>
            Interpolation is performed using the cross-fade() function as
            defined in [<cite><a class="bibref" href="#bib-CSS4-IMAGES">CSS4-IMAGES</a></cite>]:
            </p><blockquote>
              <var>V<sub>res</sub></var> = cross-fade(<i>p</i>,
              <var>V<sub>start</sub></var> , <var>V<sub>end</sub></var>).
            </blockquote>
          <p></p>
          <p>
            Addition is defined as the composition of <var>V<sub>a</sub></var>
            over
            <var>V<sub>b</sub></var>, with <var>V<sub>a</sub></var> and
            <var>V<sub>b</sub></var> aligned at their top left corners.
            The height and width of the result is the maximum of the heights and
            widths of <var>V<sub>a</sub></var> and <var>V<sub>b</sub></var>. Any
            result pixels outside the bounds of <var>V<sub>a</sub></var> or
            <var>V<sub>b</sub></var> are defined to be rgba(0, 0, 0, 0).
          </p>
          <div class="issue">
            Probably need to spell out that &#x201c;over&#x201d; here refers to
            the Porter-Duff operator of that name (if, indeed, that is what it
            means here).
          </div>
          <div class="issue">
            This does not match the saturating behavior defined for addition 
            of colors.
          </div>
        </section>
        <section id="the--position--type">
          <h5><span class="secno">4.6.1.6 </span>The &lt;position&gt; type</h5>
          <p>
            Before interpolation or addition, any shorthand is expanded as
            described in [<cite><a class="bibref" href="#bib-CSS21">CSS21</a></cite>] to include both horizontal and vertical
            positions. Keywords are converted to their equivalent percentage
            values as described in [<cite><a class="bibref" href="#bib-CSS21">CSS21</a></cite>].
          </p>
          <p>
            Interpolation or addition is performed on each provided value in
            accordance with its type.
          </p>
        </section>
        <section id="the--transform-function--type">
          <h5><span class="secno">4.6.1.7 </span>The &lt;transform-function&gt; type</h5>
          <p>
            Interpolation is calculated as defined in [<cite><a class="bibref" href="#bib-CSS3-TRANSFORMS">CSS3-TRANSFORMS</a></cite>].
          </p>
          <p>
            Addition is calculated as an accumulation as defined in 
            [<cite><a class="bibref" href="#bib-CSS3-TRANSFORMS">CSS3-TRANSFORMS</a></cite>].
          </p>
        </section>
      </section>
      <section id="animation-of-non-matching-primitive-types">
        <h4><span class="secno">4.6.2 </span>Animation of non-matching primitive types</h4>
        <p>
          In general, non-matching primitive types cannot be interpolated or
          added.
          Non-matching primitive types may only be interpolated or added
          if the property value they are defined on allows both those types,
          for example &lt;length&gt; and &lt;percent&gt;.
          In these cases, the CSS calc() function as defined in [<cite><a class="bibref" href="#bib-CSS3-VALUES">CSS3-VALUES</a></cite>]
          is used.
        </p>
        <p>
          For interpolation:
          </p><blockquote>
            <var>V<sub>res</sub></var> =
              calc((1 - <i>p</i>) * <var>V<sub>start</sub></var> +
                   <i>p</i>  * <var>V<sub>end</sub></var>).
          </blockquote>  
        <p></p>
        <p>
          For addition:
          </p><blockquote>
            <var>V<sub>res</sub></var> =
              calc(<var>V<sub>a</sub></var> + <var>V<sub>b</sub></var>).
          </blockquote>
        <p></p>
      </section>
      <section id="animation-of-keywords-and-primitive-types">
        <h4><span class="secno">4.6.3 </span>Animation of keywords and primitive types</h4>
        <p>
          If keyword value is be defined as equivalent to a primitive type,
          either directly, or via some intermediate calculation, the equivalent
          primitive type is be used, and
          interpolation and addition calculated are defined in <a href="#animation-of-like-types" class="sectionRef">section 4.6.1 Animation of like types</a> or <a href="#animation-of-non-matching-primitive-types" class="sectionRef">section 4.6.2 Animation of non-matching primitive types</a>.
        </p>
        <p>
          In the case that a keyword maps onto a finite ordered list of values
          with a determinable spacing between them, then a step-wise
          interpolation is used. For example, the font-weight property 
          accepts an ordered list of values from 100 to 900 in
          steps of 100. The interpolation in this case is defined as ((1 -
          <i>p</i>) * <var>V<sub>start</sub></var> + <i>p</i> *
          <var>V<sub>end</sub></var>), rounded to the nearest member of the
          list.
          Addition in this case is defined as (<var>V<sub>a</sub></var>
          + <var>V<sub>b</sub></var>), clamped to remain within the specifed
          list of values. 
        </p>
        <p>
          In all other cases, the keyword value is not interpolable. Result of
          add is the right hand side.
        </p>
      </section>
      <section id="animation-of-shorthand-properties">
        <h4><span class="secno">4.6.4 </span>Animation of shorthand properties</h4>
        <p>
          Shorthand properties are animated as defined in [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>].
        </p>
        <div class="issue">
          We probably should just duplicate that text here.
          For example, it's not obvious from that sentence how addition works
          since transitions has not concept of addition.
        </div>
      </section>
      <section id="animation-of-css-calc-expressions">
        <h4><span class="secno">4.6.5 </span>Animation of CSS calc expressions</h4>
        <p>
          For interpolation:
          </p><blockquote>
            <var>V<sub>res</sub></var> = calc((1 - <i>p</i>) *
            <var>V<sub>start</sub></var> + <i>p</i>  * <var>V<sub>end</sub></var>).
          </blockquote>  
        <p></p>
        <p>
          For addition:
          </p><blockquote>
            <var>V<sub>res</sub></var> = calc(<var>V<sub>a</sub></var> +
            <var>V<sub>b</sub></var>).
          </blockquote>
        <p></p>
      </section>
      <section id="animation-of-transform-lists">
        <h4><span class="secno">4.6.6 </span>Animation of transform lists</h4>
        <p>
          Interpolation of CSS and SVG transform lists is performed as defined
          in [<cite><a class="bibref" href="#bib-CSS3-TRANSFORMS">CSS3-TRANSFORMS</a></cite>]
        </p>
        <p>
          Addition of CSS and SVG transform lists is performed by appending
          <var>V<sub>b</sub></var> to <var>V<sub>a</sub></var>.
        </p>
      </section>
      <section id="default-animation-procedures">
        <h4><span class="secno">4.6.7 </span>Default animation procedures</h4>
        <p>
          In the case that no specific set of procedures matches the
          pair of <a>animation values</a>, the following default procedures are
          used.
        </p>
        <p>
          Note that the <a href="#dfn-neutral-value-for-composition" class="internalDFN">neutral value for composition</a> does not match
          any value type and thus all calculations involving the <a href="#dfn-neutral-value-for-composition" class="internalDFN">neutral
          value for composition</a> will use the default algorithms.
        </p>
        <p>
          Given the output <i>p</i> of a timing function, the result
          <var>V<sub>res</sub></var> of interpolating between two values,
          <var>V<sub>start</sub></var> and <var>V<sub>end</sub></var> is given by
          </p><blockquote>
            <dl class="switch">
              <dt>If 0 &#x2264; <i>p</i> &lt; 0.5</dt>
              <dd><var>V<sub>res</sub></var> = <var>V<sub>start</sub></var></dd>
              <dt>Otherwise,</dt>
              <dd><var>V<sub>res</sub></var> = <var>V<sub>end</sub></var></dd>
            </dl>
          </blockquote>
          Note that interpolation is never performed on invalid values.
        <p></p>
        <p>
          Addition is between two values <i>V</i><sub>a</sub> and 
          <i>V</i><sub>b</sub>. The result <i>V</i><sub>res</sub> is given by 
          </p><blockquote>
            <i>V</i><sub>res</sub> = <i>V</i><sub>b</sub> 
          </blockquote>
          unless <i>V</i><sub>b</sub> is the <a href="#dfn-neutral-value-for-composition" class="internalDFN">neutral value for
          composition</a>, in which case
          <blockquote>
            <i>V</i><sub>res</sub> = <i>V</i><sub>a</sub>
          </blockquote>
        <p></p>
      </section>
    </section>

    <section id="custom-effects">
      <h3><span class="secno">4.7 </span>Custom effects</h3>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          In some situations the <a href="#dfn-animation-effect" class="internalDFN">animation
          effects</a> provided by Web Animations may be insufficient.
          For example, the <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>
          defined here are only able to target certain CSS properties.
          They are unable, therefore, to modify the <a href="http://www.w3.org/TR/SVG11/struct.html#__svg__SVGSVGElement__currentScale"><code>currentScale</code></a>
          property of an SVG element to smoothly zoom the viewport without
          affecting the document content.
        </p>
        <p>
          In such cases, where the provided <a href="#dfn-animation-effect" class="internalDFN">animation
          effects</a> do not provide needed functionality, an effect defined by
          script may be used.
          Such <a href="#dfn-custom-effect" class="internalDFN">custom effects</a> receive a <a href="#dfn-time-fraction" class="internalDFN">time
          fraction</a> and <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> from the timing model and
          are responsible for producing an effect corresponding to the specified
          time.
        </p>
        <p>
          Using an effect defined in script it is possible to animate not only
          otherwise un-animatable attributes and properties, but potentially
          anything that is accessible via script, including even producing audio
          or creating vibrations.
        </p>
        <p>
          For example, using a <a href="#dfn-custom-effect" class="internalDFN">custom effect</a> that draws to a <a href="http://www.w3.org/TR/html5/embedded-content-0.html#the-canvas-element"><code>canvas</code></a>
          element, it is possible to produce a complex animated effect
          featuring patterns that may be difficult to create using CSS or
          SVG.
          Compared to using the <a href="http://www.w3.org/TR/animation-timing/">WindowAnimationTiming</a>
          interface, this approach ensures the animation is frame-rate
          independent and can be paused, reversed, eased with timing effects,
          accelerated, synchronized with other animations, and be controlled
          in the same manner as any other Web Animations animation without any
          additional programming.
        </p>
      </div> <!-- informative -->
      <p>
        A <dfn id="dfn-custom-effect">custom effect</dfn> is an author-defined programming callback
        that is passed timing information whenever a <a href="#dfn-sample" class="internalDFN">sample</a> is performed.
      </p>
      <section id="execution-order-of-custom-effects">
        <h4><span class="secno">4.7.1 </span>Execution order of custom effects</h4>
        <p>
          Since <a href="#dfn-custom-effect" class="internalDFN">custom effects</a>, unlike <a title="animation effect" href="#dfn-animation-effect" class="internalDFN">animation effects</a>, are not limited to
          a single <a>target property</a>, the steps for assessing their
          order of execution differs from <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>.
        </p>
        <p>
          <a href="#dfn-custom-effect" class="internalDFN">Custom effects</a> are executed after all
          <a href="#dfn-animation-effect" class="internalDFN">animation effects</a> have completed and
          applied their result to their targets (see <a href="#combining-with-other-styles--the-override-stylesheet" class="sectionRef">section 4.2.4 Combining with other styles: the override stylesheet</a>).
        </p>
        <p class="issue">
          Need to define this more precisely.
          Are styles flushed?
          Presumably they are.
          Can we suspend reflow for the duration of executing the script-based
          animation effects and just do it once afterwards?
        </p>
        <p>
          Within the set of <a href="#dfn-custom-effect" class="internalDFN">custom effects</a>, the
          order of execution is initially the same as that defined for <a title="animation effect" href="#dfn-animation-effect" class="internalDFN">animation effects</a> in <a href="#the-animation-stack" class="sectionRef">section 4.2.1 The animation stack</a>.
          However, <a href="#dfn-custom-effect" class="internalDFN">custom effects</a> may also override
          this ordering through a <dfn title="custom effect priority" id="dfn-custom-effect-priority">priority</dfn> property associated with
          the effect.
          This <a title="custom effect priority" href="#dfn-custom-effect-priority" class="internalDFN">priority</a> property, if
          defined, specifies the order in which the callbacks are executed
          such that the callback of the <a href="#dfn-custom-effect" class="internalDFN">custom effect</a> with the least
          priority is executed first.
        </p>
        <p>
          In deciding which of two <a href="#dfn-custom-effect" class="internalDFN">custom effects</a>,
          <var>A</var> and <var>B</var>, should be executed first, the following
          rules are applied.
        </p>
        <ol>
          <li>Sort <var>A</var> and <var>B</var> based on their
              <a title="custom effect priority" href="#dfn-custom-effect-priority" class="internalDFN">priority</a> properties such
              that lower priorities are sorted first.
              If either does not have a defined <a title="custom effect priority" href="#dfn-custom-effect-priority" class="internalDFN">priority</a>, then treat the <a title="custom effect priority" href="#dfn-custom-effect-priority" class="internalDFN">priority</a> as being zero for the
              purposes of sorting.</li>
          <li>If <var>A</var> and <var>B</var> have the same <a title="custom effect priority" href="#dfn-custom-effect-priority" class="internalDFN">priority</a>,
              sort <var>A</var> and <var>B</var> using the procedure defined for
              sorting <a href="#dfn-animation-effect" class="internalDFN">animation effects</a> in <a href="#the-animation-stack" class="sectionRef">section 4.2.1 The animation stack</a>.</li>
        </ol>
        <p>
          Items sorted earlier are executed before those sorted later.
        </p>
      </section>
    </section>
    </section> <!-- End of animation model -->

    <section id="timing-events">
      <!--OddPage--><h2><span class="secno">5. </span>Timing events</h2>
      <div class="issue">
        Possibly move this section into <a href="#timing-model" class="sectionRef">section 3. Timing model</a>.
      </div>
      <div class="issue">
        <p>
          The current event model has two undesirable consequences:
          </p><ul>
            <li>
              There are two different modes in which events are dispatched:
              seeked mode and regular mode.
              Some applications will need to provide different handling based on
              the mode which complicates handling.
              Other applications will simply assume seeked mode behavior since
              the mode can change based on parameters outside the application's
              control (such as being switched to a background tab causing the
              refresh rate to drop and the maximum event threshold to be
              exceeded).
            </li>
            <li>
              Uneased timing can cause events to be reordered with respect
              to how they are visually percieved and can also cause events
              to be delivered with timestamps in the future.
            </li>
          </ul>
        <p></p>
        <p>
          One alternative under consideration is as follows:
        </p>
        <ul>
          <li>
            Primitive onstart / onend events that fire only when an 
            animation first starts playing and last stops playing.
          </li>
          <li>
            An onchange event that fires when the play state (e.g. current
            iteration, fill state, etc.) of an Animation changes, and provides
            a summary only of ther changes since the last sample.
            No more than one event is generated per animation per sample.
          </li>
          <li>
            The list of actual changes associated with a change event would be
            lazily generated since this could be costly to generate for large
            sample intervals.
          </li>
        </ul>
        <p>
          See <a href="http://lists.w3.org/Archives/Public/public-fx/2013AprJun/0184.html">sections
          8 and 14 of minuted discussion from Tokyo 2013 F2F</a>.
        </p>
        <p>
          Another possibility is that rather that switching to seeked event
          dispatch when there are many events to dispatch due to delays between
          samples, to instead ignore the delay (as is required for SVG).
          This would make seeked event dispatch predictable.
          This approach, however, does not address the issues regarding uneased
          timing.
        </p>
      </div>
      <p>
        As <a href="#dfn-timed-item" class="internalDFN">timed items</a> play they report changes to
        their status through <dfn title="timing event" id="dfn-timing-event">timing events</dfn>.
      </p>
      <p>
        <a href="#dfn-timing-event" class="internalDFN">Timing events</a> are a property of the Web
        Animations timing model.
        As a result they are dispatched even for <a title="animation" href="#dfn-animation" class="internalDFN">animations</a> that do not have an associated
        <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>, for <a href="#dfn-animation" class="internalDFN">animations</a> whose
        <a href="#dfn-target-element" class="internalDFN">target element</a> is not rendered because it or a parent element has
        <span class="property">display</span> property of <span class="prop-value">none</span>, and for <a href="#dfn-timed-item" class="internalDFN">timed
        items</a> that perform no animation such as <a href="#dfn-timing-group" class="internalDFN">timing groups</a>.
      </p>
      
      <section id="types-of-timing-events">
        <h3><span class="secno">5.1 </span>Types of timing events</h3>
          <dl>
          <dt><dfn id="dfn-timingstart">timingstart</dfn></dt>
          <dd>
            <p>
              Occurs at the moment when a <a href="#dfn-timed-item" class="internalDFN">timed item</a> enters its <a href="#dfn-active-interval" class="internalDFN">active
              interval</a> (from either direction).
            </p>
            <p>
              Note that if the <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a> starts a new
              iteration, this is treated as if this element momentarily exited
              its <a href="#dfn-active-interval" class="internalDFN">active interval</a> (producing a new <a href="#dfn-timingend" class="internalDFN">timingend</a>
              event), and entered it again (producing a new <a href="#dfn-timingstart" class="internalDFN">timingstart</a>
              event).
            </p>
            <ul>
              <li>Bubbles: yes</li>
              <li>Cancelable: no</li>
              <li>Context Info: localTime, documentTime, iterationIndex,
                                seeked</li>
            </ul>
          </dd>
          <dt><dfn id="dfn-timingiteration">timingiteration</dfn></dt>
          <dd>
            <p>
              Occurs at the moment when a <a href="#repeating">repeating</a>
              <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> changes value
              excluding changes to and from <code>null</code>.
            </p>
            <p>
              Note that if the <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a> starts a new
              iteration, this is treated as if this element momentarily exited
              its <a href="#dfn-active-interval" class="internalDFN">active interval</a> (causing the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a>
              to become <code>null</code>), and entered it again (producing
              a new value for <a href="#dfn-current-iteration" class="internalDFN">current iteration</a>) and hence producing no
              <a href="#dfn-timingiteration" class="internalDFN">timingiteration</a> event since the only changes to <a href="#dfn-current-iteration" class="internalDFN">current
              iteration</a> are to and from <code>null</code>.
            </p>
            <ul>
              <li>Bubbles: yes</li>
              <li>Cancelable: no</li>
              <li>Context Info: localTime, documentTime, iterationIndex,
                                seeked</li>
            </ul>
          </dd>
          <dt><dfn id="dfn-timingend">timingend</dfn></dt>
          <dd>
            <p>
              Occurs at the moment when a <a href="#dfn-timed-item" class="internalDFN">timed item</a> leaves its <a href="#dfn-active-interval" class="internalDFN">active
              interval</a> (from either direction).
            </p>
            <ul>
              <li>Bubbles: yes</li>
              <li>Cancelable: no</li>
              <li>Context Info: localTime, documentTime, iterationIndex,
                                seeked</li>
            </ul>
          </dd>
          <dt><dfn id="dfn-timingcancel">timingcancel</dfn></dt>
          <dd>
            <p>
              Occurs when a <a href="#dfn-timed-item" class="internalDFN">timed item</a> loses its association with
              a <a href="#dfn-player" class="internalDFN">player</a>.
            </p>
            <ul>
              <li>Bubbles: yes</li>
              <li>Cancelable: no</li>
              <li>Context Info: None</li>
            </ul>
          </dd>
        </dl>
        <p class="issue">
          Can we rename these to just <em>start</em>, <em>iteration</em>,
          <em>end</em>, and <em>cancel</em>?
          They are only fired at <a href="#dfn-timed-item" class="internalDFN">timed items</a>, never
          DOM nodes, so they won't clash with other events.
          Is that enough or do the names need to be globally unique?
        </p>
      </section>
      <section id="uneased-timing">
        <h3><span class="secno">5.2 </span>Uneased timing</h3>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            <a href="#dfn-timing-event" class="internalDFN">Timing events</a> in Web Animations rely on
            a mode of operating the timing model that does not apply <a title="timing function" href="#dfn-timing-function" class="internalDFN">timing functions</a> called <em>uneased
            timing</em>.
            There are two reasons for this:
          </p>
          <ul>
            <li>
              <p>
                <a href="#dfn-timing-function" class="internalDFN">Timing functions</a> are not always invertible.
              </p>
              <p>
                In order to dispatch events in the correct order it is often
                necessary to convert from a <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-local-time" class="internalDFN">local
                time</a> to a common time space for sorting and non-invertible
                <a href="#dfn-timing-function" class="internalDFN">timing functions</a> make this
                impractical.
              </p>
            </li>
            <li>
              <p>
                <a href="#dfn-timing-function" class="internalDFN">Timing functions</a> on parent <a title="timing group" href="#dfn-timing-group" class="internalDFN">timing groups</a> can cause unnecessary
                events to be generated.
              </p>
              <p>
                For example, consider a <a href="#dfn-timing-group" class="internalDFN">timing group</a> that has a <a href="#dfn-timing-function" class="internalDFN">timing
                function</a> that is not monotonically increasing such as
                a bounce effect.
                Within a single iteration of the <a href="#dfn-timing-group" class="internalDFN">timing group</a> child <a title="timed item" href="#dfn-timed-item" class="internalDFN">timed items</a> may repeatedly exit and enter
                their <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
                Dispatching a <a href="#dfn-timing-event" class="internalDFN">timing event</a> on each such moment is
                unlikely to be useful to most applications.
              </p>
            </li>
          </ul>
          <p>
            An analogue is a graphics editing program where the user can apply
            a blur filter to a geometric shape.
            The graphics program may draw a selection box around the bounding
            box of the geometric shape ignoring the fact that the blur stretches
            (infinitely) beyond the selection box.
          </p>
          <p>
            Furthermore, since <a href="#dfn-fill-mode" class="internalDFN">fill modes</a> affect the
            calculation of times in ways that obscure the boundaries of the
            <a href="#dfn-active-interval" class="internalDFN">active interval</a> they are also ignored when operating in
            <em>uneased time</em>.
          </p>
        </div>
        <p>
          The <dfn id="dfn-uneased-timing">uneased timing</dfn> of a <a href="#dfn-timed-item" class="internalDFN">timed item</a> refers to
          performing any of the calculations defined for the <a href="#dfn-timed-item" class="internalDFN">timed item</a>
          with the following exceptions:
        </p>
        <ul>
          <li><a href="#dfn-timing-function" class="internalDFN">Timing functions</a> on the <a href="#dfn-timed-item" class="internalDFN">timed
              item</a> and all <a href="#dfn-ancestor" class="internalDFN">ancestor</a> <a href="#dfn-timing-group" class="internalDFN">timing groups</a> are
              ignored.</li>
          <li>The <a href="#dfn-fill-mode" class="internalDFN">fill modes</a> of the <a href="#dfn-timed-item" class="internalDFN">timed item</a>
              and all <a href="#dfn-ancestor" class="internalDFN">ancestor</a> <a href="#dfn-timing-group" class="internalDFN">timing groups</a> are
              treated as <span class="prop-value">none.</span></li>
        </ul>
        <p>
          For example, the <em>uneased inherited time</em> of a <a href="#dfn-timed-item" class="internalDFN">timed
          item</a> is calculated using the regular definition of <a href="#dfn-inherited-time" class="internalDFN">inherited
          time</a> after applying the two modifications to the timing of the
          item and its <a href="#dfn-ancestor" class="internalDFN">ancestors</a> noted above.
        </p>
        <p>
          Normally the time value used as input to a child <a href="#dfn-timed-item" class="internalDFN">timed item</a>
          of a <a href="#dfn-timing-group" class="internalDFN">timing group</a> is the group's <a href="#dfn-transformed-time" class="internalDFN">transformed time</a>.
          However, since <a href="#dfn-uneased-timing" class="internalDFN">uneased timing</a> does not apply <a title="timing function" href="#dfn-timing-function" class="internalDFN">timing functions</a>, we refer to <dfn id="dfn-uneased-child-time">uneased
          child time</dfn> which is equivalent to both <em>uneased transformed
          time</em> and <em>uneased directed time</em>.
        </p>
      </section>
      <section id="inverse-timing-calculations">
        <h3><span class="secno">5.3 </span>Inverse timing calculations</h3>
        <p>
          For times calculated using <a href="#dfn-uneased-timing" class="internalDFN">uneased timing</a> it is possible to
          perform the reverse operation to, for example, convert times from
          a <a href="#dfn-child-timed-item" class="internalDFN">child timed item</a> to that of its its <a href="#dfn-parent-timing-group" class="internalDFN">parent timing
          group</a> or <a href="#dfn-timeline" class="internalDFN">timeline</a>.
        </p>
        <p>
          Calculating the <dfn id="dfn-uneased-local-time-from-uneased-child-time"><em>uneased local time</em> from <a href="#dfn-uneased-child-time" class="internalDFN">uneased child
          time</a></dfn> of a given <a href="#dfn-timed-item" class="internalDFN">timed item</a> requires recording the
          iteration index that corresponds to the <a href="#dfn-uneased-child-time" class="internalDFN">uneased child time</a> and
          is calculated as follows.
        </p>
        <ol>
          <li>Let <var>item</var> be the <a href="#dfn-timed-item" class="internalDFN">timed item</a> for which the
              <em>uneased local time</em> is to be calculated.</li>
          <li>Let <var>child time</var> be the <a href="#dfn-uneased-child-time" class="internalDFN">uneased child time</a> to be
              converted.</li>
          <li>Let <var>iteration index</var> be the value of <a href="#dfn-current-iteration" class="internalDFN">current
              iteration</a> corresponding to <var>child time</var>.</li>
          <li>Calculate the <var>current direction</var> of <var>item</var>
              using the procedure defined in <a href="#calculating-the-directed-time" class="sectionRef">section 3.11.1 Calculating the directed time</a> substituting <var>iteration index</var>
              for the <em>current iteration</em>.</li>
          <li>
            <p>
              Let the <var>uneased iteration time</var> be the result
              corresponding to the first matching condition from below.
            </p>
            <dl class="switch">
              <dt>If the <var>current direction is <em>forwards</em>,</var></dt>
              <dd>
                <var>child time</var>
              </dd>
              <dt>Otherwise,</dt>
              <dd>
                <code><a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> - <var>child time</var></code>
              </dd>
            </dl>
          </li>
          <li>
            <p>
              Let the <var>uneased scaled active time</var> be the result
              corresponding to the first matching condition from below.
            </p>
            <dl class="switch">
              <dt>If <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> is zero,</dt>
              <dd>
                zero
              </dd>
              <dt>If <var>uneased iteration time</var> equals <a href="#dfn-iteration-duration" class="internalDFN">iteration
                  duration</a>,</dt>
              <dd>
                <code><a href="#dfn-repeated-duration" class="internalDFN">repeated duration</a> * <a href="#dfn-start-offset" class="internalDFN">start offset</a></code>
              </dd>
              <dt>Otherwise,</dt>
              <dd>
                <code><var>iteration index</var> * <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>
                + <var>uneased iteration time</var></code>
              </dd>
            </dl>
          </li>
          <li>
            <p>
              Let the <var>uneased active time</var> be the result corresponding
              to the first matching condition from below.
            </p>
            <dl class="switch">
              <dt>If the <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a>
                  is zero,</dt>
              <dd>
                positive infinity unless <var>scaled active time</var> is zero,
                in which case the <var>active time is zero
              </var></dd>
              <dt>If the <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a>
                  is positive,</dt>
              <dd>
                <code>(<var>uneased scaled active time</var> - <a href="#dfn-start-offset" class="internalDFN">start
                offset</a>) / <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback
                rate</a></code>
              </dd>
              <dt>Otherwise,
              </dt><dd>
                <code>(<var>uneased scaled active time</var> - <a href="#dfn-start-offset" class="internalDFN">start
                offset</a>) / <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback
                rate</a> + <a href="#dfn-active-duration" class="internalDFN">active duration</a></code>
              </dd>
          </dl></li>
          <li>Return <code><var>uneased active time</var> + <a href="#dfn-start-delay" class="internalDFN">start
              delay</a></code>.
          </li>
        </ol>
        <p>
          Note that the above procedure is only defined when the <a href="#dfn-uneased-child-time" class="internalDFN">uneased
          child time</a> is defined, that is, not <code>null</code>.
        </p>
        <p>
          The <dfn id="dfn-uneased-inherited-time-from-uneased-local-time"><em>uneased inherited time</em> from <em>uneased local
          time</em></dfn> is simply the sum of the <em>uneased local time</em>
          and the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a title="timed item" href="#dfn-timed-item" class="internalDFN">start time</a>.
        </p>
        <p>
          The <dfn id="dfn-timeline-time-from-the-current-time-of-a-player"><em><a href="#dfn-timeline" class="internalDFN">timeline</a> time</em> from the <a href="#dfn-current-time" class="internalDFN">current time</a> of
          a <a href="#dfn-player" class="internalDFN">player</a></dfn> is calculated as follows.
        </p>
        <blockquote>
          <code><var>timeline time</var> =
            (<a href="#dfn-current-time" class="internalDFN">current time</a> + <a href="#dfn-time-drift" class="internalDFN">time drift</a>) /
            <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> +
            <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a></code>
        </blockquote>
        <p>
          If the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">player's playback rate</a> is
          zero, the <var>timeline time</var> is undefined.
          The handling of an undefined value depends on the context in which it
          is used.
          Typically, a current <a href="#dfn-time-value" class="internalDFN">time value</a> for the <a href="#dfn-timeline" class="internalDFN">timeline</a> is
          available and this is used in place of the undefined value.
        </p>
        <p>
          Provided that the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> values used when
          calculating the <em>uneased local time</em> are recorded, it is
          possible, by applying the above definitions in succession, to
          calculate the <a href="#dfn-time-value" class="internalDFN">time value</a> of a <a href="#dfn-timeline" class="internalDFN">timeline</a> corresponding to
          the <em>uneased local time</em> of a <a href="#dfn-timed-item" class="internalDFN">timed item</a> <a title="associated with a timeline" href="#dfn-associated-with-a-timeline" class="internalDFN">associated</a> with that
          <a href="#dfn-timeline" class="internalDFN">timeline</a>.
        </p>
      </section>
      <section id="event-parameters">
        <h3><span class="secno">5.4 </span>Event parameters</h3>
        <p>
          <a href="#dfn-timing-event" class="internalDFN">Timing events</a> have an associated <a href="#dfn-event-local-time" class="internalDFN">event
          local time</a>, <a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>, <a href="#dfn-event-iteration-index" class="internalDFN">event iteration
          index</a>, and <a href="#dfn-seeked-dispatch-flag" class="internalDFN">seeked dispatch flag</a>.
        </p>
        <p>
          The <dfn id="dfn-event-local-time">event local time</dfn> is the <em>uneased local time</em> of
          the <a href="#dfn-timed-item" class="internalDFN">timed item</a> that generated event at the moment the event is
          scheduled to occur.
          This time is constrained by the timing of the <a href="#dfn-parent-timing-group" class="internalDFN">parent timing
          group</a>'s <a href="#dfn-iteration-interval" class="internalDFN">iteration interval</a> such that when converted to an
          <em>uneased iteration time</em> in the parent's <a href="#iteration-time-space">iteration time space</a> (see <a href="#inverse-timing-calculations" class="sectionRef">section 5.3 Inverse timing calculations</a>) it lies
          within the range 0 &#x2264; <em>uneased iteration time</em> &#x2264;
          <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> (of the <a title="parent timing
          group" href="#dfn-parent-timing-group" class="internalDFN">parent</a>).
        </p>
        <p>
          The <dfn id="dfn-event-timeline-time">event timeline time</dfn> is the result of converting the
          <a href="#dfn-event-local-time" class="internalDFN">event local time</a> into the time space of the <a href="#dfn-timeline" class="internalDFN">timeline</a>
          that sampled the <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
          If is calculated using the procedures defined in <a href="#inverse-timing-calculations" class="sectionRef">section 5.3 Inverse timing calculations</a>.
        </p>
        <p>
          The <dfn id="dfn-event-iteration-index">event iteration index</dfn> is the value of the <a href="#dfn-timed-item" class="internalDFN">timed
          item</a>'s <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> and moment the event is scheduled
          to occur.
        </p>
        <p>
          The <dfn id="dfn-seeked-dispatch-flag">seeked dispatch flag</dfn> is a boolean value set to
          <code>true</code> if this event was generated as a result of applying
          <a href="#dfn-seeked-event-dispatch" class="internalDFN">seeked event dispatch</a>.
        </p>
      </section>
      <section id="propagation-path">
        <h3><span class="secno">5.5 </span>Propagation path</h3>
        <p>
          The <a href="http://www.w3.org/TR/DOM-Level-3-Events/#glossary-propagation-path">propagation
          path</a> for a <a href="#dfn-timing-event" class="internalDFN">timing event</a> generated by <var>item</var>,
          is simply <var>item</var> itself.
        </p>
        <p class="note">
          Note that unlike <code>AnimationEvent</code>s and
          <code>TransitionEvent</code>s in CSS, and <code>TimeEvent</code>s in
          SVG, all of which target an Element; the target of a <a href="#dfn-timing-event" class="internalDFN">timing
          event</a> is a <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
        </p>
      </section>
      <section id="sequence-of-events">
        <h3><span class="secno">5.6 </span>Sequence of events</h3>
        <p>
          The sequence in which <a href="#dfn-timing-event" class="internalDFN">timing events</a> are queued is as follows:
        </p>
        <ol>
          <li><a href="#dfn-timingcancel" class="internalDFN">timingcancel</a> events are queued first.
              The sequence within <a href="#dfn-timingcancel" class="internalDFN">timingcancel</a> events is as follows:
              <ol>
                <li>
                  Events generated by a <a href="#dfn-timed-item" class="internalDFN">timed item</a>
                  associated with a <a href="#dfn-player" class="internalDFN">player</a> that was created earlier
                  precede events generated by a <a href="#dfn-timed-item" class="internalDFN">timed item</a> associated
                  with a <a href="#dfn-player" class="internalDFN">player</a> created later.
                </li>
                <li>
                  Events generated by the same <a href="#dfn-player" class="internalDFN">player</a> are queued in the
                  order that the <a href="#dfn-unattached-timed-item" class="internalDFN">unattached timed items</a> that generated
                  the events appear in the <a href="#dfn-player" class="internalDFN">player</a>'s <a href="#dfn-queue-of-unattached-timed-items" class="internalDFN">queue of
                  unattached timed items</a>
                  (see <a href="#event-dispatch-and-unattached-timed-items" class="sectionRef">section 5.7.4 Event dispatch and unattached timed items</a>).
                </li>
              </ol>
          </li>
          <li>All other events are ordered by <a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a> with
              earlier times preceding later times in the queue.</li>
          <li>For events with the same <a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>, the following
              rules are applied in succession until the order in the queue is
              resolved,
            <ol>
              <li><a href="#dfn-timingstart" class="internalDFN">timingstart</a> events of <a title="parent timing group" href="#dfn-parent-timing-group" class="internalDFN">parents</a> precede all events
                  generated by <a title="child timed item" href="#dfn-child-timed-item" class="internalDFN">children</a>.</li>
              <li><a href="#dfn-timingiteration" class="internalDFN">timingiteration</a> events of <a title="parent timing group" href="#dfn-parent-timing-group" class="internalDFN">parents</a> precede all events
                  generated by <a title="child timed item" href="#dfn-child-timed-item" class="internalDFN">children</a> during
                  the iteration corresponding to the
                  <a href="#dfn-timingiteration" class="internalDFN">timingiteration</a> event's <a href="#dfn-event-iteration-index" class="internalDFN">event iteration
                  index</a>.</li>
              <li><a href="#dfn-timingend" class="internalDFN">timingend</a> events of <a title="parent timing group" href="#dfn-parent-timing-group" class="internalDFN">parents</a> follow all events
                  generated by <a title="child timed item" href="#dfn-child-timed-item" class="internalDFN">children</a>.
                  <p class="note">
                    In effect, <a title="child timed item" href="#dfn-child-timed-item" class="internalDFN">child timed items</a>
                    operate <em>inside</em> an iteration of their <a href="#dfn-parent-timing-group" class="internalDFN">parent
                    timing group</a> and hence events generated by children are
                    <em>wrapped</em> by their parents' events.
                  </p>
              </li>
              <li>For events generated by different <a href="#dfn-timed-item" class="internalDFN">timed
                  items</a>, <a href="#dfn-timingend" class="internalDFN">timingend</a> events precede <a href="#dfn-timingstart" class="internalDFN">timingstart</a>
                  events which precede <a href="#dfn-timingiteration" class="internalDFN">timingiteration</a> events.
                  <p class="note">
                    Note that sorting end events before start events is
                    consistent with the end-point exclusive nature of intervals
                    (see <a href="#interval-timing" class="sectionRef">section 3.8.4 Interval timing</a>).
                    When animation A ends at the same time as animation
                    B begins, we can imagine that animation A ends an infinitely
                    short amount of time before animation B begins such that
                    there is no overlap.
                  </p>
              </li>
              <li>For events generated by the same <a href="#dfn-timed-item" class="internalDFN">timed
                  items</a>, <a href="#dfn-timingstart" class="internalDFN">timingstart</a> events precede
                  <a href="#dfn-timingiteration" class="internalDFN">timingiteration</a> events which precede
                  <a href="#dfn-timingend" class="internalDFN">timingend</a> events.</li>
              <li>
                For events generated by <a href="#dfn-timed-item" class="internalDFN">timed items</a>
                with a common <a href="#dfn-ancestor" class="internalDFN">ancestor</a> <a href="#dfn-timing-group" class="internalDFN">timing group</a>, events are
                ordered based on a <a href="#dfn-tree-order" class="internalDFN">tree order</a> traversal of the
                descendents of the <a href="#dfn-ancestor" class="internalDFN">ancestor</a> <a href="#dfn-timing-group" class="internalDFN">timing group</a>.
              </li>
              <li>
                Events generated by a <a href="#dfn-timed-item" class="internalDFN">timed item</a>
                associated with a <a href="#dfn-player" class="internalDFN">player</a> that was created earlier precede
                events generated by a <a href="#dfn-timed-item" class="internalDFN">timed item</a> associated with
                a <a href="#dfn-player" class="internalDFN">player</a> created later.
              </li>
            </ol>
          </li>
        </ol>
      </section>
      <section id="event-dispatch">
        <h3><span class="secno">5.7 </span>Event dispatch</h3>
        <p>
          <dfn id="dfn-events-are-queued">Events are queued</dfn> when either of the following occurs:
        </p>
        <ul>
          <li>a <a href="#dfn-timeline" class="internalDFN">timeline</a> is <a title="sampling" href="#dfn-sampling" class="internalDFN">sampled</a>, or</li>
          <li>a <a href="#dfn-player" class="internalDFN">player</a> is <a title="seeking" href="#dfn-seeking" class="internalDFN">seeked</a>.</li>
        </ul>
        <p>
          In the former case&#x2014;when a <a href="#dfn-timeline" class="internalDFN">timeline</a> is <a title="sampling" href="#dfn-sampling" class="internalDFN">sampled</a>&#x2014;since Web Animations put no
          requirements on the time between successive samples, it is often the
          case  that the moment when a change in state that should produce an
          event is scheduled to occur does not line up with a sample.
        </p>
        <p>
          As such, except for the specific circumstances mentioned in following
          sections, the events that should be queued when <a href="#dfn-sampling" class="internalDFN">sampling</a>
          a <a href="#dfn-timeline" class="internalDFN">timeline</a> includes all events scheduled to occur in the
          interval since the previous sample time up to and including the
          current timeline time.
        </p>
        <p class="note">
          Note that when a <a href="#dfn-player" class="internalDFN">player</a> is first <a title="sampling" href="#dfn-sampling" class="internalDFN">sampled</a>, it will employ <a href="#dfn-seeked-event-dispatch" class="internalDFN">seeked event
          dispatch</a> as described in <a href="#event-dispatch-and-time-adjustments" class="sectionRef">section 5.7.3 Event dispatch and time adjustments</a>
          after which point the previous sample time for that <a href="#dfn-player" class="internalDFN">player</a>
          will be resolved.
          As a result, there is never an occasion where the previous sample time
          is used and yet is undefined.
        </p>
        <p>
          For the latter case&#x2014;when a <a href="#dfn-player" class="internalDFN">player</a> is <a title="seeking" href="#dfn-seeking" class="internalDFN">seeked</a>&#x2014;the behavior is defined in <a href="#event-dispatch-and-seeking-a-player" class="sectionRef">section 5.7.2 Event dispatch and seeking a player</a>.
        </p>
        <p class="todo">
          Make sure we update the previous sample time for a seek/etc.
        </p>
        <p class="note">
          Note that <a href="#algorithms-for-event-dispatch" class="sectionRef">section C. Algorithms for event dispatch</a> provides non-normative algorithms that
          incorporate the behavior defined in this section as well as <a href="#sequence-of-events" class="sectionRef">section 5.6 Sequence of events</a>.
        </p>
        <section id="seeked-event-dispatch">
          <h4><span class="secno">5.7.1 </span>Seeked event dispatch</h4>
          <div class="informative informative-bg">
            <p><em>This section is non-normative.</em></p><p>
              Under some circumstances the usual behavior of dispatching all
              events scheduled between two times is not appropriate either
              because it would produce such a large number of events that
              performance may be adversely affected,
              or because it would produce counter-intuitive results in the
              circumstances.
              In such situations, an alternative form of event dispatch called
              <a href="#dfn-seeked-event-dispatch" class="internalDFN">seeked event dispatch</a> is used.
            </p>
          </div>
          <p>
            <dfn id="dfn-seeked-event-dispatch">Seeked event dispatch</dfn> is a mode of event dispatch that
            produces at most one <a href="#dfn-timing-event" class="internalDFN">timing event</a> per <a href="#dfn-timed-item" class="internalDFN">timed item</a> by
            comparing whether the <a href="#dfn-timed-item" class="internalDFN">timed item</a> was <a href="#dfn-active" class="internalDFN">active</a> or not at
            some <var>initial moment</var> and at some <var>final moment</var>.
          </p>
          <p>
            To facilitate this, each <a href="#dfn-timed-item" class="internalDFN">timed item</a> has an associated
            <dfn id="dfn-previous-active-state">previous active state</dfn> property that initially has the
            value <em>inactive</em>.
          </p>
          <p>
            For a given <a href="#dfn-timed-item" class="internalDFN">timed item</a> the events queued as a result of
            performing <a href="#dfn-seeked-event-dispatch" class="internalDFN">seeked event dispatch</a> at <em>uneased local
            time</em> <var>t</var> is as follows:
          </p>
          <ol>
            <li>Let <var>timeline time</var> be the <a href="#dfn-time-value" class="internalDFN">time value</a> of the
                <a href="#dfn-timeline" class="internalDFN">timeline</a> with which the <a href="#dfn-timed-item" class="internalDFN">timed item</a> is
                associated.
                The procedures for calculating the timeline time from a <a href="#dfn-timed-item" class="internalDFN">timed
                item</a>'s <em>uneased local time</em> or the <a href="#dfn-current-time" class="internalDFN">current
                time</a> of a <a href="#dfn-player" class="internalDFN">player</a> are defined in <a href="#inverse-timing-calculations" class="sectionRef">section 5.3 Inverse timing calculations</a>.
                </li>
            <li>Let <var>iteration index</var> be the result of calculating the
                <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> at <var>t</var>.</li>
            <li>Let <var>timeline time</var> be the <a href="#dfn-time-value" class="internalDFN">time value</a> of the
                <a href="#dfn-timeline" class="internalDFN">timeline</a> with which the <a href="#dfn-timed-item" class="internalDFN">timed item</a> is
                associated.
                The procedures for calculating the timeline time from a <a href="#dfn-timed-item" class="internalDFN">timed
                item</a>'s <em>uneased local time</em> or the <a href="#dfn-current-time" class="internalDFN">current
                time</a> of a <a href="#dfn-player" class="internalDFN">player</a> are defined in <a href="#inverse-timing-calculations" class="sectionRef">section 5.3 Inverse timing calculations</a>.
                </li>
            <li>Let <var>current active state</var> be <em>active</em> if the
                timed item is <a href="#dfn-active" class="internalDFN">active</a> at <var>t</var>, and
                <em>inactive</em> otherwise.</li>
            <li>The events to be queued depend on comparing the <var>current
                active state</var> and the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-previous-active-state" class="internalDFN">previous active
                state</a> as follows.
            <dl class="switch">
              <dt>If the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-previous-active-state" class="internalDFN">previous active state</a> is
                <em>active</em> and <var>current active state</var> is
                <em>inactive</em>,</dt>
              <dd>
                Queue a new <a href="#dfn-timingend" class="internalDFN">timingend</a> event with parameters:
                <ul>
                  <li><a href="#dfn-event-local-time" class="internalDFN">event local time</a>: <var>t</var></li>
                  <li><a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>: <var>timeline time</var></li>
                  <li><a href="#dfn-event-iteration-index" class="internalDFN">event iteration index</a>: <var>iteration index</var>
                  </li><li><a href="#dfn-seeked-dispatch-flag" class="internalDFN">seeked dispatch flag</a>: <var>true</var>
                </li></ul>
              </dd>
              <dt>If the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-previous-active-state" class="internalDFN">previous active state</a> is
                <em>inactive</em> and <var>current active state</var> is
                <em>active</em>,</dt>
              <dd>
                Queue a new <a href="#dfn-timingstart" class="internalDFN">timingstart</a> event with parameters:
                <ul>
                  <li><a href="#dfn-event-local-time" class="internalDFN">event local time</a>: <var>t</var></li>
                  <li><a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>: <var>timeline time</var></li>
                  <li><a href="#dfn-event-iteration-index" class="internalDFN">event iteration index</a>: <var>iteration index</var>
                  </li><li><a href="#dfn-seeked-dispatch-flag" class="internalDFN">seeked dispatch flag</a>: <var>true</var>
                </li></ul>
              </dd>
            </dl>
            </li>
            <li>
              Let the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a href="#dfn-previous-active-state" class="internalDFN">previous active state</a> be
              <var>current active state</var>.
            </li>
          </ol>
          <p>
            For <a href="#dfn-timing-group" class="internalDFN">timing groups</a>, this procedure is
            applied recursively to all <a href="#dfn-child-timed-item" class="internalDFN">child timed
            items</a>.
            The resulting events are sorted using the sequence defined in <a href="#sequence-of-events" class="sectionRef">section 5.6 Sequence of events</a>.
          </p>
          <p>
            Note that <a href="#dfn-seeked-event-dispatch" class="internalDFN">seeked event dispatch</a> is only defined for <a href="#dfn-timed-item" class="internalDFN">timed
            items</a> associated with a <a href="#dfn-player" class="internalDFN">player</a>.
            <a href="#dfn-timed-item" class="internalDFN">Timed items</a> not associated with a <a href="#dfn-player" class="internalDFN">player</a> dispatch
            <a href="#dfn-timingcancel" class="internalDFN">timingcancel</a> events as defined in <a href="#event-dispatch-and-time-adjustments" class="sectionRef">section 5.7.3 Event dispatch and time adjustments</a>.
          </p>
        </section>
        <section id="event-dispatch-and-seeking-a-player">
          <h4><span class="secno">5.7.2 </span>Event dispatch and seeking a player</h4>
          <p>
            When a seek is performed on a <a href="#dfn-player" class="internalDFN">player</a> (see <a href="#performing-a-seek" class="sectionRef">section 3.5.2.6 Performing a seek</a>) <a href="#dfn-seeked-event-dispatch" class="internalDFN">seeked event
            dispatch</a> is applied.
          </p>
          <p>
            Prior to performing the seek, the <a href="#dfn-previous-active-state" class="internalDFN">previous active state</a> of
            each <a href="#dfn-timed-item" class="internalDFN">timed item</a> that is either the <a href="#dfn-source-content" class="internalDFN">source content</a> of
            the <a href="#dfn-player" class="internalDFN">player</a> or a descendent of the <a href="#dfn-source-content" class="internalDFN">source content</a> is
            updated to reflect whether the <a href="#dfn-timed-item" class="internalDFN">timed item</a> is <a href="#dfn-active" class="internalDFN">active</a> or
            not at the moment prior to performing the seek.
          </p>
          <p>
            If the <a href="#dfn-time-adjusted-flag" class="internalDFN">time adjusted flag</a> of the <a href="#dfn-player" class="internalDFN">player</a> has been set,
            no update of the <a href="#dfn-previous-active-state" class="internalDFN">previous active state</a> of the <a href="#dfn-source-content" class="internalDFN">source
            content</a> and its <a href="#dfn-descendant" class="internalDFN">descendants</a> is performed.
          </p>
          <p>
            The <var>timeline time</var> used in the <a href="#dfn-seeked-event-dispatch" class="internalDFN">seeked event
            dispatch</a> procedure is simply the <var>seek time</var>.
          </p>
          <p>
            After completing the seek, the previous sample time of the
            <a href="#dfn-player" class="internalDFN">player</a> is updated to reflect the <var>seek time</var> and the
            <a href="#dfn-time-adjusted-flag" class="internalDFN">time adjusted flag</a>, if set, is cleared.
          </p>
          
        </section>
        <section id="event-dispatch-and-time-adjustments">
          <h4><span class="secno">5.7.3 </span>Event dispatch and time adjustments</h4>
          <div class="informative informative-bg">
            <p><em>This section is non-normative.</em></p><p>
              Apart from seeking a <a href="#dfn-player" class="internalDFN">player</a>, making adjustments to the
              arrangement or timing of a player's <a href="#dfn-source-content" class="internalDFN">source content</a> can also
              cause the <a href="#dfn-timed-item" class="internalDFN">timed items</a>' <a href="#dfn-local-time" class="internalDFN">local time</a> to jump.
              Like seeking, in such circumstances it is often not sensible to
              dispatch all the intermediate events but rather to employ
              <a href="#dfn-seeked-event-dispatch" class="internalDFN">seeked event dispatch</a>.
            </p>
            <p>
              The range of circumstances where this behavior is necessary is
              quite broad when we consider the interdependencies in the timing
              of <a href="#dfn-timed-item" class="internalDFN">timed items</a>.
              For example,
            </p>
            <ul>
              <li><a href="#dfn-timing-group" class="internalDFN">Timing groups</a> calculate their <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration
              duration</a> based on the <a href="#dfn-active-duration" class="internalDFN">active duration</a> of their
              <a title="child timed item" href="#dfn-child-timed-item" class="internalDFN">children</a>.</li>
              <li>Children of a <a href="#dfn-sequence-timing-group" class="internalDFN">sequence timing group</a> base their
              <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> on the <a href="#dfn-active-duration" class="internalDFN">active
              duration</a> of sibling <a href="#dfn-timed-item" class="internalDFN">timed items</a> that appear earlier in
              the group.</li>
            </ul>
            <p>
              As such, even small changes to the timing of a <a href="#dfn-timed-item" class="internalDFN">timed item</a>
              can have knock-on effects that affect all other <a href="#dfn-timed-item" class="internalDFN">timed items</a>
              <a title="associated with a player">associated</a> with the same
              player possibly causing their <a href="#dfn-local-time" class="internalDFN">local time</a> to jump.
              As a result, <a href="#dfn-seeked-event-dispatch" class="internalDFN">seeked event dispatch</a> is employed for the
              <a href="#dfn-source-content" class="internalDFN">source content</a> of a <a href="#dfn-player" class="internalDFN">player</a> and <em>all</em> its
              descendents whenever <em>any</em> change is made to the timing or
              arrangement of any of those <a href="#dfn-timed-item" class="internalDFN">timed items</a>.
            </p>
          </div>
          <p>
            Associated with each <a href="#dfn-player" class="internalDFN">player</a> is a <dfn id="dfn-time-adjusted-flag">time adjusted
            flag</dfn> that is initially <code>false</code>.
          </p>
          <p>
            The <a href="#dfn-time-adjusted-flag" class="internalDFN">time adjusted flag</a> is set to <code>true</code> whenever
            any of the following actions is performed on any of the <a href="#dfn-timed-item" class="internalDFN">timed
            items</a> <a title="associated with a player">associated</a> with
            the <a href="#dfn-player" class="internalDFN">player</a>.
          </p>
          <ul>
            <li>The <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a> changes identity including
                changes to and from <code>null</code>.
                This includes <a href="#dfn-timed-item" class="internalDFN">timed items</a> that become newly <a title="associated with a player">associated</a> with the
                <a href="#dfn-player" class="internalDFN">player</a> or likewise cease to be associated with the
                player.</li>
            <li>
              The following timing parameters are modified:
              <ul>
                <li><a href="#dfn-start-delay" class="internalDFN">start delay</a></li>
                <li><a href="#dfn-iteration-start" class="internalDFN">iteration start</a></li>
                <li><a href="#dfn-iteration-count" class="internalDFN">iteration count</a></li>
                <li><a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a></li>
                <li><a href="#dfn-active-duration" class="internalDFN">active duration</a></li>
                <li><a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a></li>
                <li><a href="#dfn-playback-direction" class="internalDFN">playback direction</a></li>
              </ul>
              <p class="note">
                Note that the <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> and <a href="#dfn-timing-function" class="internalDFN">timing function</a>
                associated with a <a href="#dfn-timed-item" class="internalDFN">timed item</a> are not included in this
                list since they do not effect <a href="#dfn-uneased-timing" class="internalDFN">uneased timing</a>.
              </p>
              <p>
                This behavior extends only to actual changes to the
                values.
                Setting a property to its current value&#x2014;for example, by
                using the <a href="#script-interface">script
                interface</a>&#x2014; does <em>not</em> cause the flag to be set.
              </p>
            </li>
            <li>
              The sequence of <a title="child timed item" href="#dfn-child-timed-item" class="internalDFN">children</a> within
              a <a href="#dfn-timing-group" class="internalDFN">timing group</a> is changed.
            </li>
          </ul>
          <p>
            The <a href="#dfn-time-adjusted-flag" class="internalDFN">time adjusted flag</a> is cleared after <a href="#dfn-events-are-queued" class="internalDFN">events are
            queued</a> for the given <a href="#dfn-player" class="internalDFN">player</a>.
          </p>
          <p>
            When <a title="events are queued" href="#dfn-events-are-queued" class="internalDFN">queuing events</a> for
            a <a href="#dfn-player" class="internalDFN">player</a>, if the <a href="#dfn-time-adjusted-flag" class="internalDFN">time adjusted flag</a> of the
            <a href="#dfn-player" class="internalDFN">player</a> is set, <a href="#dfn-seeked-event-dispatch" class="internalDFN">seeked event dispatch</a> is used for all
            <a href="#dfn-timed-item" class="internalDFN">timed items</a> <a title="associated with
            a player">associated</a> with the <a href="#dfn-player" class="internalDFN">player</a>.
          </p>
        </section>
        <section id="event-dispatch-and-unattached-timed-items">
          <h4><span class="secno">5.7.4 </span>Event dispatch and unattached timed items</h4>
          <div class="issue">
            <p>
              The <a href="#dfn-timingcancel" class="internalDFN">timingcancel</a> event may not be necessary.
            </p>
            <p>
              It was introduced since in some situations it is useful to
              distinguish between an animation completing normally
              (<a href="#dfn-timingend" class="internalDFN">timingend</a>&#x2014;in which case actions that are scheduled
              to occur at the end of the animation should be performed) and
              being prematurely terminated (<a href="#dfn-timingcancel" class="internalDFN">timingcancel</a>&#x2014;in which
              case such actions will generally not be performed).
            </p>
            <p>
              Currently the only way to prematurely end a <a href="#dfn-timed-item" class="internalDFN">timed item</a> is
              to manually disassociate it from any <a href="#dfn-player" class="internalDFN">player</a> which seems too
              rare to warrant a special event.
              If <a href="#dfn-player" class="internalDFN">players</a> could be cancelled or stopped in some way then
              this event may make more sense.
            </p>
            <p>
              Note that the <em>touchcancel</em> event is conceptually similar
              and may be an argument in favor of keeping this event.
            </p>
          </div>
          <p>
            A <a href="#dfn-timed-item" class="internalDFN">timed item</a> that is not <a>associated with a player</a> is
            an <dfn id="dfn-unattached-timed-item">unattached timed item</dfn>.
          </p>
          <p>
            Each time an operation is performed that causes a <a href="#dfn-timed-item" class="internalDFN">timed item</a>
            that was <a>associated with a player</a> to become an <a href="#dfn-unattached-timed-item" class="internalDFN">unattached
            timed item</a> it is appended to the end of a <dfn id="dfn-queue-of-unattached-timed-items">queue of
            unattached timed items</dfn> associated with the <a href="#dfn-player" class="internalDFN">player</a>.
          </p>
          <p>
            Should an <a href="#dfn-unattached-timed-item" class="internalDFN">unattached timed item</a> later become <a>associated
            with a player</a> it is removed from any <a href="#dfn-queue-of-unattached-timed-items" class="internalDFN">queue of unattached
            timed items</a> it may be present in.
            As a result a <a href="#dfn-timed-item" class="internalDFN">timed item</a> will only ever appear in at most one
            <a>queue of unattached times</a> and never twice in the same queue.
          </p>
          <p>
            When <a href="#dfn-events-are-queued" class="internalDFN">events are queued</a> as a result of <a href="#dfn-sampling" class="internalDFN">sampling</a>,
            the following steps are performed for all <a href="#dfn-timed-item" class="internalDFN">timed items</a> in the
            <a>queue of unattached items</a> for each <a href="#dfn-player" class="internalDFN">player</a> that is <a title="sampling" href="#dfn-sampling" class="internalDFN">sampled</a>.
          </p>
          <ol>
            <li>If the <a href="#dfn-previous-active-state" class="internalDFN">previous active state</a> of the <a href="#dfn-timed-item" class="internalDFN">timed item</a> is
                <em>active</em>,
                <ol>
                  <li>Queue a new <a href="#dfn-timingcancel" class="internalDFN">timingcancel</a> event with all parameters
                      set to <code>null</code>.</li>
                  <li>Set the <a href="#dfn-previous-active-state" class="internalDFN">previous active state</a> to
                      <em>inactive</em>.</li>
                </ol>
            </li>
            <li>
              Remove the <a href="#dfn-timed-item" class="internalDFN">timed item</a> from the <a href="#dfn-queue-of-unattached-timed-items" class="internalDFN">queue of unattached timed
              items</a>.
            </li>
          </ol>
          <p class="note">
            Note that <a href="#dfn-timingcancel" class="internalDFN">timingcancel</a> events are not dispatched when <a title="seeking" href="#dfn-seeking" class="internalDFN">seeking</a> a <a href="#dfn-player" class="internalDFN">player</a>.
            As a result it is possible, using the <a href="#script-interface">script interface</a> to make a batch of
            changes to the arrangement of <a href="#dfn-timed-item" class="internalDFN">timed items</a> including
            <a href="#dfn-seeking" class="internalDFN">seeking</a> and provided all <a href="#dfn-timed-item" class="internalDFN">timed items</a> are <a>associated
            with a player</a> when the script block completes no
            <a href="#dfn-timingcancel" class="internalDFN">timingcancel</a> events will be dispatched.
          </p>
        </section>
        <section id="event-dispatch-and-extended-delays">
          <h4><span class="secno">5.7.5 </span>Event dispatch and extended delays</h4>
          <div class="informative informative-bg">
            <p><em>This section is non-normative.</em></p><p>
              In some circumstances, when <a href="#dfn-events-are-queued" class="internalDFN">events are queued</a> during
              a <a href="#dfn-sample" class="internalDFN">sample</a>, the number of events generated may be excessive.
              This can happen, for example, if the user agent dramatically
              reduces the sample rate for a background application to conserve
              battery, or if the device is activated after being in a sleep
              state for an extended period of time.
            </p>
            <p>
              In such situations, requiring the user agent to dispatch all
              <a href="#dfn-timing-event" class="internalDFN">timing events</a> scheduled in the interim period would result
              in a significant drop in performance and in extreme circumstances
              may render the user agent temporarily unusable whilst it catches
              up on event processing.
            </p>
            <p>
              In order to ensure a good user experience even in such
              circumstances a user agent may switch to <a href="#dfn-seeked-event-dispatch" class="internalDFN">seeked event
              dispatch</a> to alleviate the burden of dispatching excessive
              events.
            </p>
          </div>
          <p>
            If, whilst <a href="#dfn-sampling" class="internalDFN">sampling</a> a <a href="#dfn-timeline" class="internalDFN">timeline</a>, more than 30 <a href="#dfn-events-are-queued" class="internalDFN">events
            are queued</a>, the user agent <em class="rfc2119" title="may">may</em> employ <a href="#dfn-seeked-event-dispatch" class="internalDFN">seeked event
            dispatch</a> for all <a href="#dfn-timed-item" class="internalDFN">timed items</a> <a title="associated with a timeline" href="#dfn-associated-with-a-timeline" class="internalDFN">associated</a> with the
            <a href="#dfn-timeline" class="internalDFN">timeline</a>.
          </p>
          <p class="issue">
            30 is somewhat arbitrary.
            Need feedback both from implementations (on the most constrained
            device, when does this start being burdensome?) and authoring (what
            is the minimum guarantee necessary to cover most regular content?)
          </p>
          
        </section>
      </section>
    </section>

    <section id="script-interface">
      <!--OddPage--><h2><span class="secno">6. </span>Script interface</h2>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          In addition to the abstract model described above, Web Animations also
          defines a programming interface to the model.
          This interface can be used to inspect and extend animations produced
          by declarative means or for directly producing animations when
          a procedural approach is more suitable.
        </p>
      </div>
      <section id="the-timeline-interface">
        <h3><span class="secno">6.1 </span>The <code>Timeline</code> interface</h3>
        <p>
          <a href="#dfn-timeline" class="internalDFN">Timelines</a>, including the <a href="#dfn-document-timeline" class="internalDFN">document
          timeline</a> are represented in the Web Animations <abbr title="Application Programming Interface">API</abbr> by the
          <a title="Timeline interface" href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-Timeline">interface <span class="idlInterfaceID">Timeline</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>double</a>?</span> <span class="idlAttrName"><a href="#widl-Timeline-currentTime">currentTime</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-Player" class="idlType"><code>Player</code></a></span>           <span class="idlMethName"><a href="#widl-Timeline-play-Player-TimedItem-source">play</a></span> (<span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span> <span class="idlParamName">source</span> = <span class="idlParamValue">null</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-Player" class="idlType"><code>Player</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-Timeline-getCurrentPlayers-sequence-Player">getCurrentPlayers</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>double</a>?</span>          <span class="idlMethName"><a href="#widl-Timeline-toTimelineTime-double-double-otherTime-Timeline-other">toTimelineTime</a></span> (<span class="idlParam"><span class="idlParamType"><a>double</a></span> <span class="idlParamName">otherTime</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a></span> <span class="idlParamName">other</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>double</a>?</span>          <span class="idlMethName"><a href="#widl-Timeline-toTimelineTime-double-Event-event">toTimelineTime</a></span> (<span class="idlParam"><span class="idlParamType"><a>Event</a></span> <span class="idlParamName">event</span></span>);</span>
};</span>
</pre><section id="attributes"><h4><span class="secno">6.1.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-Timeline-currentTime"><code>currentTime</code> of type <span class="idlAttrType"><a>double</a></span>, readonly, nullable</dt><dd>
            <p>
              Returns the <a href="#dfn-time-value" class="internalDFN">time value</a> for this timeline or
              <code>null</code> if this timeline is <a href="#dfn-not-started" class="internalDFN">not started</a>.
            </p>
            <p>
              For a <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> this will never be negative and
              represents the number of seconds since the document with which
              this <a href="#dfn-timeline" class="internalDFN">timeline</a> is associated was ready to fire its load
              event.
            </p>
          </dd></dl></section><section id="methods"><h4><span class="secno">6.1.2 </span>Methods</h4><dl class="methods"><dt id="widl-Timeline-play-Player-TimedItem-source"><code>play</code></dt><dd>
            <p>
              Creates a new <a title="Player interface" href="#idl-def-Player" class="idlType"><code>Player</code></a> object
              associated with this <a href="#dfn-timeline" class="internalDFN">timeline</a> that is scheduled to start
              at <code>currentTime</code>.
            </p>
            <p>
              The <code>timeline</code> attribute of the newly-created <a title="Player interface" href="#idl-def-Player" class="idlType"><code>Player</code></a> object will be set to this
              object.
            </p>
            <p>
              Similarly, the <code>startTime</code> attribute will be set to the
              value of this object's <code>currentTime</code> attribute at the
              moment the method was called, or, if <code>currentTime</code> is
              <code>null</code>, zero.
            </p>
            <p>
              The setting of the <code>source</code> attribute is described
              below under the description of the <em>source</em> parameter.
            </p>
            <p>
              The <code>currentTime</code> attribute of the <a title="Player
              interface" href="#idl-def-Player" class="idlType"><code>Player</code></a> object is a calculated value described in <a href="#the-current-time-of-a-player" class="sectionRef">section 3.5.1 The current time of a player</a>.
            </p>
            <p>
              The <code>playbackRate</code> and <code>paused</code> attributes
              take on their default values as described in the definitions of
              the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> and
              <a href="#dfn-paused-state" class="internalDFN">paused state</a> properties of <a href="#dfn-player" class="internalDFN">player</a> objects.
            </p>
            
            <div class="issue">
              <p>
                We will likely change this interface to the following format:
              </p>
              <pre class="example webidl">Promise play(optional TimedItem? source = null);
Player  playNow(optional TimedItem? source = null);</pre>
              <p>
                Under this arrangement <code>play</code> would begin at the next
                possible moment whilst attempting to ensure that the animation
                begins from the first frame.
                This allows implementations to make adjustments for vsync or
                overhead in triggering the animation in another process.
              </p>
              <p>
                The <code>play</code> callback passes the created <a title="Player interface" href="#idl-def-Player" class="idlType"><code>Player</code></a> as the argument to the
                Promise's fulfill callback.
              </p>
              <p>
                <code>playNow</code> matches the existing definition of the
                function and causes the start time of the player to be set to
                this timeline's <code>currentTime</code> even though this may
                cause the first part of the animation to be dropped.
              </p>
            </div>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">source</td><td class="prmType"><code><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a></code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span> (<code>null</code>)</td><td class="prmDesc">
                <p>
                  The <a href="#dfn-source-content" class="internalDFN">source content</a> to assign to the newly-created <a title="Player interface" href="#idl-def-Player" class="idlType"><code>Player</code></a> object.
                </p>
                <p>
                  The <a href="#widl-Player-source"><code>source</code></a>
                  attribute of the created <a title="Player
                  interface" href="#idl-def-Player" class="idlType"><code>Player</code></a> is set by following the procedure
                  defined for updating that attribute.
                  As a result, if <em>source</em> is already associated with
                  a <code>player</code>, it will be disassociated first before
                  being associated with the new <a title="Player
                  interface" href="#idl-def-Player" class="idlType"><code>Player</code></a> object.
                </p>
              </td></tr></table><div><em>Return type: </em><code><a href="#idl-def-Player" class="idlType"><code>Player</code></a></code></div></dd><dt id="widl-Timeline-getCurrentPlayers-sequence-Player"><code>getCurrentPlayers</code></dt><dd>
            <p>
              Returns the set of <a title="Player interface" href="#idl-def-Player" class="idlType"><code>Player</code></a> objects
              associated with this <a href="#dfn-timeline" class="internalDFN">timeline</a> that have associated
              <a href="#dfn-source-content" class="internalDFN">source content</a> which is <a href="#dfn-current" class="internalDFN">current</a>.
            </p>
            <p>
              The returned list is sorted in increasing order by <a href="#dfn-player-sequence-number" class="internalDFN">player
              sequence number</a>.
            </p>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code>sequence&lt;<a></a><a href="#idl-def-Player" class="idlType"><code>Player</code></a>&gt;</code></div></dd><dt id="widl-Timeline-toTimelineTime-double-double-otherTime-Timeline-other"><code>toTimelineTime</code></dt><dd>
            <p>
              Returns the <a href="#dfn-time-value" class="internalDFN">time value</a>, <em>otherTime</em>, from another
              <a title="Timeline interface" href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a> also tied to the
              <a href="#dfn-global-clock" class="internalDFN">global clock</a>, <em>other</em>, converted to a <a href="#dfn-time-value" class="internalDFN">time
              value</a> relative to this timeline's <a href="#dfn-zero-time" class="internalDFN">zero time</a>.
            </p>
            <p>
              Returns <code>null</code> if:
            </p>
            <ul>
              <li>this timeline is <a href="#dfn-not-started" class="internalDFN">not started</a>, or</li>
              <li><em>other</em> is <a href="#dfn-not-started" class="internalDFN">not started</a>.</li>
            </ul>
            <p>
              Note that unlike <code>currentTime</code>, this method may return
              a negative <a href="#dfn-time-value" class="internalDFN">time value</a> if <em>otherTime</em> occurred prior
              to this timeline's <a href="#dfn-zero-time" class="internalDFN">zero time</a>.
            </p>
            <p>
              Furthermore, negative values for <em>otherTime</em> are also
              allowed.
            </p>
            <p>
              If this timeline records the <a href="#dfn-time-value" class="internalDFN">time value</a> of the <a href="#dfn-global-clock" class="internalDFN">global
              clock</a> at its <a href="#dfn-zero-time" class="internalDFN">zero time</a> as <var>global clock
              offset</var>, and so does <em>other</em> as <var>other global
              clock offset</var>, then the result of this method is simply:
            </p>
            <blockquote>
              <code><var>other global clock offset</var> + <var>otherTime</var>
              - <var>global clock offset</var></code>
            </blockquote>
            <p>
              Exceptions:
            </p>
            <dl class="exceptions">
              <dt>DOMException of type <code>InvalidNodeTypeError</code></dt>
              <dd>
                Raised if <em>other</em> is a timeline that is not tied to the
                <a href="#dfn-global-clock" class="internalDFN">global clock</a>.
                
              </dd>
            </dl>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">otherTime</td><td class="prmType"><code><a>double</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr><tr><td class="prmName">other</td><td class="prmType"><code><a href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>double</a></code>, nullable</div></dd><dt id="widl-Timeline-toTimelineTime-double-Event-event"><code>toTimelineTime</code></dt><dd>
            <p>
              Returns the number of seconds between when <em>event</em> was
              fired and this <a href="#dfn-timeline" class="internalDFN">timeline</a>'s <a href="#dfn-zero-time" class="internalDFN">zero time</a>.
            </p>
            <p>
              Since the <code>timeStamp</code> attribute of the
              <code>Event</code> interface specified in [<cite><a class="bibref" href="#bib-DOM-LEVEL-3-EVENTS">DOM-LEVEL-3-EVENTS</a></cite>]
              is not guaranteed to be monotonically increasing, implementations
              <em class="rfc2119" title="should">should</em> record alongside each event the <a href="#dfn-time-value" class="internalDFN">time value</a> of the
              <a href="#dfn-global-clock" class="internalDFN">global clock</a> when the event is dispatched so that it can be
              converted to an accurate <a href="#dfn-time-value" class="internalDFN">time value</a> here.
            </p>
            <p>
              Unlike <code>currentTime</code>, this method may return a negative
              <a href="#dfn-time-value" class="internalDFN">time value</a> if the event was fired prior to this
              <a href="#dfn-timeline" class="internalDFN">timeline</a>'s <a href="#dfn-zero-time" class="internalDFN">zero time</a>.
            </p>
            <p>
              Returns <code>null</code> if this <a href="#dfn-timeline" class="internalDFN">timeline</a> is <a href="#dfn-not-started" class="internalDFN">not
              started</a>.
            </p>
            <p class="issue">
              This might be deferred to a later version.
            </p>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">event</td><td class="prmType"><code><a>Event</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>double</a></code>, nullable</div></dd></dl></section>
      </section>
      <section id="the-player-interface">
        <h3><span class="secno">6.2 </span>The <code>Player</code> interface</h3>
        <p>
          <a href="#dfn-player" class="internalDFN">Players</a> are represented in the Web Animations
          <abbr title="Application Programming Interface">API</abbr> by the <a title="Player interface" href="#idl-def-Player" class="idlType"><code>Player</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-Player">interface <span class="idlInterfaceID">Player</span> {
<span class="idlAttribute">             attribute <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span> <span class="idlAttrName"><a href="#widl-Player-source">source</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a></span>   <span class="idlAttrName"><a href="#widl-Player-timeline">timeline</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>double</a></span>     <span class="idlAttrName"><a href="#widl-Player-startTime">startTime</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>double</a></span>     <span class="idlAttrName"><a href="#widl-Player-currentTime">currentTime</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>double</a></span>     <span class="idlAttrName"><a href="#widl-Player-playbackRate">playbackRate</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>boolean</a></span>    <span class="idlAttrName"><a href="#widl-Player-paused">paused</a></span>;</span>
};</span>
</pre><section id="attributes-1"><h4><span class="secno">6.2.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-Player-source"><code>source</code> of type <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a></span>, nullable</dt><dd>
            <p>
              The <a href="#dfn-source-content" class="internalDFN">source content</a> associated with this player.
            </p>
            <p>
              A <a href="#dfn-player" class="internalDFN">player</a> can only be associated with at most one <a href="#dfn-timed-item" class="internalDFN">timed
              item</a>, and likewise, a <a href="#dfn-timed-item" class="internalDFN">timed item</a> can only be
              associated&#x2014;either directly or via an
              <a href="#dfn-ancestor" class="internalDFN">ancestor</a>&#x2014;with at most one <a href="#dfn-player" class="internalDFN">player</a>.
              In order to maintain these invariants, on setting this value, the
              following procedure is performed:
            </p>
            <ol>
              <li>Let <var>old value</var> be the current value of the
                  <code>source</code> attribute.</li>
              <li>Let <var>new value</var> be the value to set.</li>
              <li>If <var>new value</var> is the same object as <var>old
                  value</var>, return.</li>
              <li>If <var>old value</var> is not <code>null</code>,
                  disassociate <var>old value</var> from this player.</li>
              <li>If <var>new value</var> is not <code>null</code>,
                  perform the steps associated with the first matching condition
                  of the following:
                <dl class="switch">
                  <dt>If <var>new value</var> has no parent group and is
                      associated with a player,</dt>
                  <dd>disassociate <var>new value</var> from its player.</dd>
                  <dt>If <var>new value</var> has a parent group,</dt>
                  <dd>remove <var>new value</var> from its parent group by
                      calling <code><var>new value</var>.remove()</code>.</dd>
                  <dt>Otherwise,</dt>
                  <dd>do nothing.</dd>
                </dl>
              </li>
              <li>Associate <var>new value</var> with this player.
              </li><li>Set the <code>source</code> attribute to <var>new
                  value</var>.</li>
            </ol>
          </dd><dt id="widl-Player-timeline"><code>timeline</code> of type <span class="idlAttrType"><a href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a></span>, readonly</dt><dd>
            The <a href="#dfn-timeline" class="internalDFN">timeline</a> associated with this player.
          </dd><dt id="widl-Player-startTime"><code>startTime</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            The <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a> of this player.
          </dd><dt id="widl-Player-currentTime"><code>currentTime</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            The <a href="#dfn-effective-current-time" class="internalDFN">effective current time</a> of this player.
            Setting this attribute follows the procedure defined in <a href="#performing-a-seek" class="sectionRef">section 3.5.2.6 Performing a seek</a>.
          </dd><dt id="widl-Player-playbackRate"><code>playbackRate</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            The <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> of this
            player.
            Setting this attribute follows the procedure defined in <a href="#updating-the-playback-rate" class="sectionRef">section 3.5.3.1 Updating the playback rate</a>.
          </dd><dt id="widl-Player-paused"><code>paused</code> of type <span class="idlAttrType"><a>boolean</a></span></dt><dd>
            The <a href="#dfn-paused-state" class="internalDFN">paused state</a> of this player.
            Setting this attribute follows the procedure defined in <a href="#updating-the-paused-state" class="sectionRef">section 3.5.2.5 Updating the paused state</a>.
          </dd></dl></section>
        <div class="feedbackWanted">
          <p>
            A reverse method would be very useful here for effects like
            transitions.
          </p>
          <p>
            The behavior would be:
          </p>
          <ol>
            <li>If <code>currentTime</code> is beyond the <a href="#dfn-end-time" class="internalDFN">end
                time</a> of the <a href="#dfn-source-content" class="internalDFN">source content</a> seek back to the end of
                the <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
            </li><li>Set <code>playbackRate</code> to
                <code>-playbackRate</code>.</li>
          </ol>
          <p>
            This reflects how transitions work as well as common usage.
          </p>
          <p>
            Some objections:
          </p>
          <ul>
            <li>Calling <code>reverse</code> twice should be a noop.</li>
            <li><a href="#dfn-player" class="internalDFN">Players</a> should be independent of their
                <a href="#dfn-source-content" class="internalDFN">source content</a>.</li>
          </ul>
          <p>
            Some suggestions:
          </p>
          <ul>
            <li>Call it <code>reverseSource</code> to make the link to the the
                <a href="#dfn-source-content" class="internalDFN">source content</a> obvious and remove any expectation that
                calling it twice is a noop.</li>
            <li>Make <a href="#dfn-player" class="internalDFN">players</a> actually stop when they reach
                the end of their <a href="#dfn-source-content" class="internalDFN">source content</a> much like a video/DVD/CD
                player.
                This would eliminate the need for the reverse seek and would
                make calling twice a noop.</li>
          </ul>
          <p>
            Your feedback is most welcome at <a href="mailto:public-fx@w3.org">public-fx@w3.org</a>, subject
            <em>[web-animations] &#x2026;</em>.
          </p>
        </div>
      </section>
      <section id="the-timeditem-interface">
        <h3><span class="secno">6.3 </span>The <code>TimedItem</code> interface</h3>
        <p>
          <a href="#dfn-timed-item" class="internalDFN">Timed items</a> are represented in the Web
          Animations <abbr title="Application Programming Interface">API</abbr> by the <a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-TimedItem">interface <span class="idlInterfaceID">TimedItem</span> : <span class="idlSuperclass"><a>EventTarget</a></span> {
<span class="idlSectionComment">    // Playback state</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>double</a>?</span>             <span class="idlAttrName"><a href="#widl-TimedItem-localTime">localTime</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned long</a>?</span>      <span class="idlAttrName"><a href="#widl-TimedItem-currentIteration">currentIteration</a></span>;</span>
<span class="idlSectionComment">
    // Specified timing</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-Timing" class="idlType"><code>Timing</code></a></span>              <span class="idlAttrName"><a href="#widl-TimedItem-specified">specified</a></span>;</span>
<span class="idlSectionComment">
    // Calculated timing</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>double</a></span>              <span class="idlAttrName"><a href="#widl-TimedItem-startTime">startTime</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unrestricted double</a></span> <span class="idlAttrName"><a href="#widl-TimedItem-iterationDuration">iterationDuration</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unrestricted double</a></span> <span class="idlAttrName"><a href="#widl-TimedItem-activeDuration">activeDuration</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unrestricted double</a></span> <span class="idlAttrName"><a href="#widl-TimedItem-endTime">endTime</a></span>;</span>
<span class="idlSectionComment">
    // Timing hierarchy</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-TimingGroup" class="idlType"><code>TimingGroup</code></a>?</span>        <span class="idlAttrName"><a href="#widl-TimedItem-parent">parent</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span>          <span class="idlAttrName"><a href="#widl-TimedItem-previousSibling">previousSibling</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span>          <span class="idlAttrName"><a href="#widl-TimedItem-nextSibling">nextSibling</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-TimedItem-before-void-TimedItem...-items">before</a></span> (<span class="idlParam"><span class="idlParamType"><a>TimedItem...</a></span> <span class="idlParamName">items</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-TimedItem-after-void-TimedItem...-items">after</a></span> (<span class="idlParam"><span class="idlParamType"><a>TimedItem...</a></span> <span class="idlParamName">items</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-TimedItem-replace-void-TimedItem...-items">replace</a></span> (<span class="idlParam"><span class="idlParamType"><a>TimedItem...</a></span> <span class="idlParamName">items</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-TimedItem-remove-void">remove</a></span> ();</span>
<span class="idlSectionComment">
    // Associated player</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-Player" class="idlType"><code>Player</code></a>?</span>             <span class="idlAttrName"><a href="#widl-TimedItem-player">player</a></span>;</span>
<span class="idlSectionComment">
    // Event callbacks</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>EventHandler</a></span>        <span class="idlAttrName"><a href="#widl-TimedItem-onstart">onstart</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>EventHandler</a></span>        <span class="idlAttrName"><a href="#widl-TimedItem-oniteration">oniteration</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>EventHandler</a></span>        <span class="idlAttrName"><a href="#widl-TimedItem-onend">onend</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>EventHandler</a></span>        <span class="idlAttrName"><a href="#widl-TimedItem-oncancel">oncancel</a></span>;</span>
};</span>
</pre><section id="attributes-2"><h4><span class="secno">6.3.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-TimedItem-localTime"><code>localTime</code> of type <span class="idlAttrType"><a>double</a></span>, readonly, nullable</dt><dd>
            <p>
              The <a href="#dfn-local-time" class="internalDFN">local time</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
            </p>
            <p>
              <code>localTime</code> will be <code>null</code> if this <a href="#dfn-timed-item" class="internalDFN">timed
              item</a> is not directly or indirectly associated with
              a <a href="#dfn-player" class="internalDFN">player</a> or if it has a parent <a href="#dfn-timing-group" class="internalDFN">timing group</a> that is
              not <a href="#dfn-in-effect" class="internalDFN">in effect</a>.
            </p>
          </dd><dt id="widl-TimedItem-currentIteration"><code>currentIteration</code> of type <span class="idlAttrType"><a>unsigned long</a></span>, readonly, nullable</dt><dd>
            The <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> index beginning with zero for the first
            iteration.
          </dd><dt id="widl-TimedItem-specified"><code>specified</code> of type <span class="idlAttrType"><a href="#idl-def-Timing" class="idlType"><code>Timing</code></a></span>, readonly</dt><dd>
            <p>
              Returns the input timing properties for this <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
            </p>
            <div class="feedbackWanted">
              <p>
                Representing these parameters has been a particularly
                contentious topic.
              </p>
              <p>
                The current arrangement:
              </p>
              <ul>
                <li>requires defining both a <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> interface and
                    a <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a> dictionary type which increases the <abbr title="Application Programming Interface">API</abbr>
                    surface area somewhat
                </li><li>means that setting the value occurs at a different place
                    (<code>anim.specified.iterationDuration</code>) to reading
                    the value (typically, <code>anim.iterationDuration</code>)
                </li><li>opens up questions about whether <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> objects
                    should be share-able or not
                </li><li>uses a union of a string and a double to represent
                    a duration which opens up questions about whether strings
                    such as <code>"3s"</code> should be allowed (and allowing
                    them makes walking the tree more complex).
                    It is also not permitted by WebIDL.
              </li></ul>
              <p>
                However, it separates "specified" timing from "computed" timing
                which some consider advantageous.
              </p>
              <p>
                The only situation where calculated values and input values
                differ is for <code>iterationDuration</code> and
                <code>activeDuration</code>.
              </p>
              <p>
                One alternative that has been proposed is to introduce
                a <code>Duration</code> interface as follows:
              </p>
              <pre class="example webidl">interface TimedItem : EventTarget {
   // Timing
   attribute double   startDelay;
   attribute FillMode fillMode;
   attribute Duration iterationDuration;
   attribute Duration activeDuration;
   attribute double   playbackRate;
   // ...
   
   // Scheduled time
   readonly attribute double              startTime;
   readonly attribute unrestricted double endTime;
};

interface Duration {
  double    sec;
  DOMString string;
}</pre>
              <p>
                Usage is as follows:
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> specifiedDur  <span class="sh_symbol">=</span> anim<span class="sh_symbol">.</span>iterationDuration<span class="sh_symbol">.</span>string<span class="sh_symbol">;</span> <span class="sh_comment">// "auto"</span>
<span class="sh_keyword">var</span> calculatedDur <span class="sh_symbol">=</span> anim<span class="sh_symbol">.</span>iterationDuration<span class="sh_symbol">.</span>sec<span class="sh_symbol">;</span> <span class="sh_comment">// 5</span>

<span class="sh_comment">// Update duration to 3s</span>
anim<span class="sh_symbol">.</span>iterationDuration<span class="sh_symbol">.</span>sec <span class="sh_symbol">=</span> <span class="sh_number">3</span><span class="sh_symbol">;</span>
<span class="sh_comment">// anim.iterationDuration.string -&gt; "3s"</span>

<span class="sh_comment">// Update duration to 3s (alt.)</span>
anim<span class="sh_symbol">.</span>iterationDuration<span class="sh_symbol">.</span>string <span class="sh_symbol">=</span> <span class="sh_string">"3s"</span><span class="sh_symbol">;</span>
<span class="sh_comment">// anim.iterationDuration.sec -&gt; 3</span>

<span class="sh_comment">// Reset to auto</span>
anim<span class="sh_symbol">.</span>iterationDuration<span class="sh_symbol">.</span>string <span class="sh_symbol">=</span> <span class="sh_string">"auto"</span><span class="sh_symbol">;</span>  
<span class="sh_comment">// anim.iterationDuration.sec -&gt; 5</span></pre>
              <p>
                Your feedback is most welcome at <a href="mailto:public-fx@w3.org">public-fx@w3.org</a>, subject
                <em>[web-animations] &#x2026;</em>.
              </p>
            </div>
          </dd><dt id="widl-TimedItem-startTime"><code>startTime</code> of type <span class="idlAttrType"><a>double</a></span>, readonly</dt><dd>
            <p>
              The <a>start time</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a> in seconds.
              This is the time at which the parent <a href="#dfn-timing-group" class="internalDFN">timing group</a>, if any,
              has scheduled this child to run within its <a title="transformed
              time" href="#dfn-transformed-time" class="internalDFN">transformed time space</a>, that is, the <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s
              <a title="inherited time" href="#dfn-inherited-time" class="internalDFN">inherited time space</a>.
            </p>
            <p>
              The start of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> is based on the sum of
              the <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> and
              <a href="#dfn-start-delay" class="internalDFN">start delay</a>.
            </p>
          </dd><dt id="widl-TimedItem-iterationDuration"><code>iterationDuration</code> of type <span class="idlAttrType"><a>unrestricted double</a></span>, readonly</dt><dd>
            <p>
              The <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
            </p>
            <p>
              Unlike the <code>iterationDuration</code> attribute of
              the <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> interface or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a> dictionary,
              this attribute returns the calculated value of the <a href="#dfn-iteration-duration" class="internalDFN">iteration
              duration</a>.
              If <code>specified.iterationDuration</code> is the
              string <code>auto</code> or any unsupported value, this attribute
              will return the current calculated value of the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic
              iteration duration</a>.
            </p>
            <p>
              This value may be changed by setting the
              <code>iterationDuration</code> attribute of the
              <code>specified</code> member of this interface.
            </p>
          </dd><dt id="widl-TimedItem-activeDuration"><code>activeDuration</code> of type <span class="idlAttrType"><a>unrestricted double</a></span>, readonly</dt><dd>
            <p>
              The <a href="#dfn-active-duration" class="internalDFN">active duration</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
            </p>
            <p>
              As with <code>iterationDuration</code>, this attribute returns the
              calculated value of the <a href="#dfn-active-duration" class="internalDFN">active duration</a>.
              If <code>specified.activeDuration</code> is the
              string <code>auto</code> or any unsupported value,
              this is the result of evaluating the <a href="#dfn-active-duration" class="internalDFN">active duration</a> using
              the procedure defined in <a href="#calculating-the-active-duration" class="sectionRef">section 3.10.2 Calculating the active duration</a>.
              Otherwise, it is the value specified for
              <code>specified.activeDuration</code>.
            </p>
            <p>
              This value may be changed by setting the
              <code>activeDuration</code> attribute of the
              <code>specified</code> member of this interface.
            </p>
          </dd><dt id="widl-TimedItem-endTime"><code>endTime</code> of type <span class="idlAttrType"><a>unrestricted double</a></span>, readonly</dt><dd>
            <p>
              The upper bound of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> expressed in
              seconds in <a title="inherited time" href="#dfn-inherited-time" class="internalDFN">inherited time space</a>.
            </p>
            <p>
              <code>endTime</code> is calculated as
              <code><a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a> + <a href="#dfn-start-delay" class="internalDFN">start
                    delay</a> + activeDuration</code>
            </p>
            <div class="note">
              <p>
                Note that while the <code>endTime</code> is read-only, it can be
                set indirectly as follows:
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_comment">// Set endTime to 't'</span>
<span class="sh_keyword">var</span> t <span class="sh_symbol">=</span> <span class="sh_number">6</span><span class="sh_symbol">;</span>
timing<span class="sh_symbol">.</span>specified<span class="sh_symbol">.</span>activeDuration <span class="sh_symbol">=</span>
  t <span class="sh_symbol">-</span> anim<span class="sh_symbol">.</span>startTime <span class="sh_symbol">-</span> anim<span class="sh_symbol">.</span>specified<span class="sh_symbol">.</span>startDelay<span class="sh_symbol">;</span></pre>
            </div>
          </dd><dt id="widl-TimedItem-parent"><code>parent</code> of type <span class="idlAttrType"><a href="#idl-def-TimingGroup" class="idlType"><code>TimingGroup</code></a></span>, readonly, nullable</dt><dd>
            <p>
              The <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a> or
              <code>null</code> if this <a href="#dfn-timed-item" class="internalDFN">timed item</a> does not have
              a <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>.
            </p>
            <div class="issue">
              Should this be <code>parentGroup</code>?
            </div>
          </dd><dt id="widl-TimedItem-previousSibling"><code>previousSibling</code> of type <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a></span>, readonly, nullable</dt><dd>
            The <a href="#dfn-previous-sibling" class="internalDFN">previous sibling</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
          </dd><dt id="widl-TimedItem-nextSibling"><code>nextSibling</code> of type <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a></span>, readonly, nullable</dt><dd>
            The <a href="#dfn-next-sibling" class="internalDFN">next sibling</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
          </dd><dt id="widl-TimedItem-player"><code>player</code> of type <span class="idlAttrType"><a href="#idl-def-Player" class="idlType"><code>Player</code></a></span>, readonly, nullable</dt><dd>
            <p>
              The <a href="#dfn-player" class="internalDFN">player</a> associated with this <a href="#dfn-timed-item" class="internalDFN">timed
              item</a>&#x2014;either <a title="directly associated with a player" href="#dfn-directly-associated-with-a-player" class="internalDFN">directly</a> or
              <a title="indirectly associated with a player" href="#dfn-indirectly-associated-with-a-player" class="internalDFN">indirectly</a>.
              This object can be used to perform play control such as pausing or
              rewinding on this <a href="#dfn-timed-item" class="internalDFN">timed item</a> <em>and all other timed items
              in the same hierarchy</em>.
            </p>
            <p>
              This will be <code>null</code> if this <a href="#dfn-timed-item" class="internalDFN">timed
              item</a> is not associated with a <a href="#dfn-player" class="internalDFN">player</a>.
            </p>
          </dd><dt id="widl-TimedItem-onstart"><code>onstart</code> of type <span class="idlAttrType"><a>EventHandler</a></span></dt><dd>
            The event handler for the <a href="#dfn-timingstart" class="internalDFN">timingstart</a> event.
          </dd><dt id="widl-TimedItem-oniteration"><code>oniteration</code> of type <span class="idlAttrType"><a>EventHandler</a></span></dt><dd>
            The event handler for the <a href="#dfn-timingiteration" class="internalDFN">timingiteration</a> event.
          </dd><dt id="widl-TimedItem-onend"><code>onend</code> of type <span class="idlAttrType"><a>EventHandler</a></span></dt><dd>
            The event handler for the <a href="#dfn-timingend" class="internalDFN">timingend</a> event.
          </dd><dt id="widl-TimedItem-oncancel"><code>oncancel</code> of type <span class="idlAttrType"><a>EventHandler</a></span></dt><dd>
            The event handler for the <a href="#dfn-timingcancel" class="internalDFN">timingcancel</a> event.
          </dd></dl></section><section id="methods-1"><h4><span class="secno">6.3.2 </span>Methods</h4><dl class="methods"><dt id="widl-TimedItem-before-void-TimedItem...-items"><code>before</code></dt><dd>
            <p>
              Inserts <var>items</var> before this <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
            </p>
            <ol>
              <li>If there is no <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>, terminate these
                  steps.
              </li><li>If any of the <a href="#dfn-timed-item" class="internalDFN">timed items</a> in <var>items</var> is an
                  <a href="#dfn-inclusive-ancestor" class="internalDFN">inclusive ancestor</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a>
                  throw a <code>HierarchyRequestError</code> exception and
                  terminate these steps. 
              </li><li><a title="insert children" href="#dfn-insert-children" class="internalDFN">Insert</a> <var>items</var> before
                  this <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
            </li></ol>
            <div class="note">
              <p>
                Note that this definition precludes the following usage since
                <code>item</code> is an <a href="#dfn-inclusive-ancestor" class="internalDFN">inclusive ancestor</a> of itself:
              </p>
              <pre class="example sh_javascript sh_sourceCode">item<span class="sh_symbol">.</span><span class="sh_function">before</span><span class="sh_symbol">(</span>item<span class="sh_symbol">);</span> <span class="sh_comment">// throws HierarchyRequestError</span></pre>
            </div>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">items</td><td class="prmType"><code><a>TimedItem...</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-TimedItem-after-void-TimedItem...-items"><code>after</code></dt><dd>
            <p>
              Inserts <var>items</var> after this <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
            </p>
            <ol>
              <li>If there is no <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>, terminate these
                  steps.
              </li><li>If any of the <a href="#dfn-timed-item" class="internalDFN">timed items</a> in <var>items</var> is an
                  <a href="#dfn-inclusive-ancestor" class="internalDFN">inclusive ancestor</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a>
                  throw a <code>HierarchyRequestError</code> exception and
                  terminate these steps. 
              </li><li>Let <var>reference child</var> be the <a title="next sibling not included" href="#dfn-next-sibling-not-included" class="internalDFN">next sibling of
                  this timed item not in <var>items</var></a>.
              </li><li><a title="insert children" href="#dfn-insert-children" class="internalDFN">Insert</a> <var>items</var> before
                  <var>reference child</var>.
            </li></ol>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">items</td><td class="prmType"><code><a>TimedItem...</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-TimedItem-replace-void-TimedItem...-items"><code>replace</code></dt><dd>
            <p>
              Replaces this <a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a> with the passed in
              <var>items</var>.
            </p>
            <ol>
              <li>If there is no <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>, terminate these
                  steps.
              </li><li>If any of the <a href="#dfn-timed-item" class="internalDFN">timed items</a> in <var>items</var> is an
                  <a href="#dfn-inclusive-ancestor" class="internalDFN">inclusive ancestor</a> of the <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>
                  throw a <code>HierarchyRequestError</code> exception and
                  terminate these steps. 
              </li><li>Let <var>reference child</var> be the <a title="next sibling not included" href="#dfn-next-sibling-not-included" class="internalDFN">next sibling of
                  this timed item not in <var>items</var></a>.
              </li><li><a title="remove a timed item" href="#dfn-remove-a-timed-item" class="internalDFN">Remove</a> this <a href="#dfn-timed-item" class="internalDFN">timed
                  item</a> from its <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>.
              </li><li><a title="insert children" href="#dfn-insert-children" class="internalDFN">Insert</a> <var>items</var> before
                  <var>reference child</var>.
            </li></ol>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">items</td><td class="prmType"><code><a>TimedItem...</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-TimedItem-remove-void"><code>remove</code></dt><dd>
            <a title="remove a timed item" href="#dfn-remove-a-timed-item" class="internalDFN">Removes</a> this <a href="#dfn-timed-item" class="internalDFN">timed
            item</a> from its <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>.
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></section>
        <p class="note">
          Note that the <a href="http://www.w3.org/TR/html5/webappapis.html#eventhandler">EventHandler</a>
          callback interface type is defined in [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
        </p>
      </section>
      <section id="the-timing-interface">
        <h3><span class="secno">6.4 </span>The <code>Timing</code> interface</h3>
        <p>
          Timing parameters for a <a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a> are collected together under
          the <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> type.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-Timing">interface <span class="idlInterfaceID">Timing</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-Timing-startDelay">startDelay</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a></span>                           <span class="idlAttrName"><a href="#widl-Timing-fillMode">fillMode</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-Timing-iterationStart">iterationStart</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>unrestricted double</a></span>                <span class="idlAttrName"><a href="#widl-Timing-iterationCount">iterationCount</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType">(<a>unrestricted double</a> or <a>DOMString</a>)</span> <span class="idlAttrName"><a href="#widl-Timing-iterationDuration">iterationDuration</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType">(<a>unrestricted double</a> or <a>DOMString</a>)</span> <span class="idlAttrName"><a href="#widl-Timing-activeDuration">activeDuration</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-Timing-playbackRate">playbackRate</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a></span>                  <span class="idlAttrName"><a href="#widl-Timing-direction">direction</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span>                          <span class="idlAttrName"><a href="#widl-Timing-timingFunction">timingFunction</a></span>;</span>
};</span>
</pre><section id="attributes-3"><h4><span class="secno">6.4.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-Timing-startDelay"><code>startDelay</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            <p>
              The <a href="#dfn-start-delay" class="internalDFN">start delay</a> which represents the number of seconds from
              a <a href="#dfn-timed-item" class="internalDFN">timed item</a>'s <a title="start time">start time</a> to the
              start of the <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
            </p>
          </dd><dt id="widl-Timing-fillMode"><code>fillMode</code> of type <span class="idlAttrType"><a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a></span></dt><dd>
            <p>
              The <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> as specified by one of the <a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a>
              enumeration values.
            </p>
          </dd><dt id="widl-Timing-iterationStart"><code>iterationStart</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            <p>
              The <a href="#dfn-timed-item" class="internalDFN">timed item</a><a>'s </a><a href="#dfn-iteration-start" class="internalDFN">iteration start</a> property.
            </p>
            <p>
              A finite real number greater than or equal to zero representing
              the number of iterations into the timed item at which to begin.
              For example, a value of 0.5 would cause the timed item to begin
              half-way through the first iteration.
            </p>
            <p>
              Values less than zero are clamped to zero for the purpose of
              timing model calculations.
            </p>
            <div class="note">
              <p>
                Note that the <code>iterationCount</code> is effectively
                <em>added</em> to the <code>iterationStart</code> such that
                a timed item with an <code>iterationStart</code> of
                &#x2018;0.5&#x2019; and <code>iterationCount</code> of
                &#x2018;2&#x2019; would still repeat twice however it would begin
                and end half-way through the timed item's <a href="#dfn-iteration-interval" class="internalDFN">iteration
                interval</a>.
              </p>
              <p>
                Setting the <code>iterationStart</code> to a value greater than
                or equal to one is typically only useful in combination with an
                animation effect that has an <code>accumulate</code> property of
                &#x2018;accumulate&#x2019;.
              </p>
            </div>
          </dd><dt id="widl-Timing-iterationCount"><code>iterationCount</code> of type <span class="idlAttrType"><a>unrestricted double</a></span></dt><dd>
            <p>
              The <a href="#dfn-timed-item" class="internalDFN">timed item</a><a>'s </a><a href="#dfn-iteration-count" class="internalDFN">iteration count</a> property.
            </p>
            <p>
              A real number greater than or equal to zero (including positive
              infinity) representing the number of times to repeat the
              timed item.
            </p>
            <p>
              Values less than zero are treated as the value 1.0 for the purpose
              of timing model calculations.
            </p>
          </dd><dt id="widl-Timing-iterationDuration"><code>iterationDuration</code> of type <span class="idlAttrType">(<a>unrestricted double</a> or <a>DOMString</a>)</span></dt><dd>
            <p>
              The <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> which is a real number greater than
              or equal to zero (including positive infinity) representing the
              time taken to complete a single iteration of the <a href="#dfn-timed-item" class="internalDFN">timed
              item</a>.
            </p>
            <p>
              The string value <code>auto</code> is used to indicate that the
              <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> reflects the timed item's <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic
              iteration duration</a>.
            </p>
            <p>
              Real numbers less than zero and strings other than the value
              lowercase value <code>auto</code> are treated the same as
              <code>auto</code> for the purpose of timing model calculations.
            </p>
          </dd><dt id="widl-Timing-activeDuration"><code>activeDuration</code> of type <span class="idlAttrType">(<a>unrestricted double</a> or <a>DOMString</a>)</span></dt><dd>
            <p>
              The <a href="#dfn-active-duration" class="internalDFN">active duration</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a>, that is, the
              length of its <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
            </p>
            <p>
              The string value <code>auto</code> is used to indicate that the
              <a href="#dfn-active-duration" class="internalDFN">active duration</a> is calculated using the procedure defined
              in <a href="#calculating-the-active-duration" class="sectionRef">section 3.10.2 Calculating the active duration</a>.
              Otherwise, if a real number greater than or equal to zero
              (including positive infinity) is specified, that procedure is
              ignored and the value provided here is used for all timing model
              calculations that refer to the active duration.
            </p>
            <p>
              Real numbers less than zero and strings other than the value
              lowercase value <code>auto</code> are treated the same as
              <code>auto</code> for the purpose of timing model calculations.
            </p>
            <div class="issue">
              <p>Should we allow strings such as <code>"3s"</code> here?
              i.e. a CSS <a href="http://www.w3.org/TR/css3-values/#time">&lt;time&gt;</a>.
              It might be useful for readability but introduces complexity when
              handling this member (need to test the type, then possibly parse
              the string).
              It also introduces the issue of whether we should parse a full
              <a href="http://www.w3.org/TR/SVG11/animate.html#ClockValueSyntax">clock
              value</a>.
            </p></div>
          </dd><dt id="widl-Timing-playbackRate"><code>playbackRate</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            <p>
              The <a href="#dfn-timed-item" class="internalDFN">timed item</a><a>'s </a><a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a> property.
            </p>
            <p>
              This is a multiplier applied to the <a href="#dfn-local-time" class="internalDFN">local time</a> potentially
              causing the item to run at a different rate to its natural speed.
            </p>
          </dd><dt id="widl-Timing-direction"><code>direction</code> of type <span class="idlAttrType"><a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a></span></dt><dd>
            <p>
              The <a href="#dfn-playback-direction" class="internalDFN">playback direction</a> of the <a href="#dfn-timed-item" class="internalDFN">timed item</a> as
              specified by one of the <a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a> enumeration
              values.
            </p>
          </dd><dt id="widl-Timing-timingFunction"><code>timingFunction</code> of type <span class="idlAttrType"><a>DOMString</a></span></dt><dd>
            <p>
              The <a href="#dfn-timing-function" class="internalDFN">timing function</a> used to scale the time to
              produce easing effects.
            </p>
            <p>
              The acceptable values and their meanings are those defined for the
              <a href="http://www.w3.org/TR/css3-transitions/#transition-timing-function-property">transition-timing-function</a>
              property in CSS Transitions [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>].
            </p>
            <p>
              In addition to the values defined in CSS Transitions, this method
              extends the <code>steps()</code> function notation to allow
              &#x2018;middle&#x2019; as a transition point keyword (e.g.
              <code>steps(3, middle)</code>).
              Similarly, the keyword &#x2018;steps-middle&#x2019; is recognized
              and given the meaning <code>steps(1, middle)</code>.
            </p>
            <p>
              Strings that specify a <code>cubic-bezier()</code> timing function
              result produce a <a href="#dfn-cubic-b-zier-timing-function" class="internalDFN">cubic B&#xe9;zier timing function</a>.
              Strings that specify a <code>steps()</code> function produce a
              <a href="#dfn-step-timing-function" class="internalDFN">step timing function</a>. Strings that specify a<code>paced()</code>
              timing function result produce a <a href="#dfn-paced-timing-function" class="internalDFN">paced timing function</a>.
            </p>
            <p>
              Unrecognized string values are treated as if the
              <code>linear</code> keyword was specified for the purpose of
              timing model calculations.
            </p>
          </dd></dl></section>
      </section>
      <section id="the-timinginput-dictionary">
        <h3><span class="secno">6.5 </span>The <code>TimingInput</code> dictionary</h3>
        <p>
          The <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a> dictionary is used as a convenience for
          specifying the timing properties of a <a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a> in bulk.
        </p>
        <pre class="idl"><span class="idlDictionary" id="idl-def-TimingInput">dictionary <span class="idlDictionaryID">TimingInput</span> {
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-TimingInput-startDelay">startDelay</a></span> = <span class="idlMemberValue">0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a></span>                           <span class="idlMemberName"><a href="#widl-TimingInput-fillMode">fillMode</a></span> = <span class="idlMemberValue">"forwards"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-TimingInput-iterationStart">iterationStart</a></span> = <span class="idlMemberValue">0.0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>unrestricted double</a></span>                <span class="idlMemberName"><a href="#widl-TimingInput-iterationCount">iterationCount</a></span> = <span class="idlMemberValue">1.0</span>;</span>
<span class="idlMember">    <span class="idlMemberType">(<a>unrestricted double</a> or <a>DOMString</a>)</span> <span class="idlMemberName"><a href="#widl-TimingInput-iterationDuration">iterationDuration</a></span> = <span class="idlMemberValue">"auto"</span>;</span>
<span class="idlMember">    <span class="idlMemberType">(<a>unrestricted double</a> or <a>DOMString</a>)</span> <span class="idlMemberName"><a href="#widl-TimingInput-activeDuration">activeDuration</a></span> = <span class="idlMemberValue">"auto"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-TimingInput-playbackRate">playbackRate</a></span> = <span class="idlMemberValue">1.0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a></span>                  <span class="idlMemberName"><a href="#widl-TimingInput-direction">direction</a></span> = <span class="idlMemberValue">"normal"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span>                          <span class="idlMemberName"><a href="#widl-TimingInput-timingFunction">timingFunction</a></span> = <span class="idlMemberValue">"linear"</span>;</span>
};</span>
</pre><section id="dictionary-timinginput-members"><h4><span class="secno">6.5.1 </span>Dictionary <a class="idlType" href="#idl-def-TimingInput"><code>TimingInput</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-TimingInput-startDelay"><code>startDelay</code> of type <span class="idlMemberType"><a>double</a></span>, defaulting to <code>0</code></dt><dd>
            <p>
              The specified <a href="#dfn-start-delay" class="internalDFN">start delay</a>.
            </p>
            <p>
              See the description of the <code>startDelay</code> attribute on
              the <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> interface.
            </p>
          </dd><dt id="widl-TimingInput-fillMode"><code>fillMode</code> of type <span class="idlMemberType"><a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a></span>, defaulting to <code>"forwards"</code></dt><dd>
            <p>
              The <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> as specified by one of the <a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a>
              enumeration values.
            </p>
            <p class="note">
              Note that in both CSS Animations [<cite><a class="bibref" href="#bib-CSS3-ANIMATIONS">CSS3-ANIMATIONS</a></cite>] and SVG
              [<cite><a class="bibref" href="#bib-SVG11">SVG11</a></cite>] the default fill mode is "none".
              Web Animations differs in this regard since it was determined
              that when generating animations from script, forwards filling is
              the more commonly-desired behavior.
            </p>
            <p class="issue">
              Some feedback suggests the default here should be "both".
            </p>
          </dd><dt id="widl-TimingInput-iterationStart"><code>iterationStart</code> of type <span class="idlMemberType"><a>double</a></span>, defaulting to <code>0.0</code></dt><dd>
            <p>
              The <a href="#dfn-timed-item" class="internalDFN">timed item</a><a>'s </a><a href="#dfn-iteration-start" class="internalDFN">iteration start</a> property.
            </p>
            <p>
              See the description of the <code>iterationStart</code> attribute
              on the <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> interface.
            </p>
          </dd><dt id="widl-TimingInput-iterationCount"><code>iterationCount</code> of type <span class="idlMemberType"><a>unrestricted double</a></span>, defaulting to <code>1.0</code></dt><dd>
            <p>
              The <a href="#dfn-timed-item" class="internalDFN">timed item</a><a>'s </a><a href="#dfn-iteration-count" class="internalDFN">iteration count</a> property.
            </p>
            <p>
              See the description of the <code>iterationCount</code> attribute
              on the <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> interface.
            </p>
          </dd><dt id="widl-TimingInput-iterationDuration"><code>iterationDuration</code> of type <span class="idlMemberType">(<a>unrestricted double</a> or <a>DOMString</a>)</span>, defaulting to <code>"auto"</code></dt><dd>
            <p>
              The <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of the <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
            </p>
            <p>
              See the description of the <code>iterationDuration</code>
              attribute on the <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> interface.
            </p>
          </dd><dt id="widl-TimingInput-activeDuration"><code>activeDuration</code> of type <span class="idlMemberType">(<a>unrestricted double</a> or <a>DOMString</a>)</span>, defaulting to <code>"auto"</code></dt><dd>
            <p>
              The <a href="#dfn-active-duration" class="internalDFN">active duration</a> of the <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
            </p>
            <p>
              See the description of the <code>activeDuration</code> attribute
              on the <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> interface.
            </p>
          </dd><dt id="widl-TimingInput-playbackRate"><code>playbackRate</code> of type <span class="idlMemberType"><a>double</a></span>, defaulting to <code>1.0</code></dt><dd>
            <p>
              The <a href="#dfn-timed-item" class="internalDFN">timed item</a><a>'s </a><a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a> property.
            </p>
            <p>
              See the description of the <code>playbackRate</code> attribute
              on the <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> interface.
            </p>
          </dd><dt id="widl-TimingInput-direction"><code>direction</code> of type <span class="idlMemberType"><a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a></span>, defaulting to <code>"normal"</code></dt><dd>
            <p>
              The <a href="#dfn-playback-direction" class="internalDFN">playback direction</a> of the <a href="#dfn-timed-item" class="internalDFN">timed item</a>.
            </p>
            <p>
              See the description of the <code>direction</code> attribute
              on the <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> interface.
            </p>
          </dd><dt id="widl-TimingInput-timingFunction"><code>timingFunction</code> of type <span class="idlMemberType"><a>DOMString</a></span>, defaulting to <code>"linear"</code></dt><dd>
            <p>
              The <a href="#dfn-timing-function" class="internalDFN">timing function</a> used to scale the time to produce
              easing effects.
            </p>
            <p>
              See the description of the <code>timingFunction</code> attribute
              on the <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> interface.
            </p>
          </dd></dl></section>
        <section id="the-fillmode-enumeration">
          <h4><span class="secno">6.5.2 </span>The <code>FillMode</code> enumeration</h4>
          <pre class="idl"><span class="idlEnum" id="idl-def-FillMode">enum <span class="idlEnumName">FillMode</span> {<span class="idlEnumValues"> "<a href="#widl-FillMode-none">none</a>", "<a href="#widl-FillMode-forwards">forwards</a>", "<a href="#widl-FillMode-backwards">backwards</a>", "<a href="#widl-FillMode-both">both</a>" </span>};</span>
</pre><section id="values"><h5><span class="secno">6.5.2.1 </span>Values</h5><dl class="values"><dt id="widl-FillMode-none"><code>none</code></dt><dd>
              No fill.
            </dd><dt id="widl-FillMode-forwards"><code>forwards</code></dt><dd>
              Fill forwards.
            </dd><dt id="widl-FillMode-backwards"><code>backwards</code></dt><dd>
              Fill backwards.
            </dd><dt id="widl-FillMode-both"><code>both</code></dt><dd>
              Fill backwards and forwards.
            </dd></dl></section>
        </section>
        <section id="the-playbackdirection-enumeration">
          <h4><span class="secno">6.5.3 </span>The <code>PlaybackDirection</code> enumeration</h4>
          <pre class="idl"><span class="idlEnum" id="idl-def-PlaybackDirection">enum <span class="idlEnumName">PlaybackDirection</span> {<span class="idlEnumValues"> "<a href="#widl-PlaybackDirection-normal">normal</a>", "<a href="#widl-PlaybackDirection-reverse">reverse</a>", "<a href="#widl-PlaybackDirection-alternate">alternate</a>", "<a href="#widl-PlaybackDirection-alternate-reverse">alternate-reverse</a>" </span>};</span>
</pre><section id="values-1"><h5><span class="secno">6.5.3.1 </span>Values</h5><dl class="values"><dt id="widl-PlaybackDirection-normal"><code>normal</code></dt><dd>
              All iterations are played as specified.
            </dd><dt id="widl-PlaybackDirection-reverse"><code>reverse</code></dt><dd>
              All iterations are played in the reverse direction from the way
              they are specified.
            </dd><dt id="widl-PlaybackDirection-alternate"><code>alternate</code></dt><dd>
              Even iterations are played as specified, odd iterations are played
              in the reverse direction from the way they are specified.
            </dd><dt id="widl-PlaybackDirection-alternate-reverse"><code>alternate-reverse</code></dt><dd>
              Even iterations are played in the reverse direction from the way
              they are specified, odd iterations are played as specified.
            </dd></dl></section>
        </section>
      </section>
      <section id="the-timinggroup-interface">
        <h3><span class="secno">6.6 </span>The <code>TimingGroup</code> interface</h3>
        <p>
          The different types of <a href="#dfn-timing-group" class="internalDFN">timing groups</a>
          defined by Web Animations share a common <a href="#idl-def-TimingGroup" class="idlType"><code>TimingGroup</code></a>
          interface as defined below.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-TimingGroup">interface <span class="idlInterfaceID">TimingGroup</span> : <span class="idlSuperclass"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-TimedItemList" class="idlType"><code>TimedItemList</code></a></span> <span class="idlAttrName"><a href="#widl-TimingGroup-children">children</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span>    <span class="idlAttrName"><a href="#widl-TimingGroup-firstChild">firstChild</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span>    <span class="idlAttrName"><a href="#widl-TimingGroup-lastChild">lastChild</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-TimingGroup-prepend-void-TimedItem...-items">prepend</a></span> (<span class="idlParam"><span class="idlParamType"><a>TimedItem...</a></span> <span class="idlParamName">items</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-TimingGroup-append-void-TimedItem...-items">append</a></span> (<span class="idlParam"><span class="idlParamType"><a>TimedItem...</a></span> <span class="idlParamName">items</span></span>);</span>
};</span>
</pre><section id="attributes-4"><h4><span class="secno">6.6.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-TimingGroup-children"><code>children</code> of type <span class="idlAttrType"><a href="#idl-def-TimedItemList" class="idlType"><code>TimedItemList</code></a></span>, readonly</dt><dd>
            The list of <a href="#dfn-child-timed-item" class="internalDFN">child timed items</a> in the group.
          </dd><dt id="widl-TimingGroup-firstChild"><code>firstChild</code> of type <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a></span>, readonly, nullable</dt><dd>
            The <a href="#dfn-first-child" class="internalDFN">first child</a> of this <a href="#dfn-timing-group" class="internalDFN">timing group</a>.
          </dd><dt id="widl-TimingGroup-lastChild"><code>lastChild</code> of type <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a></span>, readonly, nullable</dt><dd>
            The <a href="#dfn-last-child" class="internalDFN">last child</a> of this <a href="#dfn-timing-group" class="internalDFN">timing group</a>.
          </dd></dl></section><section id="methods-2"><h4><span class="secno">6.6.2 </span>Methods</h4><dl class="methods"><dt id="widl-TimingGroup-prepend-void-TimedItem...-items"><code>prepend</code></dt><dd>
            <ol>
              <li>If any of the <a href="#dfn-timed-item" class="internalDFN">timed items</a> in <var>items</var> is an
                  <a href="#dfn-inclusive-ancestor" class="internalDFN">inclusive ancestor</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a>
                  throw a <code>HierarchyRequestError</code> exception and
                  terminate these steps. 
              </li><li><a title="insert children" href="#dfn-insert-children" class="internalDFN">Insert</a> <var>items</var> before
                  the <a href="#dfn-first-child" class="internalDFN">first child</a>.
            </li></ol>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">items</td><td class="prmType"><code><a>TimedItem...</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-TimingGroup-append-void-TimedItem...-items"><code>append</code></dt><dd>
            <ol>
              <li>If any of the <a href="#dfn-timed-item" class="internalDFN">timed items</a> in <var>items</var> is an
                  <a href="#dfn-inclusive-ancestor" class="internalDFN">inclusive ancestor</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a>
                  throw a <code>HierarchyRequestError</code> exception and
                  terminate these steps. 
              </li><li><a title="insert children" href="#dfn-insert-children" class="internalDFN">Insert</a> <var>items</var> before
                  <code>null</code>.
            </li></ol>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">items</td><td class="prmType"><code><a>TimedItem...</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></section>
        <section id="common-definitions-for-manipulating-hierarchies">
          <h4><span class="secno">6.6.3 </span>Common definitions for manipulating hierarchies</h4>
          <p>The <dfn title="next sibling not included" id="dfn-next-sibling-not-included">next sibling of
             <var>item</var> not included</dfn> in a set of <a href="#dfn-timed-item" class="internalDFN">timed
             items</a>, <var>items</var> is determined using the following
             steps:</p>
          <ol>
            <li>Let <var>context item</var> be <var>item</var>.
            </li><li>While the <a href="#dfn-next-sibling" class="internalDFN">next sibling</a> of <var>context item</var> is not
                <code>null</code> perform the following steps:
              <ol>
                <li>Let <var>context item</var> be the <a href="#dfn-next-sibling" class="internalDFN">next sibling</a> of
                    <var>context item</var>.
                </li><li>If <var>context item</var> is not in <var>items</var> return
                    <var>context item</var> and terminate these steps.
              </li></ol>
            </li><li>Return <code>null</code>.
          </li></ol>
          <p>To <dfn title="remove a timed item" id="dfn-remove-a-timed-item">remove</dfn> an <var>item</var>
             from its <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a> or <a href="#dfn-player" class="internalDFN">player</a>, perform the
             steps corresponding to the first matching condition from below, if
             any:
          </p><dl class="switch">
            <dt>If <var>item</var> has a <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>,</dt>
            <dd>
              Remove <var>item</var> from the <a href="#dfn-parent-timing-group" class="internalDFN">parent timing group</a>'s list
              of <a href="#dfn-child-timed-item" class="internalDFN">child timed items</a>.
            </dd>
            <dt>If <var>item</var> is <a href="#dfn-directly-associated-with-a-player" class="internalDFN">directly associated with
                a player</a>,</dt>
            <dd>
              Disassociate <var>item</var> from the <a href="#dfn-player" class="internalDFN">player</a>.
            </dd>
          </dl>
          <p>To <dfn title="insert children" id="dfn-insert-children">insert</dfn> a series of zero or
             more <a href="#dfn-timed-item" class="internalDFN">timed items</a>, <var>items</var>, to <var>parent</var>'s
             list of <a href="#dfn-child-timed-item" class="internalDFN">child timed items</a> before <var>reference child</var>
             perform the following steps for each <var>item</var> in
             <var>items</var>:</p>
          <ol>
            <li><a title="remove a timed item" href="#dfn-remove-a-timed-item" class="internalDFN">Remove</a> <var>item</var>
                from its parent.
            </li><li>Insert <var>item</var> to <var>parent</var>'s list of <a href="#dfn-child-timed-item" class="internalDFN">child
                timed items</a> before <var>reference child</var>.
          </li></ol>
        </section>
      </section>
      <section id="the-timeditemlist-interface">
        <h3><span class="secno">6.7 </span>The <code>TimedItemList</code> interface</h3>
        <p>
          A list of <a href="#dfn-timed-item" class="internalDFN">timed items</a> may be represented by
          a <a href="#idl-def-TimedItemList" class="idlType"><code>TimedItemList</code></a>.
        </p>
        <p>
          The <code>TimedItemList</code> interface supports indexed
          properties with indices in the range 0 &#x2264; <var>index</var> &lt;
          <code>length</code>. 
        </p>
        
        <pre class="idl"><span class="idlInterface" id="idl-def-TimedItemList">interface <span class="idlInterfaceID">TimedItemList</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned long</a></span> <span class="idlAttrName"><a href="#widl-TimedItemList-length">length</a></span>;</span>
<span class="idlMethod">    getter <span class="idlMethType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span> <span class="idlMethName"><a href="#widl-TimedItemList-item-TimedItem-unsigned-long-index">item</a></span> (<span class="idlParam"><span class="idlParamType"><a>unsigned long</a></span> <span class="idlParamName">index</span></span>);</span>
};</span>
</pre><section id="attributes-5"><h4><span class="secno">6.7.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-TimedItemList-length"><code>length</code> of type <span class="idlAttrType"><a>unsigned long</a></span>, readonly</dt><dd>
            The number of <a href="#dfn-timed-item" class="internalDFN">timed items</a> in the list.
          </dd></dl></section><section id="methods-3"><h4><span class="secno">6.7.2 </span>Methods</h4><dl class="methods"><dt id="widl-TimedItemList-item-TimedItem-unsigned-long-index"><code>item</code> [<em>index</em>]</dt><dd>
            <p>
              Returns the <a href="#dfn-timed-item" class="internalDFN">timed item</a> at <code>index</code>.
              If <code>index</code> is greater than or equal to
              <code>length</code> returns <code>null</code>.
            </p>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">index</td><td class="prmType"><code><a>unsigned long</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a></code>, nullable</div></dd></dl></section>
      </section>
      <section id="the-pargroup-interface">
        <h3><span class="secno">6.8 </span>The <code>ParGroup</code> interface</h3>
        <p>
          <a href="#dfn-parallel-timing-group" class="internalDFN">Parallel timing groups</a> are
          represented by the <code>ParGroup</code> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-ParGroup">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-ParGroup--sequence-TimedItem--children--unrestricted-double-or-TimingInput--timing">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">sequence&lt;<a></a><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>&gt;?</span> <span class="idlParamName">children</span></span>, 
              <span class="idlParam">optional <span class="idlParamType">(<a>unrestricted double</a> or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>)?</span> <span class="idlParamName">timing</span> = <span class="idlParamValue">null</span></span>)</span>]
interface <span class="idlInterfaceID">ParGroup</span> : <span class="idlSuperclass"><a href="#idl-def-TimingGroup" class="idlType"><code>TimingGroup</code></a></span> {
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-ParGroup" class="idlType"><code>ParGroup</code></a></span> <span class="idlMethName"><a href="#widl-ParGroup-clone-ParGroup">clone</a></span> ();</span>
};</span>
</pre><section id="constructors"><h4><span class="secno">6.8.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-ParGroup--sequence-TimedItem--children--unrestricted-double-or-TimingInput--timing"><code>ParGroup</code></dt><dd>
            <p>
              Creates a new <a href="#idl-def-ParGroup" class="idlType"><code>ParGroup</code></a> object using the following
              procedure:
            </p>
            <ol>
              <li>Create a new <a href="#idl-def-ParGroup" class="idlType"><code>ParGroup</code></a> object, <var>group</var>.</li>
              <li>Set <var>timing input</var> as follows,
                <dl class="switch">
                  <dt>If <var>timing</var> is a <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a> object,</dt>
                  <dd>
                    Let <var>timing input</var> refer to <var>timing</var>.
                  </dd>
                  <dt>If <var>timing</var> is a <code>double</code>,</dt>
                  <dd>
                    Let <var>timing input</var> be a new
                    <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a> object with all members set to their
                    default values and <code>iterationDuration</code> set to
                    <var>timing</var>.
                  </dd>
                  <dt>Otherwise (<var>timing</var> is <code>null</code> or
                      undefined),</dt>
                  <dd>
                    Let <var>timing input</var> be a new <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>
                    object with all members set to their default values.
                  </dd>
                </dl>
              </li>
              <li>
                Set <code><var>group</var>.specified</code> to a new
                <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> object whose attributes are assigned the
                value of the member of the same name on <var>timing input</var>.
                <p class="todo">
                  The above two steps are identical with the constructor for <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> and should be
                  factored out somewhere.
                </p>
              </li>
              <li>
                Add <var>children</var> to the group by calling
                <code><var>group</var>.splice(0, 0,
                <var>children</var>)</code>.
              </li>
            </ol>
            <div class="note">
              <p>
                Note that since <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> objects have the same member
                names as <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a> dictionaries, it is also possible to
                pass the <code>specified</code> member of another
                <a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a> as the <var>timing</var> parameter.
              </p>
              <p>
                Doing so will cause the <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> object to be treated as
                a <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a> dictionary and thus it will effectively be
                cloned, not shared.
              </p>
            </div>
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">children</td><td class="prmType"><code>sequence&lt;<a></a><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>&gt;</code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                <p>
                  A sequence of timed items to add as children of this group.
                </p>
                <p>
                  These children are appended in sequence using the same
                  semantics as the <code><a href="#idl-def-TimingGroup" class="idlType"><code>TimingGroup</code></a>.append</code>
                  method.
                </p>
              </td></tr><tr><td class="prmName">timing</td><td class="prmType"><code>(<a>unrestricted double</a> or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>)</code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span> (<code>null</code>)</td><td class="prmDesc">
                <p>
                  The timing properties or <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of the new
                  timing group.
                </p>
              </td></tr></table></dd></dl></section><section id="methods-4"><h4><span class="secno">6.8.2 </span>Methods</h4><dl class="methods"><dt id="widl-ParGroup-clone-ParGroup"><code>clone</code></dt><dd>
            <p>
              Creates a deep copy of this <a href="#idl-def-ParGroup" class="idlType"><code>ParGroup</code></a> object using the
              following procedure.
            </p>
            <ol>
              <li>Let <var>source</var> be this <a href="#idl-def-ParGroup" class="idlType"><code>ParGroup</code></a> object, the
                  object to be cloned.</li>
              <li>Let <var>cloned timing</var> be a new <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>
                  object whose members are assigned the value of the attribute
                  with the same name on
                  <code><var>source</var>.specified</code>.</li>
              <li>Let <var>cloned children</var> be an empty sequence of
                  <a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a> objects.</li>
              <li>For each <var>child</var> in
                  <code><var>source</var>.children</code>, append the result
                  of calling <code><var>child</var>.clone()</code>
                  to <var>cloned children</var>.
              </li><li>Return a new <a href="#idl-def-ParGroup" class="idlType"><code>ParGroup</code></a> object created by
                  calling the <a href="#idl-def-ParGroup" class="idlType"><code>ParGroup</code></a> constructor with parameters
                  <code>ParGroup(<var>cloned children</var>,
                  <var>cloned timing</var>)</code>.</li>
            </ol>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a href="#idl-def-ParGroup" class="idlType"><code>ParGroup</code></a></code></div></dd></dl></section>
      </section>
      <section id="the-seqgroup-interface">
        <h3><span class="secno">6.9 </span>The <code>SeqGroup</code> interface</h3>
        <p>
          <a href="#dfn-sequence-timing-group" class="internalDFN">Sequence timing groups</a> are
          represented by the <code>SeqGroup</code> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-SeqGroup">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-SeqGroup--sequence-TimedItem--children--unrestricted-double-or-TimingInput--timing">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">sequence&lt;<a></a><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>&gt;?</span> <span class="idlParamName">children</span></span>, 
              <span class="idlParam">optional <span class="idlParamType">(<a>unrestricted double</a> or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>)?</span> <span class="idlParamName">timing</span> = <span class="idlParamValue">null</span></span>)</span>]
interface <span class="idlInterfaceID">SeqGroup</span> : <span class="idlSuperclass"><a href="#idl-def-TimingGroup" class="idlType"><code>TimingGroup</code></a></span> {
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-SeqGroup" class="idlType"><code>SeqGroup</code></a></span> <span class="idlMethName"><a href="#widl-SeqGroup-clone-SeqGroup">clone</a></span> ();</span>
};</span>
</pre><section id="constructors-1"><h4><span class="secno">6.9.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-SeqGroup--sequence-TimedItem--children--unrestricted-double-or-TimingInput--timing"><code>SeqGroup</code></dt><dd>
            The meaning and handling of each of the parameters in this
            constructor is identical to the constructor for
            <a href="#idl-def-ParGroup" class="idlType"><code>ParGroup</code></a>.
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">children</td><td class="prmType"><code>sequence&lt;<a></a><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>&gt;</code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr><tr><td class="prmName">timing</td><td class="prmType"><code>(<a>unrestricted double</a> or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>)</code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span> (<code>null</code>)</td><td class="prmDesc"></td></tr></table></dd></dl></section><section id="methods-5"><h4><span class="secno">6.9.2 </span>Methods</h4><dl class="methods"><dt id="widl-SeqGroup-clone-SeqGroup"><code>clone</code></dt><dd>
            <p>
              Creates a deep copy of this <a href="#idl-def-SeqGroup" class="idlType"><code>SeqGroup</code></a> object using the same
              procedure as defined for <a href="#widl-ParGroup-clone-ParGroup">ParGroup.clone</a> except
              that a new <a href="#idl-def-SeqGroup" class="idlType"><code>SeqGroup</code></a> object is created instead of
              a <a href="#idl-def-ParGroup" class="idlType"><code>ParGroup</code></a>.
            </p>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a href="#idl-def-SeqGroup" class="idlType"><code>SeqGroup</code></a></code></div></dd></dl></section>
      </section>
      <section id="the-animation-interface">
        <h3><span class="secno">6.10 </span>The <code>Animation</code> interface</h3>
        <p>
          <a href="#dfn-animation" class="internalDFN">Animations</a> are represented by the
          <code>Animation</code> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-Animation">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-Animation--AnimationTarget-element--AnimationEffect-or-CustomEffect-or-OneOrMoreKeyframes--effect--unrestricted-double-or-TimingInput--timing">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-AnimationTarget" class="idlType"><code>AnimationTarget</code></a>?</span> <span class="idlParamName">element</span></span>, 
              <span class="idlParam"><span class="idlParamType">(<a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> or <a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a>)?</span> <span class="idlParamName">effect</span></span>, 
              <span class="idlParam">optional <span class="idlParamType">(<a>unrestricted double</a> or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>)?</span> <span class="idlParamName">timing</span> = <span class="idlParamValue">null</span></span>)</span>]
interface <span class="idlInterfaceID">Animation</span> : <span class="idlSuperclass"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a></span> {
<span class="idlAttribute">             attribute <span class="idlAttrType">(<a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a>)?</span> <span class="idlAttrName"><a href="#widl-Animation-effect">effect</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationTarget" class="idlType"><code>AnimationTarget</code></a>?</span>                   <span class="idlAttrName"><a href="#widl-Animation-target">target</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a></span> <span class="idlMethName"><a href="#widl-Animation-clone-Animation">clone</a></span> ();</span>
};</span>
</pre><section id="constructors-2"><h4><span class="secno">6.10.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-Animation--AnimationTarget-element--AnimationEffect-or-CustomEffect-or-OneOrMoreKeyframes--effect--unrestricted-double-or-TimingInput--timing"><code>Animation</code></dt><dd>
            <p>
              Creates a new <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object
              using the following procedure:
            </p>
            <ol>
              <li>Create a new <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a>
                  object, <var>animation</var>.</li>
              <li>Set <var>timing input</var> as follows,
                <dl class="switch">
                  <dt>If <var>timing</var> is a <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a> object,</dt>
                  <dd>
                    Let <var>timing input</var> refer to <var>timing</var>.
                  </dd>
                  <dt>If <var>timing</var> is a <code>double</code>,</dt>
                  <dd>
                    Let <var>timing input</var> be a new
                    <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a> object with all members set to their
                    default values and <code>iterationDuration</code> set to
                    <var>timing</var>.
                  </dd>
                  <dt>Otherwise (<var>timing</var> is <code>null</code> or
                      undefined),</dt>
                  <dd>
                    Let <var>timing input</var> be a new <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>
                    object with all members set to their default values.
                  </dd>
                </dl>
              </li>
              <li>
                Set <code><var>animation</var>.specified</code> to a new
                <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> object whose attributes are assigned the
                value of the member of the same name on <var>timing input</var>.
              </li>
              <li>Assign the animation effect based on the type of
                <var>effect</var> as follows,
                <dl class="switch">
                  <dt>If <var>effect</var> is an <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a>
                      object or a <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> object,</dt>
                  <dd>
                    Assign <code><var>animation</var>.effect</code> to
                    <var>effect</var>.
                  </dd>
                  <dt>If <var>effect</var> is a <a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a>,</dt>
                  <dd>
                    Set <code><var>animation</var>.effect</code> to
                    a new <a href="#idl-def-KeyframeAnimationEffect" class="idlType"><code>KeyframeAnimationEffect</code></a> object constructed by
                    passing <var>effect</var> as the <var>frames</var> parameter
                    and with the other parameters set to their default values.
                  </dd>
                  <dt>Otherwise,</dt>
                  <dd>
                    Set <code><var>animation</var>.effect</code> to
                    <code>null</code>.
                  </dd>
                </dl>
              </li>
            </ol>
            <p>
              Examples of the usage of this constructor are given in <a href="#creating-a-new-animation-object" class="sectionRef">section 6.10.4 Creating a new Animation object</a>.
            </p>
            <div class="note">
              <p>
                Note that as with <a href="#widl-ctor-TimingEvent--DOMString-type-TimingEventInit-eventInitDict">the
                constructor for </a><a href="#idl-def-TimingGroup" class="idlType"><code>TimingGroup</code></a>s
                it is possible to pass in a <a href="#idl-def-Timing" class="idlType"><code>Timing</code></a> object here (e.g. the
                <code>specified</code> member of another <a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>) in
                which case it will be cloned.
              </p>
            </div>
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">element</td><td class="prmType"><code><a href="#idl-def-AnimationTarget" class="idlType"><code>AnimationTarget</code></a></code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                The <a href="#dfn-target-element" class="internalDFN">target element</a> or target pseudo-element.
                This may be <code>null</code> for animations that do not target
                a specific element.
              </td></tr><tr><td class="prmName">effect</td><td class="prmType"><code>(<a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> or <a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a>)</code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                The animation effect used to set the <code>effect</code>
                attribute of the newly-created <a title="Animation
                interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object.
                <p>
                  If this parameter is an <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> object or
                  <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> object, it will shared with any
                  other <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> objects
                  referring to the same <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or
                  <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> object.
                  It will <em>not</em> be copied.
                </p>
                <p>
                  If this parameter of type <a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a>,
                  the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> of the newly-created
                  <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> will be
                  a newly-created <a href="#idl-def-KeyframeAnimationEffect" class="idlType"><code>KeyframeAnimationEffect</code></a> object
                  initialized by using this object as the list of
                  <a href="#dfn-keyframe" class="internalDFN">keyframes</a> and with all other parameters set to their
                  default values.
                </p>
                <p>
                  If this parameter is <code>null</code>, the newly-created
                  <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> will also have
                  a <code>null</code> animation effect.
                </p>
              </td></tr><tr><td class="prmName">timing</td><td class="prmType"><code>(<a>unrestricted double</a> or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>)</code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span> (<code>null</code>)</td><td class="prmDesc">
                <p>
                  The timing properties or <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of the new
                  animation.
                </p>
              </td></tr></table></dd></dl></section><section id="attributes-6"><h4><span class="secno">6.10.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-Animation-effect"><code>effect</code> of type <span class="idlAttrType">(<a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a>)</span>, nullable</dt><dd>
            <p>
              The <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> or <a href="#dfn-custom-effect" class="internalDFN">custom effect</a> to apply.
              May be <code>null</code> in which case the animation will produce
              no noticeable effect other than dispatching events (see <a href="#timing-events" class="sectionRef">section 5. Timing events</a>).
            </p>
          </dd><dt id="widl-Animation-target"><code>target</code> of type <span class="idlAttrType"><a href="#idl-def-AnimationTarget" class="idlType"><code>AnimationTarget</code></a></span>, readonly, nullable</dt><dd>
            <p>
              The element or pseudo-element being animated by this object.
              This may be <code>null</code> for animations that do not target
              a specific element such as an animation that produces a sound
              using an audio <abbr title="Application Programming Interface">API</abbr>.
            </p>
            <p class="note">
              Note that in a future version, <a href="#idl-def-AnimationTarget" class="idlType"><code>AnimationTarget</code></a> may be
              extended to allow targetting, for example, a sequence of elements.
              Therefore, code that is intended to be used with arbitrary
              <a href="#dfn-animation" class="internalDFN">Animation</a> objects should test the concrete type of
              <code>target</code> before using it and not assume that it refers
              to an Element.
            </p>
            <p class="issue">
              If SVG is extended to allow multiple targets (using, e.g.,
              <code>select="rect"</code>) then it might be most natural to
              represent that in the <abbr title="Application Programming Interface">API</abbr> by allowing the <code>target</code> to
              refer to multiple elements.
              It's something that deserves attention for version 1.
            </p>
            </dd></dl></section><section id="methods-6"><h4><span class="secno">6.10.3 </span>Methods</h4><dl class="methods"><dt id="widl-Animation-clone-Animation"><code>clone</code></dt><dd>
              <p>
                Creates a copy of this <a title="Animation
                interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object using the following procedure.
              </p>
              <ol>
                <li>Let <var>source</var> be the <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object to
                    clone, that is, this object.</li>
                <li>Let <var>cloned timing</var> be a new <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>
                    object whose members are assigned the value of the attribute
                    with the same name on
                    <code><var>source</var>.specified</code>.</li>
                <li>
                  The <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> is cloned depending on the type of
                  <code><var>source</var>.effect</code> as follows,
                  <dl class="switch">
                    <dt>If <code><var>source</var>.effect</code> is an
                        <a href="#dfn-animation" class="internalDFN">Animation</a> object,</dt>
                    <dd>
                      Let <var>cloned effect</var> be the result of calling
                      <code><var>source</var>.effect.clone()</code>.
                    </dd>
                    <dt>If <code><var>source</var>.effect</code> is a
                        <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> object,</dt>
                    <dd>
                      If <code><var>source</var>.effect</code> has a method
                      called <code>clone</code> let <var>cloned effect</var> be
                      the result of calling that method, otherwise let
                      <var>cloned effect</var> be
                      <code><var>source</var>.effect</code>.
                    </dd>
                    <dt>Otherwise,</dt>
                    <dd>
                      Let <var>cloned effect</var> be <code>null</code>.
                    </dd>
                  </dl>
                </li>
                <li>Return a new <a href="#dfn-animation" class="internalDFN">Animation</a> object created by
                    calling the <a href="#widl-ctor-Animation--AnimationTarget-element--AnimationEffect-or-CustomEffect-or-OneOrMoreKeyframes--effect--unrestricted-double-or-TimingInput--timing">Animation
                    constructor</a> with parameters
                    <code>Animation(<var>source</var>.target, <var>cloned
                    effect</var>, <var>cloned timing</var>)</code>.</li>
              </ol>
            <div><em>No parameters.</em></div><div><em>Return type: </em><code><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a></code></div></dd></dl></section>
        <section class="informative" id="creating-a-new-animation-object">
          <h4><span class="secno">6.10.4 </span>Creating a new <code>Animation</code> object</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
          <p>
            The <a href="#dfn-animation" class="internalDFN">Animation</a> constructor offers a number of approaches to
            creating a new <a href="#dfn-animation" class="internalDFN">Animation</a> object.
            At its simplest, an <a href="#dfn-animation" class="internalDFN">Animation</a> object that changes the
            &#x2018;left&#x2019; property of <var>elem</var> to 100 over three
            seconds can be achieved as follows:
          </p>
          <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> anim <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">3</span><span class="sh_symbol">);</span></pre>
          <p>
            The second parameter, representing the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>, may
            specify multiple properties, an <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> object, or
            even a callback object.
          </p>
          <pre class="example sh_javascript sh_sourceCode"><span class="sh_comment">// Specify multiple properties at once</span>
<span class="sh_keyword">var</span> animA <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span><span class="sh_symbol">,</span> top<span class="sh_symbol">:</span> <span class="sh_string">'300px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">3</span><span class="sh_symbol">);</span>

<span class="sh_comment">// Specify multiple frames</span>
<span class="sh_keyword">var</span> animB <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_symbol">[</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'300px'</span> <span class="sh_cbracket">}</span> <span class="sh_symbol">],</span> <span class="sh_number">3</span><span class="sh_symbol">);</span>

<span class="sh_comment">// Share the animation effect of another animation</span>
<span class="sh_keyword">var</span> animC <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> animB<span class="sh_symbol">.</span>effect<span class="sh_symbol">,</span> <span class="sh_number">3</span><span class="sh_symbol">);</span>

<span class="sh_comment">// Supply a specialized animation effect</span>
<span class="sh_keyword">var</span> animD <span class="sh_symbol">=</span>
  <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_keyword">new</span> <span class="sh_function">PathAnimationEffect</span><span class="sh_symbol">(</span><span class="sh_string">"M100 250C100 50 400 50 400 250"</span><span class="sh_symbol">),</span> <span class="sh_number">3</span><span class="sh_symbol">);</span>

<span class="sh_comment">// Supply a custom script-based animation effect</span>
<span class="sh_keyword">var</span> animE <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span>
  <span class="sh_cbracket">{</span> 
    sample<span class="sh_symbol">:</span> <span class="sh_keyword">function</span><span class="sh_symbol">(</span>time<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span> 
      <span class="sh_keyword">if</span> <span class="sh_symbol">(</span>time <span class="sh_symbol">!==</span> <span class="sh_keyword">null</span><span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
        document<span class="sh_symbol">.</span>documentElement<span class="sh_symbol">.</span>currentScale <span class="sh_symbol">=</span> <span class="sh_number">1.0</span> <span class="sh_symbol">+</span> time <span class="sh_symbol">*</span> <span class="sh_number">2.0</span><span class="sh_symbol">;</span>
      <span class="sh_cbracket">}</span> <span class="sh_keyword">else</span> <span class="sh_cbracket">{</span>
        document<span class="sh_symbol">.</span>documentElement<span class="sh_symbol">.</span>currentScale <span class="sh_symbol">=</span> <span class="sh_number">1.0</span><span class="sh_symbol">;</span>
      <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span>
  <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">3</span><span class="sh_symbol">);</span></pre>
          <p>
            The third parameter representing the animation's timing, may
            simply be a number representing the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> as
            above, or, to specify further timing properties such as the <a title="timed item playback rate" href="#dfn-timed-item-playback-rate" class="internalDFN">playback rate</a>,
            a <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a> object can be used as follows:
          </p>
          <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> anim <span class="sh_symbol">=</span>
  <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> iterationDuration<span class="sh_symbol">:</span> <span class="sh_number">3</span><span class="sh_symbol">,</span> playbackRate<span class="sh_symbol">:</span> <span class="sh_number">2</span> <span class="sh_cbracket">}</span><span class="sh_symbol">);</span></pre>
          <p>
            It is also possible to omit the timing parameter altogether in which
            case default timing values will be used.
            Since the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> of an <a href="#dfn-animation" class="internalDFN">animation</a>
            is zero, and the default <code>fillMode</code> when constructing an
            <a href="#dfn-animation" class="internalDFN">Animation</a> is <span class="prop-value">forwards</span>, it is
            possible to create animations that simply set a property without
            any interpolation as follows,
          </p>
          <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> display<span class="sh_symbol">:</span> <span class="sh_string">'none'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">);</span></pre>
          <p>
            This is particularly useful in combination with other <a title="animation" href="#dfn-animation" class="internalDFN">animations</a> or <a href="#dfn-timed-item" class="internalDFN">timed
            items</a>.
            For example, fading an element before switching
            &#x2018;display&#x2019; to &#x2018;none&#x2019; can be achieved as
            follows,
          </p>
          <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">new</span> <span class="sh_function">SeqGroup</span><span class="sh_symbol">(</span>
  <span class="sh_symbol">[</span>
    <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> opacity<span class="sh_symbol">:</span> <span class="sh_string">'0%'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">1</span><span class="sh_symbol">),</span>
    <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> display<span class="sh_symbol">:</span> <span class="sh_string">'none'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">)</span>
  <span class="sh_symbol">]</span>
<span class="sh_symbol">);</span></pre>
          <p>
            Having created an <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a>, it
            can be played using
            <code>document.timeline.play(<var>anim</var>)</code>.
            For simple effects, the <a href="#extensions-to-the-element-interface"><code>Element.animate</code></a>
            shortcut is more convenient since it performs this last step
            automatically. For example,
          </p>
          <pre class="example sh_javascript sh_sourceCode">elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">(</span><span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">3</span><span class="sh_symbol">);</span></pre>
        </div></section>
      </section>
      <section id="the-pseudoelementreference-interface">
        <h3><span class="secno">6.11 </span>The <code>PseudoElementReference</code> interface</h3>
        <p class="issue">
          We should replace this with the <a href="http://dev.w3.org/csswg/cssom/#the-pseudoelement-interface"><code>PseudoElement</code></a>
          from <a href="http://dev.w3.org/csswg/cssom/">the ED of CSSOM</a>
          unless it gets dropped.
        </p>
        <p>
          Since <a href="#dfn-animation" class="internalDFN">animations</a> may also target
          pseudo-elements, Web Animations <abbr title="Application Programming Interface">API</abbr> introduces the
          <a href="#idl-def-PseudoElementReference" class="idlType"><code>PseudoElementReference</code></a> interface to represent such targets.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-PseudoElementReference">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-PseudoElementReference--Element-element-DOMString-pseudoElement">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-Element" class="idlType"><code>Element</code></a></span> <span class="idlParamName">element</span></span>, <span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">pseudoElement</span></span>)</span>]
interface <span class="idlInterfaceID">PseudoElementReference</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-Element" class="idlType"><code>Element</code></a></span>   <span class="idlAttrName"><a href="#widl-PseudoElementReference-element">element</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span> <span class="idlAttrName"><a href="#widl-PseudoElementReference-pseudoElement">pseudoElement</a></span>;</span>
};</span>
</pre><section id="constructors-3"><h4><span class="secno">6.11.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-PseudoElementReference--Element-element-DOMString-pseudoElement"><code>PseudoElementReference</code></dt><dd>
            Creates a new pseudo-element reference using <var>element</var> as
            the <a href="http://www.w3.org/TR/css3-selectors/#subject">subject</a>
            and <var>pseudoElement</var> as the pseudo-element to match (e.g.
            &#x2018;<code>::first-line</code>&#x2019;).
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">element</td><td class="prmType"><code><a href="#idl-def-Element" class="idlType"><code>Element</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr><tr><td class="prmName">pseudoElement</td><td class="prmType"><code><a>DOMString</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table></dd></dl></section><section id="attributes-7"><h4><span class="secno">6.11.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-PseudoElementReference-element"><code>element</code> of type <span class="idlAttrType"><a href="#idl-def-Element" class="idlType"><code>Element</code></a></span></dt><dd>
            The element used as the <a href="http://www.w3.org/TR/css3-selectors/#subject">subject</a> for
            matching a pseudo-element.
            <p>Exceptions:</p>
            <dl class="exceptions">
              <dt>DOMException of type
                  <code>NoModificationAllowedError</code></dt>
              <dd>
                Raised on setting if this object is a readonly object.
              </dd>
            </dl>
          </dd><dt id="widl-PseudoElementReference-pseudoElement"><code>pseudoElement</code> of type <span class="idlAttrType"><a>DOMString</a></span></dt><dd>
            The pseudo-element including the initial colon(s). For example,
            &#x2018;<code>::after</code>&#x2019;.
            <p>Exceptions:</p>
            <dl class="exceptions">
              <dt>DOMException of type
                  <code>NoModificationAllowedError</code></dt>
              <dd>
                Raised on setting if this object is a readonly object.
              </dd>
            </dl>
          </dd></dl></section>
      </section>
      <section id="the-animationtarget-typedef">
        <h3><span class="secno">6.12 </span>The <code>AnimationTarget</code> typedef</h3>
        <pre class="idl"><span class="idlTypedef" id="idl-def-AnimationTarget">typedef <span class="idlTypedefType">(<a href="#idl-def-Element" class="idlType"><code>Element</code></a> or <a href="#idl-def-PseudoElementReference" class="idlType"><code>PseudoElementReference</code></a>)</span> <span class="idlTypedefID">AnimationTarget</span>;</span>
</pre><div class="idlTypedefDesc">
          For simplicity, throughout this specification <a href="#idl-def-AnimationTarget" class="idlType"><code>AnimationTarget</code></a>
          is used wherever either an <a href="#idl-def-Element" class="idlType"><code>Element</code></a> or
          a <a href="#idl-def-PseudoElementReference" class="idlType"><code>PseudoElementReference</code></a> can be used.
        </div>
      </section>
      <section id="the-animationeffect-interface">
        <h3><span class="secno">6.13 </span>The <code>AnimationEffect</code> interface</h3>
        <p>
          <a href="#dfn-animation-effect" class="internalDFN">Animation effects</a> are represented by
          the <code>AnimationEffect</code> interface.
          <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> is an abstract interface of which several
          concrete subinterfaces are provided.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-AnimationEffect">interface <span class="idlInterfaceID">AnimationEffect</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-AccumulateOperation" class="idlType"><code>AccumulateOperation</code></a></span> <span class="idlAttrName"><a href="#widl-AnimationEffect-accumulate">accumulate</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></span> <span class="idlMethName"><a href="#widl-AnimationEffect-clone-AnimationEffect">clone</a></span> ();</span>
};</span>
</pre><section id="attributes-8"><h4><span class="secno">6.13.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-AnimationEffect-accumulate"><code>accumulate</code> of type <span class="idlAttrType"><a href="#idl-def-AccumulateOperation" class="idlType"><code>AccumulateOperation</code></a></span></dt><dd>
            <p>
              The <a href="#dfn-accumulation-operation" class="internalDFN">accumulation operation</a> property of this <a href="#dfn-animation-effect" class="internalDFN">animation
              effect</a> as specified by one of the <a href="#idl-def-AccumulateOperation" class="idlType"><code>AccumulateOperation</code></a>
              constants.
            </p>
          </dd></dl></section><section id="methods-7"><h4><span class="secno">6.13.2 </span>Methods</h4><dl class="methods"><dt id="widl-AnimationEffect-clone-AnimationEffect"><code>clone</code></dt><dd>
            <p>
              Creates and returns a new object of the same type as this object's
              most-derived interface such that it will produce the same output
              as this object.
            </p>
            <p class="todo">
              We either need a more rigorous definition here or (probably
              better) a sets of steps on a per-subclass basis.
            </p>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></code></div></dd></dl></section>
        
      </section>
      <section id="the-accumulateoperation-enumeration">
        <h3><span class="secno">6.14 </span>The <code>AccumulateOperation</code> enumeration</h3>
        <p>
          The possible values of an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>'s
          <a href="#dfn-accumulation" class="internalDFN">accumulation</a> behavior are represented by the
          <a href="#idl-def-AccumulateOperation" class="idlType"><code>AccumulateOperation</code></a> enumeration.
        </p>
        <pre class="idl"><span class="idlEnum" id="idl-def-AccumulateOperation">enum <span class="idlEnumName">AccumulateOperation</span> {<span class="idlEnumValues"> "<a href="#widl-AccumulateOperation-sum">sum</a>", "<a href="#widl-AccumulateOperation-none">none</a>" </span>};</span>
</pre><section id="values-2"><h4><span class="secno">6.14.1 </span>Values</h4><dl class="values"><dt id="widl-AccumulateOperation-sum"><code>sum</code></dt><dd>
            Corresponds to the <a title="accumulation operation sum" href="#dfn-accumulation-operation-sum" class="internalDFN">sum</a>
            accumulation operation value such that
            subsequent iterations of an <a href="#dfn-animation" class="internalDFN">animation</a> build on the final
            value of the previous iteration.
          </dd><dt id="widl-AccumulateOperation-none"><code>none</code></dt><dd>
            Corresponds to the <a title="accumulation operation none" href="#dfn-accumulation-operation-none" class="internalDFN">none</a>
            accumulation operation value such that the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation
            value</a> produced is independent of the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a>.
          </dd></dl></section>
      </section>
      <section id="the-compositeoperation-enumeration">
        <h3><span class="secno">6.15 </span>The <code>CompositeOperation</code> enumeration</h3>
        <p>
          The possible values of an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>'s
          composition behavior are represented by the
          <a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a> enumeration.
        </p>
        <pre class="idl"><span class="idlEnum" id="idl-def-CompositeOperation">enum <span class="idlEnumName">CompositeOperation</span> {<span class="idlEnumValues"> "<a href="#widl-CompositeOperation-replace">replace</a>", "<a href="#widl-CompositeOperation-add">add</a>" </span>};</span>
</pre><section id="values-3"><h4><span class="secno">6.15.1 </span>Values</h4><dl class="values"><dt id="widl-CompositeOperation-replace"><code>replace</code></dt><dd>
            Corresponds to the <a title="composition operation replace" href="#dfn-composition-operation-replace" class="internalDFN">replace</a>
            <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> value such that
            the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> overrides the <a href="#dfn-base-value" class="internalDFN">base value</a> it is
            combined with.
          </dd><dt id="widl-CompositeOperation-add"><code>add</code></dt><dd>
            Corresponds to the <a title="composition operation add" href="#dfn-composition-operation-add" class="internalDFN">add</a>
            <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> value such that
            the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> is <a title="addition" href="#dfn-addition" class="internalDFN">added</a> to
            <a href="#dfn-base-value" class="internalDFN">base value</a> it is combined with.
          </dd></dl></section>
      </section>
      <section id="the-keyframeanimationeffect-interface">
        <h3><span class="secno">6.16 </span>The <code>KeyframeAnimationEffect</code> interface</h3>
        <p>
          <a href="#dfn-keyframe-animation-effect" class="internalDFN">Keyframe animation effects</a> are represented by the
          <a href="#idl-def-KeyframeAnimationEffect" class="idlType"><code>KeyframeAnimationEffect</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-KeyframeAnimationEffect">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-KeyframeAnimationEffect--OneOrMoreKeyframes-frames-CompositeOperation-composite-AccumulateOperation-accumulate">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a></span> <span class="idlParamName">frames</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span> <span class="idlParamName">composite</span> = <span class="idlParamValue">"replace"</span></span>, 
              <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-AccumulateOperation" class="idlType"><code>AccumulateOperation</code></a></span> <span class="idlParamName">accumulate</span> = <span class="idlParamValue">"none"</span></span>)</span>]
interface <span class="idlInterfaceID">KeyframeAnimationEffect</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span> <span class="idlAttrName"><a href="#widl-KeyframeAnimationEffect-composite">composite</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-KeyframeAnimationEffect-getFrames-sequence-Keyframe">getFrames</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>               <span class="idlMethName"><a href="#widl-KeyframeAnimationEffect-setFrames-void-OneOrMoreKeyframes-frames">setFrames</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a></span> <span class="idlParamName">frames</span></span>);</span>
};</span>
</pre><section id="constructors-4"><h4><span class="secno">6.16.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-KeyframeAnimationEffect--OneOrMoreKeyframes-frames-CompositeOperation-composite-AccumulateOperation-accumulate"><code>KeyframeAnimationEffect</code></dt><dd>
            <p>
              Creates a new <a href="#idl-def-KeyframeAnimationEffect" class="idlType"><code>KeyframeAnimationEffect</code></a> object for the
              given set of keyframes.
            </p>
            <p>
              Before storing, each of the keyframes in <var>frames</var> is
              normalized using the procedure in <a href="#normalizing-a-keyframe-object" class="sectionRef">section 6.17.2 Normalizing a Keyframe object</a>.
            </p>
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">frames</td><td class="prmType"><code><a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                The set of <a href="#dfn-keyframe" class="internalDFN">keyframes</a> used for calculating animation
                values for this <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>.
                The constraints on this parameter and its processing are
                identical to those for <code>setFrames</code>.
              </td></tr><tr><td class="prmName">composite</td><td class="prmType"><code><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span> (<code>"replace"</code>)</td><td class="prmDesc">
                The <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> used to composite this
                animation with the <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>, as specified by one
                of the <a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a> enumeration values.
                This is used for all keyframes that do not specify
                a <a href="#dfn-composition-operation" class="internalDFN">composition operation</a>.
              </td></tr><tr><td class="prmName">accumulate</td><td class="prmType"><code><a href="#idl-def-AccumulateOperation" class="idlType"><code>AccumulateOperation</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span> (<code>"none"</code>)</td><td class="prmDesc">
                The <a href="#dfn-accumulation-operation" class="internalDFN">accumulation operation</a> used to define the way
                animation values build from iteration to iteration.
              </td></tr></table></dd></dl></section><section id="attributes-9"><h4><span class="secno">6.16.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-KeyframeAnimationEffect-composite"><code>composite</code> of type <span class="idlAttrType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span></dt><dd>
            <p>
              The <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> used to composite this animation
              with the <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>, as specified by one of the
              <a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a> enumeration values.
            </p>
            <p>
              This is used for all keyframes that do not specify
              a <a href="#dfn-composition-operation" class="internalDFN">composition operation</a>.
            </p>
          </dd></dl></section><section id="methods-8"><h4><span class="secno">6.16.3 </span>Methods</h4><dl class="methods"><dt id="widl-KeyframeAnimationEffect-getFrames-sequence-Keyframe"><code>getFrames</code></dt><dd>
            <p>
              Returns the <a href="#dfn-keyframe" class="internalDFN">keyframes</a> that make up this effect as
              a sequence of <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> objects.
            </p>
            <p>
              Note that the normalization applied to the <em>list</em> of
              <a href="#dfn-keyframe" class="internalDFN">keyframes</a> as defined in <a href="#normalizing-the-list-of-keyframes" class="sectionRef">section 6.16.4 Normalizing the list of keyframes</a> does not affect the value returned by this
              method.
            </p>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code>sequence&lt;<a></a><a href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a>&gt;</code></div></dd><dt id="widl-KeyframeAnimationEffect-setFrames-void-OneOrMoreKeyframes-frames"><code>setFrames</code></dt><dd>
            <p>
              Replaces the set of <a href="#dfn-keyframe" class="internalDFN">keyframes</a> that make up this effect.
            </p>
            <p>
              Upon setting, each keyframe in <var>frames</var> is normalized
              using the procedure in <a href="#normalizing-a-keyframe-object" class="sectionRef">section 6.17.2 Normalizing a Keyframe object</a> before storing.
            </p>
            <p>
              Before being used by the animation model, the set of frames
              associated with this effect is normalized using the procedure
              defined in <a href="#normalizing-the-list-of-keyframes" class="sectionRef">section 6.16.4 Normalizing the list of keyframes</a>.
            </p>
            <p>
              As a result of the normalization of the list, if <var>frames</var>
              is not <a href="#dfn-loosely-sorted-by-offset" class="internalDFN">loosely sorted by offset</a> this effect will not
              contribute to the final <a href="#dfn-composited-value" class="internalDFN">composited value</a>.
            </p>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">frames</td><td class="prmType"><code><a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></section>
        <section id="normalizing-the-list-of-keyframes">
          <h4><span class="secno">6.16.4 </span>Normalizing the list of keyframes</h4>
          <div class="issue">
            This behavior is expected to be revised such that keyframe lists
            that are not in sequence are accepted and keyframe offsets outside
            the range [0, 1] are also allowed.
            Doing so may make this procedure unnecessary.
          </div>
          <p>
            Before passing the list of <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframes</code></a> specified in the <abbr title="Application Programming Interface">API</abbr> to the
            animation model so that the <a href="#dfn-unaccumulated-animation-value" class="internalDFN">unaccumulated animation value</a> can
            be calculated (see <a href="#the-unaccumulated-animation-value-of-a-keyframe-animation-effect" class="sectionRef">section 4.3.1 The unaccumulated animation value of a keyframe animation effect</a>), the following normalization is performed.
          </p>
          <ol>
            <li>Let <var>normalized keyframes</var> be a copy of the
                <a href="#dfn-keyframe" class="internalDFN">keyframe</a> list returned by <code>getFrames</code>.
            </li><li>If <var>normalized keyframes</var> is not <a href="#dfn-loosely-sorted-by-offset" class="internalDFN">loosely sorted by
                offset</a>, return an empty list.
            </li><li>If there exist any <a href="#dfn-keyframe" class="internalDFN">keyframes</a> whose specified positional
                offset is less than zero, remove all <a href="#dfn-keyframe" class="internalDFN">keyframes</a> from the
                start of <var>normalized keyframes</var> up to and including the
                <a href="#dfn-keyframe" class="internalDFN">keyframe</a> with the largest specified positional offset
                that is still less than zero.
            </li><li>Likewise, if there exist any <a href="#dfn-keyframe" class="internalDFN">keyframes</a> whose specified
                offset is greater than one, remove all <a href="#dfn-keyframe" class="internalDFN">keyframes</a> from
                <a href="#dfn-keyframe" class="internalDFN">keyframe</a> with the smallest specified positional offset
                that is still greater than one until the end of
                <var>normalized keyframes</var>.
            </li><li>Set the <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional
                offset</a> of any keyframes without a specified offset using the
                procedure defined in <a href="#procedure-for-evenly-distributing-keyframes" class="sectionRef">section 4.3.2 Procedure for evenly distributing keyframes</a>.
            </li><li>Remove all property values in <var>normalized keyframes</var>
                that are invalid or not supported by the implementation.
            </li><li>Return <var>normalized keyframes</var>.
          </li></ol>
          <div class="note">
            <p>
              Note that this normalization is only applied to the keyframes
              before they are passed to the model and does not affect the result
              returned by <code>getFrames</code>.
            </p>
          </div>
        </section>
      </section>
      <section id="the-keyframe-dictionary">
        <h3><span class="secno">6.17 </span>The <code>Keyframe</code> dictionary</h3>
        <p>
          Individual <a href="#dfn-keyframe" class="internalDFN">keyframes</a> are represented by a special kind of
          <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> dictionary type whose
          members map to the properties to be animated.
          At the time of writing, this kind of open-ended dictionary cannot
          be represented using WebIDL and hence special
          ECMAScript-specific handling for this type is defined in
          <a href="#normalizing-a-keyframe-object" class="sectionRef">section 6.17.2 Normalizing a Keyframe object</a>.
          No handling is defined for other languages.
        </p>
        <pre class="idl"><span class="idlDictionary" id="idl-def-Keyframe">dictionary <span class="idlDictionaryID">Keyframe</span> {
<span class="idlSectionComment">    // ... property-value pairs ...</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span>             <span class="idlMemberName"><a href="#widl-Keyframe-offset">offset</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a>?</span> <span class="idlMemberName"><a href="#widl-Keyframe-composite">composite</a></span> = <span class="idlMemberValue">null</span>;</span>
};</span>
</pre><section id="dictionary-keyframe-members"><h4><span class="secno">6.17.1 </span>Dictionary <a class="idlType" href="#idl-def-Keyframe"><code>Keyframe</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-Keyframe-offset"><code>offset</code> of type <span class="idlMemberType"><a>double</a></span>, nullable, defaulting to <code>null</code></dt><dd>
            <p>
              The <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional
              offset</a> of the <a href="#dfn-keyframe" class="internalDFN">keyframe</a> specified as a number between
              0.0 and 1.0 inclusive or <code>null</code>.
            </p>
            <p>
              <a href="#dfn-keyframe" class="internalDFN">Keyframes</a> with offsets outside the range [0.0, 1.0] are
              ignored when calculating animation values as defined in
              <a href="#normalizing-the-list-of-keyframes" class="sectionRef">section 6.16.4 Normalizing the list of keyframes</a>.
            </p>
            <p>
              A <code>null</code> value indicates that the <a href="#dfn-keyframe" class="internalDFN">keyframe</a>
              should be positioned automatically using the algorithm defined in
              <a href="#procedure-for-evenly-distributing-keyframes" class="sectionRef">section 4.3.2 Procedure for evenly distributing keyframes</a> and applied in
              <a href="#normalizing-the-list-of-keyframes" class="sectionRef">section 6.16.4 Normalizing the list of keyframes</a>.
            </p>
          </dd><dt id="widl-Keyframe-composite"><code>composite</code> of type <span class="idlMemberType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span>, nullable, defaulting to <code>null</code></dt><dd>
            <p>
              The <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> used to combine the values
              specified in this keyframe with the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>.
            </p>
            <p>
              If <code>null</code>, the <a href="#dfn-composition-operation" class="internalDFN">composition operation</a>
              specified on the <a href="#idl-def-KeyframeAnimationEffect" class="idlType"><code>KeyframeAnimationEffect</code></a> will be used.
            </p>
          </dd></dl></section>
        <section id="normalizing-a-keyframe-object">
          <h4><span class="secno">6.17.2 </span>Normalizing a <code>Keyframe</code> object</h4>
          <div class="note">
            <p>
              Since accessing the properties of an ECMAScript user object can
              have side effects, the manner in which these properties is
              accessed is important.
              In light of this consideration the procedure for normalizing
              a <a href="#dfn-keyframe" class="internalDFN">Keyframe</a> has the following properties:
            </p>
            <ul>
              <li>Each property that is read, is read only once.</li>
              <li>Properties are read in a well-defined order.</li>
              <li>Properties corresponding to unsupported target properties or
                  attributes are not read.</li>
            </ul>
          </div>
          <p>
            A <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> object, <var>keyframe
            input</var>, is converted to a normalized internal representation
            <var>keyframe result</var> using the following procedure:
          </p>
          <ol>
            <li>Let the initial <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offset</a>
                of <var>keyframe result</var> be <code>null</code>.
            </li><li>Let the initial <a href="#dfn-composition-operation" class="internalDFN">composition operation</a>
                of <var>keyframe result</var> be <code>null</code>.
            </li><li>Create a list, <var>supported properties</var>, of property
                names and attribute names that <a title="animatable" href="#dfn-animatable" class="internalDFN">can be
                animated</a> by the implementation.
            </li><li>Convert each property name in <var>supported properties</var>
                to the equivalent IDL attribute by applying the <a href="http://dev.w3.org/csswg/cssom/#css-property-to-idl-attribute">CSS
                property to IDL attribute</a> algorithm [<cite><a class="bibref" href="#bib-CSSOM">CSSOM</a></cite>].
            </li><li>If the user agent supports animation of the <span class="prop-name">float CSS property, replace 'float' in
                <var>supported properties</var> with 'cssFloat'.
            </span></li><li>Let <var>animation properties</var> be an empty sequence.
            </li><li>Iterate over the properties of <var>keyframe input</var>.
                For each <var>property</var> in <var>keyframe input</var>,
                perform the step corresponding to the first matching condition
                from below, if any.
              <dl class="switch">
                <dt>If <var>property</var> is a case-sensitive match for
                  the string 'offset',</dt>
                <dd>
                  If <code><var>keyframe input</var>.offset</code> is
                  a Number, set the <a title="positional offset of a keyframe" href="#dfn-positional-offset-of-a-keyframe" class="internalDFN">positional offset</a>
                  of <var>keyframe input</var> to 
                  <code><var>keyframe input</var>.offset</code>.
                </dd>
                <dt>if <var>property</var> is a case-sensitive match for
                  the string 'composite',</dt>
                <dd>
                  If <code><var>keyframe input</var>.composite</code> is
                  a case-sensitive match for one of the values of the
                  <a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a> enumeration,
                  set the <a href="#dfn-composition-operation" class="internalDFN">composition operation</a>
                  of <var>keyframe input</var> to 
                  <code><var>keyframe input</var>.composite</code>.
                </dd>
                <dt>Otherise, if <var>property</var> also exists in
                  <var>supported properties</var> based on a case-sensitive
                  comparison,</dt>
                <dd>append <var>property</var> to <var>animation
                  properties</var>.</dd>
              </dl>
            </li><li>For user agents that support both a prefixed and an
                unprefixed version of some CSS properties, remove all
                prefixed properties from <var>animation properties</var>
                where the corresponding unprefixed version is also
                present in <var>animation properties</var>.
            </li><li>Sort <var>animation properties</var> lexicographically by
                the Unicode codepoints that define each element.
            </li><li>Iterate over <var>animation properties</var> and for each
                element, <var>name</var>, add a new property-value pair to
                <var>keyframe result</var> as follows:
              <ul>
                <li><em>property name</em>: the result of applying the
                    the <a href="http://dev.w3.org/csswg/cssom/#idl-attribute-to-css-property">IDL
                    attribute to CSS property</a> algorithm [<cite><a class="bibref" href="#bib-CSSOM">CSSOM</a></cite>] to
                    <var>name</var> unless <var>name</var> is
                    a case-sensitive match for the string 'cssFloat' in
                    which case use the string 'float'.
                </li><li><em>property value</em>: the result of calling
                    <code>toString</code> on the <var>name</var> property of
                    <var>keyframe input</var>.
              </li></ul>
            </li><li>Return <var>keyframe result</var>.
          </li></ol>
          <p>
            This procedure is performed exactly once per call to
            <code>setFrames</code> or the constructor for
            <a href="#idl-def-KeyframeAnimationEffect" class="idlType"><code>KeyframeAnimationEffect</code></a>.
          </p>
          <div class="issue">
            <p>
              The above algorithm gives special meaning to the property names
              'offset' and 'composite'.
              If a CSS property called 'offset' or 'composite' is ever
              introduced it will clash with the meaning here.
            </p>
            <p>
              We have a few options:
            </p>
            <ul>
              <li>Add special handling at that time to allow addressing the
                  property of the same name, e.g. <code>cssOffset</code>.
              </li><li>Rename these keywords now to avoid risk of a later clash,
                  e.g. 'keyframeOffset'.
            </li></ul>
          </div>
        </section>
      </section>
      <section id="the-oneormorekeyframes-typedef">
        <h3><span class="secno">6.18 </span>The <code>OneOrMoreKeyframes</code> typedef</h3>
        <pre class="idl"><span class="idlTypedef" id="idl-def-OneOrMoreKeyframes">typedef <span class="idlTypedefType">(<a href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> or sequence&lt;<a></a><a href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a>&gt;)</span> <span class="idlTypedefID">OneOrMoreKeyframes</span>;</span>
</pre><div class="idlTypedefDesc">
          Throughout this specification we use the <a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a>
          type to represent either a single keyframe or a list of such
          keyframes.
        </div>
      </section>
      <section id="the-pathanimationeffect-interface">
        <h3><span class="secno">6.19 </span>The <code>PathAnimationEffect</code> interface</h3>
        <p>
          <a href="#dfn-path-animation-effect" class="internalDFN">Path animation effects</a> are
          represented by the <a href="#idl-def-PathAnimationEffect" class="idlType"><code>PathAnimationEffect</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-PathAnimationEffect">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-PathAnimationEffect---DOMString-or-SVGPathSegList--path-AutoRotationMode-autoRotate-double-angle-CompositeOperation-composite">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">(<a>DOMString</a> or <a>SVGPathSegList</a>)</span> <span class="idlParamName">path</span></span>, 
              <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-AutoRotationMode" class="idlType"><code>AutoRotationMode</code></a></span> <span class="idlParamName">autoRotate</span> = <span class="idlParamValue">"none"</span></span>, <span class="idlParam">optional <span class="idlParamType"><a>double</a></span> <span class="idlParamName">angle</span> = <span class="idlParamValue">0</span></span>, 
              <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span> <span class="idlParamName">composite</span> = <span class="idlParamValue">"replace"</span></span>)</span>]
interface <span class="idlInterfaceID">PathAnimationEffect</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>SVGPathSegList</a></span>     <span class="idlAttrName"><a href="#widl-PathAnimationEffect-segments">segments</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>AutoRotationFlag</a></span>   <span class="idlAttrName"><a href="#widl-PathAnimationEffect-autoRotate">autoRotate</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>             <span class="idlAttrName"><a href="#widl-PathAnimationEffect-angle">angle</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span> <span class="idlAttrName"><a href="#widl-PathAnimationEffect-composite">composite</a></span>;</span>
};</span>
</pre><section id="constructors-5"><h4><span class="secno">6.19.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-PathAnimationEffect---DOMString-or-SVGPathSegList--path-AutoRotationMode-autoRotate-double-angle-CompositeOperation-composite"><code>PathAnimationEffect</code></dt><dd>
            <p>
              Creates a new <a href="#idl-def-PathAnimationEffect" class="idlType"><code>PathAnimationEffect</code></a> object with the specified
              parameters.
            </p>
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">path</td><td class="prmType"><code>(<a>DOMString</a> or <a>SVGPathSegList</a>)</code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                <p>
                  The <a href="#dfn-path" class="internalDFN">path</a> which defines the motion.
                </p>
                <p>
                  A string may be provided specifying the path using the syntax
                  for <a href="http://www.w3.org/TR/SVG11/paths.html#PathData">SVG path
                  data</a> [<cite><a class="bibref" href="#bib-SVG11">SVG11</a></cite>].
                </p>
                <p>
                  If a string is provided, it is converted into an
                  <code>SVGPathSegList</code> using the procedures defined for
                  parsing <a href="http://www.w3.org/TR/SVG11/paths.html#PathData">path
                  data</a> in [<cite><a class="bibref" href="#bib-SVG11">SVG11</a></cite>].
                  Any errors encountered in the path data causing parsing to
                  cease and the path data processed up to that point to be used.
                </p>
                <p>
                  The resulting <a>SVGPathSegList</a> is assigned to the
                  <code>path</code> attribute of the generated object without
                  copying.
                </p>
              </td></tr><tr><td class="prmName">autoRotate</td><td class="prmType"><code><a href="#idl-def-AutoRotationMode" class="idlType"><code>AutoRotationMode</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span> (<code>"none"</code>)</td><td class="prmDesc">
                The <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a> setting for the generated
                effect.
              </td></tr><tr><td class="prmName">angle</td><td class="prmType"><code><a>double</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span> (<code>0</code>)</td><td class="prmDesc">
                The <a href="#dfn-rotation-angle" class="internalDFN">rotation angle</a> for the generated effect.
              </td></tr><tr><td class="prmName">composite</td><td class="prmType"><code><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span> (<code>"replace"</code>)</td><td class="prmDesc">
                The <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> used to composite this
                animation with the <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>, as specified by one
                of the <a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a> enumeration values.
              </td></tr></table></dd></dl></section><section id="attributes-10"><h4><span class="secno">6.19.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-PathAnimationEffect-segments"><code>segments</code> of type <span class="idlAttrType"><a>SVGPathSegList</a></span></dt><dd>
            The list of segments that make up the <a href="#dfn-path" class="internalDFN">path</a>.
            <p class="issue">
              Is this the correct data type here?
            </p>
            <p class="issue">
              Is this sufficient to allow us to animate along an animated path?
              Do we need to spell out how this works in more detail?
            </p>
          </dd><dt id="widl-PathAnimationEffect-autoRotate"><code>autoRotate</code> of type <span class="idlAttrType"><a>AutoRotationFlag</a></span></dt><dd>
            The <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a> of the <a href="#dfn-path-animation-effect" class="internalDFN">path animation
            effect</a>.
          </dd><dt id="widl-PathAnimationEffect-angle"><code>angle</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            The <a href="#dfn-rotation-angle" class="internalDFN">rotation angle</a> of the <a href="#dfn-path-animation-effect" class="internalDFN">path animation effect</a>.
          </dd><dt id="widl-PathAnimationEffect-composite"><code>composite</code> of type <span class="idlAttrType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span></dt><dd>
            The <a href="#dfn-composition-operation" class="internalDFN">composition operation</a> used to composite this animation
            with the <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>, as specified by one of the
            <a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a> enumeration values.
          </dd></dl></section>
        <section id="the-autorotationmode-enumeration">
          <h4><span class="secno">6.19.3 </span>The <code>AutoRotationMode</code> enumeration</h4>
          <p>
            The values of the <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a> of a <a href="#dfn-path-animation-effect" class="internalDFN">path
            animation effect</a> are represented by the <a href="#idl-def-AutoRotationMode" class="idlType"><code>AutoRotationMode</code></a>
            enumeration.
          </p>
          <pre class="idl"><span class="idlEnum" id="idl-def-AutoRotationMode">enum <span class="idlEnumName">AutoRotationMode</span> {<span class="idlEnumValues"> "<a href="#widl-AutoRotationMode-auto-rotate">auto-rotate</a>", "<a href="#widl-AutoRotationMode-none">none</a>" </span>};</span>
</pre><section id="values-4"><h5><span class="secno">6.19.3.1 </span>Values</h5><dl class="values"><dt id="widl-AutoRotationMode-auto-rotate"><code>auto-rotate</code></dt><dd>
              Corresponds to setting the <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a>.
            </dd><dt id="widl-AutoRotationMode-none"><code>none</code></dt><dd>
              Corresponds to clearing the <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a>.
            </dd></dl></section>
        </section>
      </section>
      <section id="the-customeffect-callback-interface">
        <h3><span class="secno">6.20 </span>The <code>CustomEffect</code> callback interface</h3>
        <p>
          <a href="#dfn-custom-effect" class="internalDFN">Custom effects</a> can be defined in script
          using the <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-CustomEffect">callback interface <span class="idlInterfaceID">CustomEffect</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>long</a>?</span>                      <span class="idlAttrName"><a href="#widl-CustomEffect-priority">priority</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-CustomEffectCloneCallback" class="idlType"><code>CustomEffectCloneCallback</code></a>?</span> <span class="idlAttrName"><a href="#widl-CustomEffect-clone">clone</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-CustomEffect-sample-void-double-timeFraction-double-currentIteration-AnimationTarget-target-double-previousTimeFraction">sample</a></span> (<span class="idlParam"><span class="idlParamType"><a>double</a>?</span> <span class="idlParamName">timeFraction</span></span>, <span class="idlParam"><span class="idlParamType"><a>double</a></span> <span class="idlParamName">currentIteration</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-AnimationTarget" class="idlType"><code>AnimationTarget</code></a>?</span> <span class="idlParamName">target</span></span>, 
                 <span class="idlParam"><span class="idlParamType"><a>double</a>?</span> <span class="idlParamName">previousTimeFraction</span></span>);</span>
};</span>
</pre><section id="attributes-11"><h4><span class="secno">6.20.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-CustomEffect-priority"><code>priority</code> of type <span class="idlAttrType"><a>long</a></span>, nullable</dt><dd>
            The <a href="#dfn-custom-effect-priority" class="internalDFN">custom effect priority</a> property of the effect (see <a href="#execution-order-of-custom-effects" class="sectionRef">section 4.7.1 Execution order of custom effects</a>).
          </dd><dt id="widl-CustomEffect-clone"><code>clone</code> of type <span class="idlAttrType"><a href="#idl-def-CustomEffectCloneCallback" class="idlType"><code>CustomEffectCloneCallback</code></a></span>, nullable</dt><dd>
            <p>
              An optional callback method used to create an independent copy of
              this object.
            </p>
          </dd></dl></section><section id="methods-9"><h4><span class="secno">6.20.2 </span>Methods</h4><dl class="methods"><dt id="widl-CustomEffect-sample-void-double-timeFraction-double-currentIteration-AnimationTarget-target-double-previousTimeFraction"><code>sample</code></dt><dd>
            The callback used to produce an effect for the given timing
            information.
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">timeFraction</td><td class="prmType"><code><a>double</a></code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                The <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> for which to produce an effect.
                When this is <code>null</code>, the callback object <em class="rfc2119" title="should">should</em>
                remove the effect.
              </td></tr><tr><td class="prmName">currentIteration</td><td class="prmType"><code><a>double</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                The <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> beginning with zero corresponding
                to the first iteration.
              </td></tr><tr><td class="prmName">target</td><td class="prmType"><code><a href="#idl-def-AnimationTarget" class="idlType"><code>AnimationTarget</code></a></code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                The element or pseudo-element to which the effect should be
                applied, if any.
                When this method is called as a result of this object being
                associated with an <a href="#dfn-animation" class="internalDFN">Animation</a> object <var>A</var>, this
                value will be <code><var>A</var>.target</code>.
              </td></tr><tr><td class="prmName">previousTimeFraction</td><td class="prmType"><code><a>double</a></code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                <p>
                  The value of <var>timeFraction</var> that was passed to this
                  <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> when <code>sample</code> was previously
                  called in the context of sampling the same <a href="#dfn-animation" class="internalDFN">Animation</a>
                  that generated the current call.
                </p>
                <p>
                  If this <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> has not previously been called
                  within the context of sampling the same <a href="#dfn-animation" class="internalDFN">Animation</a> as
                  with the current call, or if the <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> was
                  <code>null</code> on the previous call, this parameter will be
                  <code>null</code>.
                </p>
              </td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></section>
        <p class="issue">
          Do we need to pass the <a href="#dfn-animation" class="internalDFN">Animation</a> to <code>sample</code> as
          well?
          If possible I'd prefer not to but it may necessary for some types of
          effect.
          Might be an additional parameter to add later if it proves
          necessary?
        </p>
        <pre class="idl"><span class="idlCallback" id="idl-def-CustomEffectCloneCallback">callback <span class="idlCallbackID">CustomEffectCloneCallback</span> = <span class="idlCallbackType"><a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a></span> ()</span>;
</pre><div class="idlCallbackDesc">
          <p>
            <a href="#idl-def-CustomEffectCloneCallback" class="idlType"><code>CustomEffectCloneCallback</code></a> is a type of callback function used
            to create an independent copy of a <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a>.
          </p>
          <p>
            When called, the <a href="http://www.w3.org/TR/WebIDL/#dfn-callback-this-value">callback
            this value</a> refers to <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> object to be cloned.
          </p>
        <div><em>No parameters.</em></div><div><em>Return type: </em><code><a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a></code></div></div>
      </section>
      <section id="the-timingevent-interface">
        <h3><span class="secno">6.21 </span>The <code>TimingEvent</code> interface</h3>
        <pre class="idl"><span class="idlInterface" id="idl-def-TimingEvent">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-TimingEvent--DOMString-type-TimingEventInit-eventInit">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">type</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-TimingEventInit" class="idlType"><code>TimingEventInit</code></a></span> <span class="idlParamName">eventInit</span></span>)</span>]
interface <span class="idlInterfaceID">TimingEvent</span> : <span class="idlSuperclass"><a>Event</a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a>?</span>        <span class="idlAttrName"><a href="#widl-TimingEvent-localTime">localTime</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a>?</span>        <span class="idlAttrName"><a href="#widl-TimingEvent-timelineTime">timelineTime</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>unsigned long</a>?</span> <span class="idlAttrName"><a href="#widl-TimingEvent-iterationIndex">iterationIndex</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>boolean</a>?</span>       <span class="idlAttrName"><a href="#widl-TimingEvent-seeked">seeked</a></span>;</span>
};</span>
</pre><section id="constructors-6"><h4><span class="secno">6.21.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-TimingEvent--DOMString-type-TimingEventInit-eventInit"><code>TimingEvent</code></dt><dd>
            Constructs a new <a href="#idl-def-TimingEvent" class="idlType"><code>TimingEvent</code></a> object as described in <a href="http://www.w3.org/TR/dom/#constructing-events">Constructing
            events</a> in [<cite><a class="bibref" href="#bib-DOM4">DOM4</a></cite>].
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">type</td><td class="prmType"><code><a>DOMString</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                The type of <a href="#dfn-timing-event" class="internalDFN">timing event</a> corresponding to one of the
                types defined in <a href="#types-of-timing-events" class="sectionRef">section 5.1 Types of timing events</a>.
              </td></tr><tr><td class="prmName">eventInit</td><td class="prmType"><code><a href="#idl-def-TimingEventInit" class="idlType"><code>TimingEventInit</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span></td><td class="prmDesc">
                The parameters of the new <a href="#idl-def-TimingEvent" class="idlType"><code>TimingEvent</code></a>.
              </td></tr></table></dd></dl></section><section id="attributes-12"><h4><span class="secno">6.21.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-TimingEvent-localTime"><code>localTime</code> of type <span class="idlAttrType"><a>double</a></span>, nullable</dt><dd>
            <p>
              The <a href="#dfn-event-local-time" class="internalDFN">event local time</a>.
            </p>
            
          </dd><dt id="widl-TimingEvent-timelineTime"><code>timelineTime</code> of type <span class="idlAttrType"><a>double</a></span>, nullable</dt><dd>
            <p>
              The <a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>.
            </p>
            
          </dd><dt id="widl-TimingEvent-iterationIndex"><code>iterationIndex</code> of type <span class="idlAttrType"><a>unsigned long</a></span>, nullable</dt><dd>
            The <a href="#dfn-event-iteration-index" class="internalDFN">event iteration index</a>.
          </dd><dt id="widl-TimingEvent-seeked"><code>seeked</code> of type <span class="idlAttrType"><a>boolean</a></span>, nullable</dt><dd>
            The <a href="#dfn-seeked-dispatch-flag" class="internalDFN">seeked dispatch flag</a>.
          </dd></dl></section>
        <p>
          The <a href="#idl-def-TimingEventInit" class="idlType"><code>TimingEventInit</code></a> dictionary type is used to specify the
          parameters when constructing a <a href="#idl-def-TimingEvent" class="idlType"><code>TimingEvent</code></a> object.
        </p>
        <pre class="idl"><span class="idlDictionary" id="idl-def-TimingEventInit">dictionary <span class="idlDictionaryID">TimingEventInit</span> {
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span>  <span class="idlMemberName"><a href="#widl-TimingEventInit-localTime">localTime</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span>  <span class="idlMemberName"><a href="#widl-TimingEventInit-timelineTime">timelineTime</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span>  <span class="idlMemberName"><a href="#widl-TimingEventInit-iterationIndex">iterationIndex</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>boolean</a>?</span> <span class="idlMemberName"><a href="#widl-TimingEventInit-seeked">seeked</a></span> = <span class="idlMemberValue">null</span>;</span>
};</span>
</pre><section id="dictionary-timingeventinit-members"><h4><span class="secno">6.21.3 </span>Dictionary <a class="idlType" href="#idl-def-TimingEventInit"><code>TimingEventInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-TimingEventInit-localTime"><code>localTime</code> of type <span class="idlMemberType"><a>double</a></span>, nullable, defaulting to <code>null</code></dt><dd></dd><dt id="widl-TimingEventInit-timelineTime"><code>timelineTime</code> of type <span class="idlMemberType"><a>double</a></span>, nullable, defaulting to <code>null</code></dt><dd></dd><dt id="widl-TimingEventInit-iterationIndex"><code>iterationIndex</code> of type <span class="idlMemberType"><a>double</a></span>, nullable, defaulting to <code>null</code></dt><dd></dd><dt id="widl-TimingEventInit-seeked"><code>seeked</code> of type <span class="idlMemberType"><a>boolean</a></span>, nullable, defaulting to <code>null</code></dt><dd></dd></dl></section>
      </section>
      <section id="extensions-to-the-document-interface">
        <h3><span class="secno">6.22 </span>Extensions to the <code>Document</code> interface</h3>
        <p>
          The following extensions are made to the <a href="http://www.w3.org/TR/dom/#interface-document">Document
          interface</a> defined in [<cite><a class="bibref" href="#bib-DOM4">DOM4</a></cite>].
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-Document">partial interface <span class="idlInterfaceID">Document</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a></span> <span class="idlAttrName"><a href="#widl-Document-timeline">timeline</a></span>;</span>
};</span>
</pre><section id="attributes-13"><h4><span class="secno">6.22.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-Document-timeline"><code>timeline</code> of type <span class="idlAttrType"><a href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a></span>, readonly</dt><dd>
            The <a title="Timeline interface" href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a> object representing
            the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a>.
          </dd></dl></section>
      </section>
      <section id="extensions-to-the-element-interface">
        <h3><span class="secno">6.23 </span>Extensions to the <code>Element</code> interface</h3>
        <p>
          To simplify the creation of <a href="#dfn-animation" class="internalDFN">Animation</a> objects for a given
          Element, the <a class="externalDFN" href="http://www.w3.org/TR/dom/#interface-element">Element</a>
          interface [<cite><a class="bibref" href="#bib-DOM4">DOM4</a></cite>] is extended as follows:
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-Element">partial interface <span class="idlInterfaceID">Element</span> {
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a></span>           <span class="idlMethName"><a href="#widl-Element-animate-Animation--AnimationEffect-or-CustomEffect-or-OneOrMoreKeyframes--effect--double-or-TimingInput--timing">animate</a></span> (
                                 <span class="idlParam"><span class="idlParamType">(<a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> or <a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a>)?</span> <span class="idlParamName">effect</span></span>, 
                                 <span class="idlParam">optional <span class="idlParamType">(<a>double</a> or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>)?</span> <span class="idlParamName">timing</span> = <span class="idlParamValue">null</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-Element-getCurrentAnimations-sequence-Animation">getCurrentAnimations</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-Player" class="idlType"><code>Player</code></a>&gt;</span>    <span class="idlMethName"><a href="#widl-Element-getCurrentPlayers-sequence-Player">getCurrentPlayers</a></span> ();</span>
};</span>
</pre><section id="methods-10"><h4><span class="secno">6.23.1 </span>Methods</h4><dl class="methods"><dt id="widl-Element-animate-Animation--AnimationEffect-or-CustomEffect-or-OneOrMoreKeyframes--effect--double-or-TimingInput--timing"><code>animate</code></dt><dd>
            <p>
              Creates a new <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object
              whose <a href="#dfn-target-element" class="internalDFN">target element</a> is the Element object on which the
              method is called, and calls
              the <a href="#widl-Timeline-play-Player-TimedItem-source"><code>play</code></a>
              method of the <a title="Timeline interface" href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a> object of
              the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> of the <a href="http://www.w3.org/TR/dom/#concept-node-document">node
              document</a> [<cite><a class="bibref" href="#bib-DOM4">DOM4</a></cite>] of the element passing the newly created
              <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> as the argument to
              the method.
            </p>
            <p>
              The following code fragment:
            </p>
            <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> anim <span class="sh_symbol">=</span> elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">(</span><span class="sh_cbracket">{</span> opacity<span class="sh_symbol">:</span> <span class="sh_string">'0'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">2</span><span class="sh_symbol">);</span></pre>
            <p>
              is equivalent to:
            </p>
            <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> anim <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> opacity<span class="sh_symbol">:</span> <span class="sh_string">'0'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">2</span><span class="sh_symbol">);</span>
elem<span class="sh_symbol">.</span>ownerDocument<span class="sh_symbol">.</span>timeline<span class="sh_symbol">.</span><span class="sh_function">play</span><span class="sh_symbol">(</span>anim<span class="sh_symbol">);</span></pre>
            <p>
              Returns the newly created <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object.
            </p>
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">effect</td><td class="prmType"><code>(<a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> or <a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a>)</code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                The effect to apply.
                This value is passed to the <a href="#widl-ctor-Animation--AnimationTarget-element--AnimationEffect-or-CustomEffect-or-OneOrMoreKeyframes--effect--unrestricted-double-or-TimingInput--timing">Animation
                constructor</a> as the <var>effect</var> parameter and has the
                same interpretation as defined for that constructor.
              </td></tr><tr><td class="prmName">timing</td><td class="prmType"><code>(<a>double</a> or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>)</code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span> (<code>null</code>)</td><td class="prmDesc">
                The timing parameters of the animation.
                This value is passed to the <a href="#widl-ctor-Animation--AnimationTarget-element--AnimationEffect-or-CustomEffect-or-OneOrMoreKeyframes--effect--unrestricted-double-or-TimingInput--timing">Animation
                constructor</a> as the <var>timing</var> parameter and has the
                same interpretation as defined for that constructor.
              </td></tr></table><div><em>Return type: </em><code><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a></code></div></dd><dt id="widl-Element-getCurrentAnimations-sequence-Animation"><code>getCurrentAnimations</code></dt><dd>
            <p>
              Returns the set of <a href="#dfn-current" class="internalDFN">current</a> <a title="Animation
              interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> objects that have an <a href="#dfn-animation-effect" class="internalDFN">animation
              effect</a> whose <a>target</a> is the Element on which this method
              is called.
              Note that this does <em>not</em> include
              <a href="#idl-def-PseudoElementReference" class="idlType"><code>PseudoElementReference</code></a>s whose <code>element</code>
              attribute refers to this Element.
            </p>
            <p>
              The returned list of <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a>
              objects is sorted by their associated <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>
              using the procedure defined for sorting <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>
              in <a href="#the-animation-stack" class="sectionRef">section 4.2.1 The animation stack</a>.
            </p>
            <div class="note">
              <p>
                Note that the definition of a <a href="#dfn-current" class="internalDFN">current</a> <a href="#dfn-animation" class="internalDFN">animation</a>
                does not include those <a href="#dfn-animation" class="internalDFN">animations</a> whose
                <a href="#dfn-local-time" class="internalDFN">local time</a> falls <em>after</em> the <a href="#dfn-active-interval" class="internalDFN">active
                interval</a> but which are still <a href="#dfn-in-effect" class="internalDFN">in effect</a> due to
                a <a href="#dfn-fill-mode" class="internalDFN">fill mode</a>.
                As a result such <a href="#dfn-animation" class="internalDFN">animations</a> are <em>not</em> returned by
                this method.
              </p>
              <p>
                This is because in order to return such <a title="animation" href="#dfn-animation" class="internalDFN">animations</a>, user agents
                would be required to maintain all <a title="animation" href="#dfn-animation" class="internalDFN">animations</a> with a forwards
                <a title="fill mode" href="#dfn-fill-mode" class="internalDFN">fill</a> indefinitely.
                As a result the resources consumed by an animated document would
                steadily accumulate over time.
              </p>
            </div>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code>sequence&lt;<a></a><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a>&gt;</code></div></dd><dt id="widl-Element-getCurrentPlayers-sequence-Player"><code>getCurrentPlayers</code></dt><dd>
            <p>
              Returns the set of <a title="Player interface" href="#idl-def-Player" class="idlType"><code>Player</code></a> objects
              whose <a href="#dfn-source-content" class="internalDFN">source content</a> is <a href="#dfn-current" class="internalDFN">current</a> and contains at
              least one <a href="#dfn-animation" class="internalDFN">animation</a> whose <a href="#dfn-target-element" class="internalDFN">target element</a> is this
              Element.
            </p>
            <p>
              If this Element is the <a href="#dfn-target-element" class="internalDFN">target element</a> of two or more <a title="animation" href="#dfn-animation" class="internalDFN">animations</a> which are associated with the
              same <a href="#dfn-player" class="internalDFN">player</a>, the corresponding <a title="Player interface" href="#idl-def-Player" class="idlType"><code>Player</code></a> object will still only appear
              in the returned list once.
            </p>
            <p>
              The returned list is sorted in increasing order by <a href="#dfn-player-sequence-number" class="internalDFN">player
              sequence number</a>.
            </p>
            <div class="feedbackWanted">
              <p>
                The primary use case for this method is an application that
                wants to increase the speed of all animations targetting
                a particular element by a factor of 2 (not sure why and never
                mind that this will affect all sorts of other elements too).
              </p>
              <p>
                With only <code>getCurrentAnimations</code> a na&#xef;ve author might
                write:
              </p>
              <pre class="example sh_javascript sh_sourceCode">elem<span class="sh_symbol">.</span><span class="sh_function">getCurrentAnimations</span><span class="sh_symbol">().</span><span class="sh_function">forEach</span><span class="sh_symbol">(</span>
  <span class="sh_keyword">function</span><span class="sh_symbol">(</span>anim<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    anim<span class="sh_symbol">.</span>player<span class="sh_symbol">.</span>playbackRate <span class="sh_symbol">*=</span> <span class="sh_number">2</span><span class="sh_symbol">;</span>
  <span class="sh_cbracket">}</span>
<span class="sh_symbol">);</span></pre>
              <p>
                However, if <code>elem</code> is the <a href="#dfn-target-element" class="internalDFN">target element</a> for
                two animations that have the same player, then those animations
                will be sped up by a factor of 4.
              </p>
              <p>
                Instead the author needs to generate a unique list of players
                first, hence this method.
              </p>
              <p>
                Is this kind of situation common enough to warrant this method?
                Or is it likely that when performing this kind of operation
                you're mostly working with single animations and not timing
                groups (as otherwise this operation could affect many other
                elements)?
              </p>
              <p>
                Your feedback is most welcome at <a href="mailto:public-fx@w3.org">public-fx@w3.org</a>, subject
                <em>[web-animations] &#x2026;</em>.
              </p>
            </div>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code>sequence&lt;<a></a><a href="#idl-def-Player" class="idlType"><code>Player</code></a>&gt;</code></div></dd></dl></section>
      </section>
      <section id="script-execution-and-live-updates-to-the-model">
        <h3><span class="secno">6.24 </span>Script execution and live updates to the model</h3>
        <p>
          The iteraction between script execution and the state of
          the model is as follows:
        </p>
        <ul>
          <li>
            <p>
              Changes made to the Web Animations model via the script interface
              are reflected immediately in the values returned by the interfaces
              defined in this specification.
            </p>
            <p>
              Similarly, methods that operate on the current state of the model
              such as pausing or reversing are applied to a fully-updated timing
              model, that is, after all previous modifications have been
              incorporated.
            </p>
            <div class="informative informative-bg">
              <p><em>This section is non-normative.</em></p><p>
                For example, if the <a title="Player interface" href="#idl-def-Player" class="idlType"><code>Player</code></a>
                associated with an
                <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a>'s is <a title="seeking" href="#dfn-seeking" class="internalDFN">seeked</a> via the <abbr title="Application Programming Interface">API</abbr>,
                the value returned when querying the
                animation's <code>startTime</code> will reflect updated state of
                the model immediately.
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_comment">// Initially anim's startTime is 3</span>
anim<span class="sh_symbol">.</span>player<span class="sh_symbol">.</span>currentTime <span class="sh_symbol">+=</span> <span class="sh_number">2</span><span class="sh_symbol">;</span>
<span class="sh_function">alert</span><span class="sh_symbol">(</span>anim<span class="sh_symbol">.</span>startTime<span class="sh_symbol">);</span> <span class="sh_comment">// Displays '5'</span></pre>
              <p>
                The same concept applies to more complex modifications of the
                Web Animations model such as adding and removing children from
                a <a href="#idl-def-TimingGroup" class="idlType"><code>TimingGroup</code></a>.
              </p>
            </div>
          </li>
          <li>
            <p>
              Changes to the model other than <a title="seeking" href="#dfn-seeking" class="internalDFN">seek operations</a> do <em>not</em> cause
              <a href="#timing-events">timing events</a> to be queued
              immediately.
              Instead, such events are queued upon the next sample as defined
              in <a href="#event-dispatch" class="sectionRef">section 5.7 Event dispatch</a>.
            </p>
            <p>
              The behavior of events with relation to seek operations is defined
              in <a href="#event-dispatch-and-seeking-a-player" class="sectionRef">section 5.7.2 Event dispatch and seeking a player</a>.
            </p>
            <p>
              Operations such as <a href="#updating-the-playback-rate">updating
              the playback rate of a player</a> that involve performing a <a title="seeking" href="#dfn-seeking" class="internalDFN">seek</a> operation cause events to be queued
              immediately.
            </p>
            <div class="informative informative-bg">
              <p><em>This section is non-normative.</em></p><p>
                For example, if a series of modifications to the timing model in
                a single script block causes a <a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>'s <a>item
                time</a> to jump from being outside the <a href="#dfn-active-interval" class="internalDFN">active interval</a>,
                to inside the interval, and then outside again, no events are
                fired as in the following example.
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_comment">// anim is due to start in 3s</span>
anim<span class="sh_symbol">.</span>onstart <span class="sh_symbol">=</span> <span class="sh_keyword">function</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span> <span class="sh_function">alert</span><span class="sh_symbol">(</span><span class="sh_string">"started"</span><span class="sh_symbol">);</span> <span class="sh_cbracket">}</span><span class="sh_symbol">;</span>
<span class="sh_comment">// Accelerate the parent causing anim to enter its active interval</span>
<span class="sh_comment">// (Note we are updating the playback rate of a *timed item* not a player)</span>
anim<span class="sh_symbol">.</span>parent<span class="sh_symbol">.</span>playbackRate <span class="sh_symbol">*=</span> <span class="sh_number">2</span><span class="sh_symbol">;</span>
<span class="sh_comment">// Adjust the start delay of anim such that it is no longer in its</span>
<span class="sh_comment">// active interval</span>
anim<span class="sh_symbol">.</span>timing<span class="sh_symbol">.</span>startDelay <span class="sh_symbol">=</span> <span class="sh_predef_var">Infinity</span><span class="sh_symbol">;</span>
<span class="sh_comment">// Result: no alert is shown</span></pre>
            </div>
          </li>
          <li>
            <p>
              Modifications to the model using the script interface do not cause
              the properties of the target element to be updated and nor is any
              <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> called until the next sample has been
              performed at some time after the current script block completes
              execution.
            </p>
            <div class="informative informative-bg">
              <p><em>This section is non-normative.</em></p><p>
                For example, if the used style of an element is queried
                immediately after applying a new <a href="#dfn-animation" class="internalDFN">Animation</a> to that
                element, the result of the new animation will <em>not</em> be
                incorporated in the value returned.
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_comment">// Set opacity to 0 immediately</span>
elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">(</span><span class="sh_cbracket">{</span> opacity<span class="sh_symbol">:</span> <span class="sh_string">'0'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">);</span>
<span class="sh_function">alert</span><span class="sh_symbol">(</span>window<span class="sh_symbol">.</span><span class="sh_function">getComputedStyle</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">).</span>opacity<span class="sh_symbol">);</span>
<span class="sh_comment">// Displays '1'</span></pre>
            </div>
            <p class="issue">
              I'm unsure if this is the desired behavior for actions such as
              <a href="#dfn-seeking" class="internalDFN">seeking</a> and <code>play()</code> (and thus
              <code>animate()</code>).
              Gecko, for example, forces a synchronous sample when a seek is
              performed.
              This certainly makes testing simpler but I'm not sure if this is
              a good idea or not.
            </p>
          </li>
          <li>
            <p>
              The value returned by the <code>currentTime</code> attribute of
              a <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> will not change within a script block.
            </p>
            <div class="informative informative-bg">
              <p><em>This section is non-normative.</em></p><p>
                For example, querying the <code>currentTime</code> twice within
                a long block of code that is executed in the same script block
                will return the same value as shown in the following example.
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> a <span class="sh_symbol">=</span> document<span class="sh_symbol">.</span>timeline<span class="sh_symbol">.</span>currentTime<span class="sh_symbol">;</span>
<span class="sh_comment">// ... many lines of code ...</span>
<span class="sh_keyword">var</span> b <span class="sh_symbol">=</span> document<span class="sh_symbol">.</span>timeline<span class="sh_symbol">.</span>currentTime<span class="sh_symbol">;</span>
<span class="sh_function">alert</span><span class="sh_symbol">(</span>b <span class="sh_symbol">-</span> a<span class="sh_symbol">);</span> <span class="sh_comment">// Displays 0</span></pre>
            </div>
            <p class="issue">
              We may introduce timelines that can be started programmatically
              (e.g. for SVG).
              In such a case, the <code>currentTime</code> should probably
              become zero <em>immediately</em> which would violate this
              condition.
              If we do indeed want that then we should probably spec it to force
              a synchronous sample at that point and note it as an exception
              here.
            </p>
          </li>
        </ul>
      </section>
    </section>

    <section id="integration-with-media-fragments">
      <!--OddPage--><h2><span class="secno">7. </span>Integration with Media Fragments</h2>
      <p>
        The Media Fragments specification [<cite><a class="bibref" href="#bib-MEDIA-FRAGMENTS">MEDIA-FRAGMENTS</a></cite>] defines a means
        for addressing a temporal range of a media resource.
        The application of media fragments depends on the MIME type of the
        resource on which they are specified.
        For resources with the <a href="http://www.w3.org/TR/SVG/intro.html#MIMEType">SVG MIME type</a>
        [<cite><a class="bibref" href="#bib-SVG11">SVG11</a></cite>], the application of temporal parameters is defined in the <a href="svg-integration.html">Web Animations and SVG Integration</a>
        specification.
      </p>
      <p class="note">
        Note that media fragments are defined to operate on resources based on
        their MIME type.
        As a result, temporal addressing may not be supported in all situations
        where Web Animations content is used.
      </p>
    </section>

    <section id="interaction-with-page-display">
      <!--OddPage--><h2><span class="secno">8. </span>Interaction with page display</h2>
      <p>
        HTML permits user agents to store <a href="http://www.w3.org/TR/html51/browsers.html#an-entry-with-persisted-user-state">user-agent
          defined state</a> along with a
        <a href="http://www.w3.org/TR/html51/browsers.html#session-history-entry">session
        history entry</a> so that as a user navigates between pages, the
        previous state of the page can be restored including state such as
        scroll position [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
      </p>
      <p>
        User agents that pause and resume <a href="http://www.w3.org/TR/html51/embedded-content-0.html#media-element">media
        elements</a> when the referencing document is
        unloaded and traversed,
        are encouraged to apply consistent handling to documents containing Web
        Animations content.
        If provided, this behavior <em class="rfc2119" title="should">should</em> be achieved by applying a time drift
        to any <a href="#dfn-timeline" class="internalDFN">timelines</a> bound to the <a href="#dfn-global-clock" class="internalDFN">global clock</a>.
      </p>
    </section>

    <section id="implementation-requirements">
      <!--OddPage--><h2><span class="secno">9. </span>Implementation requirements</h2>
      <section id="precision-of-time-values">
        <h3><span class="secno">9.1 </span>Precision of time values</h3>
        <p>
          The internal representation of time values is implementation dependant
          however, it is <em class="rfc2119" title="recommended">recommended</em> that user agents be able to represent input
          time values with microsecond precision so that 0.000001 is
          distinguishable from 0.0.
        </p>
      </section>
      <section id="conformance-criteria">
        <h3><span class="secno">9.2 </span>Conformance criteria</h3>
        <p>
          This specification defines an abstract model for animation and, as
          such, for user agents that do not support scripting, there are no
          conformance criteria since there is no testable surface area.
        </p>
        <p>
          User agents that do not support scripting, however, may implement
          additional technologies defined in terms of this specification in
          which case the definitions provided in this specification will form
          part of the conformance criteria of the additional technology.
        </p>
        <p>
          A <dfn id="dfn-conforming-scripted-web-animations-user-agent">conforming scripted Web Animations user agent</dfn> is a user
          agent that implements the <abbr title="Application Programming Interface">API</abbr> defined in <a href="#script-interface" class="sectionRef">section 6. Script interface</a> including dispatching
          events as defined in <a href="#timing-events" class="sectionRef">section 5. Timing events</a>.
        </p>
      </section>
    </section>

    <section class="appendix" id="webidl-ref">
      <!--OddPage--><h2><span class="secno">A. </span>Interface summary</h2>
    <pre class="idl"><span class="idlInterface" id="idl-def-Timeline-s">interface <span class="idlInterfaceID">Timeline</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>double</a>?</span> <span class="idlAttrName"><a href="#widl-Timeline-currentTime">currentTime</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-Player" class="idlType"><code>Player</code></a></span>           <span class="idlMethName"><a href="#widl-Timeline-play-Player-TimedItem-source">play</a></span> (<span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span> <span class="idlParamName">source</span> = <span class="idlParamValue">null</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-Player" class="idlType"><code>Player</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-Timeline-getCurrentPlayers-sequence-Player">getCurrentPlayers</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>double</a>?</span>          <span class="idlMethName"><a href="#widl-Timeline-toTimelineTime-double-double-otherTime-Timeline-other">toTimelineTime</a></span> (<span class="idlParam"><span class="idlParamType"><a>double</a></span> <span class="idlParamName">otherTime</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a></span> <span class="idlParamName">other</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>double</a>?</span>          <span class="idlMethName"><a href="#widl-Timeline-toTimelineTime-double-Event-event">toTimelineTime</a></span> (<span class="idlParam"><span class="idlParamType"><a>Event</a></span> <span class="idlParamName">event</span></span>);</span>
};</span>

<span class="idlInterface" id="idl-def-Player-s">interface <span class="idlInterfaceID">Player</span> {
<span class="idlAttribute">             attribute <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span> <span class="idlAttrName"><a href="#widl-Player-source">source</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a></span>   <span class="idlAttrName"><a href="#widl-Player-timeline">timeline</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>double</a></span>     <span class="idlAttrName"><a href="#widl-Player-startTime">startTime</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>double</a></span>     <span class="idlAttrName"><a href="#widl-Player-currentTime">currentTime</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>double</a></span>     <span class="idlAttrName"><a href="#widl-Player-playbackRate">playbackRate</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>boolean</a></span>    <span class="idlAttrName"><a href="#widl-Player-paused">paused</a></span>;</span>
};</span>

<span class="idlInterface" id="idl-def-TimedItem-s">interface <span class="idlInterfaceID">TimedItem</span> : <span class="idlSuperclass"><a>EventTarget</a></span> {
<span class="idlSectionComment">    // Playback state</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>double</a>?</span>             <span class="idlAttrName"><a href="#widl-TimedItem-localTime">localTime</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned long</a>?</span>      <span class="idlAttrName"><a href="#widl-TimedItem-currentIteration">currentIteration</a></span>;</span>
<span class="idlSectionComment">
    // Specified timing</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-Timing" class="idlType"><code>Timing</code></a></span>              <span class="idlAttrName"><a href="#widl-TimedItem-specified">specified</a></span>;</span>
<span class="idlSectionComment">
    // Calculated timing</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>double</a></span>              <span class="idlAttrName"><a href="#widl-TimedItem-startTime">startTime</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unrestricted double</a></span> <span class="idlAttrName"><a href="#widl-TimedItem-iterationDuration">iterationDuration</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unrestricted double</a></span> <span class="idlAttrName"><a href="#widl-TimedItem-activeDuration">activeDuration</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unrestricted double</a></span> <span class="idlAttrName"><a href="#widl-TimedItem-endTime">endTime</a></span>;</span>
<span class="idlSectionComment">
    // Timing hierarchy</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-TimingGroup" class="idlType"><code>TimingGroup</code></a>?</span>        <span class="idlAttrName"><a href="#widl-TimedItem-parent">parent</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span>          <span class="idlAttrName"><a href="#widl-TimedItem-previousSibling">previousSibling</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span>          <span class="idlAttrName"><a href="#widl-TimedItem-nextSibling">nextSibling</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-TimedItem-before-void-TimedItem...-items">before</a></span> (<span class="idlParam"><span class="idlParamType"><a>TimedItem...</a></span> <span class="idlParamName">items</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-TimedItem-after-void-TimedItem...-items">after</a></span> (<span class="idlParam"><span class="idlParamType"><a>TimedItem...</a></span> <span class="idlParamName">items</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-TimedItem-replace-void-TimedItem...-items">replace</a></span> (<span class="idlParam"><span class="idlParamType"><a>TimedItem...</a></span> <span class="idlParamName">items</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-TimedItem-remove-void">remove</a></span> ();</span>
<span class="idlSectionComment">
    // Associated player</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-Player" class="idlType"><code>Player</code></a>?</span>             <span class="idlAttrName"><a href="#widl-TimedItem-player">player</a></span>;</span>
<span class="idlSectionComment">
    // Event callbacks</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>EventHandler</a></span>        <span class="idlAttrName"><a href="#widl-TimedItem-onstart">onstart</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>EventHandler</a></span>        <span class="idlAttrName"><a href="#widl-TimedItem-oniteration">oniteration</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>EventHandler</a></span>        <span class="idlAttrName"><a href="#widl-TimedItem-onend">onend</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>EventHandler</a></span>        <span class="idlAttrName"><a href="#widl-TimedItem-oncancel">oncancel</a></span>;</span>
};</span>

<span class="idlInterface" id="idl-def-Timing-s">interface <span class="idlInterfaceID">Timing</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-Timing-startDelay">startDelay</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a></span>                           <span class="idlAttrName"><a href="#widl-Timing-fillMode">fillMode</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-Timing-iterationStart">iterationStart</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>unrestricted double</a></span>                <span class="idlAttrName"><a href="#widl-Timing-iterationCount">iterationCount</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType">(<a>unrestricted double</a> or <a>DOMString</a>)</span> <span class="idlAttrName"><a href="#widl-Timing-iterationDuration">iterationDuration</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType">(<a>unrestricted double</a> or <a>DOMString</a>)</span> <span class="idlAttrName"><a href="#widl-Timing-activeDuration">activeDuration</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-Timing-playbackRate">playbackRate</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a></span>                  <span class="idlAttrName"><a href="#widl-Timing-direction">direction</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span>                          <span class="idlAttrName"><a href="#widl-Timing-timingFunction">timingFunction</a></span>;</span>
};</span>

<span class="idlDictionary" id="idl-def-TimingInput-s">dictionary <span class="idlDictionaryID">TimingInput</span> {
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-TimingInput-startDelay">startDelay</a></span> = <span class="idlMemberValue">0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a></span>                           <span class="idlMemberName"><a href="#widl-TimingInput-fillMode">fillMode</a></span> = <span class="idlMemberValue">"forwards"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-TimingInput-iterationStart">iterationStart</a></span> = <span class="idlMemberValue">0.0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>unrestricted double</a></span>                <span class="idlMemberName"><a href="#widl-TimingInput-iterationCount">iterationCount</a></span> = <span class="idlMemberValue">1.0</span>;</span>
<span class="idlMember">    <span class="idlMemberType">(<a>unrestricted double</a> or <a>DOMString</a>)</span> <span class="idlMemberName"><a href="#widl-TimingInput-iterationDuration">iterationDuration</a></span> = <span class="idlMemberValue">"auto"</span>;</span>
<span class="idlMember">    <span class="idlMemberType">(<a>unrestricted double</a> or <a>DOMString</a>)</span> <span class="idlMemberName"><a href="#widl-TimingInput-activeDuration">activeDuration</a></span> = <span class="idlMemberValue">"auto"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-TimingInput-playbackRate">playbackRate</a></span> = <span class="idlMemberValue">1.0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a></span>                  <span class="idlMemberName"><a href="#widl-TimingInput-direction">direction</a></span> = <span class="idlMemberValue">"normal"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span>                          <span class="idlMemberName"><a href="#widl-TimingInput-timingFunction">timingFunction</a></span> = <span class="idlMemberValue">"linear"</span>;</span>
};</span>

<span class="idlEnum" id="idl-def-FillMode-s">enum <span class="idlEnumName">FillMode</span> {<span class="idlEnumValues"> "<a href="#widl-FillMode-none">none</a>", "<a href="#widl-FillMode-forwards">forwards</a>", "<a href="#widl-FillMode-backwards">backwards</a>", "<a href="#widl-FillMode-both">both</a>" </span>};</span>

<span class="idlEnum" id="idl-def-PlaybackDirection-s">enum <span class="idlEnumName">PlaybackDirection</span> {<span class="idlEnumValues"> "<a href="#widl-PlaybackDirection-normal">normal</a>", "<a href="#widl-PlaybackDirection-reverse">reverse</a>", "<a href="#widl-PlaybackDirection-alternate">alternate</a>", "<a href="#widl-PlaybackDirection-alternate-reverse">alternate-reverse</a>" </span>};</span>

<span class="idlInterface" id="idl-def-TimingGroup-s">interface <span class="idlInterfaceID">TimingGroup</span> : <span class="idlSuperclass"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-TimedItemList" class="idlType"><code>TimedItemList</code></a></span> <span class="idlAttrName"><a href="#widl-TimingGroup-children">children</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span>    <span class="idlAttrName"><a href="#widl-TimingGroup-firstChild">firstChild</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span>    <span class="idlAttrName"><a href="#widl-TimingGroup-lastChild">lastChild</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-TimingGroup-prepend-void-TimedItem...-items">prepend</a></span> (<span class="idlParam"><span class="idlParamType"><a>TimedItem...</a></span> <span class="idlParamName">items</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-TimingGroup-append-void-TimedItem...-items">append</a></span> (<span class="idlParam"><span class="idlParamType"><a>TimedItem...</a></span> <span class="idlParamName">items</span></span>);</span>
};</span>

<span class="idlInterface" id="idl-def-TimedItemList-s">interface <span class="idlInterfaceID">TimedItemList</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned long</a></span> <span class="idlAttrName"><a href="#widl-TimedItemList-length">length</a></span>;</span>
<span class="idlMethod">    getter <span class="idlMethType"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>?</span> <span class="idlMethName"><a href="#widl-TimedItemList-item-TimedItem-unsigned-long-index">item</a></span> (<span class="idlParam"><span class="idlParamType"><a>unsigned long</a></span> <span class="idlParamName">index</span></span>);</span>
};</span>

<span class="idlInterface" id="idl-def-ParGroup-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-ParGroup--sequence-TimedItem--children--unrestricted-double-or-TimingInput--timing">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">sequence&lt;<a></a><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>&gt;?</span> <span class="idlParamName">children</span></span>, 
              <span class="idlParam">optional <span class="idlParamType">(<a>unrestricted double</a> or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>)?</span> <span class="idlParamName">timing</span> = <span class="idlParamValue">null</span></span>)</span>]
interface <span class="idlInterfaceID">ParGroup</span> : <span class="idlSuperclass"><a href="#idl-def-TimingGroup" class="idlType"><code>TimingGroup</code></a></span> {
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-ParGroup" class="idlType"><code>ParGroup</code></a></span> <span class="idlMethName"><a href="#widl-ParGroup-clone-ParGroup">clone</a></span> ();</span>
};</span>

<span class="idlInterface" id="idl-def-SeqGroup-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-SeqGroup--sequence-TimedItem--children--unrestricted-double-or-TimingInput--timing">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">sequence&lt;<a></a><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a>&gt;?</span> <span class="idlParamName">children</span></span>, 
              <span class="idlParam">optional <span class="idlParamType">(<a>unrestricted double</a> or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>)?</span> <span class="idlParamName">timing</span> = <span class="idlParamValue">null</span></span>)</span>]
interface <span class="idlInterfaceID">SeqGroup</span> : <span class="idlSuperclass"><a href="#idl-def-TimingGroup" class="idlType"><code>TimingGroup</code></a></span> {
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-SeqGroup" class="idlType"><code>SeqGroup</code></a></span> <span class="idlMethName"><a href="#widl-SeqGroup-clone-SeqGroup">clone</a></span> ();</span>
};</span>

<span class="idlInterface" id="idl-def-Animation-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-Animation--AnimationTarget-element--AnimationEffect-or-CustomEffect-or-OneOrMoreKeyframes--effect--unrestricted-double-or-TimingInput--timing">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-AnimationTarget" class="idlType"><code>AnimationTarget</code></a>?</span> <span class="idlParamName">element</span></span>, 
              <span class="idlParam"><span class="idlParamType">(<a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> or <a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a>)?</span> <span class="idlParamName">effect</span></span>, 
              <span class="idlParam">optional <span class="idlParamType">(<a>unrestricted double</a> or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>)?</span> <span class="idlParamName">timing</span> = <span class="idlParamValue">null</span></span>)</span>]
interface <span class="idlInterfaceID">Animation</span> : <span class="idlSuperclass"><a href="#idl-def-TimedItem" class="idlType"><code>TimedItem</code></a></span> {
<span class="idlAttribute">             attribute <span class="idlAttrType">(<a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a>)?</span> <span class="idlAttrName"><a href="#widl-Animation-effect">effect</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationTarget" class="idlType"><code>AnimationTarget</code></a>?</span>                   <span class="idlAttrName"><a href="#widl-Animation-target">target</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a></span> <span class="idlMethName"><a href="#widl-Animation-clone-Animation">clone</a></span> ();</span>
};</span>

<span class="idlInterface" id="idl-def-PseudoElementReference-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-PseudoElementReference--Element-element-DOMString-pseudoElement">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-Element" class="idlType"><code>Element</code></a></span> <span class="idlParamName">element</span></span>, <span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">pseudoElement</span></span>)</span>]
interface <span class="idlInterfaceID">PseudoElementReference</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-Element" class="idlType"><code>Element</code></a></span>   <span class="idlAttrName"><a href="#widl-PseudoElementReference-element">element</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span> <span class="idlAttrName"><a href="#widl-PseudoElementReference-pseudoElement">pseudoElement</a></span>;</span>
};</span>

<span class="idlTypedef" id="idl-def-AnimationTarget-s">typedef <span class="idlTypedefType">(<a href="#idl-def-Element" class="idlType"><code>Element</code></a> or <a href="#idl-def-PseudoElementReference" class="idlType"><code>PseudoElementReference</code></a>)</span> <span class="idlTypedefID">AnimationTarget</span>;</span>

<span class="idlInterface" id="idl-def-AnimationEffect-s">interface <span class="idlInterfaceID">AnimationEffect</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-AccumulateOperation" class="idlType"><code>AccumulateOperation</code></a></span> <span class="idlAttrName"><a href="#widl-AnimationEffect-accumulate">accumulate</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></span> <span class="idlMethName"><a href="#widl-AnimationEffect-clone-AnimationEffect">clone</a></span> ();</span>
};</span>

<span class="idlEnum" id="idl-def-AccumulateOperation-s">enum <span class="idlEnumName">AccumulateOperation</span> {<span class="idlEnumValues"> "<a href="#widl-AccumulateOperation-sum">sum</a>", "<a href="#widl-AccumulateOperation-none">none</a>" </span>};</span>

<span class="idlEnum" id="idl-def-CompositeOperation-s">enum <span class="idlEnumName">CompositeOperation</span> {<span class="idlEnumValues"> "<a href="#widl-CompositeOperation-replace">replace</a>", "<a href="#widl-CompositeOperation-add">add</a>" </span>};</span>

<span class="idlInterface" id="idl-def-KeyframeAnimationEffect-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-KeyframeAnimationEffect--OneOrMoreKeyframes-frames-CompositeOperation-composite-AccumulateOperation-accumulate">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a></span> <span class="idlParamName">frames</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span> <span class="idlParamName">composite</span> = <span class="idlParamValue">"replace"</span></span>, 
              <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-AccumulateOperation" class="idlType"><code>AccumulateOperation</code></a></span> <span class="idlParamName">accumulate</span> = <span class="idlParamValue">"none"</span></span>)</span>]
interface <span class="idlInterfaceID">KeyframeAnimationEffect</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span> <span class="idlAttrName"><a href="#widl-KeyframeAnimationEffect-composite">composite</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-KeyframeAnimationEffect-getFrames-sequence-Keyframe">getFrames</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>               <span class="idlMethName"><a href="#widl-KeyframeAnimationEffect-setFrames-void-OneOrMoreKeyframes-frames">setFrames</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a></span> <span class="idlParamName">frames</span></span>);</span>
};</span>

<span class="idlDictionary" id="idl-def-Keyframe-s">dictionary <span class="idlDictionaryID">Keyframe</span> {
<span class="idlSectionComment">    // ... property-value pairs ...</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span>             <span class="idlMemberName"><a href="#widl-Keyframe-offset">offset</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a>?</span> <span class="idlMemberName"><a href="#widl-Keyframe-composite">composite</a></span> = <span class="idlMemberValue">null</span>;</span>
};</span>

<span class="idlTypedef" id="idl-def-OneOrMoreKeyframes-s">typedef <span class="idlTypedefType">(<a href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> or sequence&lt;<a></a><a href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a>&gt;)</span> <span class="idlTypedefID">OneOrMoreKeyframes</span>;</span>

<span class="idlInterface" id="idl-def-PathAnimationEffect-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-PathAnimationEffect---DOMString-or-SVGPathSegList--path-AutoRotationMode-autoRotate-double-angle-CompositeOperation-composite">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">(<a>DOMString</a> or <a>SVGPathSegList</a>)</span> <span class="idlParamName">path</span></span>, 
              <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-AutoRotationMode" class="idlType"><code>AutoRotationMode</code></a></span> <span class="idlParamName">autoRotate</span> = <span class="idlParamValue">"none"</span></span>, <span class="idlParam">optional <span class="idlParamType"><a>double</a></span> <span class="idlParamName">angle</span> = <span class="idlParamValue">0</span></span>, 
              <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span> <span class="idlParamName">composite</span> = <span class="idlParamValue">"replace"</span></span>)</span>]
interface <span class="idlInterfaceID">PathAnimationEffect</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>SVGPathSegList</a></span>     <span class="idlAttrName"><a href="#widl-PathAnimationEffect-segments">segments</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>AutoRotationFlag</a></span>   <span class="idlAttrName"><a href="#widl-PathAnimationEffect-autoRotate">autoRotate</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>             <span class="idlAttrName"><a href="#widl-PathAnimationEffect-angle">angle</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span> <span class="idlAttrName"><a href="#widl-PathAnimationEffect-composite">composite</a></span>;</span>
};</span>

<span class="idlEnum" id="idl-def-AutoRotationMode-s">enum <span class="idlEnumName">AutoRotationMode</span> {<span class="idlEnumValues"> "<a href="#widl-AutoRotationMode-auto-rotate">auto-rotate</a>", "<a href="#widl-AutoRotationMode-none">none</a>" </span>};</span>

<span class="idlInterface" id="idl-def-CustomEffect-s">callback interface <span class="idlInterfaceID">CustomEffect</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>long</a>?</span>                      <span class="idlAttrName"><a href="#widl-CustomEffect-priority">priority</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-CustomEffectCloneCallback" class="idlType"><code>CustomEffectCloneCallback</code></a>?</span> <span class="idlAttrName"><a href="#widl-CustomEffect-clone">clone</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-CustomEffect-sample-void-double-timeFraction-double-currentIteration-AnimationTarget-target-double-previousTimeFraction">sample</a></span> (<span class="idlParam"><span class="idlParamType"><a>double</a>?</span> <span class="idlParamName">timeFraction</span></span>, <span class="idlParam"><span class="idlParamType"><a>double</a></span> <span class="idlParamName">currentIteration</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-AnimationTarget" class="idlType"><code>AnimationTarget</code></a>?</span> <span class="idlParamName">target</span></span>, 
                 <span class="idlParam"><span class="idlParamType"><a>double</a>?</span> <span class="idlParamName">previousTimeFraction</span></span>);</span>
};</span>

<span class="idlCallback" id="idl-def-CustomEffectCloneCallback-s">callback <span class="idlCallbackID">CustomEffectCloneCallback</span> = <span class="idlCallbackType"><a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a></span> ()</span>;

<span class="idlInterface" id="idl-def-TimingEvent-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-TimingEvent--DOMString-type-TimingEventInit-eventInit">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">type</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-TimingEventInit" class="idlType"><code>TimingEventInit</code></a></span> <span class="idlParamName">eventInit</span></span>)</span>]
interface <span class="idlInterfaceID">TimingEvent</span> : <span class="idlSuperclass"><a>Event</a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a>?</span>        <span class="idlAttrName"><a href="#widl-TimingEvent-localTime">localTime</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a>?</span>        <span class="idlAttrName"><a href="#widl-TimingEvent-timelineTime">timelineTime</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>unsigned long</a>?</span> <span class="idlAttrName"><a href="#widl-TimingEvent-iterationIndex">iterationIndex</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>boolean</a>?</span>       <span class="idlAttrName"><a href="#widl-TimingEvent-seeked">seeked</a></span>;</span>
};</span>

<span class="idlDictionary" id="idl-def-TimingEventInit-s">dictionary <span class="idlDictionaryID">TimingEventInit</span> {
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span>  <span class="idlMemberName"><a href="#widl-TimingEventInit-localTime">localTime</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span>  <span class="idlMemberName"><a href="#widl-TimingEventInit-timelineTime">timelineTime</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span>  <span class="idlMemberName"><a href="#widl-TimingEventInit-iterationIndex">iterationIndex</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>boolean</a>?</span> <span class="idlMemberName"><a href="#widl-TimingEventInit-seeked">seeked</a></span> = <span class="idlMemberValue">null</span>;</span>
};</span>

<span class="idlInterface" id="idl-def-Document-s">partial interface <span class="idlInterfaceID">Document</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-Timeline" class="idlType"><code>Timeline</code></a></span> <span class="idlAttrName"><a href="#widl-Document-timeline">timeline</a></span>;</span>
};</span>

<span class="idlInterface" id="idl-def-Element-s">partial interface <span class="idlInterfaceID">Element</span> {
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a></span>           <span class="idlMethName"><a href="#widl-Element-animate-Animation--AnimationEffect-or-CustomEffect-or-OneOrMoreKeyframes--effect--double-or-TimingInput--timing">animate</a></span> (
                                 <span class="idlParam"><span class="idlParamType">(<a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or <a href="#idl-def-CustomEffect" class="idlType"><code>CustomEffect</code></a> or <a href="#idl-def-OneOrMoreKeyframes" class="idlType"><code>OneOrMoreKeyframes</code></a>)?</span> <span class="idlParamName">effect</span></span>, 
                                 <span class="idlParam">optional <span class="idlParamType">(<a>double</a> or <a href="#idl-def-TimingInput" class="idlType"><code>TimingInput</code></a>)?</span> <span class="idlParamName">timing</span> = <span class="idlParamValue">null</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-Element-getCurrentAnimations-sequence-Animation">getCurrentAnimations</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-Player" class="idlType"><code>Player</code></a>&gt;</span>    <span class="idlMethName"><a href="#widl-Element-getCurrentPlayers-sequence-Player">getCurrentPlayers</a></span> ();</span>
};</span>
</pre></section>

    <section class="appendix informative" id="algorithms-for-path-animation-effects">
      <!--OddPage--><h2><span class="secno">B. </span>Algorithms for path animation effects</h2><div class="informative-bg"><p><em>This section is non-normative.</em></p>
      <p class="todo">TBD</p>
    </div></section>

    <section class="appendix informative" id="algorithms-for-event-dispatch">
      <!--OddPage--><h2><span class="secno">C. </span>Algorithms for event dispatch</h2><div class="informative-bg"><p><em>This section is non-normative.</em></p>
      <p>
        The following algorithms demonstrate a possible approach to handling
        event queuing that incorporates the various requirements outlined in <a href="#timing-events" class="sectionRef">section 5. Timing events</a>.
      </p>
      <p>
        Some of the features of the following approach are:
      </p>
      <ul>
        <li>Sorts only once per timeline.
        </li><li>Handles cotemporal samples without dispatching duplicate events.
        </li><li>Handles zero-length intervals.
        </li><li>Stores sample state only at the <a href="#dfn-player" class="internalDFN">player</a> level.
            (The <a href="#dfn-previous-active-state" class="internalDFN">previous active state</a> is still per-<a href="#dfn-timed-item" class="internalDFN">timed item</a>
            however.)
            This makes it possible for an implementation to optimize
            the case when there are no registered event listeners on part of the
            timing hierarchy.
            In such a case the whole procedure for determining and dispatching
            events can be skipped for that part of the hierarchy.
            Should event listeners be attached at a later point, the
            state stored at the player can be used to ensure the previously
            ignored timed items begin providing events as if they had always had
            event listeners.
      </li></ul>
      <section id="interval-boundaries-and-time-marks">
        <h3><span class="secno">C.1 </span>Interval boundaries and time marks</h3>
        <p>
          With regards to event dispatch, interval boundary conditions are
          particularly important.
          For example, if we were to conduct a <a href="#dfn-sample" class="internalDFN">sample</a> at time 3s and then
          another sample at 5s, on that second sample we should dispatch all
          events between the two times.
          If a <a href="#dfn-timed-item" class="internalDFN">timed item</a> were to start at time 5s, then we
          should dispatch the corresponding <a href="#dfn-timingstart" class="internalDFN">timingstart</a> event since that
          time has arrived.
          However, since we will have already dispatched all events at time 3s
          during the previous sample, we should <em>not</em> dispatch any events
          coinciding with time 3s.
        </p>
        <p>
          In other situations, however, such as when getting the events
          scheduled by <a href="#dfn-child-timed-item" class="internalDFN">child timed items</a> within a given iteration, we
          should include <a href="#dfn-timingstart" class="internalDFN">timingstart</a> events that coincide with the start
          of the iteration but not <a href="#dfn-timingend" class="internalDFN">timingend</a> events since, under Web
          Animations endpoint-exclusive timing model, those <a href="#dfn-timingend" class="internalDFN">timingend</a>
          events happened fractionally before the iteration started.
          To accommodate these different endpoint behaviors we introduce the
          concept of <a href="#dfn-time-mark" class="internalDFN">time marks</a>.
        </p>
        <p>
          A <dfn id="dfn-time-mark">time mark</dfn> is a triple consisting of:
        </p>
        <ul>
          <li>a <span class="property">time value</span>,
          </li><li>a <span class="property">position</span>: <span class="position">minus</span>, <span class="position">zero</span>,
            or <span class="position">plus</span>, and
          </li><li>a Boolean flag indicating if the mark represents the endpoint of
              an interval or not (regardless of which &#x2018;end&#x2019; of the
              interval the mark represents)
        </li></ul>
        <p>
          We can use subscript notation to indicate these properties.
          For example, <var class="timeMark">t<sub>minus|end</sub></var>.
          If the time mark does not represent an interval endpoint, the
          &#x2018;|end&#x2019; part of the subscript text is dropped, as in
          <var class="timeMark">t<sub>minus</sub></var>.
        </p>
        <p>
          For a given <a href="#dfn-time-mark" class="internalDFN">time mark</a>, |<var class="timeMark">t</var>|
          indicates just the <span class="property">time value</span> ignoring
          the other properties, and <var class="timeMark">t<sub>pos</sub></var>
          indicates just the <span class="property">position</span>.
        </p>
        <p>
          The <span class="position">minus</span> position represents a value
          an infinitely small amount less than the <span class="property">time
          value</span> whilst the <span class="position">plus</span> position
          represents a value infinitely small amount greater.
          <span class="position">zero</span> represents the moment at the time
          value.
        </p>
        <p>
          The meaning of these <span class="property">position</span> values is
          not affected by the direction in which playback proceeds.
          We can compare <span class="property">positions</span> and <span class="property">time values</span> as follows:
        </p>
        <p>
          For two <a href="#dfn-time-mark" class="internalDFN">time marks</a> <var class="timeMark">a</var> and <var class="timeMark">b</var>, <var class="timeMark">a</var> is less than
          <var class="timeMark">b</var> if one of the following conditions is
          true:
        </p>
        <ul>
          <li>|<var class="timeMark">a</var>| &lt;
              |<var class="timeMark">b</var>|, or
          </li><li>|<var class="timeMark">a</var>| =
              |<var class="timeMark">b</var>| and
              <var class="timeMark">a<sub>pos</sub></var> =
              <span class="position">before</span> and
              <var class="timeMark">b<sub>pos</sub></var> &#x2260;
              <span class="position">before</span>, or
          </li><li>|<var class="timeMark">a</var>| =
              |<var class="timeMark">b</var>| and
              <var class="timeMark">a<sub>pos</sub></var>=
              <span class="position">zero</span> and
              <var class="timeMark">b<sub>pos</sub></var>=
              <span class="position">after</span>
        </li></ul>
        <p>
          For two <a href="#dfn-time-mark" class="internalDFN">time marks</a> <var class="timeMark">a</var> and <var class="timeMark">b</var>, <var class="timeMark">a</var> equals 
          <var class="timeMark">b</var> if
          |<var class="timeMark">a</var>| equals |<var class="timeMark">b</var>|
          and
          <var class="timeMark">a<sub>pos</sub></var> equals
          <var class="timeMark">b<sub>pos</sub></var>.
        </p>
        <p>
          Operations such as greater-than and less-than-or-equal can be
          extrapolated from these definitions.
        </p>
        <p>
          Since these operations only apply to the <span class="property">position</span> and <span class="property">time
          value</span> of the <a href="#dfn-time-mark" class="internalDFN">time mark</a>, we define
          the <code><a title="first(a,b)" href="#dfn-first-a-b" class="internalDFN">first</a>()</code> and
          <code><a title="last(a,b)" href="#dfn-last-a-b" class="internalDFN">last</a>()</code> operations which are
          for most purposes equivalent to <code>min()</code> and
          <code>max()</code> but in the case where the two arguments are equal,
          it preserves their order.
          Their definitions are as follows.
        </p>
        <ul>
          <li><dfn title="first(a,b)" id="dfn-first-a-b">first</dfn>(<var class="timeMark">a</var>,<var class="timeMark">b</var>) =
              <var class="timeMark">a</var> if <var class="timeMark">a</var>
              &#x2264; <var class="timeMark">b</var> and
              <var class="timeMark">b</var> otherwise.
          </li><li><dfn title="last(a,b)" id="dfn-last-a-b">last</dfn>(<var class="timeMark">a</var>,<var class="timeMark">b</var>) =
              <var class="timeMark">a</var> if <var class="timeMark">a</var>
              &gt; <var class="timeMark">b</var> and
              <var class="timeMark">b</var> otherwise.
        </li></ul>
        <p>
          Given an interval delimited by two <a href="#dfn-time-mark" class="internalDFN">time marks</a> <var class="timeMark">a</var> and <var class="timeMark">b</var>,
          a time <var>t</var> is <dfn id="dfn-in-the-interval-ab">in the interval <var>ab</var></dfn> if the
          following relationship holds:
          <a title="first(a,b)" href="#dfn-first-a-b" class="internalDFN">first</a><a>(<var class="timeMark">a</var>,
                                         <var class="timeMark">b</var>)
          &#x2264; <var>t</var>
          &#x2264; </a><a title="last(a,b)" href="#dfn-last-a-b" class="internalDFN">last</a><a>(<var class="timeMark">a</var>,
                                            <var class="timeMark">b</var>).
        </a></p><a>
        </a><p><a>
          A </a><a href="#dfn-time-mark" class="internalDFN">time mark</a> can be added to a <a href="#dfn-time-value" class="internalDFN">time value</a> by simply
          adding the time value components and keeping the <span class="property">position</span> and interval
          endpoint state of the <a href="#dfn-time-mark" class="internalDFN">time mark</a>.
          Addition of two <a href="#dfn-time-mark" class="internalDFN">time marks</a> is not defined.
        </p>
      </section>
      <section id="events-when-sampling-a-timeline">
        <h3><span class="secno">C.2 </span>Events when sampling a timeline</h3>
        <p>
          For a <a href="#dfn-timeline" class="internalDFN">timeline</a>, <a>sampled</a> such that the current <a href="#dfn-time-value" class="internalDFN">time
          value</a> is <var>t</var>, the set of <a href="#dfn-timing-event" class="internalDFN">timing events</a> to queue
          can be determined as follows:
        </p>
        <ol>
          <li>Iterate over each <a href="#dfn-player" class="internalDFN">player</a> in the set of players 
            <a title="associated with a timeline" href="#dfn-associated-with-a-timeline" class="internalDFN">
            associated</a> with this
            <a href="#dfn-timeline" class="internalDFN">timeline</a> in the order in which the players were created
            starting from the first created to the last, and for each
            <a href="#dfn-player" class="internalDFN">player</a>, perform the steps defined in
            <a href="#event-dispatch-and-unattached-timed-items" class="sectionRef">section 5.7.4 Event dispatch and unattached timed items</a>.
          </li><li>Let <var>events</var> be an empty sequence of <a href="#dfn-timing-event" class="internalDFN">timing
              events</a>.
          </li><li>Iterate over each <a href="#dfn-player" class="internalDFN">player</a> in the set of players i
            <a title="associated with a timeline" href="#dfn-associated-with-a-timeline" class="internalDFN">
            associated</a> with this
            <a href="#dfn-timeline" class="internalDFN">timeline</a> in the order in which the players were created
            starting from the first created to the last and
            get the <a title="partially ordered set of events for a player at timeline time
            t" href="#dfn-partially-ordered-set-of-events-for-a-player-at-timeline-time-t" class="internalDFN">partially ordered set of events for the player</a> at
            <var>t</var> and append then to <var>events</var>.
          </li><li>Perform a stable sort on <var>events</var> by <a href="#dfn-event-timeline-time" class="internalDFN">event timeline
              time</a> such that earlier times sort first.</li>
          <li>Add <var>events</var> to the event queue in their current
              order.</li>
        </ol>
      </section>
      <section id="events-when-sampling-a-player">
        <h3><span class="secno">C.3 </span>Events when sampling a player</h3>
        <p>
          The <dfn id="dfn-partially-ordered-set-of-events-for-a-player-at-timeline-time-t">partially ordered set of events for a <a href="#dfn-player" class="internalDFN">player</a> at
          timeline time <var>t</var></dfn>, can be determined as follows:
        </p>
        <ol>
          <li>Let <var>previous sample mark</var> be a <a href="#dfn-time-mark" class="internalDFN">time mark</a>
              associated with the <a href="#dfn-player" class="internalDFN">player</a> that is initialized to <span class="timeMark">0<sub>zero|end</sub></span> when the
              <a href="#dfn-player" class="internalDFN">player</a> is first created.
          </li><li>Let <var>sample time</var> be the result of calculating the
              <a href="#dfn-player" class="internalDFN">player</a>&#x2019;s <a href="#dfn-current-time" class="internalDFN">current time</a> at timeline time <var>t</var>.
          </li><li>Let <var>sample mark</var> be <var class="timeMark">sample
              time<sub>plus</sub></var>.
          </li><li>Let <var>events</var> be an empty sequence of <a href="#dfn-timing-event" class="internalDFN">timing
              events</a>.
          </li><li>
            The events queued depends on whether or not the <a href="#dfn-time-adjusted-flag" class="internalDFN">time adjusted
            flag</a> is set as follows,
            <dl class="switch">
              <dt>If the <a href="#dfn-time-adjusted-flag" class="internalDFN">time adjusted flag</a> of the
                  <a href="#dfn-player" class="internalDFN">player</a> is set,</dt>
              <dd>
                <ol>
                  <li>If this <a href="#dfn-player" class="internalDFN">player</a> has associated <a href="#dfn-source-content" class="internalDFN">source
                      content</a>, then get the <a title="partially ordered set of events for a timed item seeked to time t" href="#dfn-partially-ordered-set-of-events-for-a-timed-item-seeked-to-time-t" class="internalDFN">partially
                      ordered set of events scheduled for seek time <var>sample
                      time</var></a> and append them to <var>events</var>.
                  </li><li>Clear the <a href="#dfn-time-adjusted-flag" class="internalDFN">time adjusted flag</a>.
                </li></ol>
              </dd>
              <dt>Otherwise,</dt>
              <dd>
                <ol>
                  <li>If this <a>player has associated </a><a href="#dfn-source-content" class="internalDFN">source content</a>,
                    then get the <a title="partially ordered set of events for a timed item scheduled between time marks a and b" href="#dfn-partially-ordered-set-of-events-for-a-timed-item-scheduled-between-time-marks-a-and-b" class="internalDFN">partially
                    ordered set of events scheduled between <var>previous sample
                    mark</var> and <var>sample mark</var></a> and append them to
                    <var>events</var>.
                </li></ol>
              </dd>
            </dl>
            <div class="note">
              <p>
                Note that this approach should correctly handle consecutive
                samples with the same time value.
              </p>
              <p>
                In such a case, both <var>previous sample mark</var> and
                <var>sample mark</var> will have a <span class="property">position</span> of <span class="position">plus</span>.
                Since no <a href="#dfn-timing-event" class="internalDFN">timing events</a> are scheduled to be
                dispatched at the <span class="position">plus</span> position
                there should be no duplicate events.
              </p>
            </div>
          </li><li>Set <var>previous sample mark</var> to <var>sample mark</var>.
          </li><li>Return <var>events</var>.
        </li></ol>
      </section>
      <section id="events-for-a-timed-item-during-regular-sampling">
        <h3><span class="secno">C.4 </span>Events for a timed item during regular sampling</h3>
        <p>
          The <dfn id="dfn-partially-ordered-set-of-events-for-a-timed-item-scheduled-between-time-marks-a-and-b">partially ordered set of events for a <a href="#dfn-timed-item" class="internalDFN">timed item</a>
          scheduled between time marks <var>a</var> and <var>b</var></dfn>,
          expressed in <a title="uneased timing" href="#dfn-uneased-timing" class="internalDFN">uneased inherited time</a>, can
          be determined as follows:
        </p>
        <ol>
          <li>Let <var>events</var> be an empty sequence of <a href="#dfn-timing-event" class="internalDFN">timing
              events</a>.
          </li><li>Let <var class="timeMark">range a</var> be the <a href="#dfn-time-mark" class="internalDFN">time mark</a>
              resulting from calculating <var class="timeMark">a</var> + <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a>.
          </li><li>Let <var class="timeMark">range b</var> be the <a href="#dfn-time-mark" class="internalDFN">time mark</a>
              resulting from calculating <var class="timeMark">b</var> + <a title="timed item start time" href="#dfn-timed-item-start-time" class="internalDFN">start time</a>.
          </li><li>Define a <a href="#dfn-time-mark" class="internalDFN">time mark</a> <var class="timeMark">t</var> as being
              <dfn id="dfn-in-range">in range</dfn> if it is <a title="in the interval ab" href="#dfn-in-the-interval-ab" class="internalDFN">in the
              interval</a> (<var class="timeMark">range a</var>,
              <var class="timeMark">range b</var>).
          </li><li>Let <var class="timeMark">range lhs</var> be <a title="first(a,b)" href="#dfn-first-a-b" class="internalDFN">first</a>(<var class="timeMark">range a</var>,
              <var class="timeMark">range b</var>).
          </li><li>Let <var class="timeMark">range rhs</var> be <a title="last(a,b)" href="#dfn-last-a-b" class="internalDFN">last</a>(<var class="timeMark">range a</var>,
              <var class="timeMark">range b</var>).
          </li><li>Let <var class="timeMark">active start</var> be <var class="timeMark">start delay<sub>zero|end</sub></var>.
          </li><li>Let <var class="timeMark">active end</var> be <span class="timeMark">(<a href="#dfn-start-delay" class="internalDFN">start delay</a> + <a href="#dfn-active-duration" class="internalDFN">active
              duration</a>)<sub>minus|end</sub></span>.
          </li><li>If |<var class="timeMark">active start</var>| = |<var class="timeMark">active end</var>| then set the <span class="property">position</span> of <var class="timeMark">active end</var> to <span class="position">zero</span>.
          </li><li>If either of the following conditions is true:
            <ul><li><var class="timeMark">active end</var> &lt;
                <var class="timeMark">range lhs</var>; or
                </li><li><var class="timeMark">active start</var> &gt;
                <var class="timeMark">range rhs</var>
            </li></ul>
            return <var>events</var>.
          </li><li>If |<var class="timeMark">active start</var>| =
              |<var class="timeMark">active end</var>| and the <a href="#dfn-timed-item" class="internalDFN">timed
              item</a>&#x2019;s <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> is infinity, let
              <var>effective iteration count</var> be 1, otherwise let it be
              the <a href="#dfn-timed-item" class="internalDFN">timed item</a>&#x2019;s <a href="#dfn-iteration-count" class="internalDFN">iteration count</a>.
          </li><li>Let <var>iteration times</var> be a sequence of <a href="#dfn-time-value" class="internalDFN">time
              values</a> populated with the results of calculating |<var class="timeMark">active start</var>| + <var>i</var> * <a href="#dfn-iteration-duration" class="internalDFN">iteration
              duration</a> for each integer <var>i</var> in the range 0 &lt;
              <var>i</var> &lt; <var>effective iteration count</var>.
          </li><li>Remove all <a href="#dfn-time-value" class="internalDFN">time values</a> from <var>iteration times</var>
              where <var class="timeMark">time value<sub>zero</sub></var> is not
              <a href="#dfn-in-range" class="internalDFN">in range</a>.
          </li><li>Let <var>subintervals</var> be an empty sequence of <a href="#dfn-time-mark" class="internalDFN">time
              marks</a>.
          </li><li>If <var class="timeMark">active start</var> is <a href="#dfn-in-range" class="internalDFN">in range</a>,
              append it to <var>subintervals</var>, otherwise append <var class="timeMark">range lhs</var>.
          </li><li>For each <a href="#dfn-time-value" class="internalDFN">time value</a> <var>t</var> in <var>iteration
              times</var>, add the following two <a href="#dfn-time-mark" class="internalDFN">time marks</a> to
              <var>subintervals</var>, in order,
              <var class="timeMark">t<sub>minus|end</sub></var>,
              <var class="timeMark">t<sub>zero|end</sub></var>
              unless the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>
              is zero, in which case add
              <var class="timeMark">t<sub>zero|end</sub></var>,
              <var class="timeMark">t<sub>zero|end</sub></var> instead.
          </li><li>If <var class="timeMark">active end</var> is <a href="#dfn-in-range" class="internalDFN">in range</a>,
              append it to <var>subintervals</var>, otherwise append <var class="timeMark">range rhs</var>.
          </li><li>If the first pair of <a href="#dfn-time-mark" class="internalDFN">time marks</a> in <var>subintervals</var>
              are not in order, that is, if <var class="timeMark">subintervals[0]</var> &gt; <var class="timeMark">subintervals[1]</var>, remove those two <a href="#dfn-time-mark" class="internalDFN">time
              marks</a> from <var>subintervals</var>.
              <p class="note">
                This will happen if a non-zero-duration iteration ends at |<var class="timeMark">range lhs</var>| and the <span class="property">position</span> of <var class="timeMark">range
                lhs</var> is not <span class="position">minus</span>.
              </p>
          </li><li>If <var class="timeMark">range a</var> &lt; <var class="timeMark">range b</var>, let <var>direction</var> be
              <span class="prop-value">forwards</span>, otherwise let
              <var>direction</var> be <span class="prop-value">backwards</span>.
          </li><li>If <var>direction</var> is <span class="prop-value">backwards</span>, reverse the elements of
              <var>subintervals</var>.
          </li><li>Let <var class="timeMark">directed active start</var> be <var class="timeMark">active start</var> if <var>direction</var> is
              <span class="prop-value">forwards</span> and <var class="timeMark">active end</var> otherwise.
          </li><li>Likewise, let <var class="timeMark">directed active end</var> be
              <var class="timeMark">active end</var> if <var>direction</var> is
              <span class="prop-value">forwards</span> and <var class="timeMark">active start</var> otherwise.
          </li><li>Define the <dfn id="dfn-iteration-index-at-local-time-mark-t">iteration index at local <a href="#dfn-time-mark" class="internalDFN">time mark</a>
              <var class="timeMark">t</var></dfn> as follows:
            <ol>
              <li>Let <var>iteration index</var> be the result of calculating
                  the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> at |<var class="timeMark">t</var>|.
              </li><li>If <var class="timeMark">t<sub>pos</sub></var> is <span class="position">minus</span> and (<var>iteration index</var>
                  x <var class="timeMark">active start</var>) % <a href="#dfn-iteration-duration" class="internalDFN">iteration
                  duration</a> = 0,
                  let <var>iteration index</var> be max(0, <var>iteration
                  index</var> - 1).
              </li><li>The result is <var>iteration index</var>.
            </li></ol>
          </li><li>Define the <dfn id="dfn-timeline-time-at-local-time-t">timeline time at local time <var>t</var></dfn> as
              follows:
            <ol>
              <li>Let the <var>uneased local root time</var> be the result of
                  repeatedly applying the procedures for calculating the
                  <a href="#dfn-uneased-inherited-time-from-uneased-local-time" class="internalDFN">uneased inherited time from uneased local time</a> and
                  <a href="#dfn-uneased-local-time-from-uneased-child-time" class="internalDFN">uneased local time from uneased child time</a>
                  defined in
                  <a href="#inverse-timing-calculations" class="sectionRef">section 5.3 Inverse timing calculations</a>
                  for each <a href="#dfn-ancestor" class="internalDFN">ancestor</a> of this <a href="#dfn-timed-item" class="internalDFN">timed item</a> in turn up
                  to the <a href="#dfn-root" class="internalDFN">root</a> <a href="#dfn-timed-item" class="internalDFN">timed item</a> using <var>t</var> as the
                  initial <var>uneased local time</var>.
              </li><li>Let the <var>uneased local player time</var> be the result of
                  calculating the
                  <a href="#dfn-uneased-inherited-time-from-uneased-local-time" class="internalDFN">uneased inherited time from uneased local time</a> for
                  the <var>uneased local root time</var> using the <var>uneased
                  local root time as the <var>uneased local time</var>.
              </var></li><li>Let the <var>timeline time</var> be the result of calculating
                  the <a href="#dfn-timeline-time-from-the-current-time-of-a-player" class="internalDFN">timeline time from the current time of a player</a> for
                  the <a href="#dfn-player" class="internalDFN">player</a> with which this <a href="#dfn-timed-item" class="internalDFN">timed item</a> is <a title="associated with a player">associated</a> using the
                  <var>uneased local player time</var> as the <var>current
                  time</var>.
              </li><li>If the <var>timeline time</var> is undefined, let
                  <var>timeline time</var> use the current
                  <a href="#dfn-time-value" class="internalDFN">time value</a> of the <a href="#dfn-timeline" class="internalDFN">timeline</a> with which this
                  <a href="#dfn-timed-item" class="internalDFN">timed item</a> is <a title="associated with
                  a timeline" href="#dfn-associated-with-a-timeline" class="internalDFN">associated</a>.
              </li><li>The result is <var>timeline time</var>.
            </li></ol>
          </li><li>If <var class="timeMark">directed active start</var> is <a href="#dfn-in-range" class="internalDFN">in
              range</a>, append to <var>events</var> a <a href="#dfn-timing-event" class="internalDFN">timing event</a>
              with the following parameters:
            <ul>
              <li>type: <a href="#dfn-timingstart" class="internalDFN">timingstart</a>
              </li><li>event target: this <a href="#dfn-timed-item" class="internalDFN">timed item</a>
              </li><li><a href="#dfn-event-local-time" class="internalDFN">event local time</a>:
                  |<var class="timeMark">directed active start</var>|
              </li><li><a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>:
                  <a title="timeline time at local time t" href="#dfn-timeline-time-at-local-time-t" class="internalDFN">timeline
                  time for |<var class="timeMark">directed active
                  start</var>|</a>.
              </li><li><a href="#dfn-event-iteration-index" class="internalDFN">event iteration index</a>:
                  <a title="iteration index at local time mark t" href="#dfn-iteration-index-at-local-time-mark-t" class="internalDFN">iteration
                  index at <var class="timeMark">directed active
                  start</var></a>
              </li><li><a href="#dfn-seeked-dispatch-flag" class="internalDFN">seeked dispatch flag</a>: false
            </li></ul>
            Alternatively, if <var class="timeMark">range a</var> is an
            interval endpoint, append a <a href="#dfn-timing-event" class="internalDFN">timing event</a> to
            <var>events</var> as above but substituting <var class="timeMark">range a</var> in place of <var class="timeMark">directed active start</var>.
          </li><li>Let <var>subinterval iteration index</var> be the <a title="iteration index at local time mark t" href="#dfn-iteration-index-at-local-time-mark-t" class="internalDFN">iteration index
            at the first </a><a href="#dfn-time-mark" class="internalDFN">time mark</a> in <var>subintervals</var>.
          </li><li>Let <var>first iteration</var> be <code>true</code>
          </li><li>Iterate over each pair of <a href="#dfn-time-mark" class="internalDFN">time marks</a> in
              <var>subintervals</var> in order such that each <a href="#dfn-time-mark" class="internalDFN">time mark</a>
              is used only once.
              For each pair of <a href="#dfn-time-mark" class="internalDFN">time marks</a>,
              (<var class="timeMark">subinterval start</var>,
              <var class="timeMark">subinterval end</var>)
              perform the following steps:
            <ol>
              <li>Let <var>subinterval iteration index</var> be the <a title="iteration index at local time mark t" href="#dfn-iteration-index-at-local-time-mark-t" class="internalDFN">iteration index
                at <var class="timeMark">subinterval start</var></a>.
              </li><li>If <em>either</em> of the following conditions is true,
                <ul>
                  <li><var>first iteration</var> is <code>false</code>, or
                  </li><li><var class="timeMark">subinterval start</var> =
                      <var class="timeMark">range a</var> &#x2260;
                      <var class="timeMark">subinterval end</var>
                </li></ul>
                append a new <a href="#dfn-timing-event" class="internalDFN">timing event</a> to <var>events</var> with the
                following paramters:
                <ul>
                  <li>type: <a href="#dfn-timingiteration" class="internalDFN">timingiteration</a>
                  </li><li>event target: this <a href="#dfn-timed-item" class="internalDFN">timed item</a>
                  </li><li><a href="#dfn-event-local-time" class="internalDFN">event local time</a>:
                      |<var class="timeMark">subinterval start</var>|
                  </li><li><a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>:
                      <a title="timeline time at local time t" href="#dfn-timeline-time-at-local-time-t" class="internalDFN">timeline
                      time for |<var class="timeMark">subinterval
                      start</var>|</a>.
                  </li><li><a href="#dfn-event-iteration-index" class="internalDFN">event iteration index</a>:
                      <var>subinterval iteration index</var>
                  </li><li><a href="#dfn-seeked-dispatch-flag" class="internalDFN">seeked dispatch flag</a>: false
                </li></ul>
              </li><li>Let <var class="timeMark">child start</var> be a <a href="#dfn-time-mark" class="internalDFN">time
                mark</a> whose <span class="property">time value</span> is the
                result of calculating the <a href="#dfn-directed-time" class="internalDFN">directed time</a> corresponding
                to |<var class="timeMark">subinterval start</var>| but using
                <var>subinterval iteration index</var> as the <var>current
                iteration value</var> and assuming a <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> of
                <span class="prop-value">none</span> and whose <span class="property">position</span> is the same as that of <var class="timeMark">subinterval start</var>.
              </li><li>Likewise, let <var class="timeMark">child end</var> be the
                result of performing the same operation but for <var class="timeMark">subinterval end</var>.
              </li><li>Let <var>child direction</var> be
                <span class="prop-value">forwards</span> if
                |<var class="timeMark">child start</var>| &lt;
                |<var class="timeMark">child end</var>|,
                <span class="prop-value">backwards</span> if
                |<var class="timeMark">child start</var>| &gt;
                |<var class="timeMark">child end</var>|,
                and <code>null</code> if
                |<var class="timeMark">child start</var>| =
                |<var class="timeMark">child end</var>|.
              </li><li>If <var>child direction</var> is not <code>null</code> and is
                not equal to <var>direction</var>, invert the <span class="property">position</span> of <var class="timeMark">child start</var> and <var class="timeMark">child end</var> each such that <span class="position">plus</span> becomes <span class="position">minus</span>, and vice versa, and <span class="position">zero</span> remains
                unchanged.
              </li><li>Let <var>child events</var> be an empty sequence of
                <a href="#dfn-timing-event" class="internalDFN">timing events</a>.
              </li><li>Iterate over each <a href="#dfn-child-timed-item" class="internalDFN">child timed item</a> in order and for
                each child get the <a title="partially ordered set of events for a timed item scheduled between time marks a and b" href="#dfn-partially-ordered-set-of-events-for-a-timed-item-scheduled-between-time-marks-a-and-b" class="internalDFN">partially
                ordered set of events scheduled between <var class="timeMark">child start</var> and <var class="timeMark">child end</var></a> and append to <var>child
                events</var>.
              </li><li>Append <var>child events</var> to <var>events</var>.
              </li><li>If <var>direction</var> is <span class="prop-value">forwards</span>, increment
                  <var>subinterval iteration index</var>, otherwise decrement
                  it.
                  <p class="note">
                    This manual handling of the <var>subinterval iteration
                      index</var> (as opposed to simply recalculating the
                    <a title="iteration index at local time mark t" href="#dfn-iteration-index-at-local-time-mark-t" class="internalDFN">iteration
                    index for each <var>subinterval start</var></a> is
                    necessary for handling zero-length intervals.
                  </p>
              </li><li>Let <var>first iteration</var> be <code>false</code>.
            </li></ol>
          </li><li>If <var class="timeMark">directed active end</var> is <a href="#dfn-in-range" class="internalDFN">in
              range</a>, append to <var>events</var> a <a href="#dfn-timing-event" class="internalDFN">timing event</a>
              with the following parameters:
            <ul>
              <li>type: <a href="#dfn-timingend" class="internalDFN">timingend</a>
              </li><li>event target: this <a href="#dfn-timed-item" class="internalDFN">timed item</a>
              </li><li><a href="#dfn-event-local-time" class="internalDFN">event local time</a>:
                  |<var class="timeMark">directed active end</var>|
              </li><li><a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>:
                  <a title="timeline time at local time t" href="#dfn-timeline-time-at-local-time-t" class="internalDFN">timeline
                  time for |<var class="timeMark">directed active
                  end</var>|</a>.
              </li><li><a href="#dfn-event-iteration-index" class="internalDFN">event iteration index</a>:
                  <a title="iteration index at local time mark t" href="#dfn-iteration-index-at-local-time-mark-t" class="internalDFN">iteration
                  index at <var class="timeMark">directed active
                  end</var></a>
              </li><li><a href="#dfn-seeked-dispatch-flag" class="internalDFN">seeked dispatch flag</a>: false
            </li></ul>
            Alternatively, if <var class="timeMark">range b</var> is an
            interval endpoint, append a <a href="#dfn-timing-event" class="internalDFN">timing event</a> to
            <var>events</var> as above but substituting <var class="timeMark">range b</var> in place of <var class="timeMark">directed active end</var>.
          </li><li>Return <var>events</var>.
        </li></ol>
      </section>
      <section id="events-for-a-timed-item-during-seeked-event-dispatch">
        <h3><span class="secno">C.5 </span>Events for a timed item during seeked event dispatch</h3>
        <p>
          The <dfn id="dfn-partially-ordered-set-of-events-for-a-timed-item-seeked-to-time-t">partially ordered set of events for a <a href="#dfn-timed-item" class="internalDFN">timed item</a>
          seeked to time <var>t</var></dfn>, expressed in <a title="uneased timing" href="#dfn-uneased-timing" class="internalDFN">uneased inherited time</a>,
          can be determined as follows:
        </p>
        <ol>
          <li>Let <var>events</var> be an empty sequence of <a href="#dfn-timing-event" class="internalDFN">timing
              events</a>.
          </li><li>Let <var>local t</var> be <var>t</var> + <a>start time</a>.
          </li><li>Let <var>child time</var> be a <var>time value</var> that is the
              result of calculating the <a href="#dfn-directed-time" class="internalDFN">directed time</a> corresponding to
              <var>local t</var> assuming a <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> of <span class="prop-value">none</span>.
          </li><li>Iterate over each <a href="#dfn-child-timed-item" class="internalDFN">child timed item</a> in order and for each
              child get the <a title="partially ordered set of events for a timed item seeked to time t" href="#dfn-partially-ordered-set-of-events-for-a-timed-item-seeked-to-time-t" class="internalDFN">partially
              ordered set of events for seek time <var>child time</var></a>
              and append to <var>events</var>.
          </li><li>Let <var>current active state</var> be the result of evaluating if
              this <a href="#dfn-timed-item" class="internalDFN">timed item</a> is <a href="#dfn-active" class="internalDFN">active</a> at time <var>local
              t</var>.
          </li><li>If this <a href="#dfn-timed-item" class="internalDFN">timed item</a> has a <a href="#dfn-previous-active-state" class="internalDFN">previous active state</a> of
              <em>inactive</em>, and a <var>current active state</var> of
              <em>active</em>, add to the beginning of <var>events</var> a new
              <a href="#dfn-timing-event" class="internalDFN">timing event</a> with the following parameters:
              <ul>
                <li>type: <a href="#dfn-timingstart" class="internalDFN">timingstart</a>
                </li><li>event target: this <a href="#dfn-timed-item" class="internalDFN">timed item</a>
                </li><li><a href="#dfn-event-local-time" class="internalDFN">event local time</a>: <var>local t</var>
                </li><li><a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>:
                    <a title="timeline time at local time t" href="#dfn-timeline-time-at-local-time-t" class="internalDFN">timeline
                    time for <var>local t</var></a>.
                </li><li><a href="#dfn-event-iteration-index" class="internalDFN">event iteration index</a>:
                    the result of calculating the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> at 
                    at <var>local t</var>
                </li><li><a href="#dfn-seeked-dispatch-flag" class="internalDFN">seeked dispatch flag</a>: true
              </li></ul>
          </li><li>If this <a href="#dfn-timed-item" class="internalDFN">timed item</a> has a <a href="#dfn-previous-active-state" class="internalDFN">previous active state</a>
              of <em>active</em>, and a <var>current active state</var> of
              <em>inactive</em>, append to the end of <var>events</var> a new
              <a href="#dfn-timing-event" class="internalDFN">timing event</a> with the following parameters:
              <ul>
                <li>type: <a href="#dfn-timingend" class="internalDFN">timingend</a>
                </li><li>event target: this <a href="#dfn-timed-item" class="internalDFN">timed item</a>
                </li><li><a href="#dfn-event-local-time" class="internalDFN">event local time</a>: <var>local t</var>
                </li><li><a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>:
                    <a title="timeline time at local time t" href="#dfn-timeline-time-at-local-time-t" class="internalDFN">timeline
                    time for <var>local t</var></a>.
                </li><li><a href="#dfn-event-iteration-index" class="internalDFN">event iteration index</a>:
                    the result of calculating the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> at 
                    at <var>local t</var>
                </li><li><a href="#dfn-seeked-dispatch-flag" class="internalDFN">seeked dispatch flag</a>: true
              </li></ul>
          </li><li>Return <var>events</var>.
        </li></ol>
      </section>
    </div></section>

    <section class="appendix" id="acknowledgements">
      <!--OddPage--><h2><span class="secno">D. </span>Acknowledgements</h2>
      <p>
        Thank you to Michiel &#x201c;Pomax&#x201d; Kamermans for help with the
        equations for a proposed smooth timing function although this feature
        has been deferred to a subsequent specification.
      </p>
      <p>
        Our deep gratitude goes out to <a href="http://www.southernstarentertainment.com.au/">Southern Star
        Animation</a> for their kind generosity and patience in introducing the
        editors to the processes and techniques used producing broadcast
        animations.
      </p>
    </section>
  

<section id="references" class="appendix"><!--OddPage--><h2><span class="secno">E. </span>References</h2><section id="normative-references"><h3><span class="secno">E.1 </span>Normative references</h3><dl class="bibliography"><dt id="bib-CSS21">[CSS21]</dt><dd>Bert Bos; et al. <a href="http://www.w3.org/TR/CSS21/"><cite>Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification.</cite></a>. W3C Recommendation. URL: <a href="http://www.w3.org/TR/CSS21">http://www.w3.org/TR/CSS21/</a> 
</dd><dt id="bib-CSS3-TRANSITIONS">[CSS3-TRANSITIONS]</dt><dd>Dean Jackson; David Hyatt; Chris Marrin; David Baron. <a href="http://www.w3.org/TR/css3-transitions/"><cite>CSS Transitions Module Level 3.</cite></a> 12 February 2013. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/css3-transitions/">http://www.w3.org/TR/css3-transitions/</a> 
</dd><dt id="bib-CSSOM">[CSSOM]</dt><dd>Anne van Kesteren. <a href="http://www.w3.org/TR/cssom/"><cite>CSSOM View Module.</cite></a> 12 July 2011. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/cssom/">http://www.w3.org/TR/cssom/</a> 
</dd><dt id="bib-DOM4">[DOM4]</dt><dd>Anne van Kesteren; Aryeh Gregor; Lachlan Hunt; Ms2ger. <a href="http://www.w3.org/TR/dom/"><cite>DOM4.</cite></a> 6 December 2012. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/dom/">http://www.w3.org/TR/dom/</a> 
</dd><dt id="bib-HTML5">[HTML5]</dt><dd>Robin Berjon; et. al. <a href="http://www.w3.org/TR/html5"><cite>HTML5.</cite></a> 17 December 2012. W3C Candidate Recommendation. (Work in progress.) URL: <a href="http://www.w3.org/TR/html5">http://www.w3.org/TR/html5</a> 
</dd><dt id="bib-MEDIA-FRAGMENTS">[MEDIA-FRAGMENTS]</dt><dd>Rapha&#xeb;l Troncy; Erik Mannens; Silvia Pfeiffer and Davy Van Deursen. <a href="http://www.w3.org/TR/media-frags/"><cite>Media Fragments URI 1.0</cite></a>. W3C Working Draft 25 September 2012. URL: <a href="http://www.w3.org/TR/media-frags/">http://www.w3.org/TR/media-frags/</a> 
</dd><dt id="bib-SELECT">[SELECT]</dt><dd>Daniel Glazman; et al. <a href="http://www.w3.org/TR/css3-selectors/"><cite>Selectors Level 3.</cite></a> 29 September 2011. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/css3-selectors/">http://www.w3.org/TR/css3-selectors/</a> 
</dd><dt id="bib-SVG11">[SVG11]</dt><dd>Erik Dahlstr&#xf6;m; et al. <a href="http://www.w3.org/TR/SVG11/"><cite>Scalable Vector Graphics (SVG) 1.1 (Second Edition).</cite></a> 16 August 2011. W3C Recommendation. URL: <a href="http://www.w3.org/TR/SVG11/">http://www.w3.org/TR/SVG11/</a> 
</dd></dl></section><section id="informative-references"><h3><span class="secno">E.2 </span>Informative references</h3><dl class="bibliography"><dt id="bib-CSS3-ANIMATIONS">[CSS3-ANIMATIONS]</dt><dd>Dean Jackson; et. al. <a href="http://www.w3.org/TR/css3-animations/"><cite>CSS Animations Module Level 3.</cite></a> 19 February 2013. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/css3-animations/">http://www.w3.org/TR/css3-animations/</a> 
</dd><dt id="bib-CSS3-COLOR">[CSS3-COLOR]</dt><dd>Tantek &#xc7;elik; Chris Lilley; L. David Baron. <a href="http://www.w3.org/TR/css3-color/"><cite>CSS Color Module Level 3.</cite></a> 7 June 2011. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/css3-color/">http://www.w3.org/TR/css3-color/</a> 
</dd><dt id="bib-CSS3-TRANSFORMS">[CSS3-TRANSFORMS]</dt><dd>Simon Fraser; Dean Jackson; Edward O'Connor; Dirk Schulze; Aryeh Gregor. <a href="http://www.w3.org/TR/css3-transforms"><cite>CSS Transforms</cite></a> 11 September 2012. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/css3-transforms">http://www.w3.org/TR/css3-transforms</a> 
</dd><dt id="bib-CSS3-VALUES">[CSS3-VALUES]</dt><dd>H&#xe5;kon Wium Lie; Tab Atkins; Elika J. Etemad. <a href="http://www.w3.org/TR/css3-values/"><cite>CSS Values and Units Module Level 3.</cite></a> 4 April 2013. W3C Candidate Recommendation. URL: <a href="http://www.w3.org/TR/css3-values/">http://www.w3.org/TR/css3-values/</a> 
</dd><dt id="bib-CSS4-IMAGES">[CSS4-IMAGES]</dt><dd>Elika J. Etemad; Tab Atkins. <a href="http://dev.w3.org/csswg/css-images"><cite>CSS Image Values and Replaced Content Module Level 4</cite></a> 11 April 2013. W3C Editor's Draft. (Work in progress.) URL: <a href="http://dev.w3.org/csswg/css-images">http://dev.w3.org/csswg/css-images</a> 
</dd><dt id="bib-DOM-LEVEL-3-EVENTS">[DOM-LEVEL-3-EVENTS]</dt><dd>Travis Leithead; et. al. <a href="http://www.w3.org/TR/DOM-Level-3-Events/"><cite>Document Object Model (DOM) Level 3 Events Specification.</cite></a> 6 September 2012. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/DOM-Level-3-Events/">http://www.w3.org/TR/DOM-Level-3-Events/</a> 
</dd><dt id="bib-FUND-COMP-GRAPHICS">[FUND-COMP-GRAPHICS]</dt><dd>Peter Shirley, Michael Ashikhmin, Steve Marschner. <cite>Fundamentals of Computer Graphics.</cite> A K Peters Limited, 2009.
</dd><dt id="bib-NAVIGATION-TIMING">[NAVIGATION-TIMING]</dt><dd>Zhiheng Wang. <a href="http://www.w3.org/TR/navigation-timing/"><cite>Navigation Timing.</cite></a> 17 December 2012. W3C Recommendation. URL: <a href="http://www.w3.org/TR/navigation-timing/">http://www.w3.org/TR/navigation-timing/</a> 
</dd><dt id="bib-SMIL-ANIMATION">[SMIL-ANIMATION]</dt><dd>Patrick Schmitz; Aaron Cohen. <a href="http://www.w3.org/TR/smil-animation/"><cite>SMIL Animation.</cite></a> 4 September 2001. W3C Recommendation. URL: <a href="http://www.w3.org/TR/smil-animation/">http://www.w3.org/TR/smil-animation/</a> 
</dd></dl></section></section></body></html>
