<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en-US" xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
 <head><meta content="text/html;charset=UTF-8" http-equiv="Content-Type" />
<title>XML Digital Signatures for Widgets</title>
<style type="text/css">
dfn {
	font-weight: bold;
}
.figure {
	display: block;
	counter-increment: fig-num;
	text-align: center;
	margin: 1em 0em 1em 0em;
}
.figcaption {
	clear:both;
	display:block;
}
.figcaption:before {
	content: "Figure " counter(fig-num) ": ";
	font-weight:bold;
}
</style>
<link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/W3C-[STATUS]"/>
</head>
<body>
<div>
  <div class="head">
    <a href="http://www.w3.org/"><img height="48" width="72" alt="W3C" src="http://www.w3.org/Icons/w3c_home"/></a>
    <h1 class="head">XML Digital Signatures for Widgets</h1>
    <h2 class="no-num no-toc">[LONGSTATUS] [DATE] 
    </h2>
    <dl>
      <dt>This version:</dt>
      <dd><a href="[VERSION]">[VERSION]</a></dd>
      <dt>Latest version:</dt>
      <dd><a href="http://www.w3.org/TR/widgets-digsig/">http://www.w3.org/TR/widgets-digsig/</a></dd>
      <dt>Previous version:</dt>
      <dd><a href="http://www.w3.org/TR/2011/PR-widgets-digsig-20110811/">http://www.w3.org/TR/2011/PR-widgets-digsig-20110811/</a><a href="http://www.w3.org/TR/2011/WD-widgets-digsig-20110607/"></a></dd>

      <dt>Test Suite:</dt>
      <dd><a href="http://dev.w3.org/2006/waf/widgets-digsig/test-suite/">http://dev.w3.org/2006/waf/widgets-digsig/test-suite/</a></dd>
      <dt>Implementation Report: </dt>
      <dd><a href="http://dev.w3.org/2006/waf/widgets-digsig/imp-report/">http://dev.w3.org/2006/waf/widgets-digsig/imp-report/</a></dd>
      <dt>Editors:</dt>
      <dd><a href="http://datadriven.com.au/">Marcos C&aacute;ceres</a>, W3C Invited Expert</dd>
      <dd>Paddy Byers, Aplix Corporation</dd>
      <dd><a href="http://stuartk.co.uk/">Stuart Knightley</a>, Opera Software ASA</dd>
      <dd>Frederick Hirsch, Nokia</dd>
      <dd>Mark Priestley, Vodafone</dd>
    </dl>
    <p>Please refer to the <a href="http://dev.w3.org/2006/waf/widgets-digsig/errata.html"><strong>errata</strong></a> for this document, which may include some normative corrections.</p>
    <p>See also <a href="http://www.w3.org/2003/03/Translations/byTechnology?technology=widgets-digsig"><strong>translations</strong></a>.</p>
<p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> &copy; [YEAR] <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>&reg;</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p>
  </div>
  <hr />
  <h2 id="abstract" class="no-num no-toc">Abstract</h2>
  <p class="no-num no-toc">This document defines a profile of the <cite>XML
    Signature Syntax and Processing</cite> specification to allow a widget package to be digitally signed. Authors and distributors can digitally sign a widget as a mechanism to
    ensure continuity of authorship and distributorship. A user agent, or other validation system, can use a digital signature to verify the
    data integrity of the files within a widget package and to
    confirm the signing key(s). </p>
<h2 class="no-num no-toc" id="sotd">Status of this Document </h2>
    <p><em>This section describes the status of this document at the time of its
  publication. Other documents may supersede this document. A list of current W3C
  publications and the latest revision of this technical report can be found in the
  <a href="http://www.w3.org/TR/">W3C technical reports index</a> at
  http://www.w3.org/TR/.</em></p>
  <p>This is the [DATE] [LONGSTATUS] of the <cite>XML Digital Signatures for Widgets</cite> specification. &nbsp;</p>
  <p>This document has been reviewed by W3C Members, by software developers, and by other W3C groups and interested parties, and is endorsed by the Director as a W3C Recommendation. It is a stable document and may be used as reference material or cited from another document. W3C's role in making the Recommendation is to draw attention to the specification and to promote its widespread deployment. This enhances the functionality and interoperability of the Web.</p>
  <p>The public is encouraged
    to send comments to the WebApps Working Group's public mailing list&nbsp;<a href=
  "mailto:public-webapps@w3.org">public-webapps@w3.org</a>&nbsp;(<a href=
  "http://lists.w3.org/Archives/Public/public-webapps/">archive</a>). See&nbsp;<a href=
  "http://www.w3.org/Mail/">W3C mailing list and archive usage guidelines</a>.   </p>
<p>This document is produced by the <a href="http://www.w3.org/2008/webapps/">Web
    Applications WG</a>, part of the <a href="http://www.w3.org/2006/rwc/Activity">Rich Web
      Client Activity</a> in the W3C <a href="http://www.w3.org/Interaction/">Interaction
        Domain</a>. It is expected that this document will progress along the W3C's
  Recommendation track.</p>

  <p>This document was produced by a group operating under the <a href=
  "http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent
  Policy</a>. W3C maintains a <a href="http://www.w3.org/2004/01/pp-impl/42538/status"
  rel="disclosure">public list of any patent disclosures</a> made in connection with the
  deliverables of the group; that page also includes instructions for disclosing a
  patent. An individual who has actual knowledge of a patent which the individual
  believes contains <a href=
  "http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
  Claim(s)</a> must disclose the information in accordance with <a href=
  "http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the
  W3C Patent Policy</a>.</p>
  <h2 class="no-num no-toc" id="toc">Table of Contents</h2>
  <!--toc-->
  <h2 id="introduction">Introduction</h2>
  <p> A <span>widget package</span> can be digitally signed by an <span>author</span> to produce a <span>signature file</span> that cryptographically covers all of the files of a widget package that are not <span title="signature file">signature files</span> (e.g., HTML files, CSS files, and JavaScript files). In this specification, this kind of signature is referred to as an <span>author signature</span>. </p>
  <p>A user agent or other entity can use an <span>author signature</span> to determine:</p>
  <ul>
    <li> which entity alleges to have authored the widget, </li>
    <li>that the integrity of the
      widget is as the <span>author</span> intended,</li>
    <li>and  whether a set of 
      widgets came from the same <span>author</span>.</li>
  </ul>
  <p>A <span>widget package</span> can also be
    signed by one or more <span title="distributor">distributors</span> to produce a <span>signature file</span> that  cryptographically includes all  non-signature files as well as any <span>author
    signature</span> (if one was included). In this specification, this kind of signature is referred to as a <span>distributor signature</span>. To be clear,<span title="distributor signature">distributor signatures</span> countersign <span title="author signature">author signatures</span>, but do not countersign other <span title="distributor signature">distributor signatures</span>. Because of this, an author signature needs to  be included in a <span>widget package</span> before a <span title="distributor signature">distributor signature</span> or the <span title="algorithm to validate digital signatures">validation process</span> defined in this specification will fail. </p>
  <p>A user agent or other entity can use a <span title="distributor signature">distributor signature</span> to determine:</p>
  <ul>
    <li> that a particular
      distributor has distributed a widget package, </li>
    <li> that the integrity of the <span>widget package</span> is as the distributor intended,</li>
    <li>and  whether a set of 
      widgets came from the same <span>distributor</span>. </li>
  </ul>
  <p>The complete signing model is illustrated in <a href="#figure1">Figure 1</a>. </p>
  <div class="figure" id="figure1"> <img src="images/digsigchain.png" alt="signature chain" width="692" height="291"/>
    <div class="figcaption">This figure shows which files are signed by each kind of signature, indicated by the dashed lines and arrows. <span title="author signature">Author signatures</span> sign all the non-signature files of the <span>widget package</span> (e.g., images, sounds, HTML files, and CSS files). The <span title="distributor signature">distributor signatures</span> sign the <span>author signature</span> and all other non-signature files in the package (but not other <span title="distributor signature">distributor signatures</span>). The model  allows <span title="distributor signature">distributor signatures</span> to be removed without affecting the integrity of the <span>widget package</span> as the author intended it. This also facilitates redistribution of <span title="widget package">widget packages</span> by either complete removal of all <span title="signature file">signature files</span> or substitutions of  signatures. </div>
  </div>
  <h3 id="requirements">Design goals and requirements</h3>
  <p>This document addresses the
    following requirements from the <span>[Widgets
    Requirements]</span> document: </p>
  <ul>
    <li>
      <p><a
          href="http://www.w3.org/TR/widgets-reqs/#digital-signatures">Digital Signatures</a>: this specification relies on <span>[XMLDSIG]</span> and <span>[RFC5280]</span> to address
        this requirement.</p>
    </li>
    <li>
      <p><a href="http://www.w3.org/TR/widgets-reqs/#multiple-signatures-and-certificate-chains">Multiple Signatures and Certificate Chains</a>:  this
        specification relies on <span>[XMLDSIG]</span> and <span>[RFC5280]</span> to address this requirement. </p>
    </li>
    <li>
      <p><a href="http://www.w3.org/TR/widgets-reqs/#signature-document-format">Signature Document Format</a>: see <a href="#signature-file">signature file</a>. </p>
    </li>
    <li>
      <p><a href="http://dev.w3.org/2006/waf/widgets-reqs/#support-for-multiple-message-digest-algorithms">Support for Multiple Message Digest Algorithms</a>: this
        specification supports <a href="http://www.w3.org/TR/xmldsig-core1/#sec-SHA-256">SHA-256</a>, the <code>reference</code> element, and <code>ds:SignedInfo</code> element. </p>
    </li>
    <li>
      <p><a href="http://www.w3.org/TR/widgets-reqs/#support-for-multiple-signature-algorithms"> Support for Multiple Signature Algorithms</a>: this specification relies on the signature algorithms defined in <span>[XMLDSIG]</span>.</p>
    </li>
    <li>
      <p><a href="http://www.w3.org/TR/widgets-reqs/#key-lengths"> Key Lengths</a>: see the <span>recommended key length</span>.</p>
    </li>
    <li>
      <p><a href="http://www.w3.org/TR/widgets-reqs/#key-usage-extension">Key Usage Extension</a>: part of X.509v3.</p>
    </li>
    <li>
      <p><a href="http://www.w3.org/TR/widgets-reqs/#inclusion-of-revocation-information">Inclusion of Revocation Information</a>:  this specification
        relies on <span>[XMLDSIG]</span> and <span>[RFC5280]</span> to address this
        requirement. </p>
    </li>
  </ul>
  <h2  id="conformance">Conformance</h2>
  <p>The key words <em class="ct">MUST</em>, <em class="ct">MUST
    NOT</em>, <em class= "ct">REQUIRED</em>, <em class="ct">SHOULD</em>, <em class="ct">SHOULD NOT</em>, <em class="ct">RECOMMENDED</em>, <em
class="ct">MAY</em> and <em class="ct">OPTIONAL</em> in this
    specification are to be interpreted as described in <span>[RFC2119]</span>. </p>
  <p> As well as sections marked as <em>non-normative</em>, the examples and notes,
    and security considerations in this specification are non-normative.
    Everything else in this specification is normative. </p>
  <p>There are two classes of product that can claim conformance to this specification, a <span>signer</span> and a <span>validator</span>: </p>
  <ul>
    <li>
      <p>A <dfn>signer</dfn> is a user agent that implements <span>[XMLDSIG]</span> and digitally signs a <span>widget package</span> in a manner  that conforms to the  requirements of this specification and in a manner that conforms to the applicable generation requirements of <span>[Signature Properties]</span>. </p>
    </li>
    <li>
      <p>A <dfn>validator</dfn> is a user agent that implements <span>[XMLDSIG]</span> and validates the <span title="signature file">signature files</span> of a <span>widget package</span> in a manner  that conforms to the  requirements of this specification and in a manner that conforms to the applicable validation requirements of <span>[Signature Properties]</span>. </p>
    </li>
  </ul>
  <p class="note">Note: User agents that implement this specification are encouraged to allow
    end-users to install digital certificates. This allows the verification of
    digital signatures within the widget package for when custom root certificates are not shipped with a runtime (e.g., for beta testing purposes).</p>
  <h2 id="definitions">Definitions</h2>
  <p>As the following terms are used throughout this specification, they are gathered here for the reader's convenience. The following list of terms is not exhaustive; other terms are defined throughout this specification. </p>
  <p>A <dfn>file </dfn> is the uncompressed  representation of a physical file contained in a <span>widget package</span> (e.g., <code>config.xml</code>).</p>
  <p>A <dfn>file name</dfn> is the name of a <span>file</span> contained in
    a <span>widget package</span> (excluding path information). </p>
  <p>The <dfn>root of the widget package</dfn> is the top-most file-path
    level of the <span>widget package</span>, as defined in the <span>[Widgets Packaging]</span> specification.</p>
  <p>A <dfn>signature file</dfn> is a <a href="http://www.w3.org/TR/xmldsig-core/#def-SignatureDetached">detached</a> <span>[XMLDSIG]</span> document, likely encoded in <span>[UTF-8]</span>.  </p>
  <p>A <dfn>widget package</dfn> is a <span>[ZIP]</span> archive that conforms  to the <span>[Widgets Packaging]</span> specification.</p>
  <p>A <dfn>zip relative path</dfn> is a string that conforms to the <span>[ABNF]</span> for <code><a href="http://www.w3.org/TR/widgets/#zip-rel-path">zip-rel-path</a></code> as specified in <span>[Widgets Packaging]</span>.</p>
  <h2>Versions, namespaces, and identifiers</h2>
  <p>This specification makes use of <span>[XML-Namespaces]</span>, and uses <span>[URI]</span>s to identify resources, algorithms, and semantics.</p>
  <p>The  XML namespace for <span>[XML]</span> elements used by this specification is <code>http://www.w3.org/ns/widgets-digsig</code></p>
  <p>The <dfn>profile URI</dfn> for this specification is <code>http://www.w3.org/ns/widgets-digsig#profile</code></p>
  <p>No provision is made for an explicit version number in this
    specification.  If a future version of 
    this specification requires explicit versioning of the document
    format, a different namespace will 
    be used.</p>
  <h2 id="algorithms">Algorithms, key lengths, and certificate formats</h2>
  <p>This specification relies on a user agent's conformance to <span>[XMLDSIG]</span> for support of signature algorithms, certificate formats, canonicalization algorithms, and digest methods. As this specification is a profile of <span>[XMLDSIG]</span>, it makes a number of recommendations as to what signature algorithms should be used when signing a widget package to achieve optimum interoperability. See <a href="http://www.w3.org/TR/xmldsig-core/#sec-SignatureAlg">Signature Algorithms</a> of <span>[XMLDSIG]</span> for the list of required algorithms. </p>
  <p>The <dfn>recommended signature algorithm</dfn> is <a href="http://www.w3.org/TR/xmldsig-core/#sec-PKCS1">RSA</a> using the RSAwithSHA256 signature identifier: <a href="http://www.ietf.org/rfc/rfc4051.txt">http://www.w3.org/2001/04/xmldsig-more#rsa-sha256</a>.</p>
  <p>The <dfn>recommended key
    length</dfn>  for <a href="http://www.w3.org/TR/xmldsig-core/#sec-PKCS1">RSA</a> is 4096 bits.</p>
<p> The <dfn>recommended digest method</dfn> is <a href="http://www.w3.org/TR/xmldsig-core1/#sec-SHA-256">SHA-256</a>. </p>
  <p>The <dfn>recommended canonicalization algorithm</dfn> is <cite> Canonical XML Version 1.1 (omits comments)</cite> as defined in <span>[C14N11]</span>. The identifier for the algorithm is <a href="http://www.w3.org/2006/12/xml-c14n11">http://www.w3.org/2006/12/xml-c14n11</a>.</p>
  <p>The <dfn>recommended certificate format</dfn> is   
    X.509 version 3   as specified in <span>[RFC5280]</span>. </p>
  <h3 id="x509note">Note about X.509 data</h3>
  <p><em>This section is informative.</em></p>
  <p> A <span> signature file</span> can have   information contained
    in a <code>ds:X509Data</code> element, as specified by the <span>[XMLDSIG]</span> specification. This can include X.509 certificates, and/or
    <abbr title="Certificate Revocation List">CRL</abbr> and/or OCSP response information that, if included, are conveyed according
    to the <span>[XMLDSIG]</span> specification.  X.509 v3 certificates provide means to  
    express the basic constraints on a certificate. This allows <abbr title="Certificate Authority"><abbr title="certification authority">CA</abbr></abbr> certificates to be distinguished from end entity certificates,
    enabling more robust trust verification. See also <span>[RFC5280]</span> for more information.</p>
  <h2 id="author-signatures">Author signature</h2>
  <p>An <dfn>author signature</dfn> is a <span>signature file</span> whose <span> file name</span> adheres to the <span>naming convention for an author  
    signature</span> and whose <span>[Signature Properties]</span> <code>Role</code> element's <code>URI</code> attribute  value is equal to the <span>author role URI</span>. An <span>author signature</span> is intended to be generated by the <dfn>author</dfn> of the widget, which is the entity or entities whom claim authorship over the content of the <span>widget package</span>.</p>
  <p> A <span>widget package</span> can contain zero or
    one <span title="author signature">author signature</span>. </p>
  <dl>
    <dt><dfn>Author role URI</dfn>: </dt>
    <dd> <code>http://www.w3.org/ns/widgets-digsig#role-author</code></dd>
  </dl>
  <h3>Naming convention</h3>
  <p>The <code>author-sig-filename</code> <span>[ABNF]</span> rule defines the <dfn>naming convention for an
    author signature</dfn>, as it applies to the <span> file name</span> of the <span>author signature</span>: </p>
  <pre> <code><dfn>author-sig-filename</dfn> = %x61.75.74.68.6f.72.2d.73.69.67.6e.61.74.75.72.65.2e.78.6d.6c</code></pre>
  <p>The <code>author-sig-filename</code> rule  defines the lower-case (case-sensitive) string &quot;<code>author-signature.xml</code>&quot;.</p>
  <h2 id="distributor-signatures">Distributor signatures</h2>
  <p>A <dfn>distributor signature</dfn> is a <span> signature file</span> whose <span> file name</span> adheres
    to the <span>naming convention for a distributor 
    signature</span> and whose <span>[Signature Properties]</span> <code>Role</code> element's <code>URI</code> attribute  value is equal to the <span>distributor role URI</span>. A <span>distributor signature</span> is intended to be generated by a <dfn>distributor</dfn>, which is a third party that is distributing the widget on behalf of the author. </p>
  <p> A <span>widget package</span> can contain zero, one, or
    more <span title="distributor signature">distributor signatures</span>. </p>
  <dl>
    <dt><dfn>Distributor role URI</dfn>:</dt>
    <dd> <code>http://www.w3.org/ns/widgets-digsig#role-distributor</code> </dd>
  </dl>
  <h3>Naming convention</h3>
  <p> Each <span>distributor signature</span> has a <span>file name</span> consisting of the  lower-case
    string &quot;<code>signature</code>&quot; followed by a digit in the range
    1-9 inclusive, followed by an optional
    zero or more digits in the range 0-9 inclusive and then the lower-case
    &quot;<code title="">.xml</code>&quot;. </p>
  <p>The <code>dist-sig-filename</code> rule formally defines the <dfn>naming convention for a
    distributor signature</dfn>, as it applies to the <span> file name</span> of a <span>distributor signature</span>: </p>
  <pre><code><dfn>dist-sig-filename</dfn> = signature-string non-zero-digit 
                    *DIGIT  xml-suffix-string
signature-string  = %x73.69.67.6e.61.74.75.72.65
non-zero-digit    = %x31-39                       
xml-suffix-string = %x2e.78.6d.6c                 </code></pre>
  <ul>
    <li>
      <p>The <code>signature-string</code> rule defines the lower-case string &quot;<code>signature</code>&quot;.</p>
    </li>
    <li>
      <p>The <code>non-zero-digit</code> rule defines a digit in the
        range <code>1-9</code>, thus leading zeros are disallowed by this rule.</p>
    </li>
    <li>
      <p><code>DIGIT</code> is defined as a
        digit in the range <code>0-9</code>.</p>
    </li>
    <li>
      <p> The <code>xml-suffix-string</code> rule defines the lower-case
        (case-sensitive) string &quot;<code title="">.xml</code>&quot;.</p>
    </li>
  </ul>
  <p class="example">An example is <code>signature20.xml</code>.</p>
  <h2>Generating a digital signature </h2>
  <p id="ta-generate">To digitally sign the contents of a <span>widget package</span> with an <span>author signature</span> or  with a <span>distributor signature</span>, a <span class="product-signer">signer</span> <em class="ct">MUST</em> run the <span>algorithm to generate a digital signature</span>.  </p>
  <p>The algorithm below relies on the <a href="http://www.w3.org/TR/xmldsig-core/#sec-CoreGeneration">signature generation rules</a> of <span>[XMLDSIG]</span> (Section 3.1) and the various generation rules defined in <span>[Signature Properties]</span> (links to the appropriate sections of those specifications are provided where needed for generation). When performing the  algorithm below, it is <em class="ct">RECOMMENDED</em> that a <span class="product-signer">signer</span> use the <span>recommended canonicalization algorithm</span>, the <span>recommended signature algorithm</span>, the <span>recommended key length</span> for the appropriate algorithm, and the <span>recommended certificate format</span>. </p>
  <p>The <dfn>algorithm to generate a digital signature</dfn> is as follows: </p>
  <ol>
    <li>
      <p>Using the <a href="http://www.w3.org/TR/xmldsig-core/#sec-Processing">Processing Rules</a> of <span>[XMLDSIG]</span>, perform <a href="http://www.w3.org/TR/xmldsig-core/#sec-ReferenceGeneration">reference generation</a> for each <span>file</span> of the <span>widget package</span> that is not a <span>signature file</span>. Set the a <code>URI</code> attribute of each <code>ds:Reference</code> to be the <span>zip
        relative path</span> that identifies the <span>file</span> inside the <span>widget
        package</span>. </p>
    </li>
    <li>
      <p>Optionally,  include a <code>ds:KeyInfo</code> element in the manner described in <span>[XMLDSIG]</span> (see <a href="http://www.w3.org/TR/xmldsig-core/#sec-KeyInfo">The <code>KeyInfo</code> Element</a> for how to do this). The element can include  CRL and/or OCSP
        information <span>[RFC5280]</span> (see <a href="#x509note">note about X.509 data</a> in this specification). </p>
    </li>
    <li>
      <p>Generate the container elements for <span>[Signature Properties]</span> in accordance with the <a href="http://www.w3.org/TR/2010/WD-xmldsig-properties-20100204/#placement">Signature Properties Placement</a> section of <span>[Signature Properties]</span>. </p>
    </li>
    <li>
      <p>If generating an <span>author signature</span>, <a href="http://www.w3.org/TR/xmldsig-properties/#role-property-generation">generate a role property</a> and let its <code>URI</code> attribute value be the <span>author  role URI</span>.</p>
    </li>
    <li>
      <p>Otherwise, if generating a <span>distributor signature</span>:</p>
      <ol>
        <li>
          <p><a href="http://www.w3.org/TR/xmldsig-properties/#role-property-generation">Generate a role property</a> in the manner specified in <span>[Signature Properties]</span> and let its <code>URI</code> attribute value be the <span>distributor  role URI</span>.</p>
        </li>
        <li>
          <p>If the <span>widget package</span> contains an <span>author signature</span>, perform <a href="http://www.w3.org/TR/xmldsig-core/#sec-ReferenceGeneration">reference generation</a> on the <span>author signature</span> and set the resulting <code>ds:Reference</code> element's <code>URI</code> attribute to be <code>author-signature.xml</code>. </p>
        </li>
      </ol>
    </li>
    <li>
      <p><a href="http://www.w3.org/TR/xmldsig-properties/#identifier-property-generation">Generate an identifier property</a> in the manner specified in <span>[Signature Properties]</span>. </p>
    </li>
    <li>
      <p><a href="http://www.w3.org/TR/xmldsig-properties/#profile-property-generation">Generate a profile property</a> in the manner specified in <span>[Signature Properties]</span> whose <code>URI</code> attribute is the <span>profile URI</span>.</p>
    </li>
    <li>
      <p>Optionally, include any additional   <span>[Signature Properties]</span> (e.g., <a href="http://www.w3.org/TR/xmldsig-properties/#created-property">created</a>, <a href="http://www.w3.org/TR/xmldsig-properties/#expires-property">expires</a>, <a href="http://www.w3.org/TR/xmldsig-properties/#replay-nonce-property">replayProtect</a>) by following the appropriate generation rules specified in <span>[Signature Properties]</span>. </p>
    </li>
    <li>
      <p><a href="http://www.w3.org/TR/xmldsig-core/#sec-ReferenceGeneration">Generate a reference</a> to the <code>ds:Object</code> that contains the signature properties created in the steps above. </p>
    </li>
    <li>
      <p>Perform <a href="http://www.w3.org/TR/xmldsig-core/#sec-SignatureGeneration">signature generation</a> as defined in <span>[XMLDSIG]</span>. </p>
    </li>
    <li>
      <p>Serialize the signature 
        as a <span>[UTF-8]</span> encoded <span>[XML]</span> document using the appropriate naming convention depending on its role: using either the <span>naming convention for a distributor
        signature</span> or the <span>naming convention for an author
        signature</span>. </p>
      <p class="note">Note: It is not a requirement that the <span title="file name">file names</span> of <span title="distributor signature">distributor signatures</span> are serially numbered <code>signatures1.xml</code>, <code>signature2.xml</code>, <code>signature3.xml</code>, and so on. A <span title="signer">signer</span> can to use whatever pattern they want, so long as the file name conforms to the <span>naming convention for a distributor 
        signature</span>. The numeric part of the file name  affects the  order in which signature files are processed by a <span>validator</span> (see the <span>algorithm to locate signature files in a widget package</span>). So, to ensure that a <span>distributor signature</span> is processed before any other <span title="distributor signature">distributor signatures</span>, assign a number greater than that of all the other <span title="distributor signature">distributor signatures</span> for the numeric part of the <span title="distributor signature">distributor signature's</span> file name. </p>
    </li>
    <li>Place the generated <span>signature file</span> at the <span>root of the widget package</span>. </li>
  </ol>
  <h3>Example of a generated distributor signature</h3>
  <p><em>This section is non-normative.</em></p>
  <p>The following is an example of a <span>distributor signature</span> document, named <code>signature1.xml</code>. For legibility, the example omits the content of the various cryptographic digests and instead uses &quot;&#8230;&quot;:</p>
  <pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Signature xmlns=&quot;http://www.w3.org/2000/09/xmldsig#&quot; 
  Id=&quot;DistributorSignature&quot;&gt;
 &lt;SignedInfo&gt;
  &lt;CanonicalizationMethod 
   Algorithm=&quot;http://www.w3.org/2006/12/xml-c14n11&quot;/&gt;
  &lt;SignatureMethod
   Algorithm=&quot;http://www.w3.org/2001/04/xmldsig-more#rsa-sha256&quot;/&gt;
  &lt;Reference URI=&quot;config.xml&quot;&gt;
   &lt;DigestMethod
    Algorithm=&quot;http://www.w3.org/2001/04/xmlenc#sha256&quot;/&gt;
   &lt;DigestValue&gt;&#8230;&lt;/DigestValue&gt;
  &lt;/Reference&gt;
  &lt;Reference URI=&quot;index.html&quot;&gt;
    &lt;DigestMethod
     Algorithm=&quot;http://www.w3.org/2001/04/xmlenc#sha256&quot;/&gt;
     &lt;DigestValue&gt;&#8230;&lt;/DigestValue&gt;
  &lt;/Reference&gt;
  &lt;Reference URI=&quot;#prop&quot;&gt;
   &lt;Transforms&gt;
    &lt;Transform Algorithm=&quot;http://www.w3.org/2006/12/xml-c14n11&quot;/&gt;
   &lt;/Transforms&gt;
   &lt;DigestMethod 
    Algorithm=&quot;http://www.w3.org/2001/04/xmlenc#sha256&quot;/&gt;
   &lt;DigestValue&gt;&#8230;&lt;/DigestValue&gt;
  &lt;/Reference&gt;
 &lt;/SignedInfo&gt;
 &lt;SignatureValue&gt;&#8230;&lt;/SignatureValue&gt;
 &lt;KeyInfo&gt;
  &lt;X509Data&gt;
   &lt;X509Certificate&gt;&#8230;&lt;/X509Certificate&gt;
  &lt;/X509Data&gt;
 &lt;/KeyInfo&gt;
 &lt;Object Id=&quot;prop&quot;&gt; 
  &lt;SignatureProperties
   xmlns:dsp=&quot;http://www.w3.org/2009/xmldsig-properties&quot;&gt;
   &lt;SignatureProperty Id=&quot;profile&quot; Target=&quot;#DistributorSignature&quot;&gt;
    &lt;dsp:Profile URI=&quot;http://www.w3.org/ns/widgets-digsig#profile&quot;/&gt;
   &lt;/SignatureProperty&gt; 
   &lt;SignatureProperty Id=&quot;role&quot; Target=&quot;#DistributorSignature&quot;&gt;
    &lt;dsp:Role
      URI=&quot;http://www.w3.org/ns/widgets-digsig#role-distributor&quot;/&gt;
   &lt;/SignatureProperty&gt; 
   &lt;SignatureProperty Id=&quot;identifier&quot; Target=&quot;#DistributorSignature&quot;&gt;
    &lt;dsp:Identifier&gt;&#8230;&lt;/dsp:Identifier&gt;
   &lt;/SignatureProperty&gt; 
  &lt;/SignatureProperties&gt; 
 &lt;/Object&gt;  
&lt;/Signature&gt;</code>
</pre>
  <h2 id="signature-verification">Validating  digital signatures </h2>
  <p id="ta-validate">To validate the <span title="signature file">signature files</span> of a <span>widget package</span>, a <span class="product-validator">validator</span> <em class="ct">MUST</em> run the <span>algorithm to validate digital signatures</span>.  </p>
  <p>The algorithm below relies on the <a href="http://www.w3.org/TR/xmldsig-core/#sec-CoreGeneration">Core Validation</a> of <span>[XMLDSIG]</span>  and the various validation rules defined in <span>[Signature Properties]</span> (links to the appropriate sections of those specifications are provided where needed for validation).  This specification
    does not define the means or format of a failure notification: handling of  signatures that are <dfn>in error</dfn> is left up to the implementation. The reason for validation failure can be returned by the implementation to an external
    entity, 
    including reasons   
    related to Reference validation, Signature validation, Signature  
    Property validation and/or certificate and CRL/OCSP verification.  The decision of which (if any) <span title="distributor signature">distributor signatures</span> are to 
    be validated and whether the <span>author signature</span> is
    validated is out of scope of this specification. This <em class="ct">MAY</em> be
    determined by the security policy used by the <span class="product-validator">validator</span>. </p>
  <p>During <span title="algorithm to validate digital signatures">validation</span>, a user agent <em class="ct">MAY</em> treat a widget package as being <span>in error</span> if it deems that the key length for a signature algorithm to is not large enough to be secure (e.g., under 2048 bits for <a href="http://www.w3.org/TR/xmldsig-core/#sec-PKCS1">RSA</a> and <a href="http://www.w3.org/TR/xmldsig-core/#sec-DSA">DSA</a>). </p>
  <p>The <dfn>algorithm to validate digital signatures</dfn> is as follows: </p>
  <ol>
    <li>
      <p>Let <var>signatures list</var> be the result of applying the <span>algorithm to locate signature files in a widget package</span>. </p>
    </li>
    <li>
      <p>If the <var>signatures list </var> is  empty (meaning no <span title="signature file">signature files</span> were found in the widget package), terminate this algorithm
        and treat the widget package as an unsigned widget package:   It is left up to the user agent to decide how to treat unsigned widget packages.</p>
    </li>
    <li>
      <p>For each <var>signature</var> in <var>signatures list</var>:</p>
      <ol>
        <li>
          <p>If <var>signature</var> is not a valid <span>[XMLDSIG]</span> document,  then <var>signature</var> is <span>in error</span>. </p>
        </li>
        <li>
          <p>Check that <var>signature</var> has a <code>ds:Reference</code> for every <span>file</span> that is not a <span>signature file</span>. If any non-signature file is not listed, then <var>signature</var> is <span>in error</span>. </p>
        </li>
        <li>
          <p> Check that <var>signature</var> has a single same-document <code>ds:Reference</code> to a <code>ds:Object</code> container for <span>[Signature Properties]</span> in accordance with the Signature Properties Placement section of <span>[Signature Properties]</span>.</p></li>
        <li>
          <p>Optionally, if the ds:Signature's key length for a given signature algorithm (e.g., <a href="http://www.w3.org/TR/xmldsig-core/#sec-PKCS1">RSA</a>) is less than a user agent predefined minimum key length, then <var>signature</var> is <span>in error</span>.</p>
        </li>
        <li>
          <p><a href="http://www.w3.org/TR/xmldsig-properties/#profile-property-generation">Validate the profile property</a> against the <span>profile URI</span> in the manner specified in <span>[Signature Properties]</span>. If the <a href="http://www.w3.org/TR/xmldsig-properties/#profile-property">profile property</a> is missing  or invalid,   then <var>signature</var> is <span>in error</span>. </p>
        </li>
        <li>
          <p><a href="http://www.w3.org/TR/xmldsig-properties/#identifier-property-generation">Validate the identifier property</a> in the manner specified in <span>[Signature Properties]</span>. If the <a href="http://www.w3.org/TR/xmldsig-properties/#identifier-property">identifier property</a> is missing or or invalid,   then <var>signature</var> is <span>in error</span>. </p>
        </li>
        <li>
          <p>If <var>signature</var>'s <span>file name</span> matches the <span>naming convention for an author signature</span>, <a href="http://www.w3.org/TR/xmldsig-properties/#role-property-validation">validate the role property</a> against the <span>author role URI</span>. If the <a href="http://www.w3.org/TR/xmldsig-properties/#role-property">role property</a> is missing or or invalid,   then <var>signature</var> is <span>in error</span>. </p>
</li>
        <li>
          <p>Otherwise, if <var>signature</var>'s <span>file name</span> matches the <span>naming convention for a distributor signature</span>:</p>
          <ol>
            <li>
              <p><a href="http://www.w3.org/TR/xmldsig-properties/#role-property-validation">Validate the role property</a> against the <span>distributor role URI</span>. If the <a href="http://www.w3.org/TR/xmldsig-properties/#role-property">role property</a> is missing or or invalid,   then <var>signature</var> is <span>in error</span>.</p>
            </li>
            <li>
              <p>If an <span>author signature</span> is present in the widget package, verify that <var>signature</var> has a <code>ds:Reference</code> for the <span>author signature</span>. </p>
            </li>
          </ol>
        </li>
        <li>
          <p>Optionally, validate any other <span>[Signature Properties]</span> supported by the user agent in  the manner specified in <span>[Signature Properties]</span>.</p>
        </li>
        <li>
          <p>Perform <a href="http://www.w3.org/TR/xmldsig-core/#sec-ReferenceValidation">reference validation</a> and <a href="http://www.w3.org/TR/xmldsig-core/#sec-SignatureValidation">signature validation</a> on <var>signature</var>. If validation fails, then <var>signature</var> is <span>in error</span>. </p>
        </li>
      </ol>
    </li>
    <li>
      <p>If all <var>signatures</var> validate successfully, treat this as a  signed widget package.  It is left up to the user agent to decide how to treat singed widget packages.</p>
    </li>
  </ol>
  <h2>Locating signature files in a widget package </h2>
  <p>The <dfn>algorithm to locate signature files in a widget package</dfn> is as follows. This algorithm makes use of the concept of <dfn>numerical order</dfn>, which is the order based on the numeric portion of a <span title="distributor signature">distributor signature's</span> <span>file name</span>. 
    Thus in the case more than one <span>distributor signature</span> is to be
    processed, the highest numbered distributor signature is 
    ordered first. </p>
  <ol>
    <li>
      <p>Let <var>signatures</var> be an empty list. </p>
    </li>
    <li>
      <p>For each <span>file</span> at the <span>root of the widget package</span>, if the <span>file name</span> case-sensitively matches the <span>naming convention for a distributor
        signature</span> then append this <span>file</span> to the <code>signatures</code> list. </p>
    </li>
    <li>
      <p>If the <var>signatures</var> list is not empty,
        sort the list of <code>signatures</code> by the <span>file name</span> in ascending <span>numerical order</span>.</p>
      <p class="example">For example, <code>signature1.xml</code> followed by <code>signature2.xml</code> followed by <code>signature3.xml</code> and so on. As another  example, <code>signature9.xml</code> followed by <code>signature44.xml</code> followed by <code>signature122134.xml</code> and so on. </p>
    </li>
    <li>
      <p>Search the <span>root of the widget package</span> for any <span>file name</span> that case-sensitively matches the <span>naming convention for an author
        signature</span> and then append this <span>file</span> to the <code>signatures</code> list. </p>
    </li>
    <li>Return <var>signatures</var>.</li>
  </ol>
  <h2  id="security-considerations">Security Considerations</h2>
  <p><em>This section is non-normative.</em> </p>
  <p>In addition to the security considerations described in this section, the <a href="http://www.w3.org/TR/xmldsig-core/#sec-Security">Security Considerations</a> of <span>[XMLDSIG]</span> apply to this specification. In addition, the security considerations of [Widget Packaging] also apply to this specification. </p>
  <p>The signature scheme described in this document deals with the
    content present inside a potentially compressed <span>widget package</span>. This implies that,
    in order to verify a <span>signature file</span>, a user agent needs to
    decompress a data stream that can come from an arbitrary source.  </p>
  <p>Care needs to be taken to avoid resource exhaustion attacks through
    maliciously crafted widget packages during signature validation.  </p>
  <p> Because there is no single <span>signature file</span> that includes all
    files of a widget package, 
    including all of the signature files, 
    
    this leaves a <span>widget package</span> subject to an  
    attack where <span title="distributor signature">distributor signatures</span> can be removed or added. An <span>author signature</span> could also be attacked by removing the signature
    and any <span title="distributor signature">distributor signatures</span>, if they are present.
    A signature file can also be renamed, 
    which can affect the order in which
    distributor signatures are processed. </p>
  <p>  If the user agent supports installing a new root certificate, an end-user should be made aware of what they are doing, and   
    why. </p>
  <p>A user agent's security policy can affect how
    signature validation 
    impacts operation, and can<em class="ct"></em> have additional constraints on
    establishing trust, including additional requirements on certificate
    chain validation and certificate revocation processing using CRLs <span>[RFC5280]</span> or 
    OCSP <span>[RFC2560]</span>. Security policy can also require additional information to be conveyed in <code>ds:KeyInfo</code>. Security policy is out of scope of this specification
    but has important implications for signature file processing. </p>
  <h2 id="acknowledgements" class="no-num">Acknowledgements</h2>
  <p>The Web Applications working group would like to thank members of
    the <a href="http://www.w3.org/2008/xmlsec/">W3C XML Security Working Group</a> for their comments and suggestions,
    as well as all reviewers of  drafts of this document. </p>
  <h2 id="references" class="no-num">Normative References</h2>
  <dl class="bibliography">
    <dt><dfn id="abnf">[ABNF]</dfn></dt>
    <dd><a
  href="http://www.ietf.org/rfc/rfc5234.txt">RFC 5234. <cite>Augmented BNF 
      for Syntax Specifications: <abbr title="Augmented
                Backus-Naur Form">ABNF</abbr></cite></a>, IETF. </dd>
    <dt><dfn id="c14n11">[C14N11]</dfn></dt>
    <dd><a
     href="http://www.w3.org/TR/xml-c14n11/">Canonical XML Version 1.1</a>, W3C.</dd>
    <dt><dfn>[RFC2119]</dfn></dt>
    <dd><cite><a href="http://www.ietf.org/rfc/rfc2119">Key words for use in RFCs to Indicate
      Requirement Levels</a></cite>, IETF.</dd>
    <dt><dfn>[RFC5280]</dfn></dt>
    <dd><cite><a href="http://www.ietf.org/rfc/rfc5280.txt"> Internet
      X.509 Public Key Infrastructure Certificate and Certificate Revocation
      List (CRL) Profile</a></cite>,
      IETF.</dd>
    <dt><dfn>[UTF-8]</dfn></dt>
    <dd><cite><a href="http://www.ietf.org/rfc/rfc2279.txt">UTF-8, a transformation format of ISO 10646</a></cite>, IETF. </dd>
    <dt><dfn>[URI]</dfn></dt>
    <dd><cite><a href="http://www.ietf.org/rfc/rfc3986.txt">Uniform Resource Identifiers (URI): Generic
      Syntax</a></cite>, IETF. </dd>
    <dt><dfn>[Widgets Packaging]</dfn></dt>
    <dd><cite><a href="http://www.w3.org/TR/widgets/">Widget Packaging and Configuration</a></cite>, 
      W3C. </dd>
    <dt><dfn>[XML]</dfn></dt>
    <dd><cite><a href="http://www.w3.org/TR/REC-xml/">Extensible Markup Language</a></cite>, W3C.</dd>
    <dt><dfn>[XML-Namespaces]</dfn></dt>
    <dd> <cite> <a
        href="http://www.w3.org/TR/xml-names/">Namespaces
      in XML</a></cite>, W3C.</dd>
    <dt><dfn>[XMLDSIG]</dfn></dt>
    <dd> <cite><a href="http://www.w3.org/TR/xmldsig-core1/">XML Signature Syntax and 
      Processing</a></cite>,  W3C.</dd>
    <dt><dfn>[Signature Properties]</dfn></dt>
    <dd> <cite><a
          href="http://www.w3.org/TR/xmldsig-properties/">XML Signature Properties</a></cite> (Work in progress), W3C.</dd>
    <dt><dfn>[ZIP]</dfn></dt>
    <dd><cite><a
    href="http://www.pkware.com/documents/casestudies/APPNOTE.TXT">.ZIP File
      Format Specification</a></cite>, PKWare Inc.</dd>
  </dl>
  <h2 id="references2" class="no-num">Informative References</h2>
  <dl class="bibliography">
    <dt><dfn>[RFC2560]</dfn></dt>
    <dd><cite><a href="http://www.ietf.org/rfc/rfc2560.txt">X.509 Public Key Infrastructure  Online Certificate Status Protocol - OCSP</a></cite>, IETF. </dd>
    <dt><dfn>[Widgets Requirements]</dfn></dt>
    <dd><cite><a href="http://www.w3.org/TR/widgets-reqs/">Widgets 
      Requirements</a></cite>, W3C. </dd>
  </dl>
  
</div>
</body>
</html>
